(window.multistep_editor_jsonpFunction=window.multistep_editor_jsonpFunction||[]).push([[21],{918:function(t,e){t.exports='<style>\n  :host {\n    width: 100%;\n    height: 100%;\n  }\n</style>\n\n<iframe id="frameID" width="100%" height="100%" style="border: none"></iframe>\n'},948:function(t,e,i){"use strict";i.r(e),i.d(e,"AuWidgetDataDrivenEditor",function(){return d}),i.d(e,"widget",function(){return d});var s=i(0),a=i(172),n=i(1),r=i(918),o=i(6);let d=class extends a.c{constructor(){super(),this.previewUrls=[],this.script="",this.styles="",this._initIFrame=this._initIFrame.bind(this),this.resourcesPromise=this._loadResources()}async exportWidgetData(t){return{design:{designId:this.stateId,isPrivateDesign:!0,designPath:this.params.config.design.designPath,dataSetId:this.params.config.design.dataSetId},access:{userId:this.params.config.access.userId}}}async restoreWidgetFromData(t,e){this._isRestoring=!0;const i=Object.assign({},this.params.config,t);this.stateId=t.design.designId,this.userId=t.access.userId,await this.setEditorConfig(i),this._isRestoring=!1,this.emitChange()}updateParams(t,e){}async updateParamsAsync(t,e){if(await super.updateParamsAsync(t,e),await this.resourcesPromise,t.config&&!this._isEditorInited&&(await this._initIFrame(t.config.api.designAtoms,t.config.access.tenantId,t.config.settings.allowManipulations),this._isEditorInited=!0),this._element=await this._itemPromise(),t.config){let e=t.config.access.userId;const i=o.a.parseJwt(t.config.access.token);try{const t=i.UserId;void 0!==t&&e.toString()!==t.toString()&&(e=t)}catch(t){}this.userId=e;const s=Object.assign({},t.config,{userId:e});this.setEditorConfig(s),this._element.$isValid.subscribe(t=>{this.isValid=t,this.emitChange()})}}async setEditorConfig(t){await this._element.setEditorConfig(t)}async createPdfPreview(t){t=t||this.params.config.renderer;try{return this.pdfUrl=await this._element.getPdfPreview(t),this.emitChange(),this.pdfUrl}catch(t){return this.showToast("Error: can't create pdf file."),""}}async createPreview(t){t=t||this.params.config.renderer;try{const{width:t,height:e}=this.params.config.preview;return this.previewUrls=await this._element.getPreview(this.stateId,t,e),this.emitChange(),this.previewUrls}catch(t){return this.showToast("Error: can't create preview images."),[]}}async createIdStr(){return this.idStr=await this._element.getIdString(),this.emitChange(),this.idStr}async saveProduct(){this.stateId=await this._element.save();const{width:t,height:e}=this.params.config.preview;this.previewUrlLink=await this._element.getPreviewLink(this.stateId,t,e),this.emitChange()}_itemPromise(){return new Promise(t=>{if(this._element)t(this._element);else{const e=()=>{setTimeout(async()=>{if(this._iframeDoc){const e=this._iframeDoc.getElementById("dd-editor");e&&(window.Aurigma=Object.assign(window.Aurigma,this._iframeWin.contentWindow.Aurigma),t(e))}this._element||e()},200)};e()}})}async _loadResources(){const t=Date.now(),e=`${o.a.getPatchedUrl("static/data-driven-editor/script.html")}?t=${t}`,i=`${o.a.getPatchedUrl("static/data-driven-editor/style.html")}?t=${t}`,[s,a]=await Promise.all([o.a.loadHtml(e),o.a.loadHtml(i)]);this.script=s.replace("TextWhizzJS.wasm",`${o.a.getPatchedUrl("static/data-driven-editor/TextWhizzJS.wasm")}`),this.styles=a.replace("bo-icons.woff",`${o.a.getPatchedUrl("static/data-driven-editor/bo-icons.woff")}`),this.styles=a.replace("bo-icons.woff2",`${o.a.getPatchedUrl("static/data-driven-editor/bo-icons.woff2")}`)}async _initIFrame(t,e,i){const s=this.querySelectorShadow("#frameID"),a=s||s.contentWindow,n=s.contentDocument||a.document;n.write('<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap" rel="stylesheet" />'),n.write('<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />'),n.write(this.script),n.write(this.styles),n.write("<style> .mat-button-toggle-button { height: 100%; } </style>"),n.write(`\n      <script>\n        window[Symbol.for("viewerConfig")] = {\n          rulerEnabled: false,\n          frontEndTextRenderingEnabled: true,\n          canvasBackground: { color: "#ffffff" },\n          backendUrl: "${t}/api/atoms/v1/tenants/${e}",\n        }\n      <\/script>\n    `),n.write(`\n      <script>\n        window[Symbol.for("textEditor")] = {\n          useSimpleFontList: false,\n          mode: ${i?2:0} \n        };\n      <\/script>\n    `),n.write('<div style="width:100%; height:100%">\n          <au-data-driven-editor id="dd-editor"></au-data-driven-editor>\n      </div>'),this._iframeDoc=n,this._iframeWin=a}};d=Object(s.b)([Object(n.a)("au-widget-data-driven-editor",r),Object(s.d)("design:paramtypes",[])],d)}}]);