(window.multistep_editor_jsonpFunction=window.multistep_editor_jsonpFunction||[]).push([[17],{511:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(176),i=n(453),o=function(){function e(){}return Object.defineProperty(e,"iframeApiPromise",{get:function(){return this._iframeApiSubject.pipe(Object(i.a)(1)).toPromise()},enumerable:!1,configurable:!0}),e.loadCCScript=function(e,t){var n=this;if("undefined"!=typeof CustomersCanvas||document.body.querySelector("#CcIframeApiScript"))"undefined"!=typeof CustomersCanvas&&this._iframeApiSubject.next(CustomersCanvas);else{this._iframeApiSubject=new r.a(1);var i=document.createElement("script");i.type="text/javascript",i.id="CcIframeApiScript",i.onload=function(e){CustomersCanvas&&n._iframeApiSubject.next(CustomersCanvas)},i.onerror=function(e){n._iframeApiSubject.error(e)},i.src=e+t,document.body.appendChild(i)}return this.iframeApiPromise},e._iframeApiSubject=new r.a(1),e}()},512:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(0),i=n(513),o=n(31),s=n(753),a=n(6),c=n(593),u=n(68),l=function(){function e(e,t,n){void 0===n&&(n=function(){return Promise.resolve()}),this._lastJobKey="init",this._lastExecutedJobSubject=new i.BehaviorSubject("init"),this._commands=e,this._onJobFinish=n,this.logger=new u.Category("command-executer_"+t)}return e.prototype.executeActions=function(e,t,n){var i=this,s=function(a){return Object(r.b)(i,void 0,void 0,function(){var i,c,u,l,d,f,h;return Object(r.e)(this,function(r){switch(r.label){case 0:if(this.logger.debug(function(){return"Execute '"+a+"'"}),i=Promise.resolve(),!(c=this._commands[a])||void 0===c.execute)return[3,5];if(i=c.execute(e[a],n[a]),!(u=e[a].after)&&Array.isArray(e[a])&&(l=e[a].find(function(e){return e.after}))&&(u=l.after),void 0===u)return[3,4];Object(o.a)(u)||(u=[u]),d=function(e,t,n){var r=n.indexOf(e);return n.indexOf(t)>r},f=0,r.label=1;case 1:return f<u.length?(h=u[f],d(a,h,t)?[3,3]:[4,i]):[3,4];case 2:r.sent(),i=s(h),r.label=3;case 3:return f++,[3,1];case 4:return[3,6];case 5:console.warn("Action "+a+" is not supported! Double check the config."),r.label=6;case 6:return[2,i]}})})},c=this.getJobReady(this._lastJobKey),u=this._lastJobKey=a.a.guid();return c.then(function(){return i.logger.debug(function(){return"Start actons: "+t}),a.a.recursiveJobPromise(t,s)}).then(function(){return i._onJobFinish()}).finally(function(){i.logger.debug(function(){return"End actons: "+t}),i._lastExecutedJobSubject.next(u)})},e.prototype.getJobReady=function(e){return this._lastExecutedJobSubject.pipe(Object(c.filter)(function(t){return t===e}),Object(c.take)(1)).toPromise()},e.prototype.getChangedActions=function(e,t){var n=Object.keys(e).filter(function(t){return a.a.isObjectNotEmpty(e[t])}).filter(function(n){return void 0===t[n]||(r=e[n],i=t[n],!(JSON.stringify(r)===JSON.stringify(i)));var r,i}),r=n.indexOf("actionsErrorToast");return-1!==r&&n.splice(r,1),n.indexOf("initial")>-1?["initial"].concat(Object(s.a)(n,"initial")):n},e}()},761:function(e,t){e.exports="<style>\n    :host {\n        width: 100%;\n        height: 100%;\n        display: block;\n        position: relative;\n    }\n\n    #editorFrame {\n        position: absolute;\n        height: 1px;\n        min-height: 100%;\n        width: 1px;\n        min-width: 100%;\n        top: 0;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        border: none;\n        background-color: transparent;\n    }\n</style>\n<iframe id='editorFrame' allowfullscreen></iframe>"},960:function(e,t,n){"use strict";n.r(t),n.d(t,"AuWidgetCanvas",function(){return R}),n.d(t,"widget",function(){return R});var r,i=n(0),o=n(761),s=n(172),a=n(178),c=n(453),u=(function(){}(),function(){return function(e){Object.assign(this,e)}}()),l=(function(){}(),function(){}(),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._customersCanvasSubject=new a.ReplaySubject(1),t}return Object(i.d)(t,e),t.prototype.customersCanvasPublish=function(e){this._customersCanvasSubject.next(e)},Object.defineProperty(t.prototype,"customersCanvasObservable",{get:function(){return this._customersCanvasSubject.asObservable()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"customersCanvasPromise",{get:function(){return this.customersCanvasObservable.pipe(Object(c.a)(1)).toPromise()},enumerable:!1,configurable:!0}),t.prototype.__methodExecuter=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=new RegExp(/^async function\s*\(\s*([^)]*)\s*\)\s*=>\s*/),s=Array.from(arguments);if(null!==function(e){return Object(i.b)(t,void 0,void 0,function(){return Object(i.e)(this,function(t){return console.log(e),[2]})})}.toString().match(o)){s[0]=function(e,t){var n=e.toString(),r=n.match(o);if(r){var i=r[1];n=n.replace(o,"async ("+i+") => ")}return"\n                var execFunc = ("+n+");\n                var args = "+JSON.stringify(t.map(function(e){return JSON.stringify(e)}))+";\n                var parseParam = function(params) {\n                    if (Array.isArray(params)) { \n                        return params.map(function(x) { return JSON.parse(x); })\n                    } else {\n                        return [params];\n                    }\n                }; \n                execFunc.apply(null, parseParam(args))"}(s[0],n)}var a=null;try{a=arguments.callee.caller}catch(e){a="function"==typeof arguments[0]?arguments[0]:void 0}var c=a?a.name:"unknown function";return this.customersCanvasPromise.then(function(e){return e.eval.apply(e,s)}).catch(function(e){if(console.error(e),!c&&a)for(var n in t)if(t.hasOwnProperty(n)&&a===t[n]){c=n;break}throw"Failed to call "+c})},t.prototype.getReady=function(){var e=this,t=function(){var e=spEditor.getCanvasViewer().get_canvas().get_layers().toArray().filter(function(e){return e._visible}),t=[].concat.apply([],Object(i.i)(e.map(function(e){return e.get_vObjects().toArray().filter(function(e){return e.isVisible()&&!e.get_ready()})})));return t.map(function(e){return new Promise(function(t){try{e.add_ready(function n(){e.remove_ready(n),t()})}catch(e){t()}})}),Promise.all(t)};return this.customersCanvasPromise.then(function(){return e.__methodExecuter(t)}).then(function(){return new Promise(function(e){window.setTimeout(e,100)})})},t.prototype.getCanvasItemModel=function(e){return Object(i.b)(this,void 0,void 0,function(){var t,n;return Object(i.e)(this,function(r){switch(r.label){case 0:return t=function(e){var t=JSON.parse(e),n=spEditor.productHandler.getAllItems().find(function(e){return e.id===t.id});if(n||(n=spEditor.productHandler.getAllItems().find(function(e){return e.name===t.name})),n){var r={id:n.id,name:n.name};switch(!0){case n instanceof CustomersCanvas.Model.PlaceholderItem&&null!==n.content&&void 0!==n.content&&n.content instanceof CustomersCanvas.Model.ImageItem&&!(n.content instanceof CustomersCanvas.Model.BarcodeItem)&&null!==n.content.tags.sourceData&&void 0!==n.content.tags.sourceData:var i=n.parentContainer.parentComponent.parentSurface.name,o=n.getTransformedRectangle(),s=n.content.getTransformedRectangle(),a=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math,c=a.normalizeAngle(s.Angle-o.Angle),u=s.clone(),l=o.clone();u.rotateAt(a.normalizeAngle(-u.Angle),l.get_center()),l.Angle=0;var d=spEditor.productHandler.product.getCurrentSurface().getPrintAreas()[0],f=spEditor.configuration.renderingConfig.getHiResRendering(d),h=n.content;r.tags=angular.copy(h.tags),r.value=h.tags.sourceData.name,r.surfaceName=i,r.placeholderContent={originalUrl:h.tags.sourceData.originalUrl+"?x-cctoken="+spEditor.configuration.tokenId,width:h.source.width,height:h.source.height,placeholderRectangle:o,contentRectangle:s,placeholderRectangleWithoutAngle:l,contentRectangleWithoutPlaceholderAngle:u,contentAngle:c,dpi:f.dpi};break;case n instanceof CustomersCanvas.Model.PlaceholderItem&&n.content&&n.content instanceof CustomersCanvas.Model.ImageItem:i=n.parentContainer.parentComponent.parentSurface.name;r={name:n.name,tags:angular.copy(n.tags),surfaceName:i};break;case n instanceof CustomersCanvas.Model.BaseTextItem&&!!n.text:var p=n,m="",g=function(e){return(e/255).toFixed(7)};p.color instanceof Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor?m="rgb("+p.color.R+","+p.color.G+","+p.color.B+","+g(p.color.A)+")":p.color instanceof Aurigma.GraphicsMill.AjaxControls.VectorObjects.CmykColor&&(m="cmyk("+g(p.color.C)+","+g(p.color.M)+","+g(p.color.Y)+","+g(p.color.K)+","+g(p.color.A)+")"),r={name:n.name,value:p.text,color:m,font:{postScriptName:p.font.postScriptName,size:p.font.size,fauxBold:p.font.fauxBold,fauxItalic:p.font.fauxItalic}}}return n.contentPermissions&&n.contentPermissions.imagePermissions&&(r.contentPermissions={imagePermissions:{allowChangeImage:n.contentPermissions.imagePermissions.allowChangeImage,allowEditImage:n.contentPermissions.imagePermissions.allowEditImage}}),n.placeholderPermissions&&(r.placeholderPermissions={allowEditContent:n.placeholderPermissions.allowEditContent,showHandleButton:n.placeholderPermissions.showHandleButton,showSelectButton:n.placeholderPermissions.showSelectButton}),n.visualizationPermissions&&(r.visualizationPermissions={noPrint:n.visualizationPermissions.noPrint,noShow:n.visualizationPermissions.noShow}),null!==n.locked&&(r.locked=n.locked),r}},[4,this.__methodExecuter(t,JSON.stringify(e))];case 1:return n=r.sent(),this.fireChangeItemEvent(n),[2,new u(n)]}})})},t}(s.c)),d=function(){return function(e){this.widget=e}}(),f=(function(){}(),function(){return function(e,t,n){this.definition=e,this.surfaceIndex=t,this.all=n}}());!function(e){e.canvas="canvas",e.config="config"}(r||(r={}));var h=n(44),p=n(6),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),t.prototype.execute=function(e,t){return Object(i.b)(this,void 0,void 0,function(){var n,o,s,a,c,u=this;return Object(i.e)(this,function(l){switch(l.label){case 0:return this.widget.modifiedItem&&this.widget.updateModifiedItem({}),n=function(e){var t="number"==typeof e.sourceSurfaceIndex?spEditor.productHandler.product.getSurfaces()[e.sourceSurfaceIndex]:spEditor.productHandler.product.getCurrentSurface(),n={canvasSourceRectangleSize:{width:t.width,height:t.height}},r=t.getPrintAreas()[0].items,i=r.filter(function(e){return e.parentContainer.name===CustomersCanvas.Configuration.MAIN_CONTAINER_NAME}),o=CustomersCanvas.Configuration.getProductSerializer();if(n.rawMainItems=i.map(function(e){return JSON.parse(o.serializeModelComponent(e))}),!e.removeBackground){var s=r.filter(function(e){return e.parentContainer.name===CustomersCanvas.Configuration.BG_CONTAINER_NAME});s.forEach(function(e){return e.itemPermissions.allowRemoveOnLayoutChange=!1}),n.rawBgItems=s.map(function(e){return JSON.parse(o.serializeModelComponent(e))})}return n},o=function(e,t,n){return Object(i.b)(u,void 0,void 0,function(){var r,o,s,a,c,u;return Object(i.e)(this,function(i){switch(i.label){case 0:return r=function(){return"number"==typeof n&&(!(n<0||n>=spEditor.productHandler.product.getSurfaces().length)||(console.error("deSerializeSurface: surfaceIndex is out of boundaries."),!1))}()?spEditor.productHandler.product.getSurfaces()[n]:spEditor.productHandler.product.getCurrentSurface(),o=r.getPrintAreas()[0],s=o.getContainers(),a=s.find(function(e){return e.name===CustomersCanvas.Configuration.MAIN_CONTAINER_NAME}),c=s.find(function(e){return e.name===CustomersCanvas.Configuration.BG_CONTAINER_NAME}),u=function(e,t,n){void 0===n&&(n=[]);var r=CustomersCanvas.Configuration.getProductSerializer(),i=e.map(function(e){return r.productParser.parseItem(e)});t.setItems(n.concat(i)),spEditor.productHandler._subscribeToItemEvents(i)},t.discardChanges?(u(e.rawMainItems,a),[3,3]):[3,1];case 1:return e.data=e.rawMainItems.concat(e.rawBgItems||[]),[4,spEditor.widgetsController.addLayoutItems(e)];case 2:i.sent(),i.label=3;case 3:return t.removeBackground||u(e.rawBgItems||[],c,c.getItems()||[]),spEditor.productHandler.updateView(),spEditor.productHandler.getProductUpdateEvent().fire(),[2,spEditor.getCanvasViewer().get_canvas().waitWebServiceCalls()]}})})},[4,this.widget.customersCanvasPromise];case 1:return s=l.sent(),a=e.map(function(e,t){return new f(e.data,t,e)}).filter(function(e,n){return h.Maybe.maybe(t).map(function(t){return t[e.surfaceIndex]}).caseOf({just:function(t){return JSON.stringify(e.all)!==JSON.stringify(t)},nothing:function(){return!0}})}),c=function(e){return Object(i.b)(u,void 0,void 0,function(){var t,a,c,u,l,d,f,m,g,v,b,C,y=this;return Object(i.e)(this,function(i){switch(i.label){case 0:switch(e.definition||console.warn("changeLayout: skipping because definition = null"),t=null,typeof(a=e.definition)){case"string":t=a;break;case"object":t={surfaces:[a]};break;default:console.error("changeLayout: Unexpected data type of "+JSON.stringify(a))}return c=p.a.createNodeFromString('<iframe style="position:fixed;top:-1000px;left:-1000px;z-index:0;opacity:0;max-width:0;max-height:0;display:block"></iframe>'),document.body.appendChild(c),u=h.Maybe.maybe(this.widget.params).map(function(e){return e.initial}).map(function(e){return e.editorConfig}),[4,CustomersCanvas.IframeApi.loadEditor(c,t,{initialMode:u.caseOf({just:function(e){return e.initialMode},nothing:function(){return CustomersCanvas.IframeApi.Configuration.ModelMode.Simple}}),restoreProductOnReloadEnabled:!1,preloader:{enabled:!1},rendering:{hiResOutputDpi:300},userId:u.caseOf({just:function(e){return e.userId},nothing:function(){return"default"}})})];case 1:if(l=i.sent(),!p.a.isNotNullOrUndefined(e.all.dimesions))return[3,4];switch(d=void 0,f=void 0,m=void 0,g=void 0,r[e.all.dimesions]){case r.config:d=l,f=s,m=0,g=e.surfaceIndex;break;case r.canvas:default:d=s,f=l,m=e.surfaceIndex,g=0}return[4,this.getSurfaceDimension(d,m)];case 2:return v=i.sent(),[4,this.setSurfaceDimension(f,v,g)];case 3:i.sent(),i.label=4;case 4:return[4,l.eval(n,e.all,e.surfaceIndex)];case 5:return b=i.sent(),[4,s.eval(o,b,e.all,e.surfaceIndex)];case 6:return i.sent(),[4,this.getSurfaceRenderingConfig(l)];case 7:return C=i.sent(),[4,this.setSurfaceRenderingConfig(s,C,e.surfaceIndex)];case 8:return i.sent(),[4,h.Maybe.maybe(e.all).map(function(e){return e.viewerSettings}).caseOf({just:function(e){return y.widget.applyViewerSettings(e)},nothing:function(){return y.widget.customersCanvasPromise}})];case 9:return i.sent(),document.body.removeChild(c),[2]}})})},[4,p.a.recursiveJobPromise(a,c)];case 2:return l.sent(),[4,this.widget.replaceInterpolationPlaceholder()];case 3:return l.sent(),[2,this.widget.getReady()]}})})},t.prototype.getSurfaceDimension=function(e,t){return Object(i.b)(this,void 0,void 0,function(){return Object(i.e)(this,function(n){return[2,e.eval(function(e){var t=spEditor.model.product,n=t.getCurrentSurface();return"number"==typeof e&&(e<0||e>=t.getSurfaces().length?(console.warn("getSurfaceDimensions: surfaceIndex is out of boundaries."),n=t.getCurrentSurface()):n=t.getSurfaces()[e]),{width:n.width,height:n.height}},t).catch(function(e){console.log("Sorry for a failure"),console.log(e)})]})})},t.prototype.setSurfaceDimension=function(e,t,n){return Object(i.b)(this,void 0,void 0,function(){return Object(i.e)(this,function(r){return[2,e.eval(function(e){var t=spEditor.model.product,r=t.getCurrentSurface();"number"==typeof n&&((n<0||n>=t.getSurfaces().length)&&console.error("setSurfaceDimensions: surfaceIndex is out of boundaries."),r=t.getSurfaces()[n]);var i=r.getPrintAreas()[0];r.width=e.width,r.height=e.height,i.bounds.Width=r.width,i.bounds.Height=r.height},t).catch(function(e){console.log("Sorry for a failure"),console.log(e)})]})})},t.prototype.getSurfaceRenderingConfig=function(e,t){return Object(i.b)(this,void 0,void 0,function(){return Object(i.e)(this,function(n){return[2,e.eval(function(e){var t=spEditor.model.product,n=t.getCurrentSurface();"number"==typeof e&&(e<0||e>=t.getSurfaces().length?console.error("getSurfaceRenderingConfig: surfaceIndex is out of boundaries."):n=t.getSurfaces()[e]);var r=spEditor.configuration.renderingConfig.perSurfacePartialConfigs[n.name];return Object.assign({},r)},t).catch(function(e){console.log("Sorry for a failure"),console.log(e)})]})})},t.prototype.setSurfaceRenderingConfig=function(e,t,n){return Object(i.b)(this,void 0,void 0,function(){return Object(i.e)(this,function(r){return[2,e.eval(function(e,t){var n=spEditor.model.product,r=n.getCurrentSurface();"number"==typeof t&&(t<0||t>=n.getSurfaces().length?(console.warn("setSurfaceRenderingConfig: surfaceIndex is out of boundaries."),r=n.getCurrentSurface()):r=n.getSurfaces()[t]);var i=spEditor.configuration.renderingConfig.perSurfacePartialConfigs;if(e.hiResOutput)for(var o in e.hiResOutput)null!==e.hiResOutput[o]&&void 0!==e.hiResOutput[o]&&(i[r.name].hiResOutput[o]=e.hiResOutput[o]);if(e.proofImage)for(var o in e.proofImage)null!==e.proofImage[o]&&void 0!==e.proofImage[o]&&(i[r.name].proofImage[o]=e.proofImage[o])},t,n).catch(function(e){console.log("Sorry for a failure"),console.log(e)})]})})},t}(d),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),t.prototype.execute=function(e){return Object(i.b)(this,void 0,void 0,function(){var t,n;return Object(i.e)(this,function(r){switch(r.label){case 0:return[4,this.widget.customersCanvasPromise];case 1:return[4,r.sent().getProduct()];case 2:return t=r.sent(),n=e.data.map(function(e,n){return{mockup:e.mockup,previewMockups:e.previewMockups,surface:t.surfaces[n]}}),[2,t.setMockups(n,e.options)]}})})},t}(d),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),t.prototype.execute=function(e){return Object(i.b)(this,void 0,void 0,function(){var t=this;return Object(i.e)(this,function(n){switch(n.label){case 0:return[4,this.widget.iframeApiPromise];case 1:return n.sent(),"string"==typeof e.productDefinition&&(e.editorConfig.autoLoadUserInfo=!1,e.editorConfig.userInfo=null,this.widget._stateId=e.productDefinition,this.widget._userId=this.widget.driver.user.id),[4,this.load(e.productDefinition,e.editorConfig,e.maximizeAssetManager||e.galleryObserverEnable)];case 2:n.sent(),n.label=3;case 3:return n.trys.push([3,5,,6]),[4,this.widget.getReady()];case 4:return n.sent(),[3,6];case 5:return n.sent(),console.error("Failed getReady() on widget canvas"),[3,6];case 6:return[2,h.Maybe.maybe(e).map(function(e){return e.viewerSettings}).caseOf({just:function(e){return t.widget.applyViewerSettings(e)},nothing:function(){return t.widget.customersCanvasPromise}})]}})})},t.prototype.load=function(e,t,n){return Object(i.b)(this,void 0,void 0,function(){var r,o,s,a,c;return Object(i.e)(this,function(i){switch(i.label){case 0:return r=this,e.surfaces&&Array.isArray(e.surfaces)&&e.surfaces.forEach(function(e){"object"==typeof e&&void 0!==e.width&&void 0!==e.height&&(e.width=Number(e.width),e.height=Number(e.height))}),r.widget.modifiedItem&&r.widget.updateModifiedItem({}),o=this.widget.shadowRoot.querySelector("#editorFrame"),[4,CustomersCanvas.IframeApi.loadEditor(o,e,t)];case 1:s=i.sent(),this.listenBoundsChanges(s),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,s.getProduct()];case 3:return(a=i.sent()).switchTo(a.surfaces[0]),[3,5];case 4:return c=i.sent(),console.error("Load failed with exception: ",c),r.widget.dispatchEvent(new CustomEvent("error",c)),[2];case 5:return r.listenItemChanges(s),r.listenSurfaceChanges(s),r.updateOverallBounds(s),r.widget.customersCanvasPublish(s),r.widget.dispatchEvent(new CustomEvent("ready",{detail:{product:a,customersCanvas:s}})),[4,this.widget.replaceInterpolationPlaceholder()];case 6:return i.sent(),n&&(r.listenModalClose(s),r.listenModalOpen(s),r.listenAssetManagerClose(s),r.listenAssetManagerOpen(s)),r.listenOriginalSize(s),r.listenFullWindow(s),[2]}})})},t.prototype.listenItemChanges=function(e){return Object(i.b)(this,void 0,void 0,function(){var t=this;return Object(i.e)(this,function(n){switch(n.label){case 0:return[4,e.eval(function(){spEditor.productHandler.itemChangedEvent.add(function(e){var t={name:e.name,id:e.id};this.spEditor._postMessageServer.notifySubscribers("itemChanged",JSON.stringify(t))})})];case 1:return n.sent(),e.subscribe("itemChanged",function(e){return Object(i.b)(t,void 0,void 0,function(){var t,n,r;return Object(i.e)(this,function(i){switch(i.label){case 0:return t=JSON.parse(e),[4,this.widget.getCanvasItemModel(t)];case 1:return n=i.sent(),r=new u(n),this.widget.updateModifiedItem(r),[2]}})})}),[2]}})})},t.prototype.listenBoundsChanges=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.BoundsNotification,function(e){t.widget.updateOverallBounds(e.overallBounds)})},t.prototype.listenSurfaceChanges=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.OnSurfaceChanged,function(e){t.widget.updateCurrentSurfaceName()})},t.prototype.updateOverallBounds=function(e){var t=this;e.eval(function(){return spEditor.injector.get(CustomersCanvas.SimplePolygraphy.IBoundsNotifier.injectName).getOverallBounds()}).then(function(e){return t.widget.updateOverallBounds(e)})},t.prototype.listenOriginalSize=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.OriginalSize,function(){t.widget.toggleMaximizeMainPanel(!1)})},t.prototype.listenFullWindow=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.FullWindow,function(){t.widget.toggleMaximizeMainPanel(!0)})},t.prototype.listenModalClose=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.ModalClose,function(){t.widget.toggleMaximizeMainPanel(!1)})},t.prototype.listenModalOpen=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.ModalOpen,function(){t.widget.toggleMaximizeMainPanel(!0)})},t.prototype.listenAssetManagerClose=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.AssetManagerClosed,function(){t.widget.toggleMaximizeMainPanel(!1)})},t.prototype.listenAssetManagerOpen=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.AssetManagerOpened,function(){t.widget.toggleMaximizeMainPanel(!0)})},t}(d),b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),t.prototype.execute=function(e){return Object(i.b)(this,void 0,void 0,function(){var t,n=this;return Object(i.e)(this,function(r){switch(r.label){case 0:return[4,this.widget.customersCanvasPromise];case 1:return t=r.sent(),e.url?[4,t.eval(function(e){var t=spEditor.productHandler._app.configuration.appDomainUrl,r=spEditor.model.product,i=null,o=(i=void 0===e.surfaceIndex||null===e.surfaceIndex?r.getCurrentSurface():r.getSurfaces()[e.surfaceIndex]).getPrintAreas()[0],s=o.getContainers().find(function(e){return e.name===CustomersCanvas.Configuration.BG_CONTAINER_NAME}),a=s.getItems()[0],c=a.content,u=function(e,t,n){if(!0!==e)return[n];for(var r=[],i=0,o=0;o<t.height;){for(;i<t.width;){var s=n.clone();s.transform.set_translateX(i),s.transform.set_translateY(o),s.locked=!0,r.push(s),i+=n.sourceWidth||n.source.width}i=0,o+=n.sourceHeight||n.source.height}return r};if(!e.url.startsWith("public:")&&!e.url.startsWith("private:"))return c.loadImageFromRemoteUrl(t,e.url).then(function(){var t;this.isVector=!0,this.source&&(this.source.isVector=!0),e.autoResize&&(t=this,i.width=t.sourceRectangle.Width,i.height=t.sourceRectangle.Height,o.bounds.Width=i.width,o.bounds.Height=i.height);var n=u(e.toTile,i,this);s.setItems(n),spEditor.productHandler.updateView()}.bind(a)).catch(function(e){console.log("Sorry for a failure"),console.log(e)});var l=e.url,d=spEditor.configuration.userId||n.widget.userId||"default";Utils.ItemUtils.getImageMetaDataFromFile(t,l,d).then(function(t){var n=t;if((e.url.endsWith(".pdf")||e.url.endsWith(".svg"))&&(n.isVector=!0),e.toTile){var r=this.content||this;r.sourceRectangle.Width=n.size.width,r.sourceRectangle.Height=n.size.height,r.setData(n),(e.url.endsWith(".pdf")||e.url.endsWith(".svg"))&&r.source&&(r.source.isVector=!0);var o=u(e.toTile,i,r);s.setItems(o),spEditor.productHandler.updateView()}else spEditor._widgetsController.changeBackground([i],n)}.bind(a)).catch(function(e){console.log("Sorry for a failure"),console.log(e)})},e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2,this.widget.getReady()]}})})},t}(d),C=n(31),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),t.prototype.execute=function(e){return Object(i.b)(this,void 0,void 0,function(){var t,n,r,o;return Object(i.e)(this,function(i){switch(i.label){case 0:return[4,this.widget.customersCanvasPromise];case 1:return[4,i.sent().getProduct()];case 2:t=i.sent(),Object(C.a)(e)||(e=[e]),n=0,i.label=3;case 3:return n<e.length?(r=e[n],o=t.currentSurface,"number"==typeof r.surfaceIndex&&(o=t.surfaces[r.surfaceIndex]),[4,o.setPrintAreas([r.data],r.options)]):[3,6];case 4:t=i.sent(),i.label=5;case 5:return n++,[3,3];case 6:return[2,Promise.resolve()]}})})},t}(d),w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),t.prototype.execute=function(e){return Object(i.b)(this,void 0,void 0,function(){return Object(i.e)(this,function(t){switch(t.label){case 0:return[4,this.widget.customersCanvasPromise];case 1:return[2,t.sent().eval(function(e){var t=this,n=spEditor.productHandler.product.getSurfaces();e.forEach(function(e){if(e.url){var r="number"==typeof e.surfaceIndex?n[e.surfaceIndex]:spEditor.productHandler.product.getCurrentSurface(),i=("up"===e.mockup.toLowerCase()?r.mockup.getUpContainers():r.mockup.getDownContainers())[0].getItems()[0];if(i){var o=t.window.location.href.split("/page/iframe")[0]+"/api/ImagePicker/GetWebImageMeta",s={url:e.url};$.ajax({method:"post",async:!1,url:o,contentType:"application/json;charset=UTF-8",data:JSON.stringify(s),success:function(e){var t=new CustomersCanvas.Model.ImageMetaData(e);t.size={width:t.size.width||t.width,height:t.size.height||t.height},t.name=i.name,spEditor._widgetsController.setImageData(i,t),spEditor.productHandler.updateView()}})}}})},e)]}})})},t}(d),O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),t.prototype.execute=function(e){return Object(i.b)(this,void 0,void 0,function(){return Object(i.e)(this,function(t){switch(t.label){case 0:return"string"==typeof e?e={theme:e}:void 0===e.theme&&(e={theme:e}),[4,this.widget.customersCanvasPromise];case 1:return[4,t.sent().getProduct()];case 2:return[2,t.sent().applyProductTheme(e.theme)]}})})},t}(d),I=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),t.prototype.execute=function(e){return Object(i.b)(this,void 0,void 0,function(){var t;return Object(i.e)(this,function(n){switch(n.label){case 0:return e&&e instanceof Array?[4,this.widget.customersCanvasPromise]:[3,3];case 1:return[4,n.sent().getProduct()];case 2:t=n.sent(),e.forEach(function(e,n){var r=Object.keys(e),i=Object.values(e),o=r.length,s=t.surfaces[n];if(s)for(var a=0;a<o;a++){var c=r[a],u=s.printAreas[0].getContainer(c);u?u.update(i[a]):console.warn("Container with name "+c+" was not found!")}}),n.label=3;case 3:return[2]}})})},t}(d),P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),t.prototype.execute=function(e,t){return Object(i.b)(this,void 0,void 0,function(){var n,r,o,s,a=this;return Object(i.e)(this,function(c){switch(c.label){case 0:return p.a.isEmptyObject(e)||p.a.isEmptyObject(e.every)&&p.a.isEmptyObject(e.items)?[2,Promise.resolve()]:[4,this.widget.customersCanvasPromise];case 1:return n=c.sent(),e.items=e.items||{},r=function(e,t){for(var n in e.items){var r=t.items[n],i=e.items[n];JSON.stringify(r)===JSON.stringify(i)&&!0!==i.force&&delete e.items[n]}return e},t&&(e=r(e,t)),o=function(e){return Object(i.b)(a,void 0,void 0,function(){var t,n,r,o,s,a,c,u,l,d,f,h,p,m=this;return Object(i.e)(this,function(g){switch(g.label){case 0:return t=spEditor.model.product,n=t.getAllItems(),r=[],o=function(e){return Object(i.b)(m,void 0,void 0,function(){var t,n,r,o,s,a,c,u=this;return Object(i.e)(this,function(l){switch(l.label){case 0:return t=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{A:255,R:parseInt(t[1],16),G:parseInt(t[2],16),B:parseInt(t[3],16)}:null},n=function(e){var t=[];return Array.from(e.match(/\d+(\.\d+)?%?/g)).map(function(e,n){var r=e.replace("%",""),i=Number(r);i<=1&&-1===e.indexOf("%")&&(i*=100),t[n]=i}),{C:255*t[0]/100,M:255*t[1]/100,Y:255*t[2]/100,K:255*t[3]/100,A:255*(t[4]||100)/100}},r=function(e){return Object(i.b)(u,void 0,void 0,function(){var t,n,r;return Object(i.e)(this,function(i){return t=encodeURIComponent(e.toString()),n=window.location.href.split("/page/iframe")[0],r=n+"/api/ColorConvertor/CmykToRgb/"+t+"/id/",[2,Ajax.request({url:r,type:Ajax.RequestType.post,headers:[Ajax.ContentType.json]}).then(function(e){return JSON.parse(e.value).value}).catch(function(e){console.error("failed to get color preview: "+e)})]})})},e.toLowerCase().startsWith("cmyk")?(o=n(e),s=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.CmykColor(o),a=s,[4,r(s)]):[3,2];case 1:return a.Preview=l.sent(),[2,s];case 2:return c=t(e),[2,new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor(c)]}})})},s=function(e){return Object(i.b)(m,void 0,void 0,function(){var t,n,r,s,a,c,u,l,d,f,h,p;return Object(i.e)(this,function(m){switch(m.label){case 0:if(t="background",!(n=e.items[t])||!n.color)return[3,8];r=spEditor.model.product,m.label=1;case 1:m.trys.push([1,6,7,8]),s=Object(i.k)(r.getSurfaces()),a=s.next(),m.label=2;case 2:return a.done?[3,5]:(c=a.value,[4,o(n.color)]);case 3:u=m.sent(),l=c.getBackgroundItem(),d=spEditor.widgetsController;try{d._selectBgColor(l,u)}catch(e){d.selectBgColor(u)}m.label=4;case 4:return a=s.next(),[3,2];case 5:return[3,8];case 6:return f=m.sent(),h={error:f},[3,8];case 7:try{a&&!a.done&&(p=s.return)&&p.call(s)}finally{if(h)throw h.error}return[7];case 8:return[2]}})})},e&&e.items?[4,s(e)]:[3,2];case 1:g.sent(),g.label=2;case 2:a=function(e){return e.placeholderContent&&e.tags&&e.tags.sourceData&&e.value===e.tags.sourceData.name},c=function(t){var n,s,c,u,l,d,f,h,p,m,g,v,b,C,y,w,O;return Object(i.e)(this,function(I){switch(I.label){case 0:return n=Object(i.a)(Object(i.a)({},e.every),e.items[t.name]),0===Object.keys(n).length?[2,"continue"]:(t instanceof CustomersCanvas.Model.Item&&(n.visualizationPermissions&&(null!=n.visualizationPermissions.noPrint&&(t.visualizationPermissions.noPrint=n.visualizationPermissions.noPrint),null!=n.visualizationPermissions.noShow&&(t.visualizationPermissions.noShow=n.visualizationPermissions.noShow)),null!=n.locked&&(t.locked=n.locked)),t instanceof CustomersCanvas.Model.PlaceholderItem&&("ImagePlaceholder"===n.type&&(a(n)?(s=CustomersCanvas.Utils.ItemUtils.getImageMetaDataFromUrl(spEditor.configuration.appDomainUrl,n.placeholderContent.originalUrl).then(function(e){t.content=new CustomersCanvas.Model.ImageItem,t.content.setData(e),t.content.updateRectangle(!1,t.contentResizeMode,t),t.content.tags=n.tags,t.isStubContent=!1;var r=t.getTransformedRectangle(),i=n.placeholderContent;if(!(r.Angle!==i.placeholderRectangle.Angle||r.Width!==i.placeholderRectangle.Width||r.Height!==i.placeholderRectangle.Height||r.CenterX!==i.placeholderRectangle.CenterX||r.CenterY!==i.placeholderRectangle.CenterY)){var o=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math,s=new o.RotatedRectangleF(i.placeholderRectangle.CenterX,i.placeholderRectangle.CenterY,i.placeholderRectangle.Width,i.placeholderRectangle.Height,i.placeholderRectangle.Angle);t.setTransformedRectangle(s);var a=new o.RotatedRectangleF(i.contentRectangle.CenterX,i.contentRectangle.CenterY,i.contentRectangle.Width,i.contentRectangle.Height,i.contentRectangle.Angle);t.content.setTransformedRectangle(a)}}),r.push(s)):t.isStubContent||(t.content=new CustomersCanvas.Model.ImageItem,t.content.setData(t.stubStorageMeta),t.isStubContent=!0),n.contentPermissions&&n.contentPermissions.imagePermissions&&(t.contentPermissions.imagePermissions.allowChangeImage=n.contentPermissions.imagePermissions.allowChangeImage,t.contentPermissions.imagePermissions.allowEditImage=n.contentPermissions.imagePermissions.allowEditImage),n.placeholderPermissions&&(t.placeholderPermissions.allowEditContent=n.placeholderPermissions.allowEditContent,t.placeholderPermissions.showHandleButton=n.placeholderPermissions.showHandleButton,t.placeholderPermissions.showSelectButton=n.placeholderPermissions.showSelectButton)),"BarcodePlaceholder"===n.type&&(n.value||t.isStubContent||(t.content.setData(t.stubStorageMeta),t.isStubContent=!0))),t instanceof CustomersCanvas.Model.BaseTextItem?(null!=(c=n.text||n.value)&&(t.text=c),t.placeholders&&t.placeholders.length>0&&(t.placeholders.forEach(function(e){e.value=c}),t.value=c),n.font?((u=n.font.leading||n.leading)&&(t.leading=u),(l=n.font.bold||n.font.fauxBold)&&(t.font.fauxBold=l),(d=n.font.italic||n.font.fauxItalic)&&(t.font.fauxItalic=d),(f=n.font.family||n.font.postScriptName)&&(t.font.postScriptName=f),n.font.size&&(t.font.size=n.font.size),n.font.underline&&(t.underline=n.font.underline),(h=n.color||n.font.color)?(p=t,[4,o(h)]):[3,2]):[3,2]):[3,3]);case 1:p.color=I.sent(),I.label=2;case 2:!0===n.locked&&(t.textPermissions.allowChangeText=!1,t.textPermissions.allowChangeTextBIU=!1),t instanceof CustomersCanvas.Model.PlainTextItem&&(b=n.position||n.location)&&(C=0,y=0,t.alignment=CustomersCanvas.Model.BaseTextItem.TextAlignment.Left,b||(b={x:0,y:0}),C=b.x||t.baselineLocation.X,y=b.y||t.baselineLocation.Y,t.baselineLocation=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF(C,y)),(t instanceof CustomersCanvas.Model.BoundedTextItem||t instanceof CustomersCanvas.Model.AutoScaledTextItem)&&((b=n.position||n.location)||n.size)&&(C=0,y=0,w=0,O=0,b||(b={x:0,y:0}),C=b.x||t.textRectangle.Left,y=b.y||t.textRectangle.Top,n.size||(n.size={width:0,height:0}),w=n.size.width||t.textRectangle.Width,O=n.size.height||t.textRectangle.Height,t.textRectangle.Width=w,t.textRectangle.Height=O,t.textRectangle.Left=C,t.textRectangle.Top=y),I.label=3;case 3:return t.type!==CustomersCanvas.Model.ShapeItem.type?[3,6]:(m=t,(g=n.color||n.fillColor)?(v=m,[4,o(g)]):[3,5]);case 4:v.fillColor=I.sent(),I.label=5;case 5:((b=n.position||n.location)||n.size)&&(C=0,y=0,w=0,O=0,b||(b={x:0,y:0}),C=b.x||m.sourceRectangle.Left,y=b.y||m.sourceRectangle.Top,n.size||(n.size={width:0,height:0}),w=n.size.width||m.sourceRectangle.Width,O=n.size.height||m.sourceRectangle.Height,m.sourcePath=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Path.rectangle(C,y,w,O)),I.label=6;case 6:return[2]}})},g.label=3;case 3:g.trys.push([3,8,9,10]),u=Object(i.k)(n),l=u.next(),g.label=4;case 4:return l.done?[3,7]:(d=l.value,[5,c(d)]);case 5:g.sent(),g.label=6;case 6:return l=u.next(),[3,4];case 7:return[3,10];case 8:return f=g.sent(),h={error:f},[3,10];case 9:try{l&&!l.done&&(p=u.return)&&p.call(u)}finally{if(h)throw h.error}return[7];case 10:return[2,Promise.all(r).then(function(){return spEditor.productHandler.updateView(),spEditor.getCanvasViewer().get_canvas().waitWebServiceCalls()})]}})})},p.a.isEmptyObject(e.items),[4,this.widget.__methodExecuter(o,e)];case 2:return c.sent(),[4,this.applyUserInfo(n,e)];case 3:return c.sent(),s=function(e){return Object(i.b)(a,void 0,void 0,function(){var t,n,r,o,s,a,c,u,l,d,f,h=this;return Object(i.e)(this,function(p){switch(p.label){case 0:t=function(e,t,n){return Object(i.b)(h,void 0,void 0,function(){var r,o,s,a,c;return Object(i.e)(this,function(i){return null==e||null==e.effect?[2,Promise.resolve()]:(r=window.location.href.split("/page/iframe")[0],o=r+"/api/ImageEditor/ProcessImage/",s=CustomersCanvas.Utils.urlCombine(o,n.storageId),a=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Effects.FiltersEffect(0,0,0,0,"grayscale"===e.effect.toLowerCase(),"sepia"===e.effect.toLowerCase()),c={effects:[a]},[2,Ajax.request({url:s,type:Ajax.RequestType.post,headers:[Ajax.ContentType.json],data:JSON.stringify(c)}).then(function(e){var n=JSON.parse(e.value);t.setData(n)}).catch(function(e){console.error(e),console.error("Failed to apply effect "+e)})])})})},n=spEditor.model.product,r=n.getAllItems(),p.label=1;case 1:p.trys.push([1,6,7,8]),o=Object(i.k)(r),s=o.next(),p.label=2;case 2:return s.done?[3,5]:(a=s.value,(c=e.items[a.name])&&c.effect?(u=null,a instanceof CustomersCanvas.Model.ImageItem&&(u=a),a instanceof CustomersCanvas.Model.PlaceholderItem&&null!=a.content&&a.content.type==CustomersCanvas.Model.ImageItem.type&&(u=a.content),null===u?[3,4]:[4,t(c,u,u.getImageMetaData())]):[3,4]);case 3:p.sent(),p.label=4;case 4:return s=o.next(),[3,2];case 5:return[3,8];case 6:return l=p.sent(),d={error:l},[3,8];case 7:try{s&&!s.done&&(f=o.return)&&f.call(o)}finally{if(d)throw d.error}return[7];case 8:return[2]}})})},e&&e.items?[4,this.widget.__methodExecuter(s,e)]:[3,5];case 4:c.sent(),c.label=5;case 5:return[2,Promise.resolve()]}})})},t.prototype.applyUserInfo=function(e,t){return Object(i.b)(this,void 0,void 0,function(){var n,r,o,s,a,c,u,l,d=this;return Object(i.e)(this,function(f){n=function(e){return!!e.placeholderContent&&e.tags&&e.tags.sourceData&&e.value===e.tags.sourceData.name},r={};try{for(o=Object(i.k)(Object.keys(t.items)),s=o.next();!s.done;s=o.next())a=s.value,((c=t.items[a]).value||"Text"===c.type||"InString"===c.type||c.image)&&("ImagePlaceholder"===c.type&&n(c)||("BarcodePlaceholder"===c.type?c.barcodeSubType&&"None"!==c.barcodeSubType?"Url"===c.barcodeSubType?r[a]={barcodeFormat:c.barcodeFormat,barcodeSubType:c.barcodeSubType,url:c.value}:"Phone"===c.barcodeSubType&&(r[a]={barcodeFormat:c.barcodeFormat,barcodeSubType:c.barcodeSubType,phone:c.value}):r[a]={barcodeFormat:c.barcodeFormat,barcodeValue:c.value}:r[a]=c.value||c.image))}catch(e){u={error:e}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(u)throw u.error}}return p.a.isEmptyObject(r)?[2,Promise.resolve()]:[2,e.loadUserInfo(r).then(function(){return d.widget.__methodExecuter(function(e){var t=spEditor.productHandler.getAllItems().filter(function(t){return-1!==e.indexOf(t.name)});spEditor.productHandler.updateItems(t)},Object.keys(r))}).catch(function(e){d.widget.showToast("Error: Invalid data"),console.log(e)})]})})},t}(d),j=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),t.prototype.execute=function(e){return Object(i.b)(this,void 0,void 0,function(){return Object(i.e)(this,function(t){switch(t.label){case 0:return[4,this.widget.customersCanvasPromise];case 1:return[2,t.sent().eval(function(e){if(void 0!==e.zoom&&spEditor.getCanvasViewer().set_zoom(e.zoom),void 0!==e.zoomMode){var t=Aurigma.GraphicsMill.ZoomMode[e.zoomMode];spEditor.getCanvasViewer().set_zoomMode(void 0!==t?t:1)}void 0!==e.scrollPosition&&spEditor.getCanvasViewer().set_scrollingPosition(e.scrollPosition)},e)]}})})},t}(d),S=n(511),x=n(1),_=n(16),E=n(512),A=n(508),M=n(580),R=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.CC_SCRIPT_RELATIVE_PATH="/Resources/SPEditor/Scripts/IFrame/IframeApi.js",t.modifiedItem=null,t._currentSurfaceName="",t.overallBounds={},t._hiResUrls=[],t._proofImageUrls=[[]],t._stateId="",t._userId="",t._variableData=[],t._allItems=[],t._depositPhotos=[],t._tags={},t._lastParams={},t._currentParams={},t.actionsFinished=!1,t.itemsData={},t.commands={initial:new v(t),changeMockup:new g(t),changeLayout:new m(t),setPrintArea:new y(t),setTheme:new O(t),setBackground:new b(t),updateContainerSettings:new I(t),setRemoteMockup:new w(t),modifyItems:new P(t),setViewerSettings:new j(t)},t._isRestoring=!1,t}return Object(i.d)(t,e),Object.defineProperty(t.prototype,"violationWarningData",{get:function(){return this._violationWarningData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"boundsData",{get:function(){return this._boundsData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentSurfaceName",{get:function(){return this._currentSurfaceName},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"proofImageUrls",{get:function(){return this._proofImageUrls},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hiResUrls",{get:function(){return this._hiResUrls},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stateId",{get:function(){return this._stateId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userId",{get:function(){return this._userId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userChanges",{get:function(){return this._userChanges},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"allItems",{get:function(){return this._allItems},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"variableData",{get:function(){return this._variableData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depositPhotos",{get:function(){return this._depositPhotos},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tags",{get:function(){return this._tags},enumerable:!1,configurable:!0}),t.prototype.updateParams=function(e){if(void 0!==e.initial&&(e.initial.editorConfig||(e.initial.editorConfig={}),e.initial.editorConfig.defaultLanguage=this.driver.config.language||"en",this.driver)){this._initialOrder=this._initialOrder||Object(A.a)(this.driver.orders.current);var t=this.driver.user.id;t&&(e.initial.editorConfig.userId=t);var n=this.driver.user.tokenId;n&&(e.initial.editorConfig.tokenId=n);var r=this.auWizard.scopeInternal.widgetsData,i=r&&r[this.name]?r[this.name].stateId:this._initialOrder.data.stateId;i&&""!==i&&(e.initial.productDefinition=i),e.initial.editorConfig.preloader={enabled:!1}}this.onChange=e.onChange?p.a.functionWrapperConstructor(e.onChange):function(){}},t.prototype.exportWidgetData=function(e){return Object(i.b)(this,void 0,void 0,function(){return Object(i.e)(this,function(t){switch(t.label){case 0:return!0!==e?[3,2]:[4,this.saveProduct()];case 1:t.sent(),t.label=2;case 2:return[2,{stateId:this._stateId}]}})})},t.prototype.restoreWidgetFromData=function(e,t){return void 0===t&&(t=!1),Object(i.b)(this,void 0,void 0,function(){var n;return Object(i.e)(this,function(r){switch(r.label){case 0:return!0!==t?[3,2]:((n=Object.assign({},this.params.initial)).productDefinition=e.stateId,[4,this.commands.initial.execute(n)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.updateParamsAsync=function(t){return Object(i.b)(this,void 0,void 0,function(){var n,r,o,s,a,c,u,l;return Object(i.e)(this,function(i){switch(i.label){case 0:return[4,e.prototype.updateParamsAsync.call(this,t)];case 1:if(i.sent(),0===(n=this._commandExecuter.getChangedActions(t,this._currentParams)).length)return[2,!1];-1!==n.indexOf("initial")&&(r=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/,o=p.a.isNotNullOrUndefined(this._stateId)&&""!==this._stateId,(s=p.a.isNotNullOrUndefined(t.initial.productDefinition)&&t.initial.productDefinition.toString().match(r))&&(this._isRestoring=!0),(o||s)&&(n=["initial"])),this.actionsFinished=!1,this._isRestoring||this.emitChange(),a=n&&1===n.length&&-1!==n.indexOf("initial"),this.showPreloader(!0,this.getPreloaderMessage(t,a)),this._currentParams=Object(A.a)(t),i.label=2;case 2:return i.trys.push([2,5,6,7]),this._isRestoring&&!a?[3,4]:[4,this._commandExecuter.executeActions(t,n,this._lastParams)];case 3:i.sent(),i.label=4;case 4:return[3,7];case 5:return c=i.sent(),this.params.actionsErrorToast&&!0===this.params.actionsErrorToast.show&&(u="widgets.canvas.actions.error",(l=this.localize(u))===u&&(l="Something went wrong. Send the website support team information about your browser and steps to reproduce the problem."),this.showToast(l,this.params.actionsErrorToast.duration)),this.logger.error(function(){return"Failed to perform an action on Customer's Canvas. "},c),[3,7];case 6:return this.showPreloader(!1),this._lastParams=Object(A.a)(this._currentParams),this.actionsFinished=!0,this._isRestoring&&(this.getInitialParamsResolved(),this._isRestoring=!1),[7];case 7:return[2]}})})},t.prototype.forceUpdateCanvas=function(){return this.__methodExecuter(function(){spEditor.productHandler.getAllItems().map(function(e){return e.correspondingVObject}).forEach(function(e){return e.update()})})},t.prototype.connectedCallback=function(){var t=this;e.prototype.connectedCallback.call(this),this._commandExecuter=new E.a(this.commands,this.uniqWidgetName,function(){return t.forceUpdateCanvas()}),this.baseUrl=this.driver.settings.customersCanvasBaseUrl,this.showPreloader(!0),this.iframeApiPromise=S.a.loadCCScript(this.baseUrl,this.CC_SCRIPT_RELATIVE_PATH),this.iframeApiPromise.then(function(){t.showPreloader(!1),CustomersCanvas.IframeApi.editorUrl=t.baseUrl})},t.prototype.switchSurfaceTo=function(e){return this.customersCanvasPromise.then(function(t){return t.getProduct().then(function(t){return t.switchTo(t.surfaces[e])})})},t.prototype.removeSurface=function(e){return Object(i.b)(this,void 0,void 0,function(){var t,n;return Object(i.e)(this,function(r){switch(r.label){case 0:return[4,this.customersCanvasPromise];case 1:return[4,r.sent().getProduct()];case 2:return t=r.sent(),e<0||e>t.surfaces.length-1?(console.error("Invalid surface index: "+e),[2,t]):(n=t.surfaces[e],[4,t.removeSurface(n)]);case 3:return[2,r.sent()]}})})},t.prototype.addSurface=function(e,t){return Object(i.b)(this,void 0,void 0,function(){return Object(i.e)(this,function(n){switch(n.label){case 0:return[4,this.customersCanvasPromise];case 1:return[4,n.sent().getProduct()];case 2:return[4,n.sent().addSurface(e,t)];case 3:return[2,n.sent()]}})})},t.prototype.addSurfaces=function(e,t){return Object(i.b)(this,void 0,void 0,function(){return Object(i.e)(this,function(n){switch(n.label){case 0:return[4,this.customersCanvasPromise];case 1:return[4,n.sent().getProduct()];case 2:return[4,n.sent().addSurfaces(e,t)];case 3:return[2,n.sent()]}})})},t.prototype.updateSurfaces=function(e,t){return Object(i.b)(this,void 0,void 0,function(){var n;return Object(i.e)(this,function(r){switch(r.label){case 0:return[4,this.customersCanvasPromise];case 1:return[4,r.sent().getProduct()];case 2:switch(n=r.sent(),e.toLowerCase()){case"remove":return[3,3];case"add":return[3,5]}return[3,7];case 3:return[4,this.removeSurface(t)];case 4:return n=r.sent(),[3,7];case 5:return[4,this.addSurface(t)];case 6:return n=r.sent(),[3,7];case 7:return[2,n]}})})},t.prototype.fireChangeItemEvent=function(e){this.onChange(e)},t.prototype.updateModifiedItem=function(e){Object(M.a)(this.modifiedItem,e)||(this.modifiedItem=e,this.emitChange({modifiedItem:this.modifiedItem},!1))},t.prototype.updateOverallBounds=function(e){Object(M.a)(this.overallBounds,e)||(this.overallBounds=e,this.emitChange({overallBounds:this.overallBounds},!1))},t.prototype.updateCurrentSurfaceName=function(){var e=this;this.__methodExecuter(function(){return spEditor.model.product.getCurrentSurface().name}).then(function(t){return e._currentSurfaceName=t})},t.prototype.applyViewerSettings=function(e){return Object(i.b)(this,void 0,void 0,function(){return Object(i.e)(this,function(t){return[2,this.commands.setViewerSettings.execute(e)]})})},t.prototype.getProofImages=function(e,t){return void 0===e&&(e=800),void 0===t&&(t=800),Object(i.b)(this,void 0,void 0,function(){var n;return Object(i.e)(this,function(r){switch(r.label){case 0:return[4,this.customersCanvasPromise];case 1:return[4,r.sent().getProofImages({maxWidth:e,maxHeight:t})];case 2:return n=r.sent(),this._proofImageUrls=n.proofImageUrls.map(function(e){return e.map(function(e){return e})}),this.emitChange({urls:this.proofImageUrls},!0),[2,n.proofImageUrls.map(function(e){return e[0]})]}})})},t.prototype.getHiResImages=function(e,t,n,r){return void 0===e&&(e=800),void 0===t&&(t=800),Object(i.b)(this,void 0,void 0,function(){var o,s;return Object(i.e)(this,function(i){switch(i.label){case 0:return[4,this.customersCanvasPromise];case 1:return o=i.sent(),null!==n&&""!==n||(n=void 0),[4,o.finishProductDesign({stateId:n,proofMaxWidth:e,proofMaxHeight:t,fileName:r})];case 2:return s=i.sent(),this._hiResUrls=s.hiResOutputUrls,this._proofImageUrls=s.proofImageUrls.map(function(e){return e.map(function(e){return e})}),this._stateId=s.stateId,this._userId=s.userId,this._userChanges=s.userChanges,this._violationWarningData=s.violationWarningData,this._boundsData=s.boundsData,this.emitChange({urls:this.hiResUrls,proofs:this.proofImageUrls,stateId:this.stateId,userId:this.userId,userChanges:this.userChanges,violationWarningData:this.violationWarningData,boundsData:this.boundsData},!0),[2,s.hiResOutputUrls]}})})},t.prototype.getVariableData=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t;return Object(i.e)(this,function(n){switch(n.label){case 0:return[4,this.customersCanvasPromise];case 1:return[4,n.sent().getProduct()];case 2:return e=n.sent(),t=this,[4,e.getVariableItems()];case 3:return t._variableData=n.sent().reverse(),this.emitChange({data:this.variableData}),[2,this.variableData]}})})},t.prototype.getAllItems=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t;return Object(i.e)(this,function(n){switch(n.label){case 0:return[4,this.customersCanvasPromise];case 1:return[4,n.sent().getProduct()];case 2:return e=n.sent(),t=this,[4,e.getAllItems()];case 3:return t._allItems=n.sent().reverse(),this.emitChange({data:this._allItems}),[2,this.allItems]}})})},t.prototype.getDepositPhotos=function(){return Object(i.b)(this,void 0,void 0,function(){var e;return Object(i.e)(this,function(t){switch(t.label){case 0:return[4,this.customersCanvasPromise];case 1:return[4,t.sent().eval(function(){var e=[];return spEditor.model.product.getAllItems().forEach(function(t){var n=t instanceof CustomersCanvas.Model.PlaceholderItem&&null!=t.content&&"ImageItem"===t.content.type?t.content:t,r=n.tags.dp_data||n.tags.sourceData;if(r&&null!=r.thumb_max){var i="string"==typeof r?JSON.parse(r).id:r.id,o="string"==typeof r?JSON.parse(r).thumb_max:r.thumb_max;e.push({imageId:t.id,depositPhotosId:i,preview:o})}}),e})];case 2:return e=t.sent(),this._depositPhotos=e,this.emitChange({data:this.depositPhotos}),[2,e]}})})},t.prototype.getTags=function(){return Object(i.b)(this,void 0,void 0,function(){var e;return Object(i.e)(this,function(t){switch(t.label){case 0:return[4,this.customersCanvasPromise];case 1:return[4,t.sent().getProduct()];case 2:return[4,t.sent().getTags()];case 3:return e=t.sent(),this._tags=e,this.emitChange({tags:this.tags}),[2,Promise.resolve(e)]}})})},t.prototype.setTags=function(e){return Object(i.b)(this,void 0,void 0,function(){return Object(i.e)(this,function(t){switch(t.label){case 0:return[4,this.customersCanvasPromise];case 1:return[4,t.sent().getProduct()];case 2:return[4,t.sent().setTags(e)];case 3:return t.sent(),this._tags=e,this.emitChange({tags:this.tags}),[2,Promise.resolve(e)]}})})},t.prototype.saveProduct=function(e){return Object(i.b)(this,void 0,void 0,function(){var t=this;return Object(i.e)(this,function(n){return[2,this.customersCanvasPromise.then(function(n){return n.saveProduct(e).then(function(e){return t._stateId=e.stateId,t._userId=e.userId,t.emitChange({stateId:e.stateId,userId:e.userId},!0),e})})]})})},t.prototype.replaceInterpolationPlaceholder=function(){if(!this._currentParams.replaceInterpolationPlaceholders)return Promise.resolve();return this.__methodExecuter(function(){return spEditor.productHandler.replaceInterpolationPlaceholders()})},t.prototype.toggleMaximizeMainPanel=function(e){this.publishData({main:e},_.a.TOGGLE_SIZE_MAIN)},t.prototype.openAssetManagerFor=function(e){this.__methodExecuter(function(e){var t=spEditor.productHandler.getAllItems().find(function(t){return t.name===e});(t instanceof CustomersCanvas.Model.ImageItem||t instanceof CustomersCanvas.Model.PlaceholderItem)&&spEditor.widgetsController.requestSetImage(t)},e)},t.prototype.toggleObjectInspector=function(){this.__methodExecuter(function(){spEditor.widgetsController.toggleObjectInspector(),spEditor.widgetsController.updateWidgets()})},t.prototype.getItemText=function(e){return Object(i.b)(this,void 0,void 0,function(){var t;return Object(i.e)(this,function(n){switch(n.label){case 0:return[4,this.customersCanvasPromise];case 1:return[4,n.sent().eval(function(e){var t="",n=spEditor.model.product.getAllItems().find(function(t){return t.name===e});n&&n instanceof CustomersCanvas.Model.BaseTextItem&&(t=n.text);return t},e)];case 2:return t=n.sent(),this.itemsData[e]=this.itemsData[e]||{},this.itemsData[e].text=t,this.emitChange(),[2,t]}})})},t.prototype.getPreloaderMessage=function(e,t){var n,r,i,o;return t?null!==(r=null===(n=null===e||void 0===e?void 0:e.preloader)||void 0===n?void 0:n.initialMessage)&&void 0!==r?r:this.localize("common.loading.preload"):null!==(o=null===(i=null===e||void 0===e?void 0:e.preloader)||void 0===i?void 0:i.actionsMessage)&&void 0!==o?o:this.localize("common.loading.preload")},Object(i.c)([Object(x.c)(),Object(i.g)("design:type",u)],t.prototype,"modifiedItem",void 0),t=Object(i.c)([Object(x.a)("au-widget-canvas",o)],t)}(l)}}]);