(window.multistep_editor_jsonpFunction=window.multistep_editor_jsonpFunction||[]).push([[21],{920:function(t,e){t.exports='<style>\n  :host {\n    width: 100%;\n    height: 100%;\n  }\n</style>\n\n<iframe id="frameID" width="100%" height="100%" style="border: none"></iframe>\n'},950:function(t,e,i){"use strict";i.r(e),i.d(e,"AuWidgetDataDrivenEditor",function(){return c}),i.d(e,"widget",function(){return c});var n=i(0),r=i(172),s=i(1),o=i(920),a=i(6),c=function(t){function e(){var e=t.call(this)||this;return e.previewUrls=[],e.script="",e.styles="",e._initIFrame=e._initIFrame.bind(e),e.resourcesPromise=e._loadResources(),e}return Object(n.d)(e,t),e.prototype.exportWidgetData=function(t){return Object(n.b)(this,void 0,void 0,function(){return Object(n.e)(this,function(t){return[2,{design:{designId:this.stateId,isPrivateDesign:!0,designPath:this.params.config.design.designPath,dataSetId:this.params.config.design.dataSetId},access:{userId:this.params.config.access.userId}}]})})},e.prototype.restoreWidgetFromData=function(t,e){return Object(n.b)(this,void 0,void 0,function(){var e;return Object(n.e)(this,function(i){switch(i.label){case 0:return this._isRestoring=!0,e=Object.assign({},this.params.config,t),this.stateId=t.design.designId,this.userId=t.access.userId,[4,this.setEditorConfig(e)];case 1:return i.sent(),this._isRestoring=!1,this.emitChange(),[2]}})})},e.prototype.updateParams=function(t,e){},e.prototype.updateParamsAsync=function(e,i){return Object(n.b)(this,void 0,void 0,function(){var r,s,o,c,d,h=this;return Object(n.e)(this,function(n){switch(n.label){case 0:return[4,t.prototype.updateParamsAsync.call(this,e,i)];case 1:return n.sent(),[4,this.resourcesPromise];case 2:return n.sent(),!e.config||this._isEditorInited?[3,4]:[4,this._initIFrame(e.config.api.designAtoms,e.config.access.tenantId,e.config.settings.allowManipulations)];case 3:n.sent(),this._isEditorInited=!0,n.label=4;case 4:return r=this,[4,this._itemPromise()];case 5:if(r._element=n.sent(),e.config){s=e.config.access.userId,o=a.a.parseJwt(e.config.access.token);try{void 0!==(c=o.UserId)&&s.toString()!==c.toString()&&(s=c)}catch(t){}this.userId=s,d=Object.assign({},e.config,{userId:s}),this.setEditorConfig(d),this._element.$isValid.subscribe(function(t){h.isValid=t,h.emitChange()})}return[2]}})})},e.prototype.setEditorConfig=function(t){return Object(n.b)(this,void 0,void 0,function(){return Object(n.e)(this,function(e){switch(e.label){case 0:return[4,this._element.setEditorConfig(t)];case 1:return e.sent(),[2]}})})},e.prototype.createPdfPreview=function(t){return Object(n.b)(this,void 0,void 0,function(){var e;return Object(n.e)(this,function(i){switch(i.label){case 0:t=t||this.params.config.renderer,i.label=1;case 1:return i.trys.push([1,3,,4]),e=this,[4,this._element.getPdfPreview(t)];case 2:return e.pdfUrl=i.sent(),this.emitChange(),[2,this.pdfUrl];case 3:return i.sent(),this.showToast("Error: can't create pdf file."),[2,""];case 4:return[2]}})})},e.prototype.createPreview=function(t){return Object(n.b)(this,void 0,void 0,function(){var e,i,r,s;return Object(n.e)(this,function(n){switch(n.label){case 0:t=t||this.params.config.renderer,n.label=1;case 1:return n.trys.push([1,3,,4]),e=this.params.config.preview,i=e.width,r=e.height,s=this,[4,this._element.getPreview(this.stateId,i,r)];case 2:return s.previewUrls=n.sent(),this.emitChange(),[2,this.previewUrls];case 3:return n.sent(),this.showToast("Error: can't create preview images."),[2,[]];case 4:return[2]}})})},e.prototype.createIdStr=function(){return Object(n.b)(this,void 0,void 0,function(){var t;return Object(n.e)(this,function(e){switch(e.label){case 0:return t=this,[4,this._element.getIdString()];case 1:return t.idStr=e.sent(),this.emitChange(),[2,this.idStr]}})})},e.prototype.saveProduct=function(){return Object(n.b)(this,void 0,void 0,function(){var t,e,i,r,s;return Object(n.e)(this,function(n){switch(n.label){case 0:return t=this,[4,this._element.save()];case 1:return t.stateId=n.sent(),e=this.params.config.preview,i=e.width,r=e.height,s=this,[4,this._element.getPreviewLink(this.stateId,i,r)];case 2:return s.previewUrlLink=n.sent(),this.emitChange(),[2]}})})},e.prototype._itemPromise=function(){var t=this;return new Promise(function(e){if(t._element)e(t._element);else{var i=function(){setTimeout(function(){return Object(n.b)(t,void 0,void 0,function(){var t;return Object(n.e)(this,function(n){return this._iframeDoc&&(t=this._iframeDoc.getElementById("dd-editor"))&&(window.Aurigma=Object.assign(window.Aurigma,this._iframeWin.contentWindow.Aurigma),e(t)),this._element||i(),[2]})})},200)};i()}})},e.prototype._loadResources=function(){return Object(n.b)(this,void 0,void 0,function(){var t,e,i,r,s,o;return Object(n.e)(this,function(c){switch(c.label){case 0:return t=Date.now(),e=a.a.getPatchedUrl("static/data-driven-editor/script.html")+"?t="+t,i=a.a.getPatchedUrl("static/data-driven-editor/style.html")+"?t="+t,[4,Promise.all([a.a.loadHtml(e),a.a.loadHtml(i)])];case 1:return r=n.h.apply(void 0,[c.sent(),2]),s=r[0],o=r[1],this.script=s.replace("TextWhizzJS.wasm",""+a.a.getPatchedUrl("static/data-driven-editor/TextWhizzJS.wasm")),this.styles=o.replace("bo-icons.woff",""+a.a.getPatchedUrl("static/data-driven-editor/bo-icons.woff")),this.styles=o.replace("bo-icons.woff2",""+a.a.getPatchedUrl("static/data-driven-editor/bo-icons.woff2")),[2]}})})},e.prototype._initIFrame=function(t,e,i){return Object(n.b)(this,void 0,void 0,function(){var r,s,o;return Object(n.e)(this,function(n){return r=this.querySelectorShadow("#frameID"),s=r||r.contentWindow,(o=r.contentDocument||s.document).write('<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap" rel="stylesheet" />'),o.write('<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />'),o.write(this.script),o.write(this.styles),o.write("<style> .mat-button-toggle-button { height: 100%; } </style>"),o.write('\n      <script>\n        window[Symbol.for("viewerConfig")] = {\n          rulerEnabled: false,\n          frontEndTextRenderingEnabled: true,\n          canvasBackground: { color: "#ffffff" },\n          backendUrl: "'+t+"/api/atoms/v1/tenants/"+e+'",\n        }\n      <\/script>\n    '),o.write('\n      <script>\n        window[Symbol.for("textEditor")] = {\n          useSimpleFontList: false,\n          mode: '+(i?2:0)+" \n        };\n      <\/script>\n    "),o.write('<div style="width:100%; height:100%">\n          <au-data-driven-editor id="dd-editor"></au-data-driven-editor>\n      </div>'),this._iframeDoc=o,this._iframeWin=s,[2]})})},e=Object(n.c)([Object(s.a)("au-widget-data-driven-editor",o),Object(n.g)("design:paramtypes",[])],e)}(r.c)}}]);