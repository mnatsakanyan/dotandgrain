(window.multistep_editor_jsonpFunction=window.multistep_editor_jsonpFunction||[]).push([[45],{752:function(e,t,n){
/*! Hammer.JS - v1.1.3 - 2014-05-20
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */
!function(t,n){"use strict";var i=function e(t,n){return new e.Instance(t,n||{})};i.VERSION="1.1.3",i.defaults={behavior:{userSelect:"none",touchAction:"pan-y",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},i.DOCUMENT=document,i.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,i.HAS_TOUCHEVENTS="ontouchstart"in t,i.IS_MOBILE=/mobile|tablet|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),i.NO_MOUSEEVENTS=i.HAS_TOUCHEVENTS&&i.IS_MOBILE||i.HAS_POINTEREVENTS,i.CALCULATE_INTERVAL=25;var o={},r=i.DIRECTION_DOWN="down",a=i.DIRECTION_LEFT="left",s=i.DIRECTION_UP="up",l=i.DIRECTION_RIGHT="right",c=i.POINTER_MOUSE="mouse",u=i.POINTER_TOUCH="touch",h=i.POINTER_PEN="pen",d=i.EVENT_START="start",p=i.EVENT_MOVE="move",f=i.EVENT_END="end",g=i.EVENT_RELEASE="release",_=i.EVENT_TOUCH="touch";i.READY=!1,i.plugins=i.plugins||{},i.gestures=i.gestures||{};var v=i.utils={extend:function(e,t,n){for(var i in t)!t.hasOwnProperty(i)||void 0!==e[i]&&n||(e[i]=t[i]);return e},on:function(e,t,n){e.addEventListener(t,n,!1)},off:function(e,t,n){e.removeEventListener(t,n,!1)},each:function(e,t,n){var i,o;if("forEach"in e)e.forEach(t,n);else if(void 0!==e.length){for(i=0,o=e.length;i<o;i++)if(!1===t.call(n,e[i],i,e))return}else for(i in e)if(e.hasOwnProperty(i)&&!1===t.call(n,e[i],i,e))return},inStr:function(e,t){return e.indexOf(t)>-1},inArray:function(e,t){if(e.indexOf){var n=e.indexOf(t);return-1!==n&&n}for(var i=0,o=e.length;i<o;i++)if(e[i]===t)return i;return!1},toArray:function(e){return Array.prototype.slice.call(e,0)},hasParent:function(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(e){var t=[],n=[],i=[],o=[],r=Math.min,a=Math.max;return 1===e.length?{pageX:e[0].pageX,pageY:e[0].pageY,clientX:e[0].clientX,clientY:e[0].clientY}:(v.each(e,function(e){t.push(e.pageX),n.push(e.pageY),i.push(e.clientX),o.push(e.clientY)}),{pageX:(r.apply(Math,t)+a.apply(Math,t))/2,pageY:(r.apply(Math,n)+a.apply(Math,n))/2,clientX:(r.apply(Math,i)+a.apply(Math,i))/2,clientY:(r.apply(Math,o)+a.apply(Math,o))/2})},getVelocity:function(e,t,n){return{x:Math.abs(t/e)||0,y:Math.abs(n/e)||0}},getAngle:function(e,t){var n=t.clientX-e.clientX,i=t.clientY-e.clientY;return 180*Math.atan2(i,n)/Math.PI},getDirection:function(e,t){return Math.abs(e.clientX-t.clientX)>=Math.abs(e.clientY-t.clientY)?e.clientX-t.clientX>0?a:l:e.clientY-t.clientY>0?s:r},getDistance:function(e,t){var n=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.sqrt(n*n+i*i)},getScale:function(e,t){return e.length>=2&&t.length>=2?this.getDistance(t[0],t[1])/this.getDistance(e[0],e[1]):1},getRotation:function(e,t){return e.length>=2&&t.length>=2?this.getAngle(t[1],t[0])-this.getAngle(e[1],e[0]):0},isVertical:function(e){return e==s||e==r},setPrefixedCss:function(e,t,n,i){var o=["","Webkit","Moz","O","ms"];t=v.toCamelCase(t);for(var r=0;r<o.length;r++){var a=t;if(o[r]&&(a=o[r]+a.slice(0,1).toUpperCase()+a.slice(1)),a in e.style){e.style[a]=(null==i||i)&&n||"";break}}},toggleBehavior:function(e,t,n){if(t&&e&&e.style){v.each(t,function(t,i){v.setPrefixedCss(e,i,t,n)});var i=n&&function(){return!1};"none"==t.userSelect&&(e.onselectstart=i),"none"==t.userDrag&&(e.ondragstart=i)}},toCamelCase:function(e){return e.replace(/[_-]([a-z])/g,function(e){return e[1].toUpperCase()})}};i.Instance=function(e,t){var n=this;i.READY||(m.determineEventTypes(),v.each(i.gestures,function(e){b.register(e)}),m.onTouch(i.DOCUMENT,p,b.detect),m.onTouch(i.DOCUMENT,f,b.detect),i.READY=!0),this.element=e,this.enabled=!0,v.each(t,function(e,n){delete t[n],t[v.toCamelCase(n)]=e}),this.options=v.extend(v.extend({},i.defaults),t||{}),this.options.behavior&&v.toggleBehavior(this.element,this.options.behavior,!0),this.eventStartHandler=m.onTouch(e,d,function(e){n.enabled&&e.eventType==d?b.startDetect(n,e):e.eventType==_&&b.detect(e)}),this.eventHandlers=[]},i.Instance.prototype={on:function(e,t){var n=this;return m.on(n.element,e,t,function(e){n.eventHandlers.push({gesture:e,handler:t})}),n},off:function(e,t){var n=this;return m.off(n.element,e,t,function(e){var i=v.inArray({gesture:e,handler:t});!1!==i&&n.eventHandlers.splice(i,1)}),n},trigger:function(e,t){t||(t={});var n=i.DOCUMENT.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t;var o=this.element;return v.hasParent(t.target,o)&&(o=t.target),o.dispatchEvent(n),this},enable:function(e){return this.enabled=e,this},dispose:function(){var e,t;for(v.toggleBehavior(this.element,this.options.behavior,!1),e=-1;t=this.eventHandlers[++e];)v.off(this.element,t.gesture,t.handler);return this.eventHandlers=[],m.off(this.element,o[d],this.eventStartHandler),null}};var m=i.event={preventMouseEvents:!1,started:!1,shouldDetect:!1,on:function(e,t,n,i){var o=t.split(" ");v.each(o,function(t){v.on(e,t,n),i&&i(t)})},off:function(e,t,n,i){var o=t.split(" ");v.each(o,function(t){v.off(e,t,n),i&&i(t)})},onTouch:function(e,t,n){var r=this,a=function(o){var a,s=o.type.toLowerCase(),l=i.HAS_POINTEREVENTS,c=v.inStr(s,"mouse");c&&r.preventMouseEvents||(c&&t==d&&0===o.button?(r.preventMouseEvents=!1,r.shouldDetect=!0):l&&t==d?r.shouldDetect=1===o.buttons||y.matchType(u,o):c||t!=d||(r.preventMouseEvents=!0,r.shouldDetect=!0),l&&t!=f&&y.updatePointer(t,o),r.shouldDetect&&(a=r.doDetect.call(r,o,t,e,n)),a==f&&(r.preventMouseEvents=!1,r.shouldDetect=!1,y.reset()),l&&t==f&&y.updatePointer(t,o))};return this.on(e,o[t],a),a},doDetect:function(e,t,n,i){var o=this.getTouchList(e,t),r=o.length,a=t,s=o.trigger,l=r;t==d?s=_:t==f&&(s=g,l=o.length-(e.changedTouches?e.changedTouches.length:1)),l>0&&this.started&&(a=p),this.started=!0;var c=this.collectEventData(n,a,o,e);return t!=f&&i.call(b,c),s&&(c.changedLength=l,c.eventType=s,i.call(b,c),c.eventType=a,delete c.changedLength),a==f&&(i.call(b,c),this.started=!1),a},determineEventTypes:function(){var e;return e=i.HAS_POINTEREVENTS?t.PointerEvent?["pointerdown","pointermove","pointerup pointercancel lostpointercapture"]:["MSPointerDown","MSPointerMove","MSPointerUp MSPointerCancel MSLostPointerCapture"]:i.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],o[d]=e[0],o[p]=e[1],o[f]=e[2],o},getTouchList:function(e,t){if(i.HAS_POINTEREVENTS)return y.getTouchList();if(e.touches){if(t==p)return e.touches;var n=[],o=[].concat(v.toArray(e.touches),v.toArray(e.changedTouches)),r=[];return v.each(o,function(e){!1===v.inArray(n,e.identifier)&&r.push(e),n.push(e.identifier)}),r}return e.identifier=1,[e]},collectEventData:function(e,t,n,i){var o=u;return v.inStr(i.type,"mouse")||y.matchType(c,i)?o=c:y.matchType(h,i)&&(o=h),{center:v.getCenter(n),timeStamp:Date.now(),target:i.target,touches:n,eventType:t,pointerType:o,srcEvent:i,preventDefault:function(){var e=this.srcEvent;e.preventManipulation&&e.preventManipulation(),e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return b.stopDetect()}}}},y=i.PointerEvent={pointers:{},getTouchList:function(){var e=[];return v.each(this.pointers,function(t){e.push(t)}),e},updatePointer:function(e,t){e==f||e!=f&&1!==t.buttons?delete this.pointers[t.pointerId]:(t.identifier=t.pointerId,this.pointers[t.pointerId]=t)},matchType:function(e,t){if(!t.pointerType)return!1;var n=t.pointerType,i={};return i[c]=n===(t.MSPOINTER_TYPE_MOUSE||c),i[u]=n===(t.MSPOINTER_TYPE_TOUCH||u),i[h]=n===(t.MSPOINTER_TYPE_PEN||h),i[e]},reset:function(){this.pointers={}}},b=i.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(e,t){this.current||(this.stopped=!1,this.current={inst:e,startEvent:v.extend({},t),lastEvent:!1,lastCalcEvent:!1,futureCalcEvent:!1,lastCalcData:{},name:""},this.detect(t))},detect:function(e){if(this.current&&!this.stopped){e=this.extendEventData(e);var t=this.current.inst,n=t.options;return v.each(this.gestures,function(i){!this.stopped&&t.enabled&&n[i.name]&&i.handler.call(i,e,t)},this),this.current&&(this.current.lastEvent=e),e.eventType==f&&this.stopDetect(),e}},stopDetect:function(){this.previous=v.extend({},this.current),this.current=null,this.stopped=!0},getCalculatedData:function(e,t,n,o,r){var a=this.current,s=!1,l=a.lastCalcEvent,c=a.lastCalcData;l&&e.timeStamp-l.timeStamp>i.CALCULATE_INTERVAL&&(t=l.center,n=e.timeStamp-l.timeStamp,o=e.center.clientX-l.center.clientX,r=e.center.clientY-l.center.clientY,s=!0),e.eventType!=_&&e.eventType!=g||(a.futureCalcEvent=e),a.lastCalcEvent&&!s||(c.velocity=v.getVelocity(n,o,r),c.angle=v.getAngle(t,e.center),c.direction=v.getDirection(t,e.center),a.lastCalcEvent=a.futureCalcEvent||e,a.futureCalcEvent=e),e.velocityX=c.velocity.x,e.velocityY=c.velocity.y,e.interimAngle=c.angle,e.interimDirection=c.direction},extendEventData:function(e){var t=this.current,n=t.startEvent,i=t.lastEvent||n;e.eventType!=_&&e.eventType!=g||(n.touches=[],v.each(e.touches,function(e){n.touches.push({clientX:e.clientX,clientY:e.clientY})}));var o=e.timeStamp-n.timeStamp,r=e.center.clientX-n.center.clientX,a=e.center.clientY-n.center.clientY;return this.getCalculatedData(e,i.center,o,r,a),v.extend(e,{startEvent:n,deltaTime:o,deltaX:r,deltaY:a,distance:v.getDistance(n.center,e.center),angle:v.getAngle(n.center,e.center),direction:v.getDirection(n.center,e.center),scale:v.getScale(n.touches,e.touches),rotation:v.getRotation(n.touches,e.touches)}),e},register:function(e){var t=e.defaults||{};return void 0===t[e.name]&&(t[e.name]=!0),v.extend(i.defaults,t,!0),e.index=e.index||1e3,this.gestures.push(e),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}};!function(e){var t=!1;i.gestures.Drag={name:e,index:50,handler:function(n,i){var o=b.current;if(!(i.options.dragMaxTouches>0&&n.touches.length>i.options.dragMaxTouches))switch(n.eventType){case d:t=!1;break;case p:if(n.distance<i.options.dragMinDistance&&o.name!=e)return;var c=o.startEvent.center;if(o.name!=e&&(o.name=e,i.options.dragDistanceCorrection&&n.distance>0)){var u=Math.abs(i.options.dragMinDistance/n.distance);c.pageX+=n.deltaX*u,c.pageY+=n.deltaY*u,c.clientX+=n.deltaX*u,c.clientY+=n.deltaY*u,n=b.extendEventData(n)}(o.lastEvent.dragLockToAxis||i.options.dragLockToAxis&&i.options.dragLockMinDistance<=n.distance)&&(n.dragLockToAxis=!0);var h=o.lastEvent.direction;n.dragLockToAxis&&h!==n.direction&&(v.isVertical(h)?n.direction=n.deltaY<0?s:r:n.direction=n.deltaX<0?a:l),t||(i.trigger(e+"start",n),t=!0),i.trigger(e,n),i.trigger(e+n.direction,n);var _=v.isVertical(n.direction);(i.options.dragBlockVertical&&_||i.options.dragBlockHorizontal&&!_)&&n.preventDefault();break;case g:t&&n.changedLength<=i.options.dragMaxTouches&&(i.trigger(e+"end",n),t=!1);break;case f:t=!1}},defaults:{dragMinDistance:10,dragDistanceCorrection:!0,dragMaxTouches:1,dragBlockHorizontal:!1,dragBlockVertical:!1,dragLockToAxis:!1,dragLockMinDistance:25}}}("drag"),i.gestures.Gesture={name:"gesture",index:1337,handler:function(e,t){t.trigger(this.name,e)}},function(e){var t;i.gestures.Hold={name:e,index:10,defaults:{holdTimeout:500,holdThreshold:2},handler:function(n,i){var o=i.options,r=b.current;switch(n.eventType){case d:clearTimeout(t),r.name=e,t=setTimeout(function(){r&&r.name==e&&i.trigger(e,n)},o.holdTimeout);break;case p:n.distance>o.holdThreshold&&clearTimeout(t);break;case g:clearTimeout(t)}}}}("hold"),i.gestures.Release={name:"release",index:1/0,handler:function(e,t){e.eventType==g&&t.trigger(this.name,e)}},i.gestures.Swipe={name:"swipe",index:40,defaults:{swipeMinTouches:1,swipeMaxTouches:1,swipeVelocityX:.6,swipeVelocityY:.6},handler:function(e,t){if(e.eventType==g){var n=e.touches.length,i=t.options;if(n<i.swipeMinTouches||n>i.swipeMaxTouches)return;(e.velocityX>i.swipeVelocityX||e.velocityY>i.swipeVelocityY)&&(t.trigger(this.name,e),t.trigger(this.name+e.direction,e))}}},function(e){var t=!1;i.gestures.Tap={name:e,index:100,handler:function(n,i){var o,r,a,s,l=i.options,c=b.current,u=b.previous;switch(n.eventType){case d:t=!1;break;case p:t=t||n.distance>l.tapMaxDistance;break;case f:!v.inStr(n.srcEvent.type,"cancel")&&n.deltaTime<l.tapMaxTime&&!t&&(o=u&&u.lastEvent&&(a=u.lastEvent,s=n,h(a)&&h(s)?h(s)-h(a):s.timeStamp-a.timeStamp),r=!1,u&&u.name==e&&o&&o<l.doubleTapInterval&&n.distance<l.doubleTapDistance&&(i.trigger("doubletap",n),r=!0),r&&!l.tapAlways||(c.name=e,i.trigger(c.name,n)))}function h(e){return e.srcEvent&&e.srcEvent.timeStamp?e.srcEvent.timeStamp:null}},defaults:{tapMaxTime:250,tapMaxDistance:10,tapAlways:!0,doubleTapDistance:20,doubleTapInterval:300}}}("tap"),i.gestures.Touch={name:"touch",index:-1/0,defaults:{preventDefault:!1,preventMouse:!1},handler:function(e,t){t.options.preventMouse&&e.pointerType==c?e.stopDetect():(t.options.preventDefault&&e.preventDefault(),e.eventType==_&&t.trigger("touch",e))}},function(e){var t=!1;i.gestures.Transform={name:e,index:45,defaults:{transformMinScale:.01,transformMinRotation:1},handler:function(n,i){switch(n.eventType){case d:t=!1;break;case p:if(n.touches.length<2)return;var o=Math.abs(1-n.scale),r=Math.abs(n.rotation);if(o<i.options.transformMinScale&&r<i.options.transformMinRotation)return;b.current.name=e,t||(i.trigger(e+"start",n),t=!0),i.trigger(e,n),r>i.options.transformMinRotation&&i.trigger("rotate",n),o>i.options.transformMinScale&&(i.trigger("pinch",n),i.trigger("pinch"+(n.scale<1?"in":"out"),n));break;case g:t&&n.changedLength<2&&(i.trigger(e+"end",n),t=!1)}}}}("transform"),t.Hammer=i,e.exports&&(e.exports=i)}(window)},932:function(e,t,n){"use strict";n.d(t,"a",function(){return sn});var i,o,r=n(385),a=n(411),s=n(435),l=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},c=function(){function e(e,t){this._service=e,this._imageLoaderService=t,this._multiCallInProgress=!1,this._multiCallItems=null,this._multiCallCallbacks=null,this._endMultiCallPromiseFuncs=null,this._multiCallInProgress=!1,this._multiCallItems=[],this._multiCallCallbacks=[],this._multiCallCounter=0,this._endMultiCallPromiseFuncs=[]}return e.prototype.increaseCounter=function(){this._multiCallCounter++},e.prototype.decreaseCounter=function(){return this._multiCallCounter--,this._multiCallCounter},e.prototype.enqueueEndMultiCall=function(){var e=this;return new Promise(function(t,n){return e._endMultiCallPromiseFuncs.push([t,n])})},Object.defineProperty(e.prototype,"multiCallStarted",{get:function(){return this._multiCallCounter>0},enumerable:!0,configurable:!0}),e.prototype.beginMultiCall=function(){this.increaseCounter()},e.prototype.endMultiCall=function(e){if(void 0===e&&(e=!0),this.decreaseCounter()>0)return this.enqueueEndMultiCall();if(null==this._multiCallItems||this._multiCallItems.length<1)return this._onMultiCallFinally(),Promise.resolve(!1);var t=this._multiCallItems,n=this._multiCallCallbacks,i=this._endMultiCallPromiseFuncs;return this._multiCallItems=[],this._multiCallCallbacks=[],this._endMultiCallPromiseFuncs=[],this._updateByMultiCall(t,n,i,e)},e.prototype.queueForMultiCall=function(e,t,n){return!this._multiCallInProgress&&(this._multiCallItems.push(e),this._multiCallCallbacks.push([t,n]),!0)},e.prototype._updateByMultiCall=function(e,t,n,i){var o=this;return void 0===i&&(i=!0),this._multiCallInProgress=!0,new Promise(function(r,a){var s=o._filter(e,t);o._updateByMultiCallRequest({items:s.items},function(e){return o._onMultiCallDone(e,s.callbacks,r,n,i)},function(i,r,s){return o._onMultiCallFailed(i,r,s,e,t,a,n)})})},e.prototype._filter=function(e,t){e=e.reverse(),t=t.reverse();var n=[],i=[];return{items:e=e.filter(function(e,t){return null!=e.itemData&&!i.includes(e.itemData.id)&&(i.push(e.itemData.id),n.push(t),!0)}),callbacks:n.map(function(e){return t[e]})}},e.prototype._onMultiCallDone=function(e,t,n,i,o){void 0===o&&(o=!0);try{o&&this._imageLoaderService.loadCombinedImage(e.combinedImageDescription);for(var r=e.items,a=0;a<r.length;a++)this._processItemResult(r[a],t[a])}finally{this._onMultiCallFinally(),n(!0),null!=i&&i.forEach(function(e){return e[0](!0)})}},e.prototype._processItemResult=function(e,t){try{var n=l(t,2),i=n[0],o=n[1];e.error?o({errorMessage:e.errorMessage}):i(e.result)}catch(e){console.error("Error while processing ItemHandlers service response",e)}},e.prototype._onMultiCallFailed=function(e,t,n,i,o,r,a){try{for(var s=0;s<o.length;s++)o[s][1]&&o[s][1](e,t,n)}finally{this._onMultiCallFinally(),r(),null!=a&&a.forEach(function(e){return e[1]()})}},e.prototype._updateByMultiCallRequest=function(e,t,n){this._service.sendRequest("UpdateByMultiCallRequest",e,t,n)},e.prototype._onMultiCallFinally=function(){this._multiCallInProgress=!1,this._multiCallItems=[],this._multiCallCallbacks=[]},e}(),u=n(474),h=n(404),d=function(){function e(e){this._serviceEndpoint=e,this.imageContainers={},this._fileCacheIdToCombined={},this._rectangles={},this._imageContainerLoadedEvent=new r.c}return e.prototype.loadCombinedImage=function(e){var t=this;if(null!=e){var n=new u.a(function(){return t._raiseImageLoadedEvent()});for(var i in this.imageContainers[e.fileCacheId]=n,n.updateUrl(this._getImageUrl(e.fileCacheId)),e.itemsRectangles)this._fileCacheIdToCombined[i]=e.fileCacheId,this._rectangles[i]=h.a.fromString(e.itemsRectangles[i])}},e.prototype.getImageContainerFor=function(e){if(!this.hasImageContainerFor(e))return null;var t=this._fileCacheIdToCombined[e];return this.imageContainers[t]},e.prototype.hasImageContainerFor=function(e){return null!=e&&void 0!==e&&0!==e.length&&e in this._fileCacheIdToCombined},e.prototype.getImageContainerRectangleFor=function(e){return this._rectangles[e]},e.prototype.addImageContainerLoaded=function(e){this._imageContainerLoadedEvent.add(e)},e.prototype.removeImageContainerLoaded=function(e){this._imageContainerLoadedEvent.remove(e)},e.prototype._getImageUrl=function(e){return this._serviceEndpoint+"/txt?f="+encodeURIComponent(e)},e.prototype._raiseImageLoadedEvent=function(){this._imageContainerLoadedEvent.notify(this)},e}(),p=n(440),f=n(382),g=function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}l((i=i.apply(e,t||[])).next())})},_=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},v=function(){return function(e,t,n,i,o){this._timeout=e,this._message=t,this._stacktrace=n,this._type=i,this._data=o}}(),m=function(){function e(e,t){void 0===t&&(t=6e4),this._serviceEndpoint=e,this._timeout=t,this._multiCallEnabled=!1,this._nextMultiCallRequest=null,this.imageLoaderService=new d(this._serviceEndpoint)}return Object.defineProperty(e.prototype,"multiCallEnabled",{get:function(){return this._multiCallEnabled},set:function(e){this._multiCallEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serviceEndpoint",{get:function(){return this._serviceEndpoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiCallStarted",{get:function(){return null!=this._nextMultiCallRequest&&this._nextMultiCallRequest.multiCallStarted},enumerable:!0,configurable:!0}),e.prototype.beginMultiCall=function(){this.multiCallEnabled&&(this.multiCallStarted||(this._nextMultiCallRequest=new c(this,this.imageLoaderService)),this._nextMultiCallRequest.beginMultiCall())},e.prototype.endMultiCall=function(e){if(void 0===e&&(e=!0),!this.multiCallEnabled)return Promise.resolve(!1);if(!this.multiCallStarted)throw new Error("ServiceProxy: beginMultiCall should be called first to start MultiCall.");return this._nextMultiCallRequest.endMultiCall(e)},e.prototype.UpdateImageItemHandler=function(e,t,n,i,o,r,a,s){var l={canvasData:e,itemHandlerData:t,itemData:n,actualSize:i,preserveAspectRatio:o,url:r};this.sendRequest("UpdateImageItemHandler",l,a,s)},e.prototype.UpdateBarcodeItemHandler=function(e,t,n,i,o){var r={canvasData:e,itemHandlerData:t,itemData:n};this.sendRequest("UpdateBarcodeItemHandler",r,i,o)},e.prototype.UpdateBoundedTextItemHandler=function(e,t,n,i,o){this._callUpdateItemHandler(e,t,n,i,o,"_updateBoundedTextItemHandler")},e.prototype._updateBoundedTextItemHandler=function(e,t,n,i,o){var r={itemData:n,canvasData:e,itemHandlerData:t};this.sendRequest("UpdateBoundedTextItemHandler",r,i,o)},e.prototype.UpdatePathBoundedTextItemHandler=function(e,t,n,i,o){var r={itemData:n,canvasData:e,itemHandlerData:t};this.sendRequest("UpdatePathBoundedTextItemHandler",r,i,o)},e.prototype.UpdatePlainTextItemHandler=function(e,t,n,i,o){this._callUpdateItemHandler(e,t,n,i,o,"_updatePlainTextItemHandler")},e.prototype._updatePlainTextItemHandler=function(e,t,n,i,o){var r={itemData:n,canvasData:e,itemHandlerData:t};this.sendRequest("UpdatePlainTextItemHandler",r,i,o)},e.prototype.UpdateAutoScaledTextItemHandler=function(e,t,n,i,o){var r={itemData:n,canvasData:e,itemHandlerData:t};this.sendRequest("UpdateAutoScaledTextItemHandler",r,i,o)},e.prototype.UpdateArchedTextItemHandler=function(e,t,n,i,o){var r={itemData:n,canvasData:e,itemHandlerData:t};this.sendRequest("UpdateArchedTextItemHandler",r,i,o)},e.prototype.UpdateCurvedTextItemHandler=function(e,t,n,i,o){var r={itemData:n,canvasData:e,itemHandlerData:t};this.sendRequest("UpdateCurvedTextItemHandler",r,i,o)},e.prototype.UpdateByColorData=function(e,t,n,i){this._callUpdateItemHandler(e,t,null,n,i,"_updateByColorData")},e.prototype._updateByColorData=function(e,t,n,i,o){var r={canvasData:e,colorData:t};this.sendRequest("UpdateByColorData",r,i,o)},e.prototype.UpdateByRectangleItemHandlerData=function(e,t,n,i,o){this.UpdateShapeItemHandler(e,t,n,i,o)},e.prototype.UpdateShapeItemHandler=function(e,t,n,i,o){this._callUpdateItemHandler(e,t,n,i,o,"_updateShapeItemHandler")},e.prototype._updateShapeItemHandler=function(e,t,n,i,o){var r={canvasData:e,itemData:n,itemHandlerData:t};this.sendRequest("UpdateShapeItemHandler",r,i,o)},e.prototype.GetImageSize=function(e,t,n,i){this._getImageSize(e,t,n,i)},e.prototype._getImageSize=function(e,t,n,i){var o={imageId:e,pageIndex:t};this.sendRequest("GetImageSize",o,n,i)},e.prototype.render=function(e,t,n,i){var o={product:e,renderingConfig:t};this.sendRequest("render",o,n,i)},e.prototype.getWatermarkItemsAsync=function(e,t,n){var i=this,o={width:e,height:t,watermarkConfig:n};return new Promise(function(e,t){i.sendRequest("getWatermarkItems",o,function(t){e(t)},function(e,n,i){return t({error:e,userContext:n,methodName:i})})})},e.prototype.getWatermarkItems=function(e,t,n,i,o){var r={width:e,height:t,watermarkConfig:n};this.sendRequest("getWatermarkItems",r,i,o)},e.prototype.getPathBoundsFromServer=function(e){return g(this,void 0,void 0,function(){var t,n;return _(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,p.e({type:p.b.post,url:this.serviceEndpoint+"/GetShapeBounds",headers:[p.a.json],data:JSON.stringify({path:e.toString()})})];case 1:return t=i.sent(),[2,f.RectangleF.FromObject(JSON.parse(t.value))];case 2:return n=i.sent(),console.error("Unable to load shape bounds. Reason: "+n),[3,3];case 3:return[2]}})})},e.prototype.sendRequest=function(e,t,n,i,o){void 0===o&&(o=!1);var r=new XMLHttpRequest,a=this._serviceEndpoint;"render"===e&&(a=a.replace("api/ccviewer","api/rendering")),r.open("POST",a+"/"+e),o&&(r.responseType="arraybuffer"),r.setRequestHeader("Content-Type","application/json; charset=UTF-8"),r.timeout=this._timeout,r.onload=function(t){if(200===r.status)o?n(r.response,r):n(JSON.parse(r.response));else{var a=new v(!1,r.statusText,r.response);i(a,null,e)}},r.onerror=function(t){i("error",null,e)},r.ontimeout=function(t){var n=new v(!0,r.statusText,r.response);i(n,null,e)};var s=JSON.stringify(t);r.send(s)},e.prototype._callUpdateItemHandler=function(e,t,n,i,o,r){var a=r;r.startsWith("_")&&(a=r.charAt(1).toUpperCase()+r.substring(2));var s={canvasData:e,itemHandlerData:t,itemData:n,methodName:a};null!=this._nextMultiCallRequest&&this._nextMultiCallRequest.multiCallStarted&&this._nextMultiCallRequest.queueForMultiCall(s,i,o)||this[r](e,t,n,i,o)},e}(),y=n(394),b=n(534),C=n(381),w=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),E=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},x=function(e){function t(t){var n=e.call(this)||this;return n._canvas=t,n}return w(t,e),t.prototype.getLayerById=function(e){for(var t=0,n=this.length;t<n;t++){var i=this.getItem(t);if(i.uniqueId==e)return i}return null},t.prototype.getLayerByContainerId=function(e){for(var t=0,n=this.length;t<n;t++){var i=this.getItem(t);if(i.container.id==e)return i}return null},t.prototype.getLayersByName=function(e){for(var t=[],n=0;n<this.length;n++)this.getItem(n).name==e&&t.push(this.getItem(n));return t},t.prototype.getItemHandlersByName=function(e){for(var t=[],n=0;n<this.length;n++)for(var i=this.getItem(n),o=0;o<i.itemHandlers.length;o++)i.itemHandlers.getItem(o).name===e&&t.push(i.itemHandlers.getItem(o));return t},t.prototype._onLayerAdded=function(e,t){var n=this._canvas;n&&(e.canvas=n,e.onLayerAdded())},t.prototype._onLayerMoved=function(e,t,n){this._canvas},t.prototype.removeRange=function(t,n){var i=function(e){this._onLayerRemoved(e.item,e.index)}.bind(this);try{return this.add_itemRemoved(i),e.prototype.removeRange.call(this,t,n)}finally{this.remove_itemRemoved(i)}},t.prototype.insertAt=function(t,n){var i,o;Array.isArray(n)||(n=[n]);try{for(var r=E(n),a=r.next();!a.done;a=r.next()){var s=a.value;if(this.contains(s))throw new C.a(b.b)}}catch(e){i={error:e}}finally{try{a&&!a.done&&(o=r.return)&&o.call(r)}finally{if(i)throw i.error}}e.prototype.insertAt.call(this,t,n);for(var l=0;l<n.length;l++){var c=n[l];this._onLayerAdded(c,this._collection.indexOf(c))}},t.prototype.move=function(t,n){var i=e.prototype.move.call(this,t,n);return i&&this._onLayerMoved(i,t,n),i},t.prototype.clear=function(){var t,n;try{for(var i=E(this),o=i.next();!o.done;o=i.next()){o.value.dispose()}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.prototype.clear.call(this)},t}(y.a),P=n(477),S=n(425),I=n(415),T=n(574),D=n(410),k=n(562),M=n(392),H=n(383),B=function(){function e(e,t){this._snapLinesHandler=t,this._parentSelectionRectangle=null,this._selectedItemHandlersChangedEvent=new r.c,this._skipUpdate=!1,this._locked=!1,this._canvas=e,this._enabled=!0,this._multipleSelectionEnabled=!1,this._currentItemHandler=null,this._itemHandlers=new y.a,this._rectangle=null,this._rectangleWithFrames=null,this._border=null,this._rubberband=null,this._region=null,this._needRedraw=!1,this._shiftState=!1,this._resizeLastPoint=null}return Object.defineProperty(e.prototype,"offset",{get:function(){return this._offset},set:function(e){null!=e&&e.equals(this._offset)||null==e&&null!=this.offset||(this._offset=e)},enumerable:!0,configurable:!0}),e.prototype.enable=function(){this.update(),this._enabled=!0},e.prototype.disable=function(){this._enabled=!1,this._canvas.hideSelection()},e.setIsSafetyLineItemHandlerFunc=function(e){this._isSafetyLineItemHandlersFunc=e},e.isSafetyLineItemHandler=function(t){if(e._isSafetyLineItemHandlersFunc)return e._isSafetyLineItemHandlersFunc(t)},Object.defineProperty(e.prototype,"history",{get:function(){return this._history},set:function(e){this._history=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multipleSelectionEnabled",{get:function(){return this._multipleSelectionEnabled&&!M.a.IsTouchDevice()&&!this.getSelectedItemHandlers().any(function(e){return e.item.parentGroupItem instanceof H.LayoutItem})},set:function(e){this._multipleSelectionEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentItemHandler",{get:function(){return null!=this._currentItemHandler&&null==this._currentItemHandler.canvas&&this.clearSelectedItemHandlers(),this._currentItemHandler},set:function(e){e!==this._currentItemHandler&&(this._currentItemHandler=e,this._canvas.onCurrentItemHandlerChanged(e))},enumerable:!0,configurable:!0}),e.prototype.lock=function(e){void 0===e&&(e=!1),this._locked=!0,e||this._itemHandlers.clear(),this._canvas.onSelectionLocked(),this._canvas.hideSelection(),this._canvas.redraw()},e.prototype.unlock=function(){this._locked=!1,this._canvas.redraw()},Object.defineProperty(e.prototype,"isLocked",{get:function(){return this._locked},enumerable:!0,configurable:!0}),e.prototype.getSelectedItemHandlers=function(){return this._itemHandlers},e.prototype.setSelectedItemHandlers=function(e,t){if(void 0===t&&(t=!1),"[object Array]"===Object.prototype.toString.call(e)&&!this._locked){t||this.clearSelectedItemHandlers();for(var n=0;n<this._itemHandlers.length;n++){var i=this._itemHandlers.get(n);this._canvas.isPlaceholder(i)&&(i.editing=!1)}this.multipleSelectionEnabled||e.splice(1,e.length-1);for(n=0;n<e.length;n++)this._itemHandlers.push(e[n]);this._onSelectedItemHandlersChanged();var o=this._itemHandlers.length>=1?this._itemHandlers.get(this._itemHandlers.length-1):null;this.currentItemHandler=o}},e.prototype.isItemHandlerSelected=function(e){return this._itemHandlers.contains(e)},e.prototype.isOnlyThisItemHandlerSelected=function(e){return this.isItemHandlerSelected(e)&&1===this._itemHandlers.length},Object.defineProperty(e.prototype,"needRedraw",{get:function(){return this._needRedraw},enumerable:!0,configurable:!0}),e.prototype.addSelectedItemHandler=function(e){!this.multipleSelectionEnabled&&this._itemHandlers.length>0&&this._itemHandlers.clear(),this.setSelectedItemHandlers([e],!0)},e.prototype.removeSelectedItemHandler=function(e){this._itemHandlers.remove(e),this._onSelectedItemHandlersChanged(),e instanceof a.a&&(e.editing=!1),this._itemHandlers.length>0?this.currentItemHandler=this._itemHandlers.getItem(this._itemHandlers.length-1):this.currentItemHandler=null},e.prototype.clearSelectedItemHandlers=function(){for(var e=0;e<this._itemHandlers.length;e++){var t=this._itemHandlers.getItem(e);t instanceof a.a&&(t.editing=!1)}this._itemHandlers.clear(),this._updateParentSelectionRectangle(),this._onSelectedItemHandlersChanged(),this.currentItemHandler=null,this._canvas.hideSelection()},Object.defineProperty(e.prototype,"visibleRectangle",{get:function(){return this._getVisibleSelectionRectangle(this._rectangle)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visibleParentSelectionRectangle",{get:function(){return this._parentSelectionRectangle},enumerable:!0,configurable:!0}),e.prototype._getVisibleSelectionRectangle=function(e){if(null==e)return null;var t=e.clone();if(t.width=Math.abs(t.width),t.height=Math.abs(t.height),null!=this._border){var n=t.toRectangleF(),i=t.angle;(t=f.RotatedRectangleF.FromLTRB(n.left-this._border.left,n.top-this._border.top,n.right+this._border.right,n.bottom+this._border.bottom)).angle=i}return t},e.prototype.hitTest=function(e,t){if(!this._enabled)return{};var n,i,o=this.visibleRectangle;if(null==o)return{selection:0===this._canvas.getItemHandlersByHitTest(e).length};n=this._itemHandlers.length>1?this._itemHandlers.toArray().reduce(function(e,t){return Math.min(e,t.getSelectionTolerance())},this._itemHandlers.getItem(0).getSelectionTolerance()):(i=this._itemHandlers.getItem(0)).getSelectionTolerance();var r=1===this._itemHandlers.length&&this._currentItemHandler instanceof P.a,s=this._canvas.hitTestSelection(o,e,r,n),l=!1;if(null!=i&&i instanceof a.a){if(i.isContentUpdating()&&s.body&&!s.resize)return s.drag=!0,s;l=i.editing&&i.isCoverMode()}var c=this._permissions;if(s.rotate=s.rotate&&c.allowRotate&&!l&&this._allowManipulation,s.resize){var u=s.resizeIndex,h=(5===u||6===u||7===u||8===u)&&this._getEdgeResize(c,i),d=(1===u||2===u||3===u||4===u)&&this._getCornerResize(c,i,!1,I.a.arbitrary),p=(1===u||2===u||3===u||4===u)&&this._getCornerResize(c,i,!0,I.a.arbitrary),f=(1===u||2===u||3===u||4===u)&&this._getCornerResize(c,i,!1,I.a.proportional),g=(1===u||2===u||3===u||4===u)&&this._getCornerResize(c,i,!0,I.a.proportional);s.arbitraryResize=h||d,s.cornerArbitraryResize=d||p,s.cornerProportionalResize=f||g,s.proportionalResize=f&&!r,s.resize=s.arbitraryResize||s.proportionalResize}return s.dragX=s.body&&c.allowMoveHorizontal&&this._allowManipulation,s.dragY=s.body&&c.allowMoveVertical&&this._allowManipulation,s.drag=s.dragX||s.dragY,s},e.prototype._getEdgeResize=function(e,t){return!(null!=t&&"PlainTextItemHandler"===t.getTypeName()||!this._allowManipulation)&&e.resizeGrips.edge},e.prototype._getCornerResize=function(e,t,n,i){if(i===I.a.arbitrary&&null!=t&&"PlainTextItemHandler"===t.getTypeName()||!this._allowManipulation)return!1;var o=e.resizeGrips;return null!=o.corner&&0!==o.corner.length&&(n&&o.corner.length>1?o.corner[1]:o.corner[0])===i},e.prototype.getCursor=function(e){var t=this.hitTest(e,!1),n=D.a,i=this._permissions;if(t.resize){var o=this._canvas.viewer.contentAngle,r=Object(f.normalizeAngle)(this._rectangle.angle-o),a=([315,45,135,225,270,0,90,180][t.resizeIndex-1]+r)%360;if(a>337.5||a<=22.5)return n.sizeNS;if(a>22.5&&a<=67.5)return n.sizeNESW;if(a>67.5&&a<=112.5)return n.sizeEW;if(a>112.5&&a<=157.5)return n.sizeNWSE;if(a>157.5&&a<=202.5)return n.sizeNS;if(a>202.5&&a<=247.5)return n.sizeNESW;if(a>247.5&&a<=292.5)return n.sizeEW;if(a>292.5&&a<=337.5)return n.sizeNWSE}else{if(t.rotate)return n.pointer;if(t.body&&(i.allowMoveHorizontal||i.allowMoveVertical&&this._allowManipulation))return n.move}return n.defaultCursor},e.prototype.update=function(){if(!this._skipUpdate)if(this._itemHandlers.length>0){var e=this._itemHandlers.getItem(0),t=e.getBorderMargin();if(1===this._itemHandlers.length)this._rectangle=e.getSelectionRectangle(),this._border={left:t,top:t,right:t,bottom:t};else{for(var n=e.getSelectionRectangle().bounds,i=n.left,o=n.top,r=n.right,a=n.bottom,s={left:t,top:t,right:t,bottom:t},l=1;l<this._itemHandlers.length;l++)t=(e=this._itemHandlers.getItem(l)).getBorderMargin(),(n=e.getSelectionRectangle().bounds).left-t<i-s.left&&(i=n.left,s.left=t),n.top-t<o-s.top&&(o=n.top,s.top=t),n.right+t>r+s.right&&(r=n.right,s.right=t),n.bottom+t>a+s.bottom&&(a=n.bottom,s.bottom=t);this._rectangle=f.RotatedRectangleF.FromLTRB(i,o,r,a),this._border=s}this._updateParentSelectionRectangle(),this._rectangleWithFrames=this._getRectWithFrames(this._rectangle),this._region=this._getRegion()}else this._rectangle=null,this._border=null,this._region=null},e.prototype._updateParentSelectionRectangle=function(){var e=null;if(null!=this._itemHandlers&&this._itemHandlers.any()&&(e=this._itemHandlers.getItem(0).item.parentGroupItem),null!=e){var t=this._canvas.handlerFactory.get(e);if(t.isEmpty())this._parentSelectionRectangle=null;else{var n=t.getSelectionRectangle();this._parentSelectionRectangle=n}}else this._parentSelectionRectangle=null},e.prototype._isItemHandlerVisible=function(e){return e.isVisible()},e.prototype.draw=function(e,t){if(this._enabled&&!this._locked){null!=this._rubberband?t.drawRubberband(e,this._rubberband):this._needRedraw=!1;var n=this.visibleRectangle;if(null==n||0===this._itemHandlers.where(function(e){return e.isVisible()}).count())return this._canvas.hideSelection(),void this._canvas.showParentSelection(this.visibleParentSelectionRectangle);var i=!1,o=!1,r=!1,s=null;if(1===this._itemHandlers.length)i=(s=this._itemHandlers.getItem(0))instanceof P.a,r=s instanceof a.a&&s.editing;else for(var l=0;l<this._itemHandlers.length;l++){var c=this._itemHandlers.getItem(l);c instanceof P.a&&(o=!0),c instanceof a.a&&c.editing&&(r=!0)}var u=r&&this._itemHandlers.getItem(0).item.isCoverMode,h=this._permissions,d={rotate:h.allowRotate&&!u&&this._allowManipulation,resize:(this._getCornerResize(h,s,!1,I.a.arbitrary)||this._getCornerResize(h,s,!1,I.a.proportional))&&!i,arbitraryWidthResize:this._getEdgeResize(h,s)&&!o&&!u,arbitraryHeightResize:this._getEdgeResize(h,s)&&!i&&!o&&!u};this._canvas.showSelection(n,d),this._canvas.showParentSelection(this.visibleParentSelectionRectangle),null!==this._canvas.hoverDiv&&(null!==s?this._canvas.updateHoverPosition(s.rectangle,s.item.name):this._canvas.hideHover()),r||this._snapLinesHandler.drawActiveLines(e,t)}},e.prototype.processKeyEvent=function(e){if(null!=this._rectangle){var t=this._permissions;if(((e.keyCode===T.a.Left||e.keyCode===T.a.Right)&&t.allowMoveHorizontal||(e.keyCode===T.a.Up||e.keyCode===T.a.Down)&&t.allowMoveVertical)&&this._allowManipulation)if("keydown"===e.type&&void 0===this._operation){var n=!0===e.shiftKey?5:1;this._keyPushed||this._startTransform(),this._keyPushed=!0,this._keyCode=e.keyCode,this._move(e.keyCode,n)}else"keyup"===e.type&&this._keyPushed&&this._keyCode===e.keyCode&&(this._keyPushed=!1,this._endTransform());if(16===e.keyCode&&this._allowManipulation){var i=e.shiftKey;i!==this._shiftState&&(this._shiftState=i,this._operation&&this._operation.resize&&this._resize(null))}}},e.prototype.startTransform=function(e){this._startPoint=e,this._startTransform(),this._startRubberbandSelection(),this._fillSnapData()},e.prototype.processMouseEvent=function(e,t){void 0===t&&(t=!1);var n=new f.PointF(e.x,e.y);if("mousedown"===e.type)this._operation=this.hitTest(n,e.originalEvent.shiftKey),this.startTransform(n);else if("mouseup"===e.type){var i=this._operation&&this._operation.resize;delete this._operation,this._endTransform(i,t),this._endRubberbandSelection(),this._snapLinesHandler.clearSnapData(),delete this._startPoint}else if("mousemove"===e.type&&null!=this._operation&&null!=this._startPoint){if(this._operation.selection)this._updateRubberband(n);else if(this._operation.resize)this._resize(n);else if(this._operation.rotate)this._rotate(n,!(e.originalEvent.ctrlKey||e.originalEvent.metaKey),e.originalEvent.shiftKey);else if(this._operation.drag){var o=this._permissions,r=o.allowMoveHorizontal&&this._allowManipulation?n.x:this._startPoint.x,a=o.allowMoveVertical&&this._allowManipulation?n.y:this._startPoint.y;this._drag(new f.PointF(r,a),e.originalEvent.ctrlKey||e.originalEvent.metaKey)}this._itemHandlers.length>0&&this._updateParentSelectionRectangle()}},e.prototype.processPinch=function(e){var t=this._currentItemHandler,n=t;if(t.editing){var i=t.rectangle,o=new f.RotatedRectangleF(t.rectangle.bounds.center.x,t.rectangle.bounds.center.y,i.width*e.gesture.scale,i.height*e.gesture.scale);null==n.startRectangle&&n._startTransform(),n._transformRectangle(i,o,!0)}},e.prototype._fillSnapData=function(){this._snapLinesHandler.fillSnapData(this._startRectangle,this._startRectangleWithFrames,null!=this._startRectangle&&null!=this._border?this._getRectangleWithBorder(this._startRectangle).bounds:null,this._region,this._canvas,this._operation)},e.prototype._constrainRectangleToSnapLines=function(e,t){return this._snapLinesHandler.constrainRectangleToSnapLines(e,this._getRectangleWithBorder(this._rectangle),t,this._operation,this._getRectWithFrames(e),this._getRectangleWithBorder(e),this._canvas)},e.prototype.isResizing=function(){return this._operation&&this._operation.resize},e.prototype.isRotating=function(){return this._operation&&this._operation.rotate},e.prototype.isOperationNotNull=function(){return null!=this._operation},Object.defineProperty(e.prototype,"angle",{set:function(e){this._startTransform();var t=this._rectangle.clone();t.angle=e,this._updateRectangle(t),this._endTransform(),this._canvas.redraw()},enumerable:!0,configurable:!0}),e.prototype._startTransform=function(){if(null!=this._rectangle){this._startRectangle=this._rectangle.clone(),this._startRectangleWithFrames=this._getRectWithFrames(this._startRectangle);for(var e=0;e<this._itemHandlers.length;e++)this._itemHandlers.getItem(e)._startTransform()}},e.prototype._endTransform=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),null!=this._rectangle){this._skipUpdate=!0;var n=!t&&null!=this._startRectangle&&!this._rectangle.equals(this._startRectangle);this.history&&this.history.pause();for(var i=0;i<this._itemHandlers.length;i++){var o=this._itemHandlers.getItem(i),r=e;n&&e&&(r=o._onResized()),o.endTransform(n,r)}n&&this._canvas.updateTexts(),this.history&&this.history.resume(),delete this._startRectangle,delete this._startRectangleWithFrames,this._skipUpdate=!1,e&&this.update()}},e.prototype._startRubberbandSelection=function(){null!=this._canvas.viewer&&this._canvas.viewer.ignoreDocumentClickOnce()},e.prototype._endRubberbandSelection=function(){if(null!=this._rubberband){var e=f.RectangleF.FromLTRB(this._rubberband.left,this._rubberband.top,this._rubberband.right,this._rubberband.bottom);if(!Object(f.EqualsOfFloatNumbers)(e.width,0)&&!Object(f.EqualsOfFloatNumbers)(e.height,0)){for(var t=[],n=this._canvas.getAllItemHandlers({onlyVisible:!0}),i=0;i<n.length;i++){var o=n[i];!this._canvas.isLockedOrDisabled(o)&&e.contains(o.rectangle.center)&&t.push(o)}this.setSelectedItemHandlers(t)}this._rubberband=null}},e.prototype._updateRubberband=function(e){this.multipleSelectionEnabled&&null!=this._startPoint&&(this._rubberband={left:Math.min(this._startPoint.x,e.x),top:Math.min(this._startPoint.y,e.y),right:Math.max(this._startPoint.x,e.x),bottom:Math.max(this._startPoint.y,e.y)},this._needRedraw=!0)},e.prototype.pinchResize=function(e,t,n){n._transformRectangle(e,t,!0)},e.prototype._resize=function(t){null==t&&(t=this._resizeLastPoint),this._resizeLastPoint=t;var n=this._operation.arbitraryResize;this._shiftState&&(n&&this._operation.cornerProportionalResize?n=!1:!n&&this._operation.cornerArbitraryResize&&(n=!0));var i,o=this._rectangle.clone(),r=new f.PointF(t.x-this._startRectangle.centerX,t.y-this._startRectangle.centerY);r.rotate(-o.angle);var a=new f.PointF(this._startPoint.x-this._startRectangle.centerX,this._startPoint.y-this._startRectangle.centerY);a.rotate(-o.angle);var s=r.translate(-a.x,-a.y),l=6,c=5,u=1,h=1;if(n)o.width=this._startRectangle.width+s.x*e.cw[this._operation.resizeIndex],o.height=this._startRectangle.height+s.y*e.ch[this._operation.resizeIndex],this._operation.resizeIndex!==l&&this._operation.resizeIndex!==c||(u=-1,h=-1),1===this._operation.resizeIndex&&(u=-1,h=-1),2===this._operation.resizeIndex&&(u=1,h=-1),4===this._operation.resizeIndex&&(u=-1,h=1);else{var d=s.x*e.cw[this._operation.resizeIndex]/this._startRectangle.width,p=s.y*e.ch[this._operation.resizeIndex]/this._startRectangle.height,g=d<p?d:p;s.x=this._startRectangle.width*g,s.y=this._startRectangle.height*g,o.width=this._startRectangle.width+s.x,o.height=this._startRectangle.height+s.y}if(this._allowNegativeResize||o.width>=0&&o.height>=0){if((i=new f.PointF(s.x/2*e.cw[this._operation.resizeIndex],s.y/2*e.ch[this._operation.resizeIndex])).rotate(o.angle),o.centerX=this._startRectangle.centerX+i.x*u,o.centerY=this._startRectangle.centerY+i.y*h,n){var _=i=new f.PointF(this._startRectangle.centerX,this._startRectangle.centerY);_.rotate(-o.angle),_.x=_.x+s.x/2*e.cw[this._operation.resizeIndex]*e.cw[this._operation.resizeIndex],_.y=_.y+s.y/2*e.ch[this._operation.resizeIndex]*e.ch[this._operation.resizeIndex],_.rotate(o.angle),o.centerX=_.x,o.centerY=_.y}}else{var v=new f.PointF(-e.cw[this._operation.resizeIndex]*this._rectangle.width/2,-e.ch[this._operation.resizeIndex]*this._rectangle.height/2);if(v.rotate(this._rectangle.angle),v.translate(this._rectangle.centerX,this._rectangle.centerY),o.center=v,n)o.width=Math.max(o.width,1),o.height=Math.max(o.height,1);else{var m=this._startRectangle.width/this._startRectangle.height;m>=1?(o.width=Math.max(o.width,1*m),o.height=Math.max(o.height,1)):(o.width=Math.max(o.width,1),o.height=Math.max(o.height,1/m))}var y=new f.PointF(e.cw[this._operation.resizeIndex]*o.width/2,e.ch[this._operation.resizeIndex]*o.height/2);y.rotate(o.angle),o.centerX+=y.x,o.centerY+=y.y}var b=this._canvas.contentEditingPlaceholderItemHandler;null!=b&&b.item.isCoverMode&&(o=this._constrainRectangleToPlaceholderCover(o,b.rectangle)),null==this._canvas.contentEditingPlaceholderItemHandler&&(o=this._constrainRectangleToSnapLines(o,n)),this._updateRectangle(o)},e.prototype._drag=function(e,t){var n=this._canvas.contentEditingPlaceholderItemHandler,i=new f.PointF(e.x-this._startPoint.x,e.y-this._startPoint.y);t?this._snapLinesHandler.resetActiveLines():null==this._canvas.contentEditingPlaceholderItemHandler&&(i=this._snapLinesHandler.constrainDiffToSnapLines(e,this._startPoint,this._canvas)),null==n?i=this._constrainDiffToRegion(this._startRectangleWithFrames.bounds,i):n.item.isCoverMode&&(i=this._constrainDiffToPlaceholderCover(this._startRectangle,n.rectangle,i));var o=this._rectangle.clone();o.centerX=this._startRectangle.centerX+i.x,o.centerY=this._startRectangle.centerY+i.y,this._updateRectangle(o,!0)},e.prototype._rotate=function(e,t,n){var i=e.clone(),o=this._startPoint,r=this._rectangle.clone(),a=new f.PointF(r.centerX,r.centerY),s=Object(f.getTriangleAngle)(i,o,a),l=n?15:90,c=t?n?7.5:5:0,u=s=Object(f.normalizeAngle)(this._startRectangle.angle+s),h=s%l;h<c?u=l*Math.floor(s/l):h>l-c&&(u=l*Math.floor(s/l+1)),r.angle=Object(f.normalizeAngle)(u),this._updateRectangle(r)},e.prototype._move=function(e,t){var n=t/this._canvas.mul,i=null;switch(e){case T.a.Up:i=new f.PointF(0,-n);break;case T.a.Down:i=new f.PointF(0,n);break;case T.a.Left:i=new f.PointF(-n,0);break;case T.a.Right:i=new f.PointF(n,0)}if(null!=i){var o=this._canvas.viewer.contentAngle;o>0&&i.rotate(-o);var r=this._canvas.contentEditingPlaceholderItemHandler;null==r?i=this._constrainDiffToRegion(this._rectangle.bounds,i):r.item.isCoverMode&&(i=this._constrainDiffToPlaceholderCover(this._rectangle,r.rectangle,i));var a=this._rectangle.clone();a.centerX+=i.x,a.centerY+=i.y,this._updateRectangle(a),this._updateParentSelectionRectangle()}},Object.defineProperty(e.prototype,"_permissions",{get:function(){if(null==this._rectangle||0===this._itemHandlers.length)return new k.a({},!1);var e=this._itemHandlers.getItem(0).getPermissions().clone();this._itemHandlers.length>1&&(this._rectangle.angle-this._itemHandlers.getItem(0).angle)%90!=0&&(e.resizeGrips.edge=!1,e.resizeGrips.setCornerArbitrary(!1));for(var t=1;t<this._itemHandlers.length;t++){var n=this._itemHandlers.getItem(t),i=n.getPermissions();i.allowMoveHorizontal||(e.allowMoveHorizontal=!1),i.allowMoveVertical||(e.allowMoveVertical=!1),i.allowRotate||(e.allowRotate=!1),i.resizeGrips.edge||(e.resizeGrips.edge=!1),i.resizeGrips.getCornerProportional()||e.resizeGrips.setCornerProportional(!1),i.resizeGrips.getCornerArbitrary()||e.resizeGrips.setCornerArbitrary(!1),(this._rectangle.angle-n.angle)%90!=0&&(e.resizeGrips.edge=!1,e.resizeGrips.setCornerArbitrary(!1))}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_allowNegativeResize",{get:function(){if(null==this._rectangle||0===this._itemHandlers.length)return!1;for(var e=0;e<this._itemHandlers.length;e++)if(!this._itemHandlers.getItem(e).allowNegativeResize)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype._getRegion=function(){var e=null;if(this._canvas.constrainedMarginEnabled&&this._canvas.margin>0){var t=this._canvas.margin;e=new f.RectangleF(t,t,this._canvas.workspaceWidth-t,this._canvas.workspaceHeight-t)}for(var n=new y.a,i=0;i<this._itemHandlers.length;i++){var o=this._itemHandlers.getItem(i).layer;null==o||null==o.region||n.contains(o)||n.add(o)}for(var r=0;r<n.length;r++){var a=n.getItem(r).region;e=null!=e?f.RectangleF.intersect(e,a):a}return e},e.prototype._updateRectangle=function(e,t){void 0===t&&(t=!1);var n=this._canvas.contentEditingPlaceholderItemHandler;if(t||!this._canvas.suppressOutOfRegionManipulation||null==this._region||null!=n||this._region.containsRectangle(this._getRectWithFrames(e).bounds)){this._rectangle=e,this._rectangleWithFrames=this._getRectWithFrames(e);for(var i=0;i<this._itemHandlers.length;i++)this._itemHandlers.getItem(i)._transformRectangle(this._startRectangle,this._rectangle,!0)}},e.prototype._getRectWithFrames=function(e){for(var t=this._getRectangleWithBorder(e),n=0;n<this._itemHandlers.length;n++){var i=this._itemHandlers.getItem(n);if(null!=i&&i instanceof a.a){var o=i.getRectangleIncludingFrames(),r=S.a.transformRectangleByTwoRectanglesDiff(o,this._rectangle,e);t=f.RotatedRectangleF.union(r,t)}}return t},e.prototype._constrainDiffToRegion=function(e,t){return this._canvas.suppressOutOfRegionManipulation&&null!=this._region?(e.left+t.x<this._region.left&&(t.x=this._region.left-e.left),e.top+t.y<this._region.top&&(t.y=this._region.top-e.top),e.right+t.x>this._region.left+this._region.width&&(t.x=this._region.left+this._region.width-e.right),e.bottom+t.y>this._region.top+this._region.height&&(t.y=this._region.top+this._region.height-e.bottom),t):t},e.prototype._constrainDiffToPlaceholderCover=function(e,t,n){var i=t.angle;t.angle=0;var o=t.bounds,r=e.clone();r.rotateAt(-i,t.center);var a=r.bounds;return n.rotate(-i),a.left+n.x>o.left&&(n.x=o.left-a.left),a.top+n.y>o.top&&(n.y=o.top-a.top),a.right+n.x<o.left+o.width&&(n.x=o.left+o.width-a.right),a.bottom+n.y<o.top+o.height&&(n.y=o.top+o.height-a.bottom),n.rotate(i),n},e.prototype._constrainRectangleToPlaceholderCover=function(e,t){var n=e.angle,i=t.angle,o=Object(f.EqualsOfFloatNumbers)(90,Object(f.normalizeAngle)(n-i)%180);t.angle=0;var r=t.bounds;e.rotateAt(-i,t.center);var a=e.bounds,s=Math.min(a.left,r.left),l=Math.min(a.top,r.top),c=Math.max(a.right,r.right),u=Math.max(a.bottom,r.bottom),h=c-s,d=u-l,p=o?this._startRectangle.height/this._startRectangle.width:this._startRectangle.width/this._startRectangle.height,g=h/d,_=(this._operation.resizeIndex-1+Math.round(Object(f.normalizeAngle)(n-i)/90))%4+1;if(g>p){var v=Math.abs(h/p-h/g);1===_||2===_?l-=v:u+=v}if(g<p){var m=Math.abs(d*p-d*g);2===_||3===_?c+=m:s-=m}var y=new f.RectangleF(s,l,c-s,u-l);if(!Object(f.EqualsOfFloatNumbers)(0,n-i%360)){var b=f.RotatedRectangleF.fromRectangleF(y);b.rotateAt(i-n,t.center),y=b.bounds}var C=f.RotatedRectangleF.fromRectangleF(y);return C.rotateAt(n,t.center),C},e.prototype._getRectangleWithBorder=function(e){if(null==e||null==this._border)return null;var t=e.center,n=e.angle;e.angle=0;var i=e.bounds,o=f.RotatedRectangleF.FromLTRB(i.left-this._border.left,i.top-this._border.top,i.right+this._border.right,i.bottom+this._border.bottom);return o.width*=Math.sign(e.width),o.height*=Math.sign(e.height),o.rotateAt(n,t),e.angle=n,o},e.prototype.addSelectedItemHandlersChanged=function(e){this._selectedItemHandlersChangedEvent.add(e)},e.prototype.removeSelectedItemHandlersChanged=function(e){this._selectedItemHandlersChangedEvent.remove(e)},e.prototype._onSelectedItemHandlersChanged=function(){this._selectedItemHandlersChangedEvent.notify(this)},Object.defineProperty(e.prototype,"_allowManipulation",{get:function(){return null!=this._canvas&&(!this._canvas.simpleMode||null!=this._canvas.contentEditingPlaceholderItemHandler)},enumerable:!0,configurable:!0}),e.cw=[0,-1,1,1,-1,-1,0,1,0],e.ch=[0,-1,-1,1,1,0,-1,0,1],e._isSafetyLineItemHandlersFunc=null,e}(),R=n(397),O=n(388),z=n(417),L=n(395),F=n(418),A=n(437),W=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},j=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(W(arguments[t]));return e},V=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},G=function(){function e(e,t){var n=this;this._canvas=e,this._viewer=t,this._dndStarting=!1,this._dndStarted=!1,this._isShown=!1,this._startPoint=null,this._currentPoint=null,this._currentPointClient=null,this._isOutOfCanvas=!1,this._dragSource=null,this._dragOver=null,this._dragImg=null,this._dragTargets=null,this._allowedTargets=null,this._onDragNDropStarting=function(e){n._canvas._onDragNDropStarting(e);var t=e.source.item,i=n._canvas.viewer.surface.getAllItems({ignoreMockups:!1,flatGroupItems:!0}),o=O.filter(i.toArray(),function(e){return null!=e.parentContainer&&e instanceof H.PlaceholderItem&&!(null!=e.content&&e.content instanceof H.BarcodeItem)&&e!==t&&function(e,t){if(e.allowedSubfolder!==t.allowedSubfolder)return!1;if(null==e.allowedTabs&&null!=t.allowedTabs||null!=e.allowedTabs&&null==t.allowedTabs)return!1;if(null!=e.linkId&&t.linkId===e.linkId)return!1;if(null!=e.allowedTabs&&null!=t.allowedTabs){if(e.allowedTabs.length!==t.allowedTabs.length)return!1;for(var n=0;n<e.allowedTabs.length;n++)if(!t.allowedTabs.includes(e.allowedTabs[n]))return!1}return!0}(t,e)&&e.parentContainer.name!==z.a.BG_CONTAINER_NAME&&e.manipulationPermissions.allowDragAndDrop});e.allowedTargets=o.map(function(e){return n._canvas.viewer.getHandler(e)})},this._onDragNDropPerformed=function(e){n._canvas._onDragNDropPerformed(e);var t=e.source,i=e.target,o=t.item,r=o.content,a=null,s=null;null!=i&&(s=(a=i.item).content);var l=s&&!a.isStubOrEmpty,c=l?new H.ImageMetaData({isUserImage:s.isUserImage,isVector:s.source.isVector,name:s.name,size:{width:s.source.width,height:s.source.height},storageId:s.source.id,origin:s.source.origin}):o.stubStorageMeta,u=null!=s?s.tags:null;if(n._createAndInsertImageContent(c,o,!l,u),null!=a){var h=new H.ImageMetaData({isUserImage:r.isUserImage,isVector:r.source.isVector,name:r.name,size:{width:r.source.width,height:r.source.height},storageId:r.source.id,origin:r.source.origin});n._createAndInsertImageContent(h,a,null,r.tags)}},this._createAndInsertImageContent=function(e,t,i,o){var r,a;void 0===i&&(i=!1),void 0===o&&(o={});var s=n._canvas.viewer,l=s.surface.parentProduct,c=(null!=l?l.getAllItems({ignoreMockups:!1,flatGroupItems:!0}):s.surface.getAllItems().toArray()).filter(function(e){return e instanceof H.PlaceholderItem}),u=null!=t.linkId?c.filter(function(e){return e.linkId===t.linkId}):[],h=j([t],u);try{for(var d=V(h),p=d.next();!p.done;p=d.next()){var f=p.value,g=null==e||null==e.storageId?null:L.a.createImageContentForPlaceholder(f,e,s.productHandler);f.isStubContent=null!=i&&i,null!=g&&null!=o&&(g.tags=o),n._viewer.commandManager.execute(F.b.addContent,{placeholder:f,content:g},A.a.NotUpdate)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(a=d.return)&&a.call(d)}finally{if(r)throw r.error}}}}return e.prototype.processMouseEvent=function(e){var t=new f.PointF(e.x,e.y);if("mousedown"===e.type){var n=this.hitTest(t),i=this._canvas.currentItemHandler;if(null!=n&&null!=i&&n.uniqueId===i.uniqueId){this._isOutOfCanvas=this._testOutOfCanvas(t);var o=n.getPermissions(),r=o.allowDragAndDrop;n.isStubOrEmpty()||!1!==o.allowMove&&!this._canvas.simpleMode||!r||this._isOutOfCanvas||n.content instanceof R.a||(this._dndStarting=!0,this._startPoint=t,this._currentPoint=t,this._currentPointClient=new f.PointF(e.clientX+window.scrollX,e.clientY+window.scrollY),this._dragSource=n,this._allowedTargets=null)}}else if("mousemove"===e.type){if(this._dndStarting){var a=Math;if(a.abs(t.x-this._startPoint.x)>4||a.abs(t.y-this._startPoint.y)>4){var s={source:this._dragSource,allowedTargets:null};this._onDragNDropStarting(s),null!=s.allowedTargets&&(this._allowedTargets=s.allowedTargets),this._dndStarted=!0,this._dndStarting=!1,this._dragSource._reloadPlaceholderButtons(),this._dragImg=this._image,this._setDragTargets(this._dragSource)}}if(this._dndStarted){this._isOutOfCanvas=this._testOutOfCanvas(t);n=this.hitTest(t);this._dragTargets.includes(n)||(n=null),this._setDragOver(n),this._currentPoint=t,this._currentPointClient=new f.PointF(e.clientX+window.scrollX,e.clientY+window.scrollY)}}else if("mouseup"===e.type&&(this._dndStarted||this._dndStarting)){var l=this.hitTest(t);this.isDragTarget(l)||(l=null),this._testOutOfCanvas(t)?(this._onDragNDropPerformed({source:this._dragSource,target:null}),this._canvas.setSelectedItemHandlers([])):null!=l&&l!=this._dragSource&&(this._onDragNDropPerformed({source:this._dragSource,target:l}),this._canvas.setSelectedItemHandlers([l])),this._setDragOver(null),this._dndStarted=!1,this._dndStarting=!1;var c=this._dragSource;this._dragSource=null,c&&c._reloadPlaceholderButtons(),this._startPoint=null,this._currentPoint=null,this._currentPointClient=null,this._dragImg=null,this._dragOver=null,this._unsetDragTargets(),this.draw(),this._canvas._onDragNDropDone()}},e.prototype._setDragOver=function(e){if(null!=this._dragOver&&this._dragOver!==e){var t=this._dragOver;this._dragOver=null,this._canvas.redrawDesign(),t._reloadPlaceholderButtons()}e&&e!==this._dragSource&&e!==this._dragOver&&(this._dragOver=e,this._canvas.redrawDesign(),this._dragOver._reloadPlaceholderButtons())},e.prototype.isDragSource=function(e){return this._dragSource===e},e.prototype.isDragTarget=function(e){return null!=this._dragTargets&&this._dragTargets.includes(e)},e.prototype.isDragStarted=function(){return this._dndStarted},e.prototype.isDragOver=function(e){return void 0===e&&(e=null),null===e?null!=this._dragOver:this._dragOver===e},e.prototype.isOutOfCanvas=function(){return this._isOutOfCanvas},e.prototype.hitTest=function(e){var t=this._canvas.getItemHandlersByHitTest(e).filter(function(e){return!(e instanceof R.e)})[0];return t instanceof a.a?t:null},e.prototype._testOutOfCanvas=function(e){return e.x<0||e.x>this._canvas.workspaceWidth||(e.y<0||e.y>this._canvas.workspaceHeight)},Object.defineProperty(e.prototype,"_image",{get:function(){return this._dragSource.content._imageContainer._image},enumerable:!0,configurable:!0}),e.prototype._unsetDragTargets=function(){var e=this._dragTargets;this._dragTargets=null,null!=e&&(e.forEach(function(e){return e._reloadPlaceholderButtons()}),this._canvas.redraw())},e.prototype._setDragTargets=function(e){var t=this,n=this._canvas.getAllItemHandlers({onlyVisible:!0,onlyType:a.a,flatGroupItems:!0});this._dragTargets=n.filter(function(n){return n!==e&&(null==t._allowedTargets||t._allowedTargets.includes(n))}),this._dragTargets.length>0&&(this._dragTargets.forEach(function(e){return e._reloadPlaceholderButtons()}),this._canvas.redraw())},e.prototype.draw=function(){this._dndStarted?(this._canvas.showDnd(this._currentPointClient,this._dragImg),this._isShown=!0):this._isShown&&(this._canvas.hideDnd(),this._isShown=!1)},e}(),N=function(){function e(e,t){this.rotateDiv=null,this._canvas=e,this._viewer=t,this._rotationStyle=null}return e.prototype.addRotationStyle=function(){null!=this._viewer&&(null!=this._rotationStyle&&this._rotationStyle.remove(),this._rotationStyle=document.createElement("style"),this._rotationStyle.type="text/css",this._rotationStyle.innerHTML="\n                #rotate-circle svg { \n                    position: absolute; \n                    width: 16px; \n                    height: 16px;                     \n                    top: 3px; \n                    left: 3px; \n                } \n                #degree { \n                    position: absolute; \n                    border-radius: 5px; \n                    background-color: rgba(0, 0, 0, 0.8); \n                    color: #fff; \n                    display: flex; \n                    align-items: center; \n                    justify-content: center; \n                    z-index: 2; \n                    font-size: 12px; \n                    line-height: 14px; \n                    height: 22px; \n                    width: 45px; \n                    transition: 0.3s opacity; \n                }\n                ",document.head.appendChild(this._rotationStyle))},e.prototype.addRotateDiv=function(e,t){if(null!=this._viewer&&null!=this._viewer.whitespaceDiv){var n=this._viewer.whitespaceDiv;this.rotateDiv=document.createElement("div"),this.rotateDiv.id="degree",n.appendChild(this.rotateDiv),this.updateRotatePositionDiv(e,t),this._canvas.updateHoverDiv()}},e.prototype.removeRotateDiv=function(){null!=this.rotateDiv&&(this.rotateDiv.remove(),this.rotateDiv=null)},e.prototype.updateRotatePositionDiv=function(e,t){null!=this.rotateDiv&&(this.rotateDiv.style.top=e+"px",this.rotateDiv.style.left=t+"px")},e.prototype.updateRotateDegreeDiv=function(e){null!=this.rotateDiv&&(this.rotateDiv.innerHTML=Math.round(e)%360+"&deg;")},e.prototype.rotateHoverLabel=function(e,t){e>45&&e<135?this._canvas.hoverDiv.querySelectorAll("#hover-label").forEach(function(e){e.style.left="-"+(t.width/2+10)+"px",e.style.top=t.height-t.width/2-7+"px",e.style.transform="rotate(-90deg)"}):e>=135&&e<225?this._canvas.hoverDiv.querySelectorAll("#hover-label").forEach(function(e){e.style.left="0px",e.style.top=t.height+5+"px",e.style.transform="rotate(180deg)"}):e>225&&e<315?this._canvas.hoverDiv.querySelectorAll("#hover-label").forEach(function(e){e.style.left=t.width/2+10+"px",e.style.top=t.width/2-10+"px",e.style.transform="rotate(90deg)"}):this._canvas.hoverDiv.querySelectorAll("#hover-label").forEach(function(e){e.style.left="0px",e.style.top="-20px",e.style.transform="rotate(0deg)"})},e.prototype.calculatePositionRotateDiv=function(e,t,n,i,o,r){var a=this._canvas.mul;switch(e){case 0:var s=i.x*a+t+20,l=i.y*a+n+20;break;case 90:s=r-i.y*a+t+20,l=i.x*a+n+20;break;case 180:s=o-i.x*a+t+20,l=r-i.y*a+n+20;break;case 270:s=i.y*a+t+20,l=o-i.x*a+n+20}return new f.PointF(s,l)},e.getRotatedPoint=function(e,t,n){void 0===n&&(n=null);var i=null!==n&&void 0!==n?n:e.contentAngle;return this.getRotatedPointFromSize(t,new f.SizeF(e.workspaceWidth,e.workspaceHeight),i)},e.getRotatedPointFromSize=function(e,t,n){var i=e.clone();return i.rotateAt(n,new f.PointF),90===n?i.translate(t.height,0):180===n?i.translate(t.width,t.height):270===n&&i.translate(0,t.width),i},e}();!function(e){e[e.ready=0]="ready",e[e.refresh=1]="refresh",e[e.busy=2]="busy"}(o||(o={}));var U,q,Y,X,Z=n(509),K=n(463),Q=function(){function e(e,t){if(this.N="",this.V=!0,this.L=!1,this.ID="l"+(new Date).getTime()+Math.round(1e3*Math.random()),this.VO=[],this.RenderingType=K.a.Normal,e){if(this.RenderingType=e.renderingType,t)return;this.N=e.name,this.V=e.getVisible(),this.L=e.locked,this.R=e.region,this.ID=e.uniqueId,this.VO=[];for(var n=e.itemHandlers,i=0;i<n.length;i++){var o=n.getItem(i);this.VO.push({T:o.getTypeName(),D:o.getData("asObject")})}this.TextureStorageId=e.textureStorageId,this.TextureSourceWidth=e.textureSourceWidth,this.TextureSourceHeight=e.textureSourceHeight,this.PreviewColor=e.previewColor}}return e.applyState=function(e,t,n){if(n||(n={}),t){t.name=e.N,t.setVisible(e.V),t.locked=e.L,t.uniqueId=e.ID,t.textureStorageId=e.TextureStorageId,t.textureSourceWidth=e.TextureSourceWidth,t.textureSourceHeight=e.TextureSourceHeight,t.previewColor=e.PreviewColor,t.renderingType=e.RenderingType,e.R&&(t.region=h.a.FromObject(e.R));for(var i=t.itemHandlers,o=0;o<e.VO.length;o++){var r=e.VO[o].D,a=n[r.ID];a?(n[r.ID]=null,a.setData(r)):((a=(new Z.a).create(e.VO[o].T)).setData(r),a.initialize()),i.add(a)}}},e}(),J=function(){return function(e,t,n){if(this.L=[],this.XDpi=72,this.YDpi=72,this.Z=1,this.RV=null,this.MinFontSize=null,this.MaxFontSize=null,this.MinLeading=null,this.MaxLeading=null,e){this.RgbCPId=e.rgbColorProfileFileId,this.CmykCPId=e.cmykColorProfileFileId,this.GrayscaleCPId=e.grayscaleColorProfileFileId,this.Z=e.zoom,this.XDpi=M.a.screenDpi,this.YDpi=M.a.screenDpi,this.TDpi=e.targetDpi,this.WW=e.workspaceWidth,this.WH=e.workspaceHeight,this.MinFontSize=e.minFontSize,this.MaxFontSize=e.maxFontSize,this.MinLeading=e.minLeading,this.MaxLeading=e.maxLeading;var i=e.layers;if(this.L=[],!1===t||void 0===t){for(var o=0;o<i.length;o++)this.L.push(new Q(i.getItem(o)));this.ReGC=e.resizeGripColor,this.RoGC=e.rotationGripColor,this.ReGS=e.resizeGripSize,this.RoGS=e.rotationGripSize,this.RV=e.returnValue,this.SB=e.isSquaredBackground,this.MW=e.marginWidth,this.MC=e.marginColor,this.LM=e.leftMargin,this.RM=e.rightMargin,this.TM=e.topMargin,this.BM=e.bottomMargin,this.CM=e.constrainedMarginEnabled,this.Tags=e.tags,this.LIU=e.loadingImageUrl,this.SC=e.selectionColor,this.SW=e.selectionWidth,this.ReGLC=e.resizeGripLineColor,this.RoGLC=e.rotationGripLineColor,this.RoGLL=e.rotationGripLineLength,this.PBGCC=e.placeholderButtonGroupCssClass,this.FloatingItemToolbarCssClass=e.floatingItemToolbarCssClass,this.SIBCC=e.selectImageButtonCssClass,this.SBBCC=e.selectBarcodeButtonCssClass,this.HBCC=e.handleButtonCssClass,this.DBCC=e.doneButtonCssClass,this.DeleteToolbarButtonCssClass=e.deleteToolbarButtonCssClass,this.EditToolbarButtonCssClass=e.editToolbarButtonCssClass,this.SelectToolbarButtonCssClass=e.selectToolbarButtonCssClass,this.QCCCC=e.qualityChangeContainerCssClass,this.QCSBCC=e.qualityChangeScaleBarCssClass,this.QBTWCSBCC=e.qualityBadToWarningChangeScaleBarCssClass,this.QWTGCSBCC=e.qualityWarningToGoodChangeScaleBarCssClass,this.QBTGCSBCC=e.qualityBadToGoodChangeScaleBarCssClass,this.QNACSBCC=e.qualityNoAnimationChangeScaleBarCssClass,this.QCIBCC=e.qualityChangeInfoBarCssClass,this.VCCC=e.violationContainerCssClass,this.VBCC=e.violationWarningButtonCssClass,this.GVICC=e.goodViolationIconCssClass,this.WVICC=e.warningViolationIconCssClass,this.BVICC=e.badViolationIconCssClass,this.BBGCC=e.bigButtonGroupCssClass,this.SBT=e.selectButtonTitle,this.HBT=e.handleButtonTitle,this.DBT=e.doneButtonTitle,this.DLTBT=e.deleteButtonTitle,this.EBT=e.editButtonTitle,this.MSE=e.multipleSelectionEnabled,this.MMT=e.mouseMoveTimeout,this.DS=e.disableSmoothing}else null!=n&&this.L.push(new Q(i.getLayerById(n),!0))}}}(),$=n(577),ee=n(414),te=n(416),ne=n(387),ie=n(501),oe=function(){function e(e,t){var n=this;if(this._container=e,this._uniqueId="l"+(new Date).getTime()+Math.round(1e3*Math.random()),this._textureSizeMultiplier=null,this._textureUrl=null,this._isTextureLoaded=!1,this._createItemHandlersCollection=function(){n.itemHandlers.setRange(n._container.items.ofType(te.a).select(n._canvas.handlerFactory.get).toArray()),n._canvas.redraw()},this._onContainerPropertyChanged=function(e,t){switch(t){case"visible":n.setVisible(e.visible);break;case"previewTextureSource":n.updateTexture(!0)}},this._canvas=null,this._itemHandlers=new $.a(this),this._visible=!0,this.updateTexture=function(e){if(null!=n._canvas&&!n.locked&&(null!=n.textureStorageId&&null!=n.textureSourceWidth&&null!=n.textureSourceHeight||null!=n.previewColor)){var t=n._canvas.width,i=n._canvas.height;if(null==n.previewColor){var o=Math.max(t/n.textureSourceWidth,i/n.textureSourceHeight);if(o=Math.min(1,o),e||null==n._textureSizeMultiplier||!(n._textureSizeMultiplier>o)){n._textureSizeMultiplier=o;var r=n._textureUrl,a=parseInt((n.textureSourceWidth*o).toString()),s=parseInt((n.textureSourceHeight*o).toString());if(n._textureUrl=ie.a.getImageUrl(n._canvas,n.textureStorageId,a,s,!1,null,!0),r!==n._textureUrl){var l=new Image(a,s);l.crossOrigin="anonymous",l.src=n._textureUrl;var c=n;l.onload=function(){c.textureImage=l,c._isTextureLoaded=!0,c._canvas.onLayerTextureLoaded()}}}}else if(null==n.textureImage){n.textureImage=document.createElement("canvas"),n.textureImage.width=10,n.textureImage.height=10;var u=n.textureImage.getContext("2d");u.fillStyle=new ne.RgbColor(n.previewColor).preview,u.fillRect(0,0,10,10)}}},this._disposeEvent=new r.a,this.textureImage=null,null!=t&&(this._canvas=t),null!=this._container){this._container.addPropertyChanged(this._onContainerPropertyChanged);var i=function(e){null!=e&&(n.itemHandlers.insertAt(e.index,n._canvas.handlerFactory.get(e.item)),n._canvas.updateTexts())},o=function(e){null!=e&&n.itemHandlers.removeAt(e.index)},a=function(e){null!=e&&n.itemHandlers.move(e.oldIndex,e.newIndex)};this._container.items.add_itemAdded(i),this._container.items.add_itemRemoved(o),this._container.items.add_itemMoved(a),this._disposeEvent.add(function(){n._container.items.remove_itemAdded(i),n._container.items.remove_itemRemoved(o),n._container.items.remove_itemMoved(a)}),this._createItemHandlersCollection(),this._visible=this._container.visible}}return Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},set:function(e){this._uniqueId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},set:function(e){this._canvas=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){var e=this.canvas;return e?e.layers.indexOf(this):-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){var e=new Q(this);return JSON.stringify(e)},set:function(e){if(e&&""!=e){var t=JSON.parse(e);Q.applyState(t,this)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"region",{get:function(){return this._container.region},set:function(e){this._container.region=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"itemHandlers",{get:function(){return this._itemHandlers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._container.name},set:function(e){this.container.name=e},enumerable:!0,configurable:!0}),e.prototype.getVisible=function(){return this._visible},e.prototype.setVisible=function(e,t){this._visible!==e&&(this._visible=e,(t=null==t||t)&&null!=this._canvas&&(this._canvas.updatePlaceholderButtonGroups(),this._canvas.updateViolationContainers()))},Object.defineProperty(e.prototype,"locked",{get:function(){return this._container.locked},set:function(e){this.locked!==e&&(this.container.locked=e,null!=this._canvas&&this._canvas.updatePlaceholderButtonGroups())},enumerable:!0,configurable:!0}),e.prototype._onRemovedFromCanvas=function(e){for(var t=this.itemHandlers,n=t.length,i=0;i<n;i++)t.getItem(i).canvas=null;this._canvas.remove_zoomChanged(this.updateTexture)},e.prototype.onLayerAdded=function(){this.updateTexture(),this._canvas.add_zoomChanged(this.updateTexture)},e.prototype.isTextureLoadedOrNotExists=function(){return null==this.textureStorageId||this._isTextureLoaded},e.prototype.dispose=function(){this._disposeEvent.notify()},Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureStorageId",{get:function(){return this._container instanceof ee.e?this._container.previewTextureSource.id:null},set:function(e){this._container instanceof ee.e&&(this._container.previewTextureSource.id=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureSourceWidth",{get:function(){return this._container instanceof ee.e?this._container.previewTextureSource.width:null},set:function(e){this._container instanceof ee.e&&(this._container.previewTextureSource.width=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureSourceHeight",{get:function(){return this._container instanceof ee.e?this._container.previewTextureSource.height:null},set:function(e){this._container instanceof ee.e&&(this._container.previewTextureSource.height=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previewColor",{get:function(){return this._container instanceof ee.c?this._container.previewColor:null},set:function(e){this._container instanceof ee.c&&(this._container.previewColor=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderingType",{get:function(){return this._container.renderingType},set:function(e){this.container.renderingType=e},enumerable:!0,configurable:!0}),e}(),re=n(475),ae=n(581),se=n(492),le=n(476),ce=function(){function e(e){this._canvas=e}return e.prototype.processMouseEvent=function(e,t){"mousemove"===e.type&&(null==t?this._canvas.hideHover():this._canvas.showHover(t.rectangle,t.item.name))},e}();!function(e){e[e.always=0]="always",e[e.auto=1]="auto"}(U||(U={})),function(e){e[e.centerBottom=5]="centerBottom",e[e.centerCenter=4]="centerCenter",e[e.centerTop=3]="centerTop",e[e.leftBottom=2]="leftBottom",e[e.leftCenter=1]="leftCenter",e[e.leftTop=0]="leftTop",e[e.rightBottom=8]="rightBottom",e[e.rightCenter=7]="rightCenter",e[e.rightTop=6]="rightTop"}(q||(q={})),function(e){e[e.none=0]="none",e[e.bestFit=1]="bestFit",e[e.bestFitShrinkOnly=2]="bestFitShrinkOnly",e[e.fitToWidth=3]="fitToWidth",e[e.fitToHeight=4]="fitToHeight",e[e.fitToWidthShrinkOnly=6]="fitToWidthShrinkOnly",e[e.fitToHeightShrinkOnly=7]="fitToHeightShrinkOnly"}(Y||(Y={})),function(e){e[e.low=0]="low",e[e.medium=1]="medium",e[e.high=2]="high",e[e.shrinkHighStretchLow=3]="shrinkHighStretchLow"}(X||(X={}));var ue,he=function(){function e(e){this._v=e}return Object.defineProperty(e.prototype,"postBackOnWorkspaceChanged",{get:function(){return this._v._clientSideOptions$postBackOnWorkspaceChanged},set:function(e){this._v._clientSideOptions$postBackOnWorkspaceChanged=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"postBackOnWorkspaceClick",{get:function(){return this._v._clientSideOptions$postBackOnWorkspaceClick},set:function(e){this._v._clientSideOptions$postBackOnWorkspaceClick=e},enumerable:!0,configurable:!0}),e}(),de=n(752),pe={start:function(e){var t=e.checkFunction,n=e.onChange;e.delayMs;return setInterval(function(){t()&&n()},500)},stop:function(e){clearInterval(e)}},fe=n(451),ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ve=function(){return function(e){var t=this;function n(e){var n;n=e.touches?e.touches.length>0?e.touches[0]:e.changedTouches[0]:e.pointers.length>0?e.pointers[0]:e.changedPointers[0],t.pageX=n.pageX,t.pageY=n.pageY,t.clientX=n.clientX,t.clientY=n.clientY}t.originalEvent=e,t.type=e.type,t.x=e.x,t.y=e.y,"string"==typeof e.type&&-1!==e.type.indexOf("touch")?n(e):null!=e.gesture?n(e.gesture):e&&function(e){t.pageX=e.pageX,t.pageY=e.pageY,t.clientX=e.clientX,t.clientY=e.clientY}(e)}}(),me=function(){return function(){}}(),ye=function(){return function(){}}(),be=function(){function e(e){void 0===e&&(e=null),this._zone=e,this._contentElements=[],this._rulerBorderWidth=1,this._rulerDivision=5,this._contentCtxLocation=null,this._ignoreDocumentClickOnce=!1,this._documentClickEvent=new r.c,this._clickEvent=new r.c,this._mouseDownEvent=new r.c,this._mouseMoveEvent=new r.c,this._mouseUpEvent=new r.c,this._workspaceDoubleClickEvent=new r.c,this._workspaceClickEvent=new r.c,this._workspaceChangedEvent=new r.c,this._workspaceMouseDownEvent=new r.c,this._workspaceMouseUpEvent=new r.c,this._workspaceMouseMoveEvent=new r.c,this._statusChangedEvent=new r.c,this._pinchStartEvent=new r.c,this._pinchStopEvent=new r.c,this._scrolledEvent=new r.c,this._onresizeEvent=new r.c,this._zoomedEvent=new r.c,this._invokingCallbackRequestEvent=new r.c,this._intervalCheckLoop=pe,this._contentAngle=0,this._backColor="#FFFFFF",this._maxZoom=16,this._minZoom=.05,this._screenXDpi=72,this._screenYDpi=72,this._scrollBarsStyle=U.auto,this._scrollBarWidth=17,this._scrollingPosition=new f.PointF(0,0),this._viewportAlignment=q.leftTop,this._zoom=1,this._zoomMode=Y.none,this._zoomQuality=X.shrinkHighStretchLow,this._bestFitWhiteSpacePc=0,this._stateFieldId="",this._needUpdateViewport=!1,this._msTouchActionInitialValue="",this._toolTip="",this._accessKey="",this._tabIndex="",this._callbackArgs="",this._callbackContext=0,this._status=o.ready,this._exceptionDescription="",this._returnValue="",this._clientSideOptions=new he(this),this._delayedRefreshTimeout=1e3,this._refreshTimer=null,this._contentElements=[],this._needToRefresh=!1,this._rulerEnabled=!1,this._rulerWidth=13,this._rulerScale=1,this._rulerOffsetX=0,this._rulerOffsetY=0,this._rulersOnScrollDelegate=null,this._rulersOnZoomDelegate=null,this._activeAjax=0,this._pinchZoomEnabled=!0,this._holderBounds=null,this._contentCtxDimension={},this._viewportLocation={},this._holderElement=null,this._touchFlags=new ye,this._rulers={},this._bodyCursor=null}return Object.defineProperty(e.prototype,"element",{get:function(){return this._viewerElement},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._viewerElement.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentAngle",{get:function(){return this._contentAngle},set:function(e){if(null!=e&&e!==this._contentAngle){this._contentAngle=Object(f.normalizeAngle)(e);var t="(0, 0)";90===this._contentAngle?t="(0px, -100%)":180===this._contentAngle?t="(-100%, -100%)":270===this._contentAngle&&(t="(-100%, 0px)"),this._contentCtx.style.transform="rotate("+this._contentAngle+"deg) translate"+t,this._contentCtx.style.transformOrigin="left top",this._updateViewport(),this._canvas.setZoom(this.zoom,void 0,{force:!0}),this._canvas.updateSelection(),this._canvas.redraw()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentWidth",{get:function(){return this._holderBounds.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._holderBounds.offsetWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentHeight",{get:function(){return this._holderBounds.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._holderBounds.offsetHeight},enumerable:!0,configurable:!0}),e.prototype.notifySizeChanged=function(){this._onResize(null,!1)},e.prototype._renderContent=function(e){return e},Object.defineProperty(e.prototype,"hasContent",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype._render=function(){var e="width:"+this.contentWidth+"px;height:"+this.contentHeight+"px;",t="";t+='<div id="cvContent" style="position:absolute; overflow: hidden; box-sizing: content-box; -webkit-box-sizing: content-box; -moz-box-sizing: content-box;',this.hasContent?t+=e:t+="display:none;";var n=this._getViewportLocation();return t+="left:"+n.x+"px;top:"+n.y+"px",t+='">',t=this._renderContent(t),t+="</div>",t+="</div>"},e.prototype._clearElement=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},e.prototype._rulersOnScroll=function(){this._touchFlags.pinchStarted||this._updateRulersStyle()},e.prototype._rulersOnZoom=function(){this._touchFlags.pinchStarted||(this._drawRulers(),this._updateRulersStyle())},e.prototype._rulersOnMouseMove=function(e,t){if(this.rulerEnabled){var n=this._rulers.topSlideBar,i=this._rulers.leftSlideBar;if(M.a.IsTouchDevice()){if(!M.a.IsTouchIE())return;if(t.originalEvent.pointerType!=t.originalEvent.MSPOINTER_TYPE_MOUSE)return n.style.left="0px",void(i.style.top="0px")}var o=this._getViewportLocation(),r=this._contentCtxLocation,a=-1,s=-1;isNaN(t.pageX)||isNaN(t.pageY)?t.originalEvent&&(t.originalEvent.touches?(a=t.originalEvent.touches[0].pageX,s=t.originalEvent.touches[0].pageY):(a=t.originalEvent.pageX,s=t.originalEvent.pageY)):(a=t.pageX,s=t.pageY);var l=o.x+a-r.left-this._scrollingPosition.x,c=o.y+s-r.top-this._scrollingPosition.y;n.style.left=l+"px",i.style.top=c+"px"}},e.prototype._initializeRulers=function(){var e=this.element.parentNode,t=e.ownerDocument,n="z-index: 2; -webkit-transform: translate3d(0px, 0px, 0px); -moz-transform: translate3d(0px, 0px, 0px)",i=t.createElement("div");i.setAttribute("style",n);var o=t.createElement("div"),r=t.createElement("div");r.setAttribute("style",n);var a=t.createElement("div"),s=t.createElement("div");s.style.zIndex="2";var l=t.createElement("div"),c=t.createElement("div");this._rulers.topRuller=i,this._rulers.leftRuller=r,this._rulers.fullTopRuller=o,this._rulers.fullLeftRuller=a,this._rulers.whiteRect=s,this._rulers.topSlideBar=l,this._rulers.leftSlideBar=c;var u=this.element.id;i.id=u+"_TopRuler",o.id=u+"_FullTopRuler",r.id=u+"_LeftRuler",a.id=u+"_FullLeftRuler",s.id=u+"_WhiteRect",l.id=u+"_TopSlideBar",c.id=u+"_LeftSlideBar",o=i.appendChild(o),a=r.appendChild(a),l=i.appendChild(l),c=r.appendChild(c),i=e.appendChild(i),r=e.appendChild(r),s=e.appendChild(s),i.style.position=o.style.position=r.style.position=a.style.position=s.style.position=l.style.position=c.style.position="absolute",c.style.width=l.style.height=this.rulerWidth+"px",c.style.height=l.style.width="1px",c.style.backgroundColor=l.style.backgroundColor="#ff0000",c.style.overflow=l.style.overflow="hidden",c.style.webkitTransform=l.style.webkitTransform="translate3d(0, 0, 0)",i.style.overflow=r.style.overflow=s.style.overflow="hidden",i.style.visibility=r.style.visibility=s.style.visibility="hidden",s.style.backgroundColor="#909090",e.style.position="relative",this._drawRulers(),this._updateRulersStyle(),this._rulersOnScrollDelegate||(this._rulersOnScrollDelegate=this._rulersOnScroll.bind(this),this.add_scrolled(this._rulersOnScrollDelegate)),this._rulersOnZoomDelegate||(this._rulersOnZoomDelegate=this._rulersOnZoom.bind(this),this.add_zoomed(this._rulersOnZoomDelegate)),this.add_mouseMove(D.b.createBoundedWrapper(this,this._rulersOnMouseMove))},e.prototype._disposeRulers=function(){this._rulersOnScrollDelegate&&(this.remove_scrolled(this._rulersOnScrollDelegate),this._rulersOnScrollDelegate=null),this._rulersOnZoomDelegate&&(this.remove_zoomed(this._rulersOnZoomDelegate),this._rulersOnZoomDelegate=null)},e.prototype._updateRulersStyle=function(){var e=this._rulers.leftRuller,t=this._rulers.topRuller,n=this._rulers.fullLeftRuller,i=this._rulers.fullTopRuller,o=this._rulers.whiteRect,r=this.width,a=this.height,s=this.contentWidth,l=this.contentHeight,c=this.scrollBarWidth,u=e.style,h=t.style,d=i.style,p=n.style,f=o.style;if(this._rulerEnabled){u.visibility=h.visibility=f.visibility="inherit",u.backgroundColor=h.backgroundColor="#ffffff",u.borderRight=h.borderBottom=this._rulerBorderWidth+"px solid black";var g=this.scrollBarsStyle==U.always,_=this.scrollBarsStyle==U.auto,v=g||_&&l>a-this.rulerWidth,m=g||_&&s>r-this.rulerWidth;v=v||m&&_&&l>a-this.rulerWidth-c,m=m||v&&_&&s>r-this.rulerWidth-c;var y=v?r-c:r,b=m?a-c:a;h.width=y+"px",u.height=b+"px",d.height=h.height=o.style.height=this._rulerWidth+"px",p.width=u.width=o.style.width=this._rulerWidth+"px",h.top=u.top=h.left=u.left=o.style.top=o.style.left="0px";var C=this.scrollingPosition;d.left=-C.x+"px",p.top=-C.y+"px"}else h.width=h.height=u.width=u.height=h.borderWidth=u.borderWidth=f.width=f.height="0px",u.visibility=h.visibility=f.visibility="hidden"},e.prototype._setRulersConfig=function(e){if(e.enabled){var t=Object(fe.d)(e);this._rulerEnabled=!0,this._rulerOffsetX=-1*e.origin.X/t,this._rulerOffsetY=-1*e.origin.Y/t,this._rulerScale=t,e.unit===fe.b.Inch&&(this._rulerDivision=4)}else this._rulerEnabled=!1;this._updateViewport()},e.prototype._drawRulers=function(){if(this._rulerEnabled)for(var e=this.element.parentNode.ownerDocument,t=this._rulers.fullLeftRuller,n=this._rulers.fullTopRuller,i=[{controlLength:this.width,contentLength:this.contentWidth,viewportLocation:this._getViewportLocation().x,factor:this.zoom*this.actualSizeHorizontalScale,ruler:n,startWorkspaceLocation:null,endWorkspaceLocation:null,rulerPixelLength:null,origin:null},{controlLength:this.height,contentLength:this.contentHeight,viewportLocation:this._getViewportLocation().y,factor:this.zoom*this.actualSizeHorizontalScale,ruler:t,startWorkspaceLocation:null,endWorkspaceLocation:null,rulerPixelLength:null,origin:null}],o=[this.rulerOffsetX+this._baseRulersOffset.x,this.rulerOffsetY+this._baseRulersOffset.y],r=this.scrollBarWidth,a=this.scrollBarsStyle==U.always,s=this.scrollBarsStyle==U.auto,l=this.rulerScale,c=0;c<i.length;c++){i[c].origin=i[c].viewportLocation+o[c]*i[c].factor;var u=a||s&&i[1-c].contentLength>i[1-c].controlLength-this.rulerWidth,h=a||s&&i[c].contentLength>i[c].controlLength-this.rulerWidth;u=u||h&&s&&i[1-c].contentLength>i[1-c].controlLength-this.rulerWidth-r,h=h||u&&s&&i[c].contentLength>i[c].controlLength-this.rulerWidth-r,i[c].rulerPixelLength=h?Math.max(i[c].contentLength+this.rulerWidth,i[c].controlLength-(u?r:0)):u?i[c].controlLength-r:i[c].controlLength,i[c].startWorkspaceLocation=-i[c].origin,i[c].endWorkspaceLocation=i[c].startWorkspaceLocation+i[c].rulerPixelLength,i[c].startWorkspaceLocation/=i[c].factor,i[c].endWorkspaceLocation/=i[c].factor,i[c].startWorkspaceLocation*=l,i[c].endWorkspaceLocation*=l;for(var d=1,p=80/i[c].factor*l,f=1;p>10;)p/=10,f*=10;p>5?(f*=5,d=this._rulerDivision):p>2&&(f*=2,d=2);for(var g=[{location:0,index:0}],_=0;_<i[c].endWorkspaceLocation;)_+=f,g.push({location:_,index:0});for(_=0;_>i[c].startWorkspaceLocation;)_-=f,g.push({location:_,index:0});for(this._clearElement(i[c].ruler),w=0;w<g.length;w++){var v=e.createElement("span"),m=Math.abs(Math.round(g[w].location)).toString();v.innerHTML=1==c?m.split("").join("<br/>"):m,v.style.position="absolute",v.style.fontSize="9px",v.style.margin="0px",v.style.padding="0px",v.style.fontFamily="Tahoma, Verdana, Arial;",v.style.backgroundColor="#ffffff";var y=Math.round(g[w].location*i[c].factor/l+i[c].origin);v.style.top=0==c?"-1px":y+2+"px",v.style.left=1==c?"2px":y+2+"px",i[c].ruler.appendChild(v)}var b=1,C={1:{newDiv:this._rulerDivision,fractions:2},2:{newDiv:1,fractions:2}};C[this._rulerDivision]={newDiv:1,fractions:this._rulerDivision};for(var w,E=C[d],x=f/E.fractions;x*i[c].factor/l>4;){for(var P=g.length-1;P>=0;){for(var S=0;S<E.fractions-1;S++)g.push({index:b,location:g[P].location+x*(S+1)});P--}b++,x/=(E=C[E.newDiv]).fractions}for(w=0;w<g.length;w++){var I=e.createElement("div");I.style.position="absolute",I.style.overflow="hidden",I.style.backgroundColor="#000000",I.style.padding="0px",I.style.margin="0px";y=Math.round(g[w].location*i[c].factor/l+i[c].origin);var T=this.rulerWidth,D=Math.max(Math.ceil(T/Math.pow(2,g[w].index)),2);I.style.width=0==c?"1px":D+"px",I.style.height=1==c?"1px":D+"px",I.style.top=0==c?T-D+"px":y+"px",I.style.left=1==c?T-D+"px":y+"px",I.style.webkitTransform="translate3d(0, 0, 0)",i[c].ruler.appendChild(I)}}},e.prototype._generateCssWithPrefixes=function(e,t){var n={};for(var i in e)n[e[i]+"transition"]=t;return n},e.prototype._getPageZoom=function(){return screen.deviceXDPI/screen.logicalXDPI},e.prototype._getActualScrollPosition=function(){var e=this.element,t=e.scrollLeft,n=e.scrollTop;return new f.PointF(t,n)},e.prototype._getViewportLocation=function(){var e,t,n=this.rulerEnabled?this.rulerWidth:0,i=this._holderBounds,o=i.width-n,r=i.height-n,a=90===this._contentAngle||270===this._contentAngle,s=a?this.contentHeight:this.contentWidth,l=a?this.contentWidth:this.contentHeight;switch(this._viewportAlignment){case q.centerBottom:case q.centerCenter:case q.centerTop:e=Math.floor((o-s)/2);break;case q.leftBottom:case q.leftCenter:case q.leftTop:e=0;break;case q.rightBottom:case q.rightCenter:case q.rightTop:e=o-s}switch(this._viewportAlignment){case q.centerCenter:case q.leftCenter:case q.rightCenter:t=Math.floor((r-l)/2);break;case q.centerTop:case q.leftTop:case q.rightTop:t=0;break;case q.centerBottom:case q.leftBottom:case q.rightBottom:t=r-l}return new f.PointF(Math.max(n,e+n),Math.max(n,t+n))},e.prototype.ignoreDocumentClickOnce=function(){this._ignoreDocumentClickOnce=!0},e.prototype._onDocumentClick=function(e){!0!==this._ignoreDocumentClickOnce?this._documentClickEvent.notify(this,e):this._ignoreDocumentClickOnce=!1},e.prototype._onClick=function(e){this._clickEvent.notify(this,e)},e.prototype._onMouseDown=function(e){this._mouseDownEvent.notify(this,e)},e.prototype._onMouseMove=function(e){this._mouseMoveEvent.notify(this,e)},e.prototype._onMouseUp=function(e){this._mouseUpEvent.notify(this,e)},e.prototype._useWorkspaceCoords=function(e){var t=new ve(e),n=this.pageToWorkspacePoint(t.pageX,t.pageY);return t.x=n.x,t.y=n.y,t},e.prototype._onWorkspaceDoubleClick=function(e){var t=this._useWorkspaceCoords(e),n={x:t.x,y:t.y};this._workspaceDoubleClickEvent.notify(this,n)},e.prototype._onWorkspaceClick=function(e){var t=this._useWorkspaceCoords(e),n={x:t.x,y:t.y};this._workspaceClickEvent.notify(this,n)},e.prototype._onWorkspaceMouseDown=function(e){if(!this._isManyTouches(e)){var t=this._useWorkspaceCoords(e);this._workspaceMouseDownEvent.notify(this,t),M.a.IsTouchIE()||this._contentCtx.setCapture()}},e.prototype._onWorkspaceMouseUp=function(e){if(!this._isManyTouches(e)){var t=this._useWorkspaceCoords(e);this._workspaceMouseUpEvent.notify(this,t),this._contentCtx.releaseCapture()}},e.prototype._onWorkspaceMouseMove=function(e){if(this._isManyTouches(e))e.preventDefault();else{var t=this._useWorkspaceCoords(e);this._workspaceMouseMoveEvent.notify(this,t)}},e.prototype._makeInactive=function(e){e.ondrag=function(){return!1},e.unselectable="on"},e.prototype._makeInactiveAll=function(){for(var e=this._contentElements,t=0;t<e.length;t++)this._makeInactive(e[t])},e.prototype._resizeContentElements=function(){for(var e=this.contentWidth,t=this.contentHeight,n=this._contentElements,i=0;i<n.length;i++)n[i].style.width=e+"px",n[i].style.height=t+"px","IMG"==n[i].tagName&&(n[i].width=e,n[i].height=t);this._contentCtxDimension.width=e,this._contentCtxDimension.height=t,this._contentCtxLocation=this._getElementPageCoord(this._contentCtx),this._holderBounds=this._getElementBounds(this.element)},e.prototype._getElementBounds=function(e){for(var t=[];e.length>0&&e!=document;)"none"==e.style.display&&(t.push({element:e,display:e.style.display,visibility:e.style.visibility}),e.style.visibility="hidden",e.style.display="block"),e=e.parent();for(var n=e.clientWidth,i=e.clientHeight,o=e.offsetHeight,r=e.offsetWidth,a=e.offsetTop,s=e.offsetLeft,l=0;l<t.length;l++){var c=t[l];c.element[0].style.visibility=c.visibility,c.element[0].style.display=c.display}return{width:n,height:i,offsetWidth:r,offsetHeight:o,offsetTop:a,offsetLeft:s}},e.prototype._isManyTouches=function(e){if(M.a.IsTouchDevice()){var t=e.originalEvent||e;if(window.navigator.pointerEnabled){if(this._touchFlags.multiTouch||!1!==t.isPrimary||(this._touchFlags.multiTouch=!0),this._touchFlags.multiTouch)return!0}else if("object"===ge(t.touches)&&null!==t.touches&&"number"==typeof t.touches.length&&t.touches.length>1)return!0}return!1},e.prototype._onTouch=function(e){this._touchFlags.startZoom=this.zoom,this._touchFlags.multiTouch=e.gesture.touches.length>1},e.prototype._onPinch=function(e,t){if(e.gesture.preventDefault(),e.preventDefault(),this._touchFlags.multiTouch=e.gesture.touches.length>1,this._touchFlags.pinchStarted||(this._touchFlags.pinchStarted=!0,this._pinchStartEvent.notify(this)),this.pinchZoomEnabled){var n=this._touchFlags.startZoom*e.gesture.scale,i=new me;t?i.skipZoomToCenter=!0:(i.centerPageX=e.gesture.center.pageX,i.centerPageY=e.gesture.center.pageY),this.setZoom(n,i)}},e.prototype._onRelease=function(e){this._touchFlags.multiTouch=!1,this._touchFlags.pinchStarted&&(this._touchFlags.pinchStarted=!1,this._pinchStopEvent.notify(this))},e.prototype.initialize=function(e){var t=this;void 0===e&&(e=null),null!=e&&(this._intervalCheckLoop=e);var n=document.createElement("style");n.id="aurigmaStyles",n.type="text/css",n.innerHTML=".aurigmaNoSelect {-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}",document.getElementsByTagName("head")[0].appendChild(n);var i=this.element;this._holderBounds=this._getElementBounds(i),this._holderElement=i,i.innerHTML=this._render(),this._makeInactive(i);var o=i.querySelectorAll("#cvContent");this._contentElements.push(this._contentCtx=o[0]),this._addSetCapture(i);var r=this._scrollingPosition;this._scrollInitialized=!0,i.scrollLeft=r.x,i.scrollTop=r.y,this._initializeRulers();var a=this._pointerEvents;M.a.IsTouchDevice()&&(de(this._holderElement).on("touch",D.b.createBoundedWrapper(this,this._onTouch)).on("pinch",D.b.createBoundedWrapper(this,this._onPinch)).on("release",D.b.createBoundedWrapper(this,this._onRelease)),window.navigator.pointerEnabled&&(this._holderElement.style.touchAction=this._msTouchActionInitialValue)),document.addEventListener("click",D.b.createBoundedWrapper(this,this._onDocumentClick)),this._holderElement.addEventListener("contextmenu",function(e){e.preventDefault()}),this._holderElement.addEventListener("click",D.b.createBoundedWrapper(this,this._onClick)),this._holderElement.addEventListener("scroll",D.b.createBoundedWrapper(this,this._onScroll)),this._contentCtx.addEventListener("click",D.b.createBoundedWrapper(this,this._onWorkspaceClick)),a.start.split(" ").forEach(function(e){t._holderElement.addEventListener(e,D.b.createBoundedWrapper(t,t._onMouseDown)),t._contentCtx.addEventListener(e,D.b.createBoundedWrapper(t,t._onWorkspaceMouseDown))}),a.move.split(" ").forEach(function(e){t._holderElement.addEventListener(e,D.b.createBoundedWrapper(t,t._onMouseMove)),t._contentCtx.addEventListener(e,D.b.createBoundedWrapper(t,t._onWorkspaceMouseMove))}),a.up.split(" ").forEach(function(e){t._holderElement.addEventListener(e,D.b.createBoundedWrapper(t,t._onMouseUp)),t._contentCtx.addEventListener(e,D.b.createBoundedWrapper(t,t._onWorkspaceMouseUp))}),a.cancel.split(" ").forEach(function(e){t._holderElement.addEventListener(e,D.b.createBoundedWrapper(t,t._onMouseUp)),t._contentCtx.addEventListener(e,D.b.createBoundedWrapper(t,t._onWorkspaceMouseUp))}),de(this._contentCtx).on("doubletap",this._onWorkspaceDoubleClick.bind(this)),this._contentCtxDimension={width:this.contentWidth,height:this.contentHeight},this._contentCtxLocation=this._getElementPageCoord(this._contentCtx),this._updateViewport(),this._updateViewportAlignment(),this._updateRulersStyle(),this.add_pinchStart(D.b.createBoundedWrapper(this,function(){this._rulers.topRuller.style.opacity=this._rulers.leftRuller.style.opacity=.1})),this.add_pinchStop(D.b.createBoundedWrapper(this,function(){this._rulersOnZoom(),this._rulers.topRuller.style.opacity=this._rulers.leftRuller.style.opacity=1})),this._startIntervalCheckLoop()},e.prototype._startIntervalCheckLoop=function(){var e=this;this._intervalCheckLoop.start({checkFunction:function(){var t=e._getElementBounds(e.element);return e._contentCtxLocation=e._getElementPageCoord(e._contentCtx),t.width>0&&t.width!==e._holderBounds.width||t.height>0&&t.height!==e._holderBounds.height},onChange:function(){var t=e._getElementBounds(e.element);e._holderBounds=t,e._onResize(e,!1)}})},e.prototype.setIntervalCheckLoop=function(e){null!=e&&(this._intervalCheckLoop=e,this._startIntervalCheckLoop())},Object.defineProperty(e.prototype,"_pointerEvents",{get:function(){var e="mousedown",t="mousemove",n="mouseup",i="";return M.a.IsTouchDevice()&&(window.navigator.pointerEnabled?(e="pointerdown",t="pointermove",n="pointerup",i="pointerCancel"):(e="mousedown touchstart",t="mousemove touchmove",n="mouseup touchend",i="touchcancel")),{start:e,move:t,up:n,cancel:i}},enumerable:!0,configurable:!0}),e.prototype._onScroll=function(e){this._scrollInitialized?this._scrollInitialized=!1:(this._scrollingPosition=this._getActualScrollPosition(),this._contentCtxLocation=this._getElementPageCoord(this._contentCtx),this._scrolledEvent.notify(this))},e.prototype._onResize=function(e,t){this._updateViewport(),this._updateViewportAlignment(),this._updateRulersStyle(),this._scrollingPosition=this._getActualScrollPosition(),this._onresizeEvent.notify(this),this._contentCtxLocation=this._getElementPageCoord(this._contentCtx)},e.prototype._updateViewport=function(){if(this.hasContent){var e=this.zoomMode,t=this.calculateZoomByZoomMode(e);if(!(null==t||t<0)){this._zoom=Math.min(Math.max(t,this.minZoom),this.getMaxZoom()),this._resizeContentElements();var n=this._getViewportLocation();this._contentCtx.style.left=n.x+"px",this._contentCtx.style.top=n.y+"px",this._viewportLocation=n,this._zoomedEvent.notify(this)}}},e.prototype._addSetCapture=function(e){var t=this._viewerElement;if(HTMLElement){var n=HTMLElement.prototype,i=["click","mousedown","mouseup","mousemove","mouseover","mouseout"],o=null;n.setCapture=function(){var e,t;document.querySelector("body").classList.add("aurigmaNoSelect"),o=this;try{for(var n=_e(i),r=n.next();!r.done;r=n.next()){var s=r.value;window.addEventListener(s,a,!0)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}};var r=n.releaseCapture;n.releaseCapture=function(){var e,t;document.querySelector("body").classList.remove("aurigmaNoSelect"),null!=r&&r.call(this);try{for(var n=_e(i),s=n.next();!s.done;s=n.next()){var l=s.value;window.removeEventListener(l,a,!0)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}o=null};var a=function e(n){window.removeEventListener(n.type,e,!0);var i=n.path||n.composedPath();null==o||null!=t&&i.some(function(e){return e.id===t.id})||o.dispatchEvent(s(n)),window.addEventListener(n.type,e,!0)},s=function(e){var t;document.createEvent?(t=document.createEvent("MouseEvent")).initMouseEvent(e.type,e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget):t=new MouseEvent(e.type,e);var n=e.buttons;return t.buttons!==n&&Object.defineProperty(t,"buttons",{get:function(){return n}}),t}}},e.prototype._getElementPageCoord=function(e){var t=e.getBoundingClientRect();return{left:t.left+window.scrollX,top:t.top+window.scrollY}},e.prototype._zoomToPagePoint=function(e,t,n){var i=this.pageToControlPoint(t,n),o=this.pageToWorkspacePoint(t,n,!0);this._setZoom(e);var r=this.workspaceToContentPoint(o),a=this.rulerEnabled?this._rulerWidth:0,s=new f.PointF(Math.round(r.x-i.x+a),Math.round(r.y-i.y+a));this.scrollingPosition=s},e.prototype._updateViewportAlignment=function(){var e=this._getViewportLocation();this._contentCtx.style.left=e.x+"px",this._contentCtx.style.top=e.y+"px"},Object.defineProperty(e.prototype,"scrollingSize",{get:function(){var e=this.element,t=e.scrollWidth-e.clientWidth,n=e.scrollHeight-e.clientHeight;return t<0&&(t=0),n<0&&(n=0),new f.PointF(Math.round(t),Math.round(n))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentCtx",{get:function(){return this._contentCtx},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clientSideOptions",{get:function(){return this._clientSideOptions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoomConfig",{get:function(){return console.log("not implemented"),null},enumerable:!0,configurable:!0}),e.prototype.setCursor=function(e,t){if(void 0===t&&(t=!1),this._getElementForCursor().style.cursor=D.b.cursorToCss(e),null!=window){if((e=!0===t?e:D.a.defaultCursor)===this._bodyCursor)return;window.document.querySelector("body").style.cursor=D.b.cursorToCss(e),this._bodyCursor=e}},e.prototype._getElementForCursor=function(){return this._contentCtx},Object.defineProperty(e.prototype,"delayedRefreshTimeout",{get:function(){return this._delayedRefreshTimeout},set:function(e){this._delayedRefreshTimeout=e},enumerable:!0,configurable:!0}),e.prototype.getMaxZoom=function(){return this._maxZoom>0?this._maxZoom:2.5},e.prototype.setMaxZoom=function(e){this._maxZoom=e,this.zoom>this.getMaxZoom()&&this.setZoom(this.getMaxZoom(),null)},Object.defineProperty(e.prototype,"minZoom",{get:function(){return this.zoomConfig?this.zoomConfig.min:this._minZoom>0?this._minZoom:.001},set:function(e){this._minZoom=e,this.zoom<this.minZoom&&this.setZoom(this.minZoom,null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenXDpi",{get:function(){return this._screenXDpi},set:function(e){this._screenXDpi=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenYDpi",{get:function(){return this._screenYDpi},set:function(e){this._screenYDpi=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollBarsStyle",{get:function(){return this._scrollBarsStyle},set:function(e){this._scrollBarsStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollBarWidth",{get:function(){if(null==this._actualScrollbarWidth){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",e.style.overflow="scroll",document.body.appendChild(e);var t=document.createElement("div");t.style.width="100%",e.appendChild(t),this._actualScrollbarWidth=100-t.offsetWidth,e.remove()}return this._actualScrollbarWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollingPosition",{get:function(){return this._scrollingPosition=this._getActualScrollPosition(),this._scrollingPosition.round()},set:function(e){var t=this.element;t.scrollLeft=e.x,t.scrollTop=e.y;var n=this.scrollingPosition;this._scrollingPosition=new f.PointF(n.x,n.y),this._scrolledEvent.notify(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportAlignment",{get:function(){return this._viewportAlignment},set:function(e){this._viewportAlignment=e,this._updateViewportAlignment(),this._drawRulers(),this._updateRulersStyle()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoom",{get:function(){return this._zoom},enumerable:!0,configurable:!0}),e.prototype.setZoom=function(e,t){var n,i;if(t){if(t.skipZoomToCenter)return this._setZoom(e),this._zoom;n=t.centerPageX,i=t.centerPageY}else{var o=this._getElementPageCoord(this.element),r=this.rulerEnabled?this._rulerWidth:0,a=this._holderBounds.width-r,s=this._holderBounds.height-r;n=Math.round(o.left+r+a/2),i=Math.round(o.top+r+s/2)}return this._zoomToPagePoint(e,n,i),this._zoom},e.prototype._setZoom=function(e){this._zoom==e&&this._zoomMode==Y.none||(this._zoom=Math.min(Math.max(e,this.minZoom),this.getMaxZoom()),this._zoomMode=Y.none,this._updateViewport())},Object.defineProperty(e.prototype,"pinchZoomEnabled",{get:function(){return this._pinchZoomEnabled},set:function(e){this._pinchZoomEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rulerEnabled",{get:function(){return this._rulerEnabled},set:function(e){var t=e?"block":"none";this._rulers.fullLeftRuller.style.display=t,this._rulers.fullTopRuller.style.display=t,this._rulers.leftRuller.style.display=t,this._rulers.topRuller.style.display=t,this._rulers.whiteRect.style.display=t,this._rulerEnabled=e,this.zoomMode=this.zoomMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rulerScale",{get:function(){return this._rulerScale},set:function(e){if(e<=0)throw new Error("Ruler scale should be greater 0.");this._rulerScale=e,this._updateViewport()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rulerDivision",{get:function(){return this._rulerDivision},set:function(e){if(e<=0)throw new Error("Ruler division should be greater 0.");this._rulerDivision=e,this._updateViewport()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rulerOffsetX",{get:function(){return this._rulerOffsetX},set:function(e){this._rulerOffsetX=e,this._updateViewport()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rulerOffsetY",{get:function(){return this._rulerOffsetY},set:function(e){this._rulerOffsetY=e,this._updateViewport()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rulerWidth",{get:function(){return this._rulerWidth},set:function(e){this._rulerWidth=e,this._updateViewport()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoomMode",{get:function(){return this._zoomMode},set:function(e){this._setZoomMode(e)},enumerable:!0,configurable:!0}),e.prototype._setZoomMode=function(e){this._zoomMode=e,this._updateViewport()},Object.defineProperty(e.prototype,"bestFitWhiteSpacePc",{get:function(){return 100*this._bestFitWhiteSpacePc},set:function(e){"number"==typeof e&&!isNaN(e)&&e>=0&&e<99&&(this._bestFitWhiteSpacePc=e/100),this.zoomMode=this.zoomMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoomQuality",{get:function(){return this._zoomQuality},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exceptionDescription",{get:function(){return this._exceptionDescription},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"returnValue",{get:function(){return this._returnValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"workspaceWidth",{get:function(){throw new Error("Not implemented")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"workspaceHeight",{get:function(){throw new Error("Not implemented")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actualSizeHorizontalScale",{get:function(){throw new Error("Not implemented")},enumerable:!0,configurable:!0}),e.prototype.calculateZoomByZoomMode=function(e){if(null!=this._holderBounds){var t=this.workspaceWidth*this.screenXDpi/72,n=this.workspaceHeight*this.screenYDpi/72,i=this.rulerEnabled?this.rulerWidth+this._rulerBorderWidth:0,o=this._holderBounds,r=o.offsetWidth-i,a=o.offsetHeight-i,s=90===this._contentAngle||270===this._contentAngle,l=s?n:t,c=s?t:n,u=r/l,h=a/c,d=this.scrollBarWidth,p=(r-d)/l,f=(a-d)/c,g=this._scrollBarsStyle===U.always,_=this.zoom;switch(e){case Y.bestFit:this._bestFitWhiteSpacePc>0&&(u=(r-r*this._bestFitWhiteSpacePc)/l,h=(a-a*this._bestFitWhiteSpacePc)/c,p=(r-d-(r-d)*this._bestFitWhiteSpacePc)/l,f=(a-d-(a-d)*this._bestFitWhiteSpacePc)/c),_=g?Math.min(p,f):Math.min(u,h);break;case Y.bestFitShrinkOnly:_=g?Math.min(p,f):Math.min(u,h),_=Math.min(1,_);break;case Y.fitToHeight:_=g?f:Math.round(h*l)<=r?h:f;break;case Y.fitToHeightShrinkOnly:_=g?Math.min(1,f):Math.round(Math.min(1,h)*l)<=r?Math.min(1,h):Math.min(1,f);break;case Y.fitToWidth:_=g?p:Math.round(u*c)<=a?u:p;break;case Y.fitToWidthShrinkOnly:_=g?Math.min(1,p):Math.round(Math.min(1,u)*c)<=a?Math.min(1,u):Math.min(1,p)}return _}},e.prototype.clearRenderCtx=function(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])},e.prototype.workspaceToContentPoint=function(e){return this.controlToContentPoint(this.workspaceToControlPoint(e))},e.prototype.controlToContentPoint=function(e){var t=this._getViewportLocation(),n=this._getActualScrollPosition(),i=new f.PointF(0,0),o=e.x,r=e.y;return i.x=o-t.x+n.x,i.y=r-t.y+n.y,i.round()},e.prototype.controlToPagePoint=function(e){var t=this._getElementPageCoord(this.element),n=e.x,i=e.y,o=n+t.left,r=i+t.top;return new f.PointF(Math.round(o),Math.round(r))},e.prototype.contentToControlPoint=function(e){var t=this._getViewportLocation(),n=this._getActualScrollPosition(),i=new f.PointF(0,0);return i.x=e.x+t.x-n.x,i.y=e.y+t.y-n.y,i.round()},e.prototype.controlToContentRectangle=function(e){var t=new f.PointF(e.left,e.top),n=new f.PointF(e.left+e.width,e.top+e.height);return t=this.controlToContentPoint(t),n=this.controlToContentPoint(n),new f.RectangleF(t.x,t.y,n.x-t.x,n.y-t.y)},e.prototype.contentToControlRectangle=function(e){var t=new f.PointF(e.left,e.top),n=new f.PointF(e.left+e.width,e.top+e.height);return t=this.contentToControlPoint(t),n=this.contentToControlPoint(n),new f.RectangleF(t.x,t.y,n.x-t.x,n.y-t.y)},e.prototype.workspaceToControlPoint=function(e){var t=this.zoom,n=e.x,i=e.y,o=new f.PointF(Math.round(n*t*this._screenXDpi/72),Math.round(i*t*this._screenYDpi/72));return this.contentToControlPoint(o).round()},e.prototype.workspaceToWhiteSpacePoint=function(e){var t=this.workspaceToContentPoint(e),n=this.rulerEnabled?this.rulerWidth:0,i=this._getViewportLocation();return new f.PointF(t.x-n+i.x,t.y-n+i.y)},e.prototype.whitespaceToWorkspacePoint=function(e){var t=this.rulerEnabled?this.rulerWidth:0,n=this._getViewportLocation();return this.controlToWorkspacePoint(this.contentToControlPoint(new f.PointF(e.x-n.x+t,e.y-n.y+t)))},e.prototype.controlToWorkspacePoint=function(e){var t=this.zoom,n=this.controlToContentPoint(e);return new f.PointF(n.x/(t*this._screenXDpi/72),n.y/(t*this._screenYDpi/72))},e.prototype.workspaceToControlRectangle=function(e){var t=this.zoom,n=this._screenXDpi/72*t,i=this._screenYDpi/72*t,o=new f.RectangleF(Math.round(e.left*n),Math.round(e.top*i),Math.round(e.width*n),Math.round(e.height*i));return this.contentToControlRectangle(o)},e.prototype.pageToControlPoint=function(e,t){var n=this._getElementPageCoord(this.element),i=e-n.left,o=t-n.top;return new f.PointF(Math.round(i),Math.round(o))},e.prototype.pageToWorkspacePoint=function(e,t,n){void 0===n&&(n=!1);var i=this.controlToWorkspacePoint(this.pageToControlPoint(e,t)),o=new f.PointF(i.x,i.y),r=this.contentAngle;return r>0&&!0!==n&&(o.rotate(-r),90===r?o.translate(0,this._canvas.workspaceHeight):180===r?o.translate(this._canvas.workspaceWidth,this._canvas.workspaceHeight):270===r&&o.translate(this._canvas.workspaceWidth,0)),new f.PointF(o.x,o.y)},e.prototype.controlToWorkspaceRectangle=function(e){var t=this.zoom,n=1/(t*this._screenXDpi/72),i=1/(t*this._screenYDpi/72),o=this.controlToContentRectangle(e);return new f.RectangleF(o.left*n,o.top*i,o.width*n,o.height*i)},e.prototype.abort=function(){this._status==o.busy&&(this._callbackContext++,this._exceptionDescription="",this._status=o.ready)},e.prototype.dispose=function(){this._disposeRulers()},e.prototype.delayedRefresh=function(){this._refreshTimer&&window.clearTimeout(this._refreshTimer);var e=D.b.createBoundedWrapper(this,function(){this._refreshTimer=null,this.refresh()});this._refreshTimer=window.setTimeout(e,this._delayedRefreshTimeout)},e.prototype._refresh=function(){},e.prototype.refresh=function(){this._status==o.busy?this._needToRefresh=!0:(this._needToRefresh=!1,this._refresh())},e.prototype._raiseInvokingCallbackRequest=function(){this._invokingCallbackRequestEvent.notify(this)},e.prototype.add_onResize=function(e){this._onresizeEvent.add(e)},e.prototype.remove_onResize=function(e){this._onresizeEvent.remove(e)},e.prototype.add_invokingCallbackRequest=function(e){this._invokingCallbackRequestEvent.add(e)},e.prototype.remove_invokingCallbackRequest=function(e){this._invokingCallbackRequestEvent.remove(e)},e.prototype.add_workspaceChanged=function(e){this._workspaceChangedEvent.add(e)},e.prototype.remove_workspaceChanged=function(e){this._workspaceChangedEvent.remove(e)},e.prototype.add_scrolled=function(e){this._scrolledEvent.add(e)},e.prototype.remove_scrolled=function(e){this._scrolledEvent.remove(e)},e.prototype.add_statusChanged=function(e){this._statusChangedEvent.add(e)},e.prototype.remove_statusChanged=function(e){this._statusChangedEvent.remove(e)},e.prototype.add_pinchStart=function(e){this._pinchStartEvent.add(e)},e.prototype.remove_pinchStart=function(e){this._pinchStartEvent.remove(e)},e.prototype.add_pinchStop=function(e){this._pinchStopEvent.add(e)},e.prototype.remove_pinchStop=function(e){this._pinchStopEvent.remove(e)},e.prototype.add_zoomed=function(e){this._zoomedEvent.add(e)},e.prototype.remove_zoomed=function(e){this._zoomedEvent.remove(e)},e.prototype.add_click=function(e){this._clickEvent.add(e)},e.prototype.remove_click=function(e){this._clickEvent.remove(e)},e.prototype.add_mouseDown=function(e){this._mouseDownEvent.add(e)},e.prototype.remove_mouseDown=function(e,t){this._mouseDownEvent.remove(e)},e.prototype.add_mouseMove=function(e){this._mouseMoveEvent.add(e)},e.prototype.remove_mouseMove=function(e){this._mouseMoveEvent.remove(e)},e.prototype.add_mouseUp=function(e){this._mouseUpEvent.add(e)},e.prototype.remove_mouseUp=function(e){this._mouseUpEvent.remove(e)},e.prototype.add_workspaceClick=function(e){this._workspaceClickEvent.add(e)},e.prototype.remove_workspaceClick=function(e){this._workspaceClickEvent.remove(e)},e.prototype.add_workspaceDoubleClick=function(e){this._workspaceDoubleClickEvent.add(e)},e.prototype.remove_workspaceDoubleClick=function(e){this._workspaceDoubleClickEvent.remove(e)},e.prototype.add_workspaceMouseDown=function(e){this._workspaceMouseDownEvent.add(e)},e.prototype.remove_workspaceMouseDown=function(e){this._workspaceMouseDownEvent.remove(e)},e.prototype.add_workspaceMouseMove=function(e){this._workspaceMouseMoveEvent.add(e)},e.prototype.remove_workspaceMouseMove=function(e){this._workspaceMouseMoveEvent.remove(e)},e.prototype.add_workspaceMouseUp=function(e){this._workspaceMouseUpEvent.add(e)},e.prototype.remove_workspaceMouseUp=function(e){this._workspaceMouseUpEvent.remove(e)},e}(),Ce=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},we=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Ce(arguments[t]));return e},Ee=function(){function e(e,t,n,i){var o=this;this._viewer=e,this._selection=t,this._dndHandler=n,this._rotateHandler=i,this._document=null,this._parent=null,this._whitespace=null,this._dndDiv=null,this._dndStyle=null,this._spotlightDivs=[],this._spotlightOptions=[],this._selectionDiv=null,this._parentSelectionDiv=null,this._selectionStyle=null,this._buttonStyle=null,this.hoverDiv=null,this._textEditorDiv=null,this.surfaceCanvas=null,this.activeCanvas=null,this.inactiveCanvas=null,this.designCanvas=null,this.cursorCanvas=null,this.staticTextCanvas=null,this.activeTextCanvas=null,this._getRotationCircleSvg=function(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("viewBox","0 0 16 16"),e.setAttribute("fill","none"),e.innerHTML='<path d="M11.151 2.54293C14.1643 4.28262 15.1967 8.13564 13.457 11.1489C13.175 11.6374 12.8374 12.0738 12.4569 12.4548L10.5467 14.3629M4.85101 13.4548C1.83777 11.7151 0.805356 7.86213 2.54505 4.84888C2.82707 4.36041 3.16463 3.924 3.54514 3.54301L5.4555 1.63498M10.5456 11.182L10.5467 14.3629M10.5467 14.3629L13.7275 14.364M5.45439 4.81807L5.4555 1.63498M5.4555 1.63498L2.27241 1.63609" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>',e.style.color="var(--de-brand-primary)",e},this._updateVCPtimers={},this._textEditorId="textEditor",this._onZoomedScrolledDelegate=function(){var e=o._selection.currentItemHandler;if(null!=e){var t=e.item instanceof H.PlainTextItem?e.item.alignment:null;o._updateTextEditorPosition(e.rectangle,t,e.item.borderWidth)}},this._stopPropagationFnc=function(e){e.stopPropagation()};var r=this._viewer.id;if(null==r)throw new C.d("Element id cannot be null or undefined");this._surfaceCanvasId=r,this._activeCanvasId=r+"_active",this._inactiveCanvasId=r+"_inactive",this._designCanvasId=r+"_design",this._cursorCanvasId=r+"_cursor",this._staticTextCanvasId=r+"_staticText",this._activeTextCanvasId=r+"_activeText"}return Object.defineProperty(e.prototype,"offset",{get:function(){return this._offset},set:function(e){null!=e&&e.equals(this._offset)||null==e&&null!=this.offset||(this._offset=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_canvas",{get:function(){return this._viewer.canvas},enumerable:!0,configurable:!0}),e.prototype.addStyles=function(){this._addButtonStyles(),this._addSelectionStyle(),this._addDndStyle(),this._rotateHandler.addRotationStyle()},e.prototype._addButtonStyles=function(){null!=this._buttonStyle&&this._buttonStyle.remove(),this._buttonStyle=document.createElement("style"),this._buttonStyle.type="text/css",this._buttonStyle.innerHTML=".buttonsHidden {opacity: 0; transition: 0.3s opacity; pointer-events: none !important;}.buttonsShown {opacity: 1; transition: 0.3s opacity; position: relative;}.elementHidden {opacity: 0; transition: 0.3s opacity;}.elementShown {opacity: 1; transition: 0.3s opacity;}",document.head.appendChild(this._buttonStyle)},e.prototype._addSelectionStyle=function(){null!=this._selectionStyle&&this._selectionStyle.remove(),this._selectionStyle=document.createElement("style"),this._selectionStyle.type="text/css",this._selectionStyle.innerHTML="#grips, #grips .selection, #hover {position: absolute; z-index: 1; pointer-events: none; box-sizing: border-box}#hover-label, .hover-label {left: 0px; top: -20px; position: absolute; width: 100%; text-align: left;min-width: 48px; font-family: Roboto; font-style: normal; font-weight: normal; font-size: 12px; line-height: 14px; white-space: nowrap; overflow: hidden;text-overflow: ellipsis;}",document.head.appendChild(this._selectionStyle)},e.prototype._addDndStyle=function(){null!=this._dndStyle&&this._dndStyle.remove(),this._dndStyle=document.createElement("style"),this._dndStyle.type="text/css",this._dndStyle.innerHTML="#ccDndDiv {position: absolute; left: 0; top: 0; z-index: 3; pointer-events: none; box-sizing: border-box; width: 100%; height: 100%;}#ccDndDiv .thumb {position: absolute; left: 0; top: 0; z-index: 3; pointer-events: none; box-sizing: border-box; width: 100px; height: 100px; border: 1px solid black; opacity: 0.8; background-size: cover;}#ccDndDiv .thumb.outside-canvas:after { content: '\\e92b'; font-size: 46px; text-align: center; font-family: 'Material Icons'; line-height: 100px; vertical-align: middle; color: white; background-color: red; opacity: 0.5; width: 100%; height: 100%; display: block; }#ccDndDiv .thumb.outside-canvas { opacity: 0.5 }#ccDndDiv .thumb.drag-over { opacity: 0.4 }.cc-dnd-icon {color: white}.cc-dnd-over {transition: transform 1.5s; transform: scale(1.2); }",document.head.appendChild(this._dndStyle)},e.prototype.addTextEditorStyles=function(e){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,document.head.appendChild(t)},e.prototype.addElement=function(e,t,n,i){this._parent=e,this._document=e.ownerDocument,this._whitespace=t,null!=this._document&&null!=this._whitespace&&(this.staticTextCanvas=this._createCanvasElement(this._staticTextCanvasId,n,i),this.staticTextCanvas.style.visibility="hidden",this._parent.appendChild(this.staticTextCanvas),this.surfaceCanvas=this._createCanvasElement(this._surfaceCanvasId,n,i),this._parent.appendChild(this.surfaceCanvas),this.activeCanvas=this._createCanvasElement(this._activeCanvasId,n,i),this._parent.appendChild(this.activeCanvas),this.activeTextCanvas=this._createCanvasElement(this._activeTextCanvasId,n,i),this._parent.appendChild(this.activeTextCanvas),this.inactiveCanvas=this._createCanvasElement(this._inactiveCanvasId,n,i),this._parent.appendChild(this.inactiveCanvas),this.designCanvas=this._createCanvasElement(this._designCanvasId,n,i),this._parent.appendChild(this.designCanvas),this.cursorCanvas=this._createCanvasElement(this._cursorCanvasId,n,i),this._parent.appendChild(this.cursorCanvas),this._viewer.frontEndTextRenderingEnabled&&this._addTextEditorDiv(),this._addDndDiv(),this._addSelectionDiv(),this._addParentSelectionDiv(),this._addHoverDiv())},e.prototype.removeElement=function(){var e=this._getAllCanvases(),t=null!=e[0]?e[0].parentNode:null;if(null!=t)for(var n=e.length-1;n>=0;--n){var i=e[n];null!=i&&t.removeChild(i)}this._removeTextEditorDiv(),this._removeDndDiv(),this._removeSelectionDiv(),this._removeParentSelectionDiv(),this._removeHoverDiv()},e.prototype.updateElementSize=function(t,n){for(var i=this._getAllCanvases(),o=0;o<i.length;o++){var r=i[o];null!=r&&e.setElementSize(r,t,n)}},e.prototype.moveActiveTextCanvasOnTop=function(){this._parent.insertBefore(this.activeTextCanvas,this.designCanvas)},e.prototype.moveActiveTextCanvasBack=function(){this._parent.insertBefore(this.activeTextCanvas,this.inactiveCanvas)},e.prototype._addDndDiv=function(){this._dndDiv=this._document.createElement("div"),this._dndDiv.id="ccDndDiv",this._document.body.appendChild(this._dndDiv);var e=this._document.createElement("div");e.id="ccDndThumb",e.classList.add("thumb"),e.style.visibility="hidden",e.style.left="50%",e.style.top="0%",this._dndDiv.appendChild(e)},e.prototype._removeDndDiv=function(){null!=this._dndDiv&&(this._dndDiv.remove(),this._dndDiv=null)},e.prototype.showDnd=function(e,t,n){this._dndDiv.querySelectorAll("div[id^=ccDndThumb]").forEach(function(t){t.style.left=e.x-50+"px",t.style.top=e.y-50+"px"}),this._dndDiv.style.visibility="visible",this._dndDiv.querySelectorAll("div[id^=ccDndThumb]").forEach(function(e){e.style.visibility="visible",e.style.backgroundImage="url("+t.src+")",e.style.transform="rotate("+n+"deg)"}),this._dndHandler.isOutOfCanvas()?this._dndDiv.querySelectorAll("div[id^=ccDndThumb]").forEach(function(e){e.classList.add("outside-canvas")}):this._dndDiv.querySelectorAll("div[id^=ccDndThumb]").forEach(function(e){e.classList.remove("outside-canvas")}),this._dndHandler.isDragOver()?this._dndDiv.querySelectorAll("div[id^=ccDndThumb]").forEach(function(e){e.classList.add("drag-over")}):this._dndDiv.querySelectorAll("div[id^=ccDndThumb]").forEach(function(e){e.classList.remove("drag-over")})},e.prototype.hideDnd=function(){this._dndDiv.style.visibility="hidden",this._dndDiv.querySelectorAll("div[id^=ccDndThumb]").forEach(function(e){e.style.visibility="hidden"})},e.prototype.showSpotlight=function(e,t,n){var i=this;this._spotlightOptions=t,e.forEach(function(e,o){var r=t[o];if(!i._spotlightDivs.find(function(e){return e.id==="spotlight_"+r.id})){var a=document.createElement("div");a.id="spotlight_"+r.id,i.setSpotlightStyles(a,r,e,n),a.animate([{opacity:0},{opacity:1}],r.transition||0).play(),i._spotlightDivs.push(a),i._whitespace.appendChild(a)}})},e.prototype.hideSpotlight=function(e){var t=this;e.forEach(function(e){var n=t._spotlightDivs.find(function(t){return t.id==="spotlight_"+e});if(n){var i=t._spotlightOptions.find(function(t){return t.id===e}),o=n.animate([{opacity:1},{opacity:0}],(null===i||void 0===i?void 0:i.transition)||0);o.play(),o.addEventListener("finish",function(){return t._whitespace.removeChild(n)})}}),this._spotlightOptions=this._spotlightDivs.filter(function(t){return e.find(function(e){return t.id===e})}),this._spotlightDivs=this._spotlightDivs.filter(function(t){return!e.find(function(e){return"spotlight_"+e===t.id})})},e.prototype.updateSpotlight=function(e,t,n,i){var o=this;e.forEach(function(e,r){var a=o._spotlightDivs.find(function(t){return t.id==="spotlight_"+e});a.innerHTML="",o.setSpotlightStyles(a,n[r],t[r],i)})},e.prototype.setSpotlightStyles=function(e,t,n,i){if(t.name){var o=document.createElement("div");o.innerText=t.name,o.style.color=(null===t||void 0===t?void 0:t.color)||this._canvas.resizeGripLineColor,o.style.position="absolute",o.style.top="-20px",o.classList.add("hover-label"),e.appendChild(o)}var r=f.RotatedRectangleF.getRectWithOffset(n,this._offset);e.style.position="absolute",e.style.boxSizing="border-box",e.style.boxShadow="0px 1px 3px rgba(0, 0, 0, 0.2)",this._updateFramePosition(e,r,i),e.style.border=(t.width||1)+"px solid "+((null===t||void 0===t?void 0:t.color)||this._canvas.resizeGripLineColor)},e.prototype._addParentSelectionDiv=function(){var e=document.createElement("div");e.classList.add("parent-selection"),e.style.visibility="hidden",e.style.position="absolute",this._whitespace.appendChild(e),this._parentSelectionDiv=e,this.updateParentSelectionDiv()},e.prototype._addSelectionDiv=function(){var e=this;this._selectionDiv=document.createElement("div"),this._selectionDiv.id="grips",this._selectionDiv.style.visibility="hidden",this._whitespace.appendChild(this._selectionDiv);var t=document.createElement("div");t.appendChild(this._getRotationCircleSvg()),t.id="rotate-circle",t.classList.add("selection"),t.style.left="calc(50% - 12px)",t.style.bottom="0%",this._selectionDiv.appendChild(t),[{left:0,top:0,id:"resize-left-top"},{left:100,top:0,id:"resize-right-top"},{left:100,top:100,id:"resize-right-bottom"},{left:0,top:100,id:"resize-left-bottom"},{left:0,top:50,id:"resize-width-left"},{left:100,top:50,id:"resize-width-right"},{left:50,top:0,id:"resize-height-top"},{left:50,top:100,id:"resize-height-bottom"}].forEach(function(t){var n=t.left,i=t.top,o=t.id;return e._addGrips(n,i,o)}),this.updateSelectionDiv()},e.prototype._addGrips=function(e,t,n){var i=document.createElement("div");i.id=n,i.classList.add("selection"),i.style.left=e+"%",i.style.top=t+"%",this._selectionDiv.appendChild(i)},e.prototype._removeSelectionDiv=function(){null!=this._selectionDiv&&(this._selectionDiv.remove(),this._selectionDiv=null)},e.prototype._removeParentSelectionDiv=function(){null!=this._parentSelectionDiv&&(this._parentSelectionDiv.remove(),this._parentSelectionDiv=null)},e.prototype.updateSelectionDiv=function(){var e=this;if(null!=this._selectionDiv){this._selectionDiv.style.border=this._canvas.selectionWidth+"px solid "+this._canvas.selectionColor;var t=this._canvas.resizeGripSize;this._selectionDiv.querySelectorAll("div[id^=resize]").forEach(function(n){n.style.width=t+"px",n.style.height=t+"px",n.style.marginLeft="-"+t/2+"px",n.style.marginTop="-"+t/2+"px",n.style.border="1px solid "+e._canvas.resizeGripLineColor,n.style.backgroundColor=""+e._canvas.resizeGripColor});var n=this._canvas.rotationGripSize;this._selectionDiv.querySelectorAll("div#rotate-circle").forEach(function(e){e.style.width=n+"px",e.style.height=n+"px",e.style.marginBottom="-"+2*n+"px",e.style.border="1px solid #eee",e.style.borderRadius="50%",e.style.backgroundColor="#fff",e.style.boxShadow="0px 1px 3px rgba(0, 0, 0, 0.2), 0px 0px 2px rgba(0, 0, 0, 0.2)"})}},e.prototype.updateParentSelectionDiv=function(){null!=this._parentSelectionDiv&&(this._parentSelectionDiv.style.border=this._canvas.selectionWidth+"px dashed "+this._canvas.selectionColor)},e.prototype.showSelection=function(e,t,n){null==this._selectionDiv||null==n||this._selection.isLocked||(this._updateSelectionPosition(e,n),this._selectionDiv.querySelectorAll("div[id^=rotate]").forEach(function(e){e.style.visibility=t.rotate?"visible":"hidden"}),this._selectionDiv.querySelectorAll("div[id^=resize]").forEach(function(e){e.style.visibility=t.resize?"visible":"hidden"}),this._selectionDiv.querySelectorAll("div[id^=resize-width]").forEach(function(e){e.style.visibility=t.arbitraryWidthResize?"visible":"hidden"}),this._selectionDiv.querySelectorAll("div[id^=resize-height]").forEach(function(e){e.style.visibility=t.arbitraryHeightResize?"visible":"hidden"}))},e.prototype.showParentSelection=function(e,t){null==e?this._parentSelectionDiv.style.visibility="hidden":this._updateSelectionPositionForDiv(this._parentSelectionDiv,e,t)},e.prototype.hideSelection=function(){null!=this._selectionDiv&&(this._selectionDiv.style.visibility="hidden",this._selectionDiv.querySelectorAll("div[id^=rotate]").forEach(function(e){e.style.visibility="hidden"}),this._selectionDiv.querySelectorAll("div[id^=resize]").forEach(function(e){e.style.visibility="hidden"}),this._selectionDiv.querySelectorAll("div[id^=resize-width]").forEach(function(e){e.style.visibility="hidden"}),this._selectionDiv.querySelectorAll("div[id^=resize-height]").forEach(function(e){e.style.visibility="hidden"}),this._parentSelectionDiv.style.visibility="hidden")},e.prototype.addChild=function(e){this._whitespace.appendChild(e)},e.prototype.removeChilds=function(e){this._whitespace.removeChild(e)},e.prototype._updateSelectionPosition=function(e,t){if(null!=(e=e||this._selection.visibleRectangle)){var n=t.contentAngle,i=f.RotatedRectangleF.getRectWithOffset(e,this._offset);this._updateFramePosition(this._selectionDiv,i,t),this._rotateHandler.updateRotateDegreeDiv(i.angle-n)}},e.prototype._updateFramePosition=function(e,t,n){var i=this._getControlRectangle(t,n);e.style.visibility="visible",e.style.left=i.left+"px",e.style.top=i.top+"px",e.style.width=i.width+"px",e.style.height=i.height+"px",e.style.transform="rotate("+t.angle+"deg)"},e.prototype._updateSelectionPositionForDiv=function(e,t,n){if(null!=t){var i=f.RotatedRectangleF.getRectWithOffset(t,this._offset),o=this._getControlRectangle(i,n);e.style.visibility="visible",e.style.left=o.left+"px",e.style.top=o.top+"px",e.style.width=o.width+"px",e.style.height=o.height+"px",e.style.transform="rotate("+i.angle+"deg)"}},e.prototype._addHoverDiv=function(){this.hoverDiv=document.createElement("div"),this.hoverDiv.id="hover",this.hoverDiv.style.visibility="hidden",this.hoverDiv.style.zIndex="-1";var e=document.createElement("div");e.id="hover-label",e.classList.add("hover-label"),this.hoverDiv.appendChild(e),this._whitespace.appendChild(this.hoverDiv),this.updateHoverDiv()},e.prototype._removeHoverDiv=function(){null!=this.hoverDiv&&(this.hoverDiv.remove(),this.hoverDiv=null)},e.prototype.updateHoverDiv=function(){null!=this.hoverDiv&&(this.hoverDiv.style.border=this._canvas.selectionWidth+"px solid "+this._canvas.selectionColor,this.hoverDiv.querySelector("#hover-label").style.color=""+this._canvas.selectionColor)},e.prototype.showHover=function(e,t,n){null!=e&&null!=this.hoverDiv&&null!=n&&(this.hoverDiv.querySelector("div[id^=hover-label]").innerText=t,this.hoverDiv.querySelector("div[id^=hover-label]").title=t,this.hoverDiv.style.visibility="visible",this.updateHoverPosition(e,n))},e.prototype.hideHover=function(){null!=this.hoverDiv&&(this.hoverDiv.style.visibility="hidden")},e.prototype.updateHoverPosition=function(e,t,n){if(null!=e&&"hidden"!==this.hoverDiv.style.visibility){var i=f.RotatedRectangleF.getRectWithOffset(e,this._offset),o=this._getControlRectangle(i,t);null!=n&&(this.hoverDiv.querySelector("div[id^=hover-label]").innerText=n),this.hoverDiv.style.left=o.left+"px",this.hoverDiv.style.top=o.top+"px",this.hoverDiv.style.width=o.width+"px",this.hoverDiv.style.height=o.height+"px",this.hoverDiv.style.transform="rotate("+i.angle+"deg)";var r=i.angle%360;this._rotateHandler.rotateHoverLabel(r,o)}},e.prototype.addPlaceholderButtonGroup=function(e,t){var n,i,o,r,a,s,l;if(null!=t&&null!=this._parent&&null!=e){var c=this._parent,u=document.createElement("div");u.style.position="absolute",u.style.display="flex",u.style.alignItems="center",u.id="buttonDiv";var h=this._canvas.placeholderButtonGroupCssClass,d=document.createElement("div");if(d.id="editDiv",null!=h&&""!==h&&(n=d.classList).add.apply(n,we(h.split(" "))),M.a.IsTouchDevice()){var p=this._canvas.bigButtonGroupCssClass;null!=p&&""!==p&&(i=d.classList).add.apply(i,we(p.split(" ")))}if(e.isStubOrEmpty()&&(!this._dndHandler.isDragStarted()||!this._dndHandler.isDragTarget(e))){var f=document.createElement("button");f.type="button",f.id="selectButton",f.setAttribute("style","will-change: transform"),f.addEventListener("mousedown",this._stopPropagationFnc),f.addEventListener("dblclick",this._stopPropagationFnc);var g=e.selectButtonClickHandler;if(this._addClickAndTapHandler(f,g),e.item.isBarcodePlaceholder){var _=this._canvas.selectBarcodeButtonCssClass;null!=_&&""!==_?(o=f.classList).add.apply(o,we(_.split(" "))):f.innerText="Select"}else{var v=this._canvas.selectImageButtonCssClass;null!=v&&""!==v?(r=f.classList).add.apply(r,we(v.split(" "))):f.innerText="Select"}e.selectButton=f,d.appendChild(f)}if(this._dndHandler.isDragStarted&&this._dndHandler.isDragTarget(e)){var m=document.createElement("div");m.id="dropIcon",m.classList.add("cc-dnd-icon"),m.setAttribute("style","width: 30px; height: 30px; will-change: transform");var y=e.isStubOrEmpty()?"cc-icon-dnd-target-empty":"cc-icon-dnd-target-not-empty";m.classList.add(y),this._dndHandler.isDragOver(e)&&m.classList.add("cc-dnd-over"),d.appendChild(m)}var b=e.getPermissions().allowEditContent;if(b&&!e.isStubOrEmpty()&&!this._dndHandler.isDragStarted()){var C=document.createElement("button");C.type="button",C.id="handleButton",C.setAttribute("style","will-change: transform"),C.addEventListener("dblclick",this._stopPropagationFnc);var w=this._canvas.handleButtonCssClass;null!=w&&""!==w?(a=C.classList).add.apply(a,we(w.split(" "))):C.innerText="Handle",e.handleButton=C,d.appendChild(C)}u.appendChild(d);var E=document.createElement("div");if(E.id="doneDiv",null!=h&&""!==h&&(s=E.classList).add.apply(s,we(h.split(" "))),b){var x=document.createElement("button");x.type="button",x.setAttribute("style","will-change: transform"),x.addEventListener("dblclick",this._stopPropagationFnc);var P=this._canvas.doneButtonCssClass;null!=P&&""!==P?(l=x.classList).add.apply(l,we(P.split(" "))):x.innerText="Done",e.doneButton=x,E.appendChild(x)}u.appendChild(E),c.appendChild(u),e.placeholderButtonGroup=u,e.editButtonGroup=d,e.doneButtonGroup=E,this.updatePlaceholderButtonGroup(e,t)}},e.prototype.removePlaceholderButtonGroup=function(e){if(null!=e&&null!=e.placeholderButtonGroup){for(var t=[e.selectButton,e.doneButton,e.handleButton],n=0;n<t.length;n++){var i=t[n];null!=i&&(i.removeEventListener("click",this._stopPropagationFnc),i.removeEventListener("mousedown",this._stopPropagationFnc),i.removeEventListener("dblclick",this._stopPropagationFnc))}e.placeholderButtonGroup.remove(),e.placeholderButtonGroup=null,e.doneButtonGroup=null,e.selectButton=null,e.handleButton=null,e.doneButton=null}},e.prototype.updatePlaceholderButtonGroup=function(e,t){var n=this;if(null!=e&&null!=e.placeholderButtonGroup){var i=e.placeholderButtonGroup;if(e.isVisible()&&!e.isLocked()&&this._isSelectionBehavior){i.style.visibility="visible";var o=this._selection.isItemHandlerSelected(e)?"auto":"none",r=t.contentAngle;i.style.pointerEvents=o,i.style.transform="rotate(-"+r+"deg)";var a=e.editButtonGroup,s=e.doneButtonGroup,l=function(){return e.isStubOrEmpty()&&e.showSelectButton()};this._canvas.autoPlaceholderEditModeEnabled?(l()||this._buttonsHidden(a),this._buttonsHidden(s)):(l()||!e.isStubOrEmpty()&&e.showHandleButton()&&n._selection.isItemHandlerSelected(e)&&!e.isContentUpdating()&&1===n._selection.getSelectedItemHandlers().length||n._dndHandler.isDragStarted()&&n._dndHandler.isDragTarget(e)?this._buttonsShow(a):this._buttonsHidden(a),e.editing&&!e.isContentUpdating()&&e.getPermissions(!0).showDoneButton?this._buttonsShow(s):this._buttonsHidden(s));var c=e.selectButton;null!=c&&(c.title=this._getSelectButtonTitle(e));var u=e.doneButton;null!=u&&(u.title=this._canvas.doneButtonTitle);var h=e.handleButton;null!=h&&(h.title=this._canvas.handleButtonTitle),this.updatePlaceholderButtonGroupPosition(e,t)}else i.style.visibility="hidden"}},e.prototype.updatePlaceholderButtonGroupPosition=function(e,t){if(null!=t&&null!=this._parent&&null!=e&&null!=e.placeholderButtonGroup){var n=f.RotatedRectangleF.getRectWithOffset(e.rectangle,this._offset),i=t.workspaceToControlPoint(new f.PointF(n.centerX,n.centerY)),o=t.getParentPosition(this._parent.parentElement),r=new f.PointF(o.left,o.top),a=e.placeholderButtonGroup,s=i.x-a.offsetWidth/2-r.x,l=i.y-a.offsetHeight/2-r.y;a.style.position="absolute",a.style.left=s+"px",a.style.top=l+"px"}},e.prototype.addFloatingItemToolbar=function(e,t){var n,i,o,r,a;if(null!=t&&null!=this._parent&&null!=e&&this._canvas.floatingItemToolbarEnabled&&null==e.floatingItemToolbar){var s=this._whitespace,l=document.createElement("div");l.style.position="absolute",l.id="buttonDiv";var c=this._canvas.floatingItemToolbarCssClass,u=document.createElement("div");if(u.style.display="flex",u.id="floatingItemToolbarDiv",null!=c&&""!==c&&(n=u.classList).add.apply(n,we(c.split(" "))),M.a.IsTouchDevice()){var h=this._canvas.bigButtonGroupCssClass;null!=h&&""!==h&&(i=u.classList).add.apply(i,we(h.split(" ")))}if(this._isPlaceholder(e)||this._isImage(e)||this._isGroup(e)){var d=document.createElement("button");d.type="button",d.addEventListener("mousedown",this._stopPropagationFnc),d.addEventListener("dblclick",this._stopPropagationFnc);var p=e.getSelectToolbarButtonClickHandler();this._addClickAndTapHandler(d,p);var f=this._canvas.selectToolbarButtonCssClass;null!=f&&""!==f?(o=d.classList).add.apply(o,we(f.split(" "))):d.innerText="Select",e.selectToolbarButton=d,u.appendChild(d)}var g=document.createElement("button");g.type="button",g.addEventListener("mousedown",this._stopPropagationFnc),g.addEventListener("dblclick",this._stopPropagationFnc);var _=e.getEditToolbarButtonClickHandler();this._addClickAndTapHandler(g,_);var v=this._canvas.editToolbarButtonCssClass;null!=v&&""!==v?(r=g.classList).add.apply(r,we(v.split(" "))):g.innerText="Edit",e.editToolbarButton=g,u.appendChild(g);var m=document.createElement("button");m.type="button",m.addEventListener("mousedown",this._stopPropagationFnc),m.addEventListener("dblclick",this._stopPropagationFnc);var y=e.getDeleteToolbarButtonClickHandler();this._addClickAndTapHandler(m,y);var b=this._canvas.deleteToolbarButtonCssClass;null!=b&&""!==b?(a=m.classList).add.apply(a,we(b.split(" "))):m.innerText="Delete",e.deleteToolbarButton=m,u.appendChild(m),l.appendChild(u),s.appendChild(l),e.floatingItemToolbar=l,this.updateFloatingItemToolbar(e,t)}},e.prototype.removeFloatingItemToolbar=function(e){if(null!=e&&null!=e.floatingItemToolbar){for(var t=[e.selectToolbarButton,e.deleteToolbarButton,e.editToolbarButton],n=0;n<t.length;n++){var i=t[n];null!=i&&(i.removeEventListener("click",this._stopPropagationFnc),i.removeEventListener("mousedown",this._stopPropagationFnc),i.removeEventListener("dblclick",this._stopPropagationFnc))}e.floatingItemToolbar.remove(),e.floatingItemToolbar=null,e.selectToolbarButton=null,e.deleteToolbarButton=null,e.editToolbarButton=null}},e.prototype.updateFloatingItemToolbar=function(e,t){if(null!=e&&null!=e.floatingItemToolbar&&this._canvas.floatingItemToolbarEnabled){var n=e.floatingItemToolbar;if(this._canvas.isShowFloatingItemToolbar(e)){if(this._buttonsShow(n),this._isImageOrPlaceholder(e)||this._isGroup(e)){var i=e.selectToolbarButton;null!=i&&(e.showSelectToolbarButton()?(i.style.display="block",this._updateFloatingItemToolbarPosition(e,t)):i.style.display="none",i.title=this._getSelectButtonTitle(e))}var o=e.deleteToolbarButton;null!=o&&(e.showDeleteToolbarButton()&&!this._canvas.simpleMode?o.style.display="block":o.style.display="none",o.title=this._canvas.deleteButtonTitle);var r=e.editToolbarButton;null!=r&&(e.showEditToolbarButton()?r.style.display="block":r.style.display="none",r.title=this._canvas.editButtonTitle),this._updateFloatingItemToolbarPosition(e,t)}else this._buttonsHidden(n)}},e.prototype._updateFloatingItemToolbarPosition=function(e,t){if(null!=t&&null!=this._parent&&null!=e&&this._canvas.floatingItemToolbarEnabled&&null!=e.floatingItemToolbar){var n=f.RotatedRectangleF.getRectWithOffset(e.rectangle,this._offset),i=t.contentAngle,o=e.floatingItemToolbar;i>0&&(n.rotateAt(i,new f.PointF),90===i?n.translate(t.workspaceHeight,0):180===i?n.translate(t.workspaceWidth,t.workspaceHeight):270===i&&n.translate(0,t.workspaceWidth));var r=t.zoom,a=t.screenXDpi/72*r,s=t.screenYDpi/72*r,l=Math.floor(n.width*a),c=Math.floor(n.height*s),u=o,h=u.offsetWidth,d=u.offsetHeight,p=3.5*h>l||3.5*d>c,g=(p?-h/2:8)+h/2,_=(p?-d:8)+d/2;new f.PointF(g,_).rotate(n.angle);var v=t.workspaceToControlPoint(n.getUpperRightCorner()),m=t.element,y=new f.PointF(0,0);y.x=Math.max(0,v.x),y.y=Math.max(0,v.y);var b=e.rectangle.angle%360;if(b>=0&&b<90){var C=[t.workspaceToControlPoint(n.getUpperLeftCorner()),t.workspaceToControlPoint(n.getUpperRightCorner()),t.workspaceToControlPoint(n.getBottomRightCorner()),t.workspaceToControlPoint(n.getBottomLeftCorner())];y=this._findBetter(C,i,m,y,d,h,t)}else if(b>=180&&b<270){C=[t.workspaceToControlPoint(n.getBottomRightCorner()),t.workspaceToControlPoint(n.getBottomLeftCorner()),t.workspaceToControlPoint(n.getUpperLeftCorner()),t.workspaceToControlPoint(n.getUpperRightCorner())];y=this._findBetter(C,i,m,y,d,h,t)}else if(b>=270){C=[t.workspaceToControlPoint(n.getUpperRightCorner()),t.workspaceToControlPoint(n.getBottomRightCorner()),t.workspaceToControlPoint(n.getBottomLeftCorner()),t.workspaceToControlPoint(n.getUpperLeftCorner())];y=this._findBetter(C,i,m,y,d,h,t)}else{C=[t.workspaceToControlPoint(n.getBottomLeftCorner()),t.workspaceToControlPoint(n.getUpperLeftCorner()),t.workspaceToControlPoint(n.getUpperRightCorner()),t.workspaceToControlPoint(n.getBottomRightCorner())];y=this._findBetter(C,i,m,y,d,h,t)}o.style.left=y.x-12+"px",o.style.top=y.y+"px"}},e.prototype._findBetter=function(e,t,n,i,o,r,a){switch(t){case 90:e=e.concat(e.splice(0,3));break;case 180:e=e.concat(e.splice(0,2));break;case 270:e=e.concat(e.splice(0,1))}var s=e[0],l=e[1],c=e[2],u=e[3],h=n.offsetWidth-(l.x+r/2),d=n.offsetHeight-c.y,p=s.y-12,f=this._selectionDiv.querySelector("div#rotate-circle"),g=null;if(f){var _=f.getBoundingClientRect();g=a.pageToControlPoint(_.left,_.top)}var v=function(){return null!=g&&g.y+15>i.y&&g.y-15<i.y+o&&g.x+30>i.x&&g.x-30<i.x+r},m=function(){return i.x=h<0?l.x-r/2-5+h:l.x-r/2-5,v()&&(h>0&&n.offsetWidth-(g.x+30+r+5)>0?i.x=g.x+30:i.x=g.x-15-r),i.x},y=function(){return s.y-o>0?i.y=s.y-o:i.y=0,v()&&(i.y=g.y+15),i.y};return p>o?(i.y=s.y-o-12,i.x=m()):h-(r/2+5)>0?(i.x=l.x+5,i.y=y()):h-(r/2+5)<0&&(u.x-r-5>5?(i.x=u.x-r-5,i.y=y()):(i.x=m(),i.y=d>o?c.y:y())),i.x+=n.scrollLeft,i.y+=n.scrollTop,i},e.prototype.addViolationContainer=function(e,t){var n,i,o,r,a;if(null!=t&&null!=this._parent&&null!=e&&(this._canvas.violationWarningButtonsEnabled||this._canvas.qualityChangeContainersEnabled)&&null==e.getViolationContainer()&&(this._canvas.violationWarningButtonsEnabled||!this._canvas.qualityChangeContainersEnabled||e instanceof R.g||e instanceof R.m)){var s=document.createElement("div"),l=this._canvas.violationContainerCssClass;if(null!=l&&""!==l&&(n=s.classList).add.apply(n,we(l.split(" "))),e.setViolationContainer(s),this._canvas.violationWarningButtonsEnabled){var c=this._canvas.violationWarningButtonCssClass,u=document.createElement("button");u.type="button",null!=c&&""!==c?(i=u.classList).add.apply(i,we(c.split(" "))):u.innerText="Quality",u.addEventListener("mousedown",this._stopPropagationFnc),u.addEventListener("dblclick",this._stopPropagationFnc);var h=e.getViolationWarningButtonClickHandler();this._addClickAndTapHandler(u,h),e.setViolationWarningButton(u),s.appendChild(u)}if(this._canvas.qualityChangeContainersEnabled&&(e instanceof R.g||e instanceof R.l&&null==e.item.barcodeFormat)){var d=document.createElement("div");s.appendChild(d);var p=this._canvas.qualityChangeContainerCssClass;null!=p&&""!==p&&(o=d.classList).add.apply(o,we(p.split(" ")));var f=document.createElement("div");d.appendChild(f);var g=this._canvas.qualityChangeScaleBarCssClass;null!=g&&""!==g&&(r=f.classList).add.apply(r,we(g.split(" ")));var _=document.createElement("div");d.appendChild(_);var v=this._canvas.qualityChangeInfoBarCssClass;null!=v&&""!==v&&(a=_.classList).add.apply(a,we(v.split(" "))),e.qualityChangeContainer=d,e.qualityChangeScaleBar=f,e.qualityChangeInfoBar=_}this._whitespace.appendChild(s),this.updateViolationContainer(e,!0,t)}},e.prototype.removeViolationContainer=function(e){if(null!=e){var t=e.getViolationWarningButton();if(null!=t&&(t.removeEventListener("click",this._stopPropagationFnc),t.removeEventListener("mousedown",this._stopPropagationFnc),t.removeEventListener("dblclick",this._stopPropagationFnc),t.remove(),e.setViolationWarningButton(null)),e instanceof R.g||e instanceof R.l){var n=e.qualityChangeContainer;null!=n&&(n.remove(),e.qualityChangeContainer=null,e.qualityChangeScaleBar=null,e.qualityChangeInfoBar=null)}var i=e.getViolationContainer();null!=i&&(i.remove(),e.setViolationContainer(null))}},e.prototype.updateViolationContainer=function(e,t,n){if(void 0===t&&(t=!1),null!=e&&null!=e.getViolationContainer()){var i=e instanceof R.g||e instanceof R.l?e.qualityChangeContainer:null,o=e.getViolationWarningButton();if(!e.isVisible()||e.locked||!this._isSelectionBehavior)return null!=i&&(i.style.visibility="hidden"),void(null!=o&&(o.style.visibility="hidden"));if(this._canvas.violationWarningButtonsEnabled&&null!=o)o.style.pointerEvents="auto",this._selection.isOnlyThisItemHandlerSelected(e)?o.classList.add("active"):o.classList.remove("active");if(this._canvas.qualityChangeContainersEnabled&&null!=i){i.style.visibility="visible";var r=e.item.violationSettings.allowImageQuality,a=L.a.getImageItem(e.item),s=null!=a&&a.source.isVector,l=e instanceof R.l&&e.isStubOrEmpty();r&&!l&&(this._selection.isResizing()||e instanceof R.l&&e.forceQualityChangeInfoBar)&&!s?this._buttonsShow(i):this._buttonsHidden(i)}t&&this.updateViolationContainerPosition(e,n)}},e.prototype._updateViolationContainerPositionByTimer=function(e,t){e instanceof R.e&&e.itemHandlers.any(function(e){return null==e.item})||(delete this._updateVCPtimers[e.uniqueId],this.updateViolationContainerPosition(e,t,!0))},e.prototype._addUpdateVCPCallback=function(e,t,n){var i=this;if(!this._updateVCPtimers[e.uniqueId]){var o=n?1e3:100;this._updateVCPtimers[e.uniqueId]=setTimeout(function(){return i._updateViolationContainerPositionByTimer(e,t)},o)}},e.prototype.updateViolationContainerPosition=function(e,t,n){if(void 0===n&&(n=!1),null!=t&&null!=this._parent&&null!=e&&null!=e.item&&(this._canvas.violationWarningButtonsEnabled||this._canvas.qualityChangeContainersEnabled)&&null!=e.getViolationContainer()){var i=f.RotatedRectangleF.getRectWithOffset(e.rectangle,this._offset),o=t.contentAngle;o>0&&(i.rotateAt(o,new f.PointF),90===o?i.translate(t.workspaceHeight,0):180===o?i.translate(t.workspaceWidth,t.workspaceHeight):270===o&&i.translate(0,t.workspaceWidth));var r=t.zoom,a=t.screenXDpi/72*r,s=t.screenYDpi/72*r,l=Math.floor(i.width*a),c=Math.floor(i.height*s),u=e.getViolationWarningButton(),h=e.getViolationContainer(),d=null!=u?u:h,p=d.offsetWidth,g=d.offsetHeight;0!==p&&0!==g||this._addUpdateVCPCallback(e,t,n);var _=3.5*p>l||3.5*g>c,v=(_?-p/2:8)+p/2,m=(_?-g:8)+g/2,y=new f.PointF(v,m);y.rotate(i.angle);var b=t.workspaceToControlPoint(i.getUpperLeftCorner()),C=t.whitespaceDiv,w=t.element;b.x+=y.x-C.offsetLeft-p/2+w.scrollLeft,b.y+=y.y-C.offsetTop-g/2+w.scrollTop,b.x=Math.max(0,b.x),b.y=Math.max(0,b.y);var E=b.x+p-t.whitespaceDiv.offsetWidth;E>0&&(b.x-=E);var x=b.y+g-t.whitespaceDiv.offsetHeight;x>0&&(b.y-=x),h.style.left=b.x+"px",h.style.top=b.y+"px",h.style.position="absolute";u=e.getViolationWarningButton();e.isVisible()?null!=u&&(u.style.visibility="visible",this._selection.isOperationNotNull()?(u.classList.remove("elementShown"),u.classList.add("elementHidden")):(u.classList.remove("elementHidden"),u.classList.add("elementShown"))):null!=u&&(u.style.visibility="hidden")}},e.prototype._addTextEditorDiv=function(){document.execCommand("styleWithCSS");var e=document.createElement("style");e.type="text/css",e.innerHTML="#"+this._textEditorId+" { -webkit-user-select: text; user-select: text; } p { margin: 0px; line-height: normal; } p:first-child::first-line { line-height: 1; }",document.head.appendChild(e),this._viewer.add_zoomed(this._onZoomedScrolledDelegate),this._viewer.add_scrolled(this._onZoomedScrolledDelegate)},e.prototype._removeTextEditorDiv=function(){null!=this._textEditorDiv&&(this._removeTextEditorDivFromDom(),this._textEditorDiv=null,this._viewer.remove_zoomed(this._onZoomedScrolledDelegate),this._viewer.remove_scrolled(this._onZoomedScrolledDelegate))},e.prototype._appendTextEditorDivToDom=function(){this._textEditorDiv=document.createElement("div"),this._textEditorDiv.id=this._textEditorId,this._textEditorDiv.style.display="block",this._textEditorDiv.style.position="absolute",this._textEditorDiv.style.zIndex="1",this._textEditorDiv.style.backgroundColor="transparent",this._textEditorDiv.style.overflow="hidden",this._textEditorDiv.style.cursor="text",this._textEditorDiv.contentEditable="true",this._textEditorDiv.addEventListener("dblclick",this._stopPropagationFnc),this._textEditorDiv.addEventListener("click",this._stopPropagationFnc),this._textEditorDiv.addEventListener("mousedown",this._stopPropagationFnc),this._textEditorDiv.addEventListener("mousemove",this._stopPropagationFnc),this._textEditorDiv.addEventListener("mouseup",this._stopPropagationFnc),this._textEditorDiv.addEventListener("keydown",this._stopPropagationFnc),this._textEditorDiv.addEventListener("keyup",this._stopPropagationFnc),this._parent.parentElement.parentElement.parentElement.appendChild(this._textEditorDiv)},e.prototype._removeTextEditorDivFromDom=function(){this._textEditorDiv.removeEventListener("dblclick",this._stopPropagationFnc),this._textEditorDiv.removeEventListener("click",this._stopPropagationFnc),this._textEditorDiv.removeEventListener("mousedown",this._stopPropagationFnc),this._textEditorDiv.removeEventListener("mousemove",this._stopPropagationFnc),this._textEditorDiv.removeEventListener("mouseup",this._stopPropagationFnc),this._textEditorDiv.removeEventListener("keydown",this._stopPropagationFnc),this._textEditorDiv.removeEventListener("keyup",this._stopPropagationFnc),this._textEditorDiv.remove()},Object.defineProperty(e.prototype,"textEditorDiv",{get:function(){return this._textEditorDiv},enumerable:!0,configurable:!0}),e.prototype.showTextEditor=function(e,t,n,i,o,r,a){this._appendTextEditorDivToDom(),this._updateTextEditorPosition(e,t,i),this._textEditorDiv.style.border="solid "+i+"pt "+o,this._textEditorDiv.style.backgroundColor=""+r,this._textEditorDiv.style.opacity=""+a,this._textEditorDiv.style.setProperty("outline",this._canvas.selectionWidth+"px solid "+this._canvas.selectionColor,"important"),this._textEditorDiv.innerHTML=n,this._textEditorDiv.focus()},e.prototype.hideTextEditor=function(){if(null!=this._textEditorDiv){var e=""===this._textEditorDiv.innerText.trim()?"":this._textEditorDiv.innerHTML;return this._removeTextEditorDivFromDom(),e}},e.prototype._updateTextEditorPosition=function(e,t,n){if(null!=e&&null!=this._textEditorDiv){var i=this._viewer;if(n>0&&(e.width+=2*n,e.height+=2*n),e=this._rotateRectangle(e,i),null==t){var o=i.workspaceToControlPoint(e.location).round();this._textEditorDiv.style.left="0px",this._textEditorDiv.style.top="0px",this._textEditorDiv.style.width=e.width+"pt",this._textEditorDiv.style.height=e.height+"pt",this._textEditorDiv.style.transformOrigin="left top",this._textEditorDiv.style.transform="translate("+o.x+"px, "+o.y+"px) scale("+i.zoom+") rotate("+e.angle+"deg)"}else{e.angle=0;var r=i.workspaceToControlPoint(e.getUpperLeftCorner()).round();if(this._textEditorDiv.style.top="0px",this._textEditorDiv.style.width="max-content",this._textEditorDiv.style.height="max-content",t==H.TextAlignment.Center){var a=i.workspaceToControlPoint(e.center).round();this._textEditorDiv.style.left=a.x+"px",this._textEditorDiv.style.transformOrigin="center top",this._textEditorDiv.style.transform="translate(-50%, "+r.y+"px) scale("+i.zoom+")"}else if(t==H.TextAlignment.Right){var s=i.workspaceToControlPoint(e.getUpperRightCorner()).round();this._textEditorDiv.style.left=s.x+"px",this._textEditorDiv.style.transformOrigin="right top",this._textEditorDiv.style.transform="translate(-100%, "+s.y+"px) scale("+i.zoom+")"}else this._textEditorDiv.style.left="0px",this._textEditorDiv.style.transformOrigin="left top",this._textEditorDiv.style.transform="translate("+r.x+"px, "+r.y+"px) scale("+i.zoom+")"}}},e.prototype.calculateRenderStateForItemHandlers=function(e){var t=this,n=!1,i=function(e,t){return e.renderState!==t&&(e.renderState=t,n=!0,!0)},o=new y.a,r=function(e,t){e.contains(t)||e.add(t)};e.selectMany(function(e){return e.itemHandlers.toArray()}).reverse().forEach(function(e){r(o,e),e instanceof R.e&&e.getNestedItemHandlers().forEach(function(e){return r(o,e)})});var a=this._selection._permissions,s=this._selection.getSelectedItemHandlers(),l=1==s.length&&s.get(0)instanceof R.h;if(!this._selection.isLocked&&(a.allowMove||a.allowRotate||a.allowResize||l))for(var c=o.indexOf(function(e){return t._selection.isItemHandlerSelected(e)}),u=o.lastIndexOf(function(e){return t._selection.isItemHandlerSelected(e)}),h=o.indexOf(function(e){return e.hasBlendMode()}),d=h>-1,p=0;p<o.count();p++){var f=o.elementAt(p),g=f.parentGroupItemHandler;if(this.setHandlerState(f,p,c,h,u,d,i)&&g){var _=o.indexOf(g);this.setHandlerState(f.parentGroupItemHandler,_,c,h,u,d,i)}}else o.forEach(function(e){e.isVisible()?i(e,R.n.Bottom):i(e,R.n.Hidden)});return n},e.prototype.setHandlerState=function(e,t,n,i,o,r,a){return e.isVisible()?e instanceof R.e&&e.getNestedItemHandlers().some(function(e){return e.renderState===R.n.Active})?a(e,R.n.Active):a(e,t<n&&(t<i||!r)?R.n.Top:t>=n&&t<=o||r&&n>=i?R.n.Active:R.n.Bottom):a(e,R.n.Hidden)},e.prototype._getAllCanvases=function(){return[this.surfaceCanvas,this.activeCanvas,this.inactiveCanvas,this.staticTextCanvas,this.activeTextCanvas,this.designCanvas,this.cursorCanvas]},e.prototype._createCanvasElement=function(t,n,i){var o=this._document.createElement("canvas");return o.id=t,o.style.position="absolute",o.style.top="0px",o.style.left="0px",o.style.pointerEvents="none",e.setElementSize(o,n,i),o},e.setElementSize=function(e,t,n){var i=M.a.devicePixelRatio;e.width=Math.ceil(t),e.style.width=Math.ceil(t/i)+"px",e.height=Math.ceil(n),e.style.height=Math.ceil(n/i)+"px"},e.prototype._addClickAndTapHandler=function(e,t){M.a.IsTouchDevice()&&!M.a.IsAndroid()?window.Hammer(e).on("tap",t):e.addEventListener("click",t)},e.prototype._buttonsShow=function(e){e.classList.remove("buttonsHidden"),e.classList.add("buttonsShown")},e.prototype._buttonsHidden=function(e){e.classList.remove("buttonsShown"),e.classList.add("buttonsHidden")},e.prototype._isPlaceholder=function(e){return e instanceof R.l},e.prototype._isImage=function(e){return e instanceof R.g},e.prototype._isGroup=function(e){return e instanceof R.e},e.prototype._isImageOrPlaceholder=function(e){return this._isImage(e)||this._isPlaceholder(e)},e.prototype._getSelectButtonTitle=function(e){return this._isGroup(e)?this._canvas.replaceGroupContentButtonTitle:this._isPlaceholder(e)&&e.item.isBarcodePlaceholder?this._canvas.editBarcodeButtonTitle:this._canvas.selectButtonTitle},e.prototype._getControlRectangle=function(e,t){var n=(e=this._rotateRectangle(e,t)).toRectangleF(),i=t.zoom,o=t.screenXDpi/72*i,r=t.screenYDpi/72*i,a=f.RectangleF.FromLTRB(Math.floor(n.left*o),Math.floor(n.top*r),Math.ceil(n.right*o)+this._canvas.selectionWidth,Math.ceil(n.bottom*r)+this._canvas.selectionWidth);return t.contentToWhitespaceRectangle(new f.RectangleF(a.left,a.top,a.width,a.height))},Object.defineProperty(e.prototype,"_isSelectionBehavior",{get:function(){return this._canvas.mouseBehaviorManager.isSelectionMouseBehavior},enumerable:!0,configurable:!0}),e.prototype._rotateRectangle=function(e,t){var n=t.contentAngle;return n>0&&(e.rotateAt(n,new f.PointF),90===n?e.translate(t.workspaceHeight,0):180===n?e.translate(t.workspaceWidth,t.workspaceHeight):270===n&&e.translate(0,t.workspaceWidth)),e},e}(),xe=n(393),Pe=n(405),Se=function(){return(Se=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Ie=function(){function e(e,t,n,i){this._selection=e,this._dndHandler=t,this._canvas=n,this._loadingImage=new Image,this.previewMode=!1,this.conf=i}return Object.defineProperty(e.prototype,"conf",{set:function(e){this._handlerConfiguration=Se({placeholderEditingViewMode:fe.a.Overlay},e||{})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._offset},set:function(e){null!=e&&e.equals(this._offset)||null==e&&null!=this.offset||(this._offset=e)},enumerable:!0,configurable:!0}),e.prototype.redrawActiveCanvas=function(e,t,n){var i=this,o=this._getScaledContext(t),r=this._getScaledContext(n);if(null!=o&&null!=r){this._getItemHandlersByRenderState(e,R.n.Active).forEach(function(e){return i.drawHandler(e,o)});var a=this._selection.getSelectedItemHandlers();if(a.length>1)a.forEach(function(e){return e.drawHighlight(r)});else{var s=this._selection.currentItemHandler;s instanceof R.e&&s.drawHighlight(r,!0),null!=s&&this._isEditing(s)&&(this._handlerConfiguration.placeholderEditingViewMode===fe.a.Overlay&&s instanceof R.l&&(this._drawFade(r),this.drawHandler(s,r)),s.drawHighlight(r))}this._selection.draw(r,this),this._dndHandler.draw(),o.restore(),r.restore()}},e.prototype.drawHandler=function(e,t){var n,i,o=!1;if(!this.previewMode)return e.draw(t);var r=null===(n=null===e||void 0===e?void 0:e.item)||void 0===n?void 0:n.parentContainer;r instanceof Pe.SurfaceContainer&&(null===(i=null===r||void 0===r?void 0:r.parentComponent)||void 0===i||i.printAreas.forEach(function(n){var i=f.Path.rectangle(n.bounds.left,n.bounds.top,n.bounds.width,n.bounds.height);null!=i&&(o=!0,e.draw(t,i))})),o||e.draw(t)},e.prototype.redrawInactiveCanvas=function(e,t,n){var i=this,o=this._getScaledContext(t),r=this._getScaledContext(n);null!=o&&null!=r&&(this._drawMargins(o),this._getItemHandlersByRenderState(e,R.n.Bottom).forEach(function(e){return i.drawHandler(e,o)}),this._getItemHandlersByRenderState(e,R.n.Top).forEach(function(e){return i.drawHandler(e,r)}),r.restore(),o.restore())},e.prototype.drawRubberband=function(e,t){null==this._offset||this._offset.isOrigin()||(t.left-=this._offset.x,t.right-=this._offset.x,t.top-=this._offset.y,t.bottom-=this._offset.y);var n=this._canvas.mul,i=1/n,o="rgba(0,0,0,1)",r="rgba(0,0,0,0)",a=2/n;xe.a.drawDashedLine(e,t.left,t.top,t.right,t.top,i,o,r,a,a),xe.a.drawDashedLine(e,t.right,t.top,t.right,t.bottom,i,o,r,a,a),xe.a.drawDashedLine(e,t.right,t.bottom,t.left,t.bottom,i,o,r,a,a),xe.a.drawDashedLine(e,t.left,t.bottom,t.left,t.top,i,o,r,a,a)},e.prototype.drawVerticalLine=function(e,t,n){var i=null!=this._offset?-this._offset.y:0;xe.a.drawLine(e,t,i,t,this._canvas.workspaceHeight,1/this._canvas.zoom,n)},e.prototype.drawHorizontalLine=function(e,t,n){var i=null!=this._offset?-this._offset.x:0;xe.a.drawLine(e,i,t,this._canvas.workspaceWidth,t,1/this._canvas.zoom,n)},e.prototype.drawWaitClock=function(e,t){var n=this._canvas.mul,i=new f.RotatedRectangleF(t.x||0,t.y||0,this._loadingImage.width/n,this._loadingImage.height/n,0);this._loadingImage.complete&&xe.a.drawImage(e,this._loadingImage,i,n,n)},e.prototype.setLoadingImageUrl=function(e){this._loadingImage.crossOrigin="anonymous",this._loadingImage.src=e},e.prototype.drawTextCursor=function(e,t,n){var i=this._getScaledContext(e);if(null!=i){var o=t.item.transform.toMatrix(),r=t.getControlCenter();i.translate(r.x,r.y),i.transform(o.m00,o.m10,o.m01,o.m11,o.m02,o.m12),i.translate(-r.x,-r.y),n(i),i.strokeStyle="rgb(0, 0, 0)",i.lineWidth=1/this._canvas.mul,i.stroke(),i.restore()}},e.prototype.clearTextCursor=function(e){var t=this._getScaledContext(e);null!=t&&t.restore()},e.prototype._getScaledContext=function(e){if(null==e)return null;var t=e.getContext("2d");if(null==t)return null;xe.a.clearCanvas(t),t.save();var n=M.a.screenDpi*this._canvas.zoom/72;return t.scale(n,n),null==this._offset||this._offset.isOrigin()||t.translate(this._offset.x,this._offset.y),t},e.prototype._isEditing=function(e){return e instanceof R.l&&e.editing||e instanceof R.h&&e.editing},e.prototype._getItemHandlersByRenderState=function(e,t){var n=this._handlerConfiguration.placeholderEditingViewMode===fe.a.Normal;return e.selectMany(function(e){return e.itemHandlers.toArray()}).where(function(e){return e.renderState==t&&(n||!(e instanceof R.l&&e.editing))})},e.prototype._drawFade=function(e){var t=null!=this._offset?-this._offset.x:0,n=null!=this._offset?-this._offset.y:0,i=f.RotatedRectangleF.FromLTRB(t,n,this._canvas.workspaceWidth,this._canvas.workspaceHeight);xe.a.rectangle(e,i,0,null,"rgb(0, 0, 0)",.75)},e.prototype._drawMargins=function(e){var t,n,i,o,r=-(null!==(n=null===(t=this._offset)||void 0===t?void 0:t.x)&&void 0!==n?n:0),a=-(null!==(o=null===(i=this._offset)||void 0===i?void 0:i.y)&&void 0!==o?o:0),s=this._canvas.leftMargin+r,l=this._canvas.rightMargin,c=this._canvas.topMargin+a,u=this._canvas.bottomMargin,h=this._canvas.workspaceWidth,d=this._canvas.workspaceHeight,p=this._canvas.mul,f=this._canvas.marginWidth/p,g=this._canvas.marginColor;0!==s&&0!==l&&0!==c&&0!==u&&h>=s+l&&d>=c+u&&f>0&&(xe.a.drawLine(e,s,c,s,d-u,f,g),xe.a.drawLine(e,s,c,h-l,c,f,g),xe.a.drawLine(e,h-l,d-u,s,d-u,f,g),xe.a.drawLine(e,h-l,d-u,h-l,c,f,g))},e}(),Te=n(384),De=function(){return(De=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},ke=function(){function e(e){this.setConfiguration(e),this._snapData={xAnchors:[],yAnchors:[],defaultBounds:null,activeXAnchorIndex:null,activeYAnchorIndex:null,xPoints:[],yPoints:[],activeXPointIndex:null,activeYPointIndex:null}}return e.prototype.setConfiguration=function(e){this._conf=Object(Te.e)(this._getDefaultConf,[e||{}])},Object.defineProperty(e.prototype,"configuration",{get:function(){return this._conf},enumerable:!0,configurable:!0}),e.prototype.drawActiveLines=function(e,t){if(null!=this._snapData.activeXAnchorIndex){var n=this._snapData.xAnchors[this._snapData.activeXAnchorIndex];t.drawVerticalLine(e,n.position,this._conf.snapElements[n.type].color)}if(null!=this._snapData.activeYAnchorIndex){var i=this._snapData.yAnchors[this._snapData.activeYAnchorIndex];t.drawHorizontalLine(e,i.position,this._conf.snapElements[i.type].color)}},e.prototype.resetActiveLines=function(){this._snapData.activeXAnchorIndex=null,this._snapData.activeYAnchorIndex=null},e.prototype.constrainDiffToSnapLines=function(e,t,n){if(null==t)return new f.PointF;var i=new f.PointF(e.x-t.x,e.y-t.y);if(!this._enabled)return i;null==i&&(i=new f.PointF(0,0));var o=i.clone();null==this._prevPoint&&(this._prevPoint=t);var r=e.x-this._prevPoint.x,a=e.y-this._prevPoint.y;this._prevPoint=e,this._snapData.activeXAnchorIndex=null;for(var s=r>0?0:this._snapData.xAnchors.length-1,l=r>0?this._snapData.xAnchors.length-1:0,c=r>0?1:-1,u=r>0?this._snapData.xPoints.length-1:0,h=r>0?0:this._snapData.xPoints.length-1,d=r>0?-1:1,p=s;p!==l+c;p+=c)for(var g=this._snapData.xAnchors[p],_=u;_!==h+d;_+=d){var v=this._snapData.xPoints[_],m=this._getSnapLineTolerance(n,g.type);if(Math.abs(v+i.x-g.position)<m){var y=null!=this._snapData.activeXAnchorIndex?this._conf.snapElements[this._snapData.xAnchors[this._snapData.activeXAnchorIndex].type]:null,b=this._conf.snapElements[g.type];(null==this._snapData.activeXAnchorIndex||b.priority>y.priority)&&(o.x=g.position-v,this._snapData.activeXAnchorIndex=p,this._snapData.activeXPointIndex=_)}}this._snapData.activeYAnchorIndex=null;for(var C=a>0?0:this._snapData.yAnchors.length-1,w=a>0?this._snapData.yAnchors.length-1:0,E=a>0?1:-1,x=a>0?this._snapData.yPoints.length-1:0,P=a>0?0:this._snapData.yPoints.length-1,S=a>0?-1:1,I=C;I!==w+E;I+=E)for(var T=this._snapData.yAnchors[I],D=x;D!==P+S;D+=S){var k=this._snapData.yPoints[D];m=this._getSnapLineTolerance(n,T.type);if(Math.abs(k+i.y-T.position)<m){y=null!=this._snapData.activeYAnchorIndex?this._conf.snapElements[this._snapData.yAnchors[this._snapData.activeYAnchorIndex].type]:null,b=this._conf.snapElements[T.type];(null==this._snapData.activeYAnchorIndex||b.priority>y.priority)&&(o.y=T.position-k,this._snapData.activeYAnchorIndex=I,this._snapData.activeYPointIndex=D)}}return o},e.prototype.constrainRectangleToSnapLines=function(e,t,n,i,o,r,a){var s=this;if(!this._enabled)return e;var l,c,u=e.clone();this._snapData.xPoints=[],this._snapData.yPoints=[];var h=i.resizeIndex-1;i.resizeIndex>4?((c=new f.PointF(o.centerX+B.cw[i.resizeIndex]*(o.width/2),o.centerY+B.ch[i.resizeIndex]*(o.height/2))).rotateAt(u.angle,o.center),(l=new f.PointF(r.centerX+B.cw[i.resizeIndex]*(r.width/2),r.centerY+B.ch[i.resizeIndex]*(r.height/2))).rotateAt(u.angle,r.center)):(c=o.getCornerByIndex(h),l=r.getCornerByIndex(h));var d,p,g=this,_=function(e,t){if(void 0===e&&(e=null),void 0===t&&(t=null),e=null==e||e,t=null==t||t,e||t){var n=s._getSnapLineTolerance(a,ue.Items);e&&(g._snapData.xPoints=[c.x],Math.abs(c.x-l.x)>n&&g._snapData.xPoints.push(l.x)),t&&(g._snapData.yPoints=[c.y],Math.abs(c.y-l.y)>n&&g._snapData.yPoints.push(l.y))}};if(n){if(o.angle%90!=0&&i.resizeIndex>4)return e;var v=u.center,m=i.resizeIndex>4&&(u.angle-90)%180==0;_(B.cw[i.resizeIndex]!==(0^(m?1:0)),B.ch[i.resizeIndex]!==(0^(m?1:0)));var y=this.constrainDiffToSnapLines(c,c,a);if(null==y||Object(f.EqualsOfFloatNumbers)(y.x,0,.1)&&Object(f.EqualsOfFloatNumbers)(y.y,0,.01))return e;d=(p=0!==y.x&&0===this._snapData.activeXPointIndex||0!==y.y&&0===this._snapData.activeYPointIndex)?c:l;var b=new f.PointF(d.x+y.x,d.y+y.y),C=u.angle;b.rotateAt(-C,v),d.rotateAt(-u.angle,v),u.angle=0;var w=new f.PointF((b.x-d.x)*(p?u.width/o.width:1),(b.y-d.y)*(p?u.height/o.height:1));u.centerX+=w.x/2,u.width+=B.cw[i.resizeIndex]*w.x,u.centerY+=w.y/2,u.height+=B.ch[i.resizeIndex]*w.y,u.rotateAt(C,v)}else if(!n){if(t.getCornerByIndex(h).equals(l,.01))return e;_();var E=this.constrainDiffToSnapLines(l,l,a),x=Object(f.EqualsOfFloatNumbers)(E.x,0,.01),P=Object(f.EqualsOfFloatNumbers)(E.y,0,.01);if(x&&P)return e;d=(p=!x&&0===this._snapData.activeXPointIndex||!P&&0===this._snapData.activeYPointIndex)?c:l;var S,I=(h+2)%4,T=r.getCornerByIndex(I);S=x?new f.PointF(T.x,d.y+E.y):new f.PointF(d.x+E.x,T.y);var D=Object(f.getTriangleAngle)(S,d,T),k=Object(f.ConvertDegreeToRadian)(D),M=Math.sqrt(Object(f.getSquareDistanceToPoint)(T,S))/Math.cos(k)/Math.sqrt(Object(f.getSquareDistanceToPoint)(T,d));if(null==M)return e;var H=u.getCornerByIndex(I);u.width*=M,u.height*=M;var R=u.getCornerByIndex(I);u.centerX+=H.x-R.x,u.centerY+=H.y-R.y}return u},e.prototype.fillSnapData=function(e,t,n,i,o,r){if(this.clearSnapData(),null!=o.viewer.surface.printAreas.get(0)&&(this._snapData.defaultBounds=o.viewer.surface.printAreas.get(0).bounds,this._enabled&&null!=e)){var a=[],s=[],l=function(e,t){var n=null!=i?f.RectangleF.intersect(e,i):e;n.isEmpty()||(a.push({position:n.left,type:t},{position:n.left+n.width/2,type:t},{position:n.right,type:t}),s.push({position:n.top,type:t},{position:n.top+n.height/2,type:t},{position:n.bottom,type:t}))},c=this._conf.snapElements;null!=i&&c.region.enabled&&l(i,ue.Region),null!=this._snapData.defaultBounds&&c.printArea.enabled&&l(this._snapData.defaultBounds,ue.PrintArea);var u=o.getAllItemHandlers({onlyVisible:!0,onlyUnlocked:!0,whiteListFilter:B.isSafetyLineItemHandler,flatGroupItems:!0});(c.items.enabled||c.safetyLines.enabled)&&u.forEach(function(e){if(e.layer.getVisible())if(B.isSafetyLineItemHandler(e)){if(!c.safetyLines.enabled)return;var t=e.controlPoints[0],n=e.controlPoints[1];a.push({position:t.x,type:ue.SafetyLines}),a.push({position:n.x,type:ue.SafetyLines}),s.push({position:t.y,type:ue.SafetyLines}),s.push({position:n.y,type:ue.SafetyLines})}else!o.isItemHandlerSelected(e)&&c.items.enabled&&l(e.bounds,ue.Items)});var h=function(e,t){void 0===t&&(t=null);var n=[];return e.sort(function(e,t){return e.position-t.position}).forEach(function(e,i){var o=n.slice(-1)[0];0!==i&&Object(f.EqualsOfFloatNumbers)(o.position,e.position,null!=t?t:.01)&&o.type===e.type||n.push(e)}),n},d=function(e,t){void 0===t&&(t=null);var n=[];return e.sort(function(e,t){return e-t}).forEach(function(e,i){0!==i&&Object(f.EqualsOfFloatNumbers)(n.slice(-1)[0],e,null!=t?t:.01)||n.push(e)}),n};if(this._snapData.xAnchors=h(a),this._snapData.yAnchors=h(s),r.drag){var p=t.bounds;this._snapData.xPoints=[n.left,e.centerX,n.right],this._snapData.yPoints=[n.top,e.centerY,n.bottom];var g=this._getSnapLineTolerance(o,ue.Items);this._snapData.xPoints=d([p.left,n.left,t.centerX,e.centerX,n.right,p.right],g),this._snapData.yPoints=d([p.top,n.top,t.centerY,e.centerY,n.bottom,p.bottom],g)}}},e.prototype.clearSnapData=function(){this._snapData.xAnchors=[],this._snapData.yAnchors=[],this._snapData.activeXAnchorIndex=null,this._snapData.activeYAnchorIndex=null,this._snapData.xPoints=[],this._snapData.yPoints=[]},e.prototype._getSnapLineTolerance=function(e,t){return Math.abs(this._conf.snapElements[t.toString()].tolerance/e.zoom)},Object.defineProperty(e.prototype,"_getDefaultConf",{get:function(){var e={tolerance:5,color:"rgb(255,0,255)",enabled:!1,priority:0};return{snapElements:{items:De({},e),printArea:De({},e),safetyLines:De({},e),region:De({},e)}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_enabled",{get:function(){var e=this._conf.snapElements;return e.items.enabled||e.printArea.enabled||e.region.enabled||e.safetyLines.enabled},enumerable:!0,configurable:!0}),e}();!function(e){e.Items="items",e.PrintArea="printArea",e.SafetyLines="safetyLines",e.Region="region"}(ue||(ue={}));var Me,He=n(426);!function(e){e[e.Selection=0]="Selection",e[e.Create=1]="Create",e[e.SelectPixel=2]="SelectPixel",e[e.Locked=3]="Locked"}(Me||(Me={}));var Be,Re=n(750),Oe=n(506),ze=function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}l((i=i.apply(e,t||[])).next())})},Le=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},Fe=function(){function e(){this._isMouseDownFired=!1,this._isMouseMoveFired=!1,this._stateChanged=new r.a,this._currentState=Be.Initial,this._allowedTransitions=new Map([[Be.Initial,[Be.PointSelected,Be.RectangleSelectionStarted]],[Be.RectangleSelectionStarted,[Be.RectangleSelected,Be.RectangleSelectionChanged]],[Be.RectangleSelectionChanged,[Be.RectangleSelected,Be.RectangleSelectionChanged]],[Be.RectangleSelected,[Be.Initial]],[Be.PointSelected,[Be.Initial]]])}return e.prototype.processMouseEvent=function(e){var t=new f.PointF(e.x,e.y);switch(e.type){case"dblclick":return this._changeState(Be.PointSelected,t);case"mousedown":this._onMouseDown();break;case"mousemove":this._onMouseMove(t);break;case"mouseup":this._onMouseUp(t)}},e.prototype.addStateChanged=function(e){this._stateChanged.add(e)},e.prototype.removeStateChanged=function(e){this._stateChanged.remove(e)},e.prototype._onMouseDown=function(){this._isMouseDownFired=!0},e.prototype._onMouseMove=function(e){return ze(this,void 0,void 0,function(){return Le(this,function(t){return this._isMouseDownFired?this._isMouseMoveFired?(this._changeState(Be.RectangleSelectionChanged,e),[2]):(this._isMouseMoveFired=!0,this._changeState(Be.RectangleSelectionStarted,e),[2]):[2]})})},e.prototype._onMouseUp=function(e){var t=!this._isMouseMoveFired;this._changeState(t?Be.PointSelected:Be.RectangleSelected,e),this._isMouseDownFired=!1,this._isMouseMoveFired=!1,this._changeState(Be.Initial,e)},e.prototype._changeState=function(e,t){if(!this._allowedTransitions.get(this._currentState).includes(e))throw new C.c(this._currentState+" to "+e+" transition is restricted");this._currentState=e,this._stateChanged.notify({state:e,point:t})},e}();!function(e){e.Initial="Initial",e.PointSelected="PointSelected",e.RectangleSelectionStarted="RectangleSelectionStarted",e.RectangleSelectionChanged="RectangleSelectionChanged",e.RectangleSelected="RectangleSelected"}(Be||(Be={}));var Ae=n(500),We=function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}l((i=i.apply(e,t||[])).next())})},je=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},Ve=function(){function e(e,t,n){var i=this;if(this._args=e,this._viewer=t,this._selection=n,this._onCompleted=new r.a,this._onStateChanged=function(e){switch(e.state){case Be.Initial:break;case Be.PointSelected:i._onPointSelectedState(e.point);break;case Be.RectangleSelectionStarted:i._startPoint=e.point,i._onRectangleSelectionStarted(e.point);break;case Be.RectangleSelectionChanged:i._endPoint=e.point,i._onRectangleSelectionChanged();break;case Be.RectangleSelected:i._endPoint=e.point,i._onRectangleSelected()}},null==this._args)throw new C.a("CreateBehaviorHandler: Create Behavior args cannot be null");if(null==this._args.item)throw new C.a("CreateBehaviorHandler: args.createdItem cannot be null!");var o=this._args.item;if(null!=o.selection||null!=o.click){if(null==o.click||null==o.selection)throw new C.a("CreateBehaviorHandler: Point and Rectangle create args must be exist both or must be null");if(null==o.click.type||null==o.selection.type)throw new C.a("CreateBehaviorHandler: Item type cannot be null")}else{if(null==this._args.item.type)throw new C.a("CreateBehaviorHandler: Item type cannot be null")}}return e.prototype.init=function(){this._createBehaviorStateMachine=new Fe,this._createBehaviorStateMachine.addStateChanged(this._onStateChanged),this._selection.lock(),this._viewer.setCursor(D.a.cross,!0)},e.prototype.dispose=function(){this._createBehaviorStateMachine.removeStateChanged(this._onStateChanged)},e.prototype.processMouseEvent=function(e){return We(this,void 0,void 0,function(){return je(this,function(t){return this._currentMouseEvent=e,this._createBehaviorStateMachine.processMouseEvent(e),[2]})})},Object.defineProperty(e.prototype,"_selectAfterCreate",{get:function(){return null==this._args.selectAfterCreate||this._args.selectAfterCreate},enumerable:!0,configurable:!0}),e.prototype.addOnCompleted=function(e){this._onCompleted.add(e)},e.prototype.removeOnCompleted=function(e){this._onCompleted.remove(e)},e.prototype._onRectangleSelectionStarted=function(e){return We(this,void 0,void 0,function(){var t;return je(this,function(n){switch(n.label){case 0:return t=this._getCreateItemArgs(e,!0),this._selection.unlock(),t.type===Re.b.BoundedTextItem?[3,2]:[4,this._addItem(t)];case 1:return n.sent(),this._selection._operation={resize:!0,resizeIndex:3,arbitraryResize:!0,cornerArbitraryResize:!0,proportionalResize:!0,cornerProportionalResize:!0},[3,3];case 2:this._selection._operation={selection:!0},n.label=3;case 3:return this._selection.update(),this._selection.startTransform(e),[2]}})})},e.prototype._onRectangleSelectionChanged=function(){this._selection.processMouseEvent(this._currentMouseEvent),this._viewer.canvas.redrawDesign()},e.prototype._onRectangleSelected=function(){return We(this,void 0,void 0,function(){var e,t,n,i;return je(this,function(o){switch(o.label){case 0:return e=O.clone(this._currentMouseEvent),null==this._itemAdded?[3,2]:[4,this._itemAdded.promise];case 1:o.sent(),o.label=2;case 2:return t=this._getCreateItemArgs(this._startPoint,!0).type===Re.b.BoundedTextItem,n=this._selectionRect,t?[4,this._viewer.commandManager.execute(F.b.createItem,this._getCreateItemArgs(this._startPoint,!0))]:[3,6];case 3:return i=o.sent(),[4,this._viewer.commandManager.execute(F.e.addItems,{items:[i]})];case 4:return o.sent(),[4,this._textWorkaround(n,i)];case 5:return o.sent(),[3,8];case 6:return[4,this._viewer.getHandler(this._item).waitUpdate()];case 7:o.sent(),o.label=8;case 8:return this._selection.processMouseEvent(e),this._onCompleted.notify(n),this._selectAfterCreate||this._selection.clearSelectedItemHandlers(),[2]}})})},e.prototype._onPointSelectedState=function(e){return We(this,void 0,void 0,function(){var t;return je(this,function(n){switch(n.label){case 0:return null==(t=this._getCreateItemArgs(e,!1))?[3,2]:[4,this._addItem(t)];case 1:n.sent(),n.label=2;case 2:return this._onCompleted.notify(e),this._selectAfterCreate||this._selection.clearSelectedItemHandlers(),[2]}})})},e.prototype._textWorkaround=function(e,t){return We(this,void 0,void 0,function(){var n;return je(this,function(i){switch(i.label){case 0:return[4,(n=this._viewer.getHandler(t)).waitUpdate()];case 1:return i.sent(),t.sourceRectangle=e,t.textRectangle=e,t.sourcePath=f.Path.rectangle(e.left,e.top,e.width,e.height),t.transform=f.RotatedRectangleF.fromRectangleF(e).getTransform(f.RotatedRectangleF.fromRectangleF(t.sourceRectangle)),n.update(),[2]}})})},e.prototype._addItem=function(e){return We(this,void 0,void 0,function(){var t;return je(this,function(n){switch(n.label){case 0:return this._itemAdded=new Ae.a,[4,this._viewer.commandManager.execute(F.b.createItem,e)];case 1:return t=n.sent(),this._item=t,[4,this._viewer.commandManager.execute(F.e.addItems,{items:[t]})];case 2:return n.sent(),[4,this._viewer.canvas.waitUpdate()];case 3:return n.sent(),this._itemAdded.resolve(),[2]}})})},e.prototype._getCreateItemArgs=function(e,t){void 0===t&&(t=!1);var n=this._args.item;return null==n.click&&null==n.selection?this._getUpdatedArgs(this._args.item,e,t):this._getUpdatedArgs(t?n.selection:n.click,e,t)},e.prototype._getUpdatedArgs=function(e,t,n){void 0===n&&(n=!1);var i=Object.assign({},e);i.itemData=Object.assign({},e.itemData||{});var o=i.itemData;return null==o.location&&(o.location={}),o.location.x=t.x,o.location.y=t.y,n&&(o.width=1,o.height=1,o.location.originX=Oe.a.Left,o.location.originY=Oe.a.Top),i.relativeToPrintArea=!1,i},Object.defineProperty(e.prototype,"_selectionRect",{get:function(){return new f.RectangleF(Math.min(this._startPoint.x,this._endPoint.x),Math.min(this._startPoint.y,this._endPoint.y),Math.abs(this._startPoint.x-this._endPoint.x),Math.abs(this._startPoint.y-this._endPoint.y))},enumerable:!0,configurable:!0}),e}();function Ge(e){return null!=e&&"function"==typeof e.addOnCompleted&&"function"==typeof e.removeOnCompleted}var Ne=function(){function e(e,t,n,i,o,r){this._canvas=e,this._selection=t,this._hoverHandler=n,this._viewer=i,this._rotateHandler=o,this._dndHandler=r,this._isMouseButtonPressed=!1,this._isSelectionProcessed=!1,this._isMouseDrag=!1}return e.prototype.init=function(){this._selection.unlock()},e.prototype.dispose=function(){},e.prototype.processMouseEvent=function(e){var t=this,n=new f.PointF(e.x,e.y),i=this._canvas.getItemHandlersByHitTest(n),o=this._getHandlerForSelect(i,n,e),r=this._selection.hitTest(n,e.originalEvent.shiftKey);if(null!=this._canvas.textEditor&&!this._isMultiselection(e)&&1===this._selection.getSelectedItemHandlers().length&&!r.resize&&!r.rotate){var a=this._canvas.currentItemHandler,s=null!=o&&null!=a&&a.uniqueId===o.uniqueId;if(null!=a&&a instanceof R.h&&a.inPlaceEditingEnabled)if(a.processInPlaceEditingMouseEvent(e,s))return;if(null!=o&&o!=a&&o instanceof R.h&&o.inPlaceEditingEnabled)if("mousedown"!==e.type&&"dblclick"!==e.type||this._processSelection(o,e),o.processInPlaceEditingMouseEvent(e,s))return}var l=o instanceof R.l&&this._placeholderButtonGroupHitTest(o,n),c=this._placeholderHandleButtonGroupHitTest(n),u=!!this._canvas.isShowFloatingItemToolbar()&&this._floatingItemToolbarHitTest(n),h=r.body||r.resize||r.rotate;!this._canvas.canvasItemHoverEnabled||r.resize||r.rotate||this._isMouseButtonPressed?this._canvas.hideHover():this._hoverHandler.processMouseEvent(e,o);var d=h||this._canvas.isResizing()||!this._canvas.violationWarningButtonsEnabled?null:this._canvas.violationWarningButtonHitTestObject(n),p=null!=d,g=this._canvas.contentUpdatingPlaceholderItemHandler,_=null!=this._viewer?this._viewer.whitespaceDiv:null;null!=_&&(_.style.pointerEvents=c||l?"none":"auto");var v=!1;if("mousedown"===e.type||"dblclick"===e.type){var m=this._canvas.contentEditingPlaceholderItemHandler;if(this._isSelectionProcessed=!1,null!=o){c||u||p||r.resize||r.rotate||this._canvas.currentItemHandler instanceof R.e&&o.item.parentGroupItem===this._canvas.currentItemHandler.item||(this._processSelection(o,e),this._isSelectionProcessed=!0);var y=this._canvas.selectedPlaceholderItemHandler;!c||this._isMouseButtonPressed||null==y||this._canvas.autoPlaceholderEditModeEnabled?null==y||!this._canvas.autoPlaceholderEditModeEnabled||this._isMouseButtonPressed||y.editing||y.onHandleButtonMouseDown():y.showHandleButton()?y.onHandleButtonMouseDown():y.editing&&y.getPermissions(!0).showDoneButton&&y.onDoneButtonClick()}else h||u||p||!t._viewer.clearSelectionOnViewerClick||this._canvas.clearSelectedItemHandlers();null!=m&&h&&(m.setContentUpdating(!0),this._canvas.updatePlaceholderButtonGroups()),this._mouseDownTimeStamp=(new Date).getTime(),"dblclick"===e.type&&null!=this._canvas.currentItemHandler&&(this._viewer.selectedItems.length>1?null!=o&&(this._canvas.clearSelectedItemHandlers(),this._canvas.addSelectedItemHandler(o),o.dispatchDoubleClickEvent(e)):this._canvas.currentItemHandler.dispatchDoubleClickEvent(e)),"dblclick"!==e.type&&(this._isMouseButtonPressed=!0)}else if("mouseup"===e.type)null!=o&&!this._isMouseDrag&&!this._isSelectionProcessed&&this._canvas.currentItemHandler instanceof R.e&&(v=!0),this._isMouseButtonPressed=!1,this._isMouseDrag=!1,null!=g&&g.onPlaceholderButtonMouseUp.apply(g),delete this._mouseDownTimeStamp,delete this._cursor,null!=this._rotateHandler.rotateDiv&&this._rotateHandler.removeRotateDiv(),this._viewer.selectedItems.length>0&&this._rotation(this._canvas.currentItemHandler,n,!0);else if("mousemove"===e.type){this._isMouseButtonPressed&&(this._isMouseDrag=!0);for(var b=this._canvas.getAllItemHandlers({onlyVisible:!0,onlyType:R.l}),C=0;C<b.length;C++){var w=b[C],E=w.placeholderButtonGroup;this._canvas.isItemHandlerSelected(w)||null==E||(E.style.pointerEvents="none")}if(c||l)if(o instanceof R.l&&null!=o.placeholderButtonGroup)o.placeholderButtonGroup.style.pointerEvents="auto";else{var x=this._canvas.selectedPlaceholderItemHandler;null!=x&&null!=x.placeholderButtonGroup&&(x.placeholderButtonGroup.style.pointerEvents="auto")}var P=this._canvas.selectedHandler;if(null!=P&&null!=P.floatingItemToolbar&&this._canvas.floatingItemToolbarEnabled){var S=P.floatingItemToolbar;r.rotate||r.resize?S.style.pointerEvents="none":S.style.pointerEvents="auto"}if(p){var I=d.getViolationWarningButton();r.rotate||r.resize?I.style.pointerEvents="none":I.style.pointerEvents="auto"}if(this._viewer.selectedItems.length>0&&this._isMouseButtonPressed&&this._rotation(P,n),null!=this._mouseDownTimeStamp&&(new Date).getTime()-this._mouseDownTimeStamp<this._canvas.mouseMoveTimeout)return}var T=this._cursor,k=null!=T;if(g=this._canvas.contentUpdatingPlaceholderItemHandler,null==T&&(r.resize||r.rotate||null==o||this._canvas.isItemHandlerSelected(o)||l?null==g||r.resize||r.rotate?T=l?D.a.defaultCursor:this._selection.getCursor(n):(T=D.a.move,k=!0):T=D.a.pointer),this._viewer.setCursor(T,k),"mousemove"!==e.type&&(this._cursor="mousedown"===e.type?T:null),this._selection.processMouseEvent(e,v),v&&this._processSelection(o,e),(c||g||this._selection.isResizing())&&"mouseup"!==e.originalEvent.type||this._dndHandler.processMouseEvent(e),"mousemove"===e.type){var M=this._selection.isOperationNotNull(),H=null!=r.selection&&this._isMouseButtonPressed;(M||H||this._dndHandler.isDragStarted())&&this._canvas.redrawDesign()}else"mouseup"===e.type&&this._canvas.redrawDesign()},e.prototype._getHandlerForSelect=function(e,t,n){var i=this;if(null!=e&&0!==e.length){var o=n.originalEvent.shiftKey||n.originalEvent.metaKey||n.originalEvent.ctrlKey,r=e.findIndex(function(e){return i._canvas.isItemHandlerSelected(e)}),a=e[0],s=this._canvas.contentEditingPlaceholderItemHandler;if(null!=s&&s.content.hitTest(t).body)return s;if(!(this._canvas.getSelectedItemHandlers().length>1&&this._selection.visibleRectangle.bounds.contains(t))||o||"dblclick"==n.type){if(e.some(function(e){return e instanceof R.e})&&this._canvas.getSelectedItemHandlers().length>0){var l=this._canvas.getSelectedItemHandlers().getItem(0),c=-1;if(l instanceof R.e&&e.includes(l)?c=e.indexOf(l):null!=l.item.parentGroupItem&&e.includes(this._canvas.handlerFactory.get(l.item.parentGroupItem))&&(c=e.indexOf(this._canvas.handlerFactory.get(l.item.parentGroupItem))),c>-1&&null!=e[c+1]){var u=e[c+1].item,h=l.item;if(u.parentGroupItem===h||null!=u.parentGroupItem&&u.parentGroupItem===h.parentGroupItem)return e[c+1]}}return r>0&&!e[r].bounds.containsRectangle(a.bounds)&&!o?e[r]:a}}},e.prototype._placeholderButtonGroupHitTest=function(e,t){return!(null==this._viewer||null==this._canvas.parentElement||null==e||null==e.placeholderButtonGroup||e.getPermissions()&&!e.getPermissions().showSelectButton)&&this._getPlaceholderButtonGroupRect(e.placeholderButtonGroup).contains(t)},e.prototype._placeholderHandleButtonGroupHitTest=function(e){var t=this._canvas.selectedPlaceholderItemHandler;return null!=t&&null!=t.placeholderButtonGroup&&this._getPlaceholderButtonGroupRect(t.placeholderButtonGroup).contains(e)},e.prototype._floatingItemToolbarHitTest=function(e){if(null==this._viewer||null==this._canvas.parentElement||!this._canvas.floatingItemToolbarEnabled)return!1;var t=this._canvas.selectedHandler;return null!=t&&null!=t.floatingItemToolbar&&this._canvas.getButtonGroupRectInGripsDiv(t.floatingItemToolbar).contains(e)},e.prototype._isMultiselection=function(e){return e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey},e.prototype._processSelection=function(e,t){if(null!=e){var n=this._isMultiselection(t);this._canvas.isItemHandlerSelected(e)?n?this._canvas.removeSelectedItemHandler(e):this._selection.currentItemHandler=e:n&&this._canvas.getSelectedItemHandlers().toArray().every(function(t){return t.item.parentGroupItem===e.item.parentGroupItem})?this._canvas.addSelectedItemHandler(e):this._canvas.setSelectedItemHandlers([e])}},e.prototype._rotation=function(e,t,n){var i=this,o=document.querySelectorAll("#resize-left-top, #resize-right-top, #resize-right-bottom, #resize-left-bottom, #rotate-circle, #resize-width-left, #resize-width-right, #resize-height-top, #resize-height-bottom"),r=this._viewer.contentAngle,a=null!=e&&this._canvas.isPlaceholder(e)?e:null,s=function(){o.forEach(function(e){i._buttonsShow(e)}),null!=a&&(null!=a.handleButton&&i._buttonsShow(a.handleButton),null!=a.selectButton&&i._buttonsShow(a.selectButton)),i._rotateHandler.removeRotateDiv()},l=this._viewer.element,c=this._rotateHandler.calculatePositionRotateDiv(r,Math.max(0,i._viewer.getParentPosition(i._canvas.parentElement.parentElement).left),Math.max(0,i._viewer.getParentPosition(i._canvas.parentElement.parentElement).top),t,this._canvas.parentElement.parentElement.offsetWidth,this._canvas.parentElement.parentElement.offsetHeight),u=l.scrollTop,h=l.scrollLeft,d=l.scrollWidth>l.clientWidth&&0==h||h>0,p=l.scrollHeight>l.clientHeight&&0==u||u>0,f=M.a.IsTouchDevice()?0:17,g=35+(d?f:0),_=58+(p?f:0),v=this._viewer.height-g+u,m=this._viewer.width-_+h;c.y>v?c.y=v:c.y<u&&(c.y=u),c.x>m?c.x=m:c.x<h&&(c.x=h),this._selection.isRotating()?(o.forEach(function(e){i._buttonsHidden(e)}),null!=a&&(null!=a.handleButton&&this._buttonsHidden(a.handleButton),null!=a.selectButton&&this._buttonsHidden(a.selectButton)),null==this._rotateHandler.rotateDiv?this._rotateHandler.addRotateDiv(c.y,c.x):this._rotateHandler.updateRotatePositionDiv(c.y,c.x)):s(),n&&s(),this._canvas.updatePlaceholderButtonGroups()},e.prototype._getPlaceholderButtonGroupRect=function(e){var t=this._viewer.getParentPosition(this._canvas.parentElement.parentElement),n=e.offsetLeft+t.left,i=e.offsetTop+t.top,o=e.offsetWidth,r=e.offsetHeight,a=new f.RectangleF(n,i,o,r),s=this._viewer.controlToWorkspaceRectangle(a),l=new f.RectangleF(s.left,s.top,s.width,s.height);return f.RotatedRectangleF.fromRectangleF(l).bounds},e.prototype._buttonsHidden=function(e){e.classList.remove("buttonsShown"),e.classList.add("buttonsHidden")},e.prototype._buttonsShow=function(e){e.classList.remove("buttonsHidden"),e.classList.add("buttonsShown")},e}(),Ue=n(438),qe=n(470),Ye=function(){return(Ye=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Xe=function(){function e(e,t,n){var i=this;this._canvas=e,this._canvasElementHandler=t,this._selection=n,this._mobileMode=M.a.IsTouchDevice(),this._cursorSize=10,this._pixelRadius=this._mobileMode?6.5:8.5,this._zoom=10,this._lenseRadius=this._pixelRadius*this._zoom,this._textYPosition=130,this._textPadding={v:4,h:10},this._buttonsElementMargin=8,this._lenseCaptured=!1,this._onCompletedEvent=new r.c,this._currentColorData=null,this._createButtonsElement=function(){var e=document.createElement("div");i._canvas.viewer.whitespaceDiv.appendChild(e),e.className="floating-btn-group btn-group color-select",e.style.position="absolute";var t=document.createElement("button");t.className="btn btn-default reject-button cc-icon-arrow-close",t.addEventListener("click",i._onReject),e.appendChild(t);var n=document.createElement("button");n.className="btn btn-default accept-button cc-icon-check-image",n.addEventListener("click",i._onAccept),e.appendChild(n),i._buttonsElement=e},this._onAccept=function(){i._onSelectPixelEnd(null!=i._currentColorData?ne.ColorFactory.createColor(i._currentColorData,!1,!0):null)},this._onReject=function(){i._onSelectPixelEnd(null)},this._onSelectPixelEnd=function(e){i._onCompletedEvent.notify(i,e),i._canvas.viewer.eventManager.selectPixelFinished.notify(e),i._selection.unlock()},this._updateCreateButtonsPosition=function(){if(null!=i._buttonsElement){var e=parseFloat(i._canvasLensElement.style.left),t=parseFloat(i._canvasLensElement.style.top),n=parseFloat(i._canvasLensElement.style.height),o=parseFloat(i._canvasLensElement.style.height),r=i._buttonsElement.getBoundingClientRect();i._buttonsElement.style.left=e+n/2-r.width/2+"px";var a=t-r.height-i._buttonsElementMargin;t-r.height-i._buttonsElementMargin<=0&&(a=t+o+i._buttonsElementMargin),i._buttonsElement.style.top=a+"px"}},this._updateView=function(e){void 0===e&&(e=null);var t=e||i._currentPoint;i._updateLensImage(t),i._changePosition(t),i._mobileMode&&i._updateCreateButtonsPosition()},this._createLensCanvas=function(){var e=document.createElement("canvas");e.width=2*i._lenseRadius,e.height=2*i._lenseRadius,e.style.width=2*i._lenseRadius+"px",e.style.height=2*i._lenseRadius+"px",e.style.position="absolute",e.style.borderRadius=i._lenseRadius+"px",e.style.borderWidth="1px",e.style.borderColor="rgb(0,0,0,0.7)",e.style.borderStyle="solid",e.style.userSelect="none",e.tabIndex=-1,e.addEventListener("keydown",i._onKeyDown);var t=e.getContext("2d");return t.imageSmoothingEnabled=!1,t.imageSmoothingQuality="low",setTimeout(function(){return e.focus()}),e},this._onKeyDown=function(e){27===e.keyCode&&i._onReject()}}return e.prototype.init=function(){this._canvas.viewer.setCursor(D.a.cross),this._selection.lock(!0),this._canvas.viewer.ignoreDocumentClickOnce(),this._mobileMode&&(this._canvasLensElement=this._createLensCanvas(),this._canvasElementHandler.addChild(this._canvasLensElement),this._createButtonsElement(),this._putLenseOnWhitespaceCenter(),this._canvas.viewer.add_onResize(this._updateView),this._canvasElementHandler.hideSelection())},e.prototype.addOnCompleted=function(e){this._onCompletedEvent.add(e)},e.prototype.removeOnCompleted=function(e){this._onCompletedEvent.remove(e)},e.prototype._putLenseOnWhitespaceCenter=function(){var e=this._canvas.viewer,t=e.whitespaceDiv,n=new f.PointF(t.offsetWidth/2,t.offsetHeight/2),i=e.whitespaceToWorkspacePoint(n);this._currentPoint=i,this._updateView()},e.prototype.processMouseEvent=function(e){this._mobileMode?this._processMobileEvent(e):this._processDesktopEvent(e)},e.prototype._processDesktopEvent=function(e){var t=new f.PointF(e.x,e.y);this._canvas.viewer.ignoreDocumentClickOnce(),"mousemove"===e.type?(null==this._canvasLensElement&&(this._canvasLensElement=this._createLensCanvas(),this._canvasElementHandler.addChild(this._canvasLensElement)),this._updateView(t)):"mouseup"===e.type&&(this._updateView(t),this._onAccept())},e.prototype._processMobileEvent=function(e){var t=new f.PointF(e.x,e.y),n=this._canvas.viewer;if("mousemove"===e.type){if(!this._lenseCaptured)return;var i=new f.PointF(this._currentPoint.x+t.x-this._capturedPoint.x,this._currentPoint.y+t.y-this._capturedPoint.y);this._updateView(i)}else if("mousedown"===e.type){var o=new f.PointF(parseInt(this._canvasLensElement.style.left)+this._lenseRadius,parseInt(this._canvasLensElement.style.top)+this._lenseRadius),r=n.workspaceToWhiteSpacePoint(t);Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2))<this._lenseRadius&&(this._lenseCaptured=!0,this._capturedPoint=t.clone())}else if("mouseup"===e.type){if(!this._lenseCaptured)return;this._lenseCaptured=!1,this._currentPoint=new f.PointF(this._currentPoint.x+t.x-this._capturedPoint.x,this._currentPoint.y+t.y-this._capturedPoint.y),this._capturedPoint=null}this._lenseCaptured&&(e.originalEvent.preventDefault(),e.originalEvent.stopPropagation())},e.prototype._changePosition=function(e){var t=this._canvas.viewer,n=N.getRotatedPoint(t,e),i=t.workspaceToWhiteSpacePoint(n),o=2*this._lenseRadius,r=t.whitespaceDiv;this._mobileMode?(this._canvasLensElement.style.left=Object(Ue.c)(i.x,this._lenseRadius,r.offsetWidth-this._lenseRadius)-this._lenseRadius+"px",this._canvasLensElement.style.top=Object(Ue.c)(i.y,this._lenseRadius,r.offsetHeight-this._lenseRadius)-this._lenseRadius+"px"):(i.x+this._cursorSize+2*this._lenseRadius<r.offsetWidth?this._canvasLensElement.style.left=i.x+this._cursorSize+"px":this._canvasLensElement.style.left=i.x-this._cursorSize-o+"px",i.y+this._cursorSize+2*this._lenseRadius<r.offsetHeight?this._canvasLensElement.style.top=i.y+this._cursorSize+"px":this._canvasLensElement.style.top=i.y-this._cursorSize-o+"px")},e.prototype._updateLensImage=function(e){var t=this._canvas.viewer,n=2*this._pixelRadius,i=t.workspaceToContentPoint(e);i.x*=window.devicePixelRatio,i.y*=window.devicePixelRatio;var o=2*this._lenseRadius,r=new f.RectangleF(i.x-Math.trunc(this._pixelRadius),i.y-Math.trunc(this._pixelRadius)+1,n,n),a=this._canvasElementHandler.surfaceCanvas.getContext("2d"),s=a.getImageData(r.left,r.top,r.width,r.height),l=Math.trunc(n/2),c=this._canvasLensElement.getContext("2d");xe.a.clearCanvas(c);for(var u=s.data,h=new f.SizeF(n,n),d=0;d<u.length;d+=4){var p=d/4,g=Math.trunc(p/n),_=p%n,v=u[d+3]/255,m=255*(1-v),y={r:Math.min(Math.round(u[d]*v+m),255),g:Math.min(Math.round(u[d+1]*v+m),255),b:Math.min(Math.round(u[d+2]*v+m),255)};c.fillStyle="rgba("+y.r+","+y.g+","+y.b+")";var b=N.getRotatedPointFromSize(new f.PointF(_,g),h,t.contentAngle);c.fillRect(b.x*this._zoom,b.y*this._zoom,this._zoom,this._zoom),l===g&&l===_&&(this._currentColorData=Ye(Ye({},y),{type:"RgbColor"}))}for(d=0;d<n;d++)xe.a.drawLine(c,d*this._zoom,0,d*this._zoom,o,1,"black",.15),xe.a.drawLine(c,0,d*this._zoom,o,d*this._zoom,1,"black",.15);if(a.globalAlpha=1,c.lineWidth=1,c.strokeStyle="#000",c.strokeRect(l*this._zoom,l*this._zoom,this._zoom,this._zoom),c.strokeStyle="#fff",c.strokeRect(l*this._zoom-1,l*this._zoom-1,this._zoom+2,this._zoom+2),this._canvas.viewer.surfaceHandler.getBounds(qe.a.Total).contains(e,!0)){if(!this._mobileMode){var C=this._currentColorData,w="RGB: "+C.r+" "+C.g+" "+C.b,E=a.measureText(w).width;c.font="10px Roboto",c.fillStyle="black";var x=(o-E)/2;c.fillStyle="rgba(0, 0, 0, 0.7)",xe.a.drawRoundedRectangle(c,new f.RectangleF(x-this._textPadding.h,this._textYPosition-10,E+2*this._textPadding.h,20),10),c.fillStyle="white",c.fillText(w,x+2,this._textYPosition+3,o)}}else this._currentColorData=null},e.prototype.dispose=function(){this._canvas.viewer.setCursor(D.a.defaultCursor),null!=this._buttonsElement&&(this._buttonsElement.querySelector(".accept-button").removeEventListener("click",this._onAccept),this._buttonsElement.querySelector(".accept-button").removeEventListener("touchend",this._onAccept),this._buttonsElement.querySelector(".reject-button").removeEventListener("click",this._onAccept),this._buttonsElement.querySelector(".reject-button").removeEventListener("touchend",this._onAccept),this._buttonsElement.remove()),null!=this._canvasLensElement&&(this._canvasLensElement.removeEventListener("keydown",this._onKeyDown),this._canvasLensElement.remove()),this._canvas.viewer.remove_onResize(this._updateView)},e}(),Ze=function(){function e(e){this._selection=e}return e.prototype.processMouseEvent=function(e){},e.prototype.init=function(){this._selection.lock()},e.prototype.dispose=function(){this._selection.unlock()},e}(),Ke=function(){function e(e,t,n,i,o,r,a){var s=this;this._selection=e,this._viewer=t,this._canvas=n,this._hoverHandler=i,this._rotateHandler=o,this._dndHandler=r,this._canvasElementHandler=a,this._onMouseBehaviorComplete=function(e){s._viewer.eventManager.mouseBehaviorCreateFinishedEvent.notify(e),(null==s._currentOptions||null==s._currentOptions.resetToDefaultBehavior||s._currentOptions.resetToDefaultBehavior)&&s.setMouseBehavior(Me.Selection)}}return Object.defineProperty(e.prototype,"currentMouseBehaviorHandler",{get:function(){return this._currentMouseBehaviorHandler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentMouseBehavior",{get:function(){return this._currentMouseBehavior},enumerable:!0,configurable:!0}),e.prototype.setMouseBehavior=function(e,t,n){switch(this._currentMouseBehavior=e,this._currentOptions=n,null!=this._currentMouseBehaviorHandler&&(Ge(this._currentMouseBehaviorHandler)&&this._currentMouseBehaviorHandler.removeOnCompleted(this._onMouseBehaviorComplete),this.currentMouseBehaviorHandler.dispose()),e){case Me.Selection:this._currentMouseBehaviorHandler=this._getSelectionModeHandler();break;case Me.Create:this._currentMouseBehaviorHandler=new Ve(t,this._viewer,this._selection);break;case Me.SelectPixel:this._currentMouseBehaviorHandler=new Xe(this._canvas,this._canvasElementHandler,this._selection);break;case Me.Locked:this._currentMouseBehaviorHandler=new Ze(this._selection)}this._currentMouseBehaviorHandler.init(),null!=this._currentMouseBehaviorHandler&&Ge(this._currentMouseBehaviorHandler)&&this._currentMouseBehaviorHandler.addOnCompleted(this._onMouseBehaviorComplete),this._canvas.updateButtonGroups()},e.prototype._getSelectionModeHandler=function(){return this._selectionModeHandler||this._createSelectionHandler()},e.prototype._createSelectionHandler=function(){return this._selectionModeHandler=new Ne(this._canvas,this._selection,this._hoverHandler,this._viewer,this._rotateHandler,this._dndHandler),this._selectionModeHandler},Object.defineProperty(e.prototype,"isSelectionMouseBehavior",{get:function(){return this._currentMouseBehaviorHandler===this._getSelectionModeHandler()},enumerable:!0,configurable:!0}),e.prototype.processMouseEvent=function(e){this._currentMouseBehaviorHandler.processMouseEvent(e)},e}(),Qe=n(582),Je=n(588),$e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},et=function(){function e(e,t){this._failedFonts=new Array,this._activeRequests=new Array,this._textWhizz=e,this._url=t+"/api/ccviewer/fonts",this._fontRegistry=new this._textWhizz.FontRegistry(72)}return Object.defineProperty(e.prototype,"textWhizzFontRegistry",{get:function(){return this._fontRegistry},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ready",{get:function(){return null!=this._fontRegistry},enumerable:!0,configurable:!0}),e.prototype.createFont=function(e,t){return this._fontRegistry.createFont(this._normalizePsName(e),t)},e.prototype.containsFonts=function(e){var t,n;try{for(var i=$e(e),o=i.next();!o.done;o=i.next()){var r=o.value;if(!this._fontRegistry.contains(this._normalizePsName(r)))return!1}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return!0},e.prototype.checkFailedFonts=function(e){var t,n;try{for(var i=$e(e),o=i.next();!o.done;o=i.next()){var r=o.value;if(this._failedFonts.includes(this._normalizePsName(r)))return!0}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return!1},e.prototype.loadFonts=function(e){var t,n;if(this.containsFonts(e))return Promise.resolve();var i=new Array;try{for(var o=$e(e),r=o.next();!r.done;r=o.next()){var a=r.value;i.push(this._loadFont(this._normalizePsName(a)))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return Promise.all(i).then(function(){}).catch(function(){throw"Failed to load some fonts"})},e.prototype.clear=function(){this._fontRegistry.clear(),this._failedFonts=new Array},e.prototype._loadFont=function(e){var t=this;if(this._failedFonts.includes(e))return Promise.reject(null);var n=this._activeRequests.find(function(t){return t.id===e});if(null!=n)return n.promise;var i=p.e({type:p.b.get,url:this._url+"/"+e,responseType:"arraybuffer"}).then(function(e){var n=e.xhr.response;if(n){var i=new Uint8Array(n),o=i.length*i.BYTES_PER_ELEMENT,r=t._textWhizz._malloc(o),a=new Uint8Array(t._textWhizz.HEAPU8.buffer,r,o);a.set(new Uint8Array(i)),t._fontRegistry.add(a.byteOffset,a.length),t._textWhizz._free(r)}}).catch(function(){throw t._failedFonts.push(e),null}).finally(function(){t._activeRequests=t._activeRequests.filter(function(t){return t.id!==e})});return this._activeRequests.push({id:e,promise:i}),i},e.prototype._normalizePsName=function(e){return e.trim().toLowerCase()},e}(),tt=n(510),nt=n(507),it=n(504),ot=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),rt=function(e){function t(t,n,i,o,r){var a=e.call(this,t,n,i,o,r)||this;return a._currentCanvas=null,a._needWorkaroundForIOs=!1,a._needWorkaroundForIOs=M.a.IsIos(),a._setCurrentCanvas(a._staticCanvas),a}return ot(t,e),t.prototype._setCurrentCanvas=function(e){this._currentCanvas!=e&&(this._textWhizz.setCurrentContext("#"+e.id),this._textWhizz.clearContext(),this._currentCanvas=e,e==this._activeCanvas&&this._needWorkaroundForIOs&&(this._textWhizz.setCurrentContextSize(Math.ceil(e.width+1),Math.ceil(e.height+1)),this._needWorkaroundForIOs=!1)),this._textWhizz.setCurrentContextSize(Math.ceil(e.width),Math.ceil(e.height));var t=this._scale,n=this._textWhizz.Matrix.createScale(t,t);this._textWhizz.setContextTransform(n)},t.prototype._getTextTransform=function(e,t,n){var i=this._scale*n,o=this._textWhizz.Matrix.createIdentity();return t.scale(1/n,1/n),o.translate(-t.x,-t.y),o.scale(e.scaleX,e.scaleY),o.rotate(Object(f.ConvertDegreeToRadian)(e.angle)),o.translate(e.translateX/n,e.translateY/n),o.translate(t.x,t.y),o.translate(this._offset.x/n,this._offset.y/n),o.scale(i,i),o},t.prototype.drawText=function(e,t,n,i,o,r){var a=this._getTextTransform(t,n,i);try{if(this._activeCanvas.style.opacity=(null!==o&&void 0!==o?o:1).toString(),this._setCurrentCanvas(this._activeCanvas),this._textWhizz.clearContext(),this._textWhizz.setContextTransform(a),null!=r){var s=r.clone();s.transform(new f.Transform(1/i,1/i,0,0,0),new f.PointF(0,0)),this._textWhizz.setClippingPaths(s.toTextWhizzPath(this._textWhizz))}else this._textWhizz.clearClippingPaths();this._textWhizz.addTextToContext(e)}catch(e){throw nt.a.createException(e,this._textWhizz)}},t.prototype.transformText=function(e,t,n,i,o,r){if(this._currentCanvas==this._activeCanvas){var a=this._getTextTransform(t,n,i);this._textWhizz.setContextTransform(a)}else this.drawText(e,t,n,i,o,r)},t.prototype.clearText=function(){this._setCurrentCanvas(this._activeCanvas),this._textWhizz.clearContext()},t.prototype.drawSelection=function(e,t,n,i,o){if(this._currentCanvas==this._activeCanvas)try{var r=t.getArea();this._textWhizz.clearContext();var a=t.getStart(),s=t.getEnd();(t.getStart().getLineIndex()>t.getEnd().getLineIndex()||t.getStart().getLineIndex()==t.getEnd().getLineIndex()&&t.getStart().getOffset()>t.getEnd().getOffset())&&(s=t.getStart(),a=t.getEnd());var l=this._colorToTextWhizz(this._selectionColor);this._textWhizz.addShapeToContext(r,l);var c=new this._textWhizz.TextRange(e.getFirstPosition(),a);this._textWhizz.addTextRangeToContext(e,c);var u=new this._textWhizz.TextRange(s,e.getLastPosition());this._textWhizz.addTextRangeToContext(e,u);var h=this._colorToTextWhizz(this._selectionTextColor);this._textWhizz.addColorTextRangeToContext(e,t,h)}catch(e){throw nt.a.createException(e,this._textWhizz)}},t.prototype.getTextImage=function(e,t,n){if(Object(f.EqualsOfFloatNumbers)(0,t.width)||Object(f.EqualsOfFloatNumbers)(0,t.height))return null;var i=this._scale,o=this._getScaledBounds(t);Ee.setElementSize(this._staticCanvas,o.width,o.height);try{this._setCurrentCanvas(this._staticCanvas);var r=this._textWhizz.Matrix.createScale(n*i,n*i);r.translate(-o.left,-o.top),this._textWhizz.setContextTransform(r),this._textWhizz.clearContext(),this._textWhizz.addTextToContext(e)}catch(e){throw nt.a.createException(e,this._textWhizz)}try{return this._getBase64Url()}catch(e){return console.warn("Cannot get base64 image for text. Reason: "+e),null}},t}(it.a),at=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),st=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return at(t,e),t.prototype.drawText=function(e,t,n,i,o,r){var a=this._getScaledContext(t,n,i);if(a.globalAlpha=null!==o&&void 0!==o?o:1,null!=r){var s=r.clone();s.transform(new f.Transform(1/i,1/i,0,0,0),new f.PointF(0,0)),xe.a.clipPath(a,s)}try{e.draw(a)}catch(e){throw nt.a.createException(e,this._textWhizz)}finally{a.restore()}},t.prototype.transformText=function(e,t,n,i,o,r){this.drawText(e,t,n,i,o,r)},t.prototype.clearText=function(){var e=this._activeCanvas.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height)},t.prototype.drawSelection=function(e,t,n,i,o){var r=this._getScaledContext(n,i,o);try{t.getArea().addToContext(r),r.fillStyle=this._selectionColor.preview,r.fill(),e.draw(r);var a=this._colorToTextWhizz(this._selectionTextColor);t.draw(r,a)}catch(e){throw nt.a.createException(e,this._textWhizz)}finally{r.restore()}},t.prototype.getTextImage=function(e,t,n){if(Object(f.EqualsOfFloatNumbers)(0,t.width)||Object(f.EqualsOfFloatNumbers)(0,t.height))return null;var i=this._scale,o=this._getScaledBounds(t);Ee.setElementSize(this._staticCanvas,o.width,o.height);var r=this._staticCanvas.getContext("2d");r.clearRect(0,0,r.canvas.width,r.canvas.height),r.save(),r.translate(-o.left,-o.top),r.scale(i*n,i*n);try{e.draw(r)}catch(e){throw nt.a.createException(e,this._textWhizz)}finally{r.restore()}try{return this._getBase64Url()}catch(e){return console.warn("Cannot get base64 image for text. Reason: "+e),null}},t.prototype._getScaledContext=function(e,t,n){var i=this._activeCanvas.getContext("2d");i.clearRect(0,0,i.canvas.width,i.canvas.height),i.save();var o=this._scale;i.scale(o,o),i.translate(this._offset.x,this._offset.y);var r=e.toMatrix();return i.translate(t.x,t.y),i.transform(r.m00,r.m10,r.m01,r.m11,r.m02,r.m12),i.translate(-t.x,-t.y),i.scale(n,n),i},t}(it.a),lt=function(){return(lt=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},ct=function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}l((i=i.apply(e,t||[])).next())})},ut=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},ht=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},dt=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},pt=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(dt(arguments[t]));return e},ft=function(){function e(e){var t,n=this;this._initialized=!1,this._zoomChangedEvent=new r.c,this._workspaceSizeChangedEvent=new r.c,this._beforeReplaceItemHandlerEvent=new r.a,this._afterReplaceItemHandlerEvent=new r.a,this._onSelectionLockedEvent=new r.a,this.canvasItemHoverEnabled=!1,this._simpleMode=!0,this.handlerFactory=new ae.a(this),this._throttleRedraw=O.throttle(this._redraw,250),this._onBeforeReplaceItemHandler=function(e){n._beforeReplaceItemHandlerEvent.fire(e)},this._onAfterReplaceItemHandler=function(e){n._afterReplaceItemHandlerEvent.fire(e)},this._onItemRemoved=function(e){var t=e.item;if(t instanceof H.Item){var i=n.handlerFactory.get(t);n.isItemHandlerSelected(i)&&n.removeSelectedItemHandler(i),i.canvas=null,n.handlerFactory.delete(i)}},this._onContainersChanged=function(e){var t,i,o,r,a,s,l,c;try{for(var u=ht(e.removed),h=u.next();!h.done;h=u.next()){var d=h.value;try{for(var p=(o=void 0,ht(d.items)),f=p.next();!f.done;f=p.next()){var g=f.value;n._onItemRemoved({item:g})}}catch(e){o={error:e}}finally{try{f&&!f.done&&(r=p.return)&&r.call(p)}finally{if(o)throw o.error}}}}catch(e){t={error:e}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(t)throw t.error}}n._updateLayers();try{for(var _=ht(e.added),v=_.next();!v.done;v=_.next()){v.value.items.add_itemRemoved(n._onItemRemoved)}}catch(e){a={error:e}}finally{try{v&&!v.done&&(s=_.return)&&s.call(_)}finally{if(a)throw a.error}}try{for(var m=ht(e.removed),y=m.next();!y.done;y=m.next()){(d=y.value).items.remove_itemRemoved(n._onItemRemoved)}}catch(e){l={error:e}}finally{try{y&&!y.done&&(c=m.return)&&c.call(m)}finally{if(l)throw l.error}}n.redraw()},this._updateLayers=function(){n.layers.clear(),n.layers.addRange(n._viewer.containersFlatList.map(function(e){return new oe(e,n)})),n.disabledLayers=n.disabledLayers.map(function(e){return n.layers.toArray().find(function(t){return t.container.id===e.container.id})}).filter(function(e){return void 0!==e}),n.maskedLayers=n.maskedLayers.map(function(e){return n.layers.toArray().find(function(t){return t.container.id===e.container.id})}).filter(function(e){return void 0!==e}),n._layersUpdatedEvent.notify(n,{})},this._onServiceImageContainerLoaded=function(e){n.redraw()},this._fontRegistryUpdated=null,this._isRedrawPaused=!1,this._viewer=e,this._prevWorkspaceSize={width:0,height:0},this._snapLinesHandler=new ke,this._selection=new B(this,this._snapLinesHandler),this._dndHandler=new G(this,this.viewer),this._hoverHandler=new ce(this),this._rotateHandler=new N(this,this.viewer),this._canvasRenderer=new Ie(this._selection,this._dndHandler,this,null===(t=e.configuration)||void 0===t?void 0:t.handlers),this._canvasElementHandler=new Ee(this.viewer,this._selection,this._dndHandler,this._rotateHandler),this._mouseBehaviorManager=new Ke(this._selection,this._viewer,this,this._hoverHandler,this._rotateHandler,this._dndHandler,this._canvasElementHandler),this.layers=new x(this),this._disabledLayers=[],this._maskedLayers=[],this._workspaceWidth=72,this._workspaceHeight=72,this._zoom=1,this._targetDpi=null,this._hiddenFieldID="",this._parent=null,this._document=document,this._mouseMoveTimeout=100,this._disableSmoothing=!1,this._rotationGripSize=24,this._resizeGripSize=11,this._resizeGripColor="rgba(255,255,255,1)",this._rotationGripColor="rgba(0,0,255,0.2)",this._resizeGripLineColor="rgba(255,0,0,1)",this._rotationGripLineColor="rgba(112,112,112,1)",this._rotationGripLineLength=12,this._floatingItemToolbarEnabled=!1,this._violationWarningButtonsEnabled=!1,this._qualityChangeContainersEnabled=!0,this._floatingItemToolbarCssClass=null,this._violationContainerCssClass=null,this._placeholderButtonGroupCssClass=null,this._selectImageButtonCssClass=null,this._selectBarcodeButtonCssClass=null,this._doneButtonCssClass=null,this._handleButtonCssClass=null,this._deleteToolbarButtonCssClass=null,this._editToolbarButtonCssClass=null,this._selectToolbarButtonCssClass=null,this._bigButtonGroupCssClass=null,this._violationWarningButtonCssClass=null,this._goodViolationIconCssClass=null,this._warningViolationIconCssClass=null,this._violationBadIconCssClass=null,this._qualityChangeContainerCssClass=null,this._qualityChangeScaleBarCssClass=null,this._qualityBadToWarningChangeScaleBarCssClass=null,this._qualityWarningToGoodChangeScaleBarCssClass=null,this._qualityBadToGoodChangeScaleBarCssClass=null,this._qualityNoAnimationChangeScaleBarCssClass=null,this._qualityChangeInfoBarCssClass=null,this._selectButtonTitle="Select image",this._editBarcodeButtonTitle="Edit barcode",this._doneButtonTitle="Done",this._handleButtonTitle="Handle",this._deleteButtonTitle="Delete item",this._editButtonTitle="Edit item",this._backgroundImage=null,this._loadingImageUrl=null,this._marginColor="rgba(100,255,100,1)",this._marginWidth=0,this._leftMargin=18,this._rightMargin=18,this._topMargin=18,this._bottomMargin=18,this._maxFontSize=null,this._minFontSize=null,this._maxLeading=null,this._minLeading=null,this._constrainedMarginEnabled=!1,this._keyEventEnabled=!0,this._selectionColor="rgba(0,0,255,0.7)",this._selectionWidth=2,this._handlerUrl=null,this._suppressOutOfRegionManipulation=!0,this._initialization=!1,this._onSelectedItemHandlersDeletingDelegate,this._onSelectedItemHandlersChangedDelegate,this._callback=null,this._status=o.ready,this._callbackContext=0,this._callbackCount=0,this._rgbColorProfileFileId=null,this._cmykColorProfileFileId=null,this._grayscaleColorProfileFileId=null,this._returnValue=null,this._tags={},this._ready=!1,this._serviceEndpoint=null,this._service=null,this._sendingRequestEvent=new r.c,this._requestCompleteEvent=new r.c,this._statusChangedEvent=new r.c,this._callbackExceptionEvent=new r.c,this._initializedEvent=new r.c,this._invokingCallbackRequestEvent=new r.c,this._currentItemHandlerChangedEvent=new r.a,this._selectedItemHandlersChangedEvent=new r.c,this._dragNDropDoneEvent=new r.c,this._dragNDropStartingEvent=new r.c,this._dragNDropPerformedEvent=new r.c,this._readyEvent=new r.c,this._layersUpdatedEvent=new r.c,this._floatingItemToolbarEnabled=!1,this._autoPlaceholderEditModeEnabled=!1,this.handlerFactory.beforeReplaceItemHandlerEvent.add(this._onBeforeReplaceItemHandler),this.handlerFactory.afterReplaceItemHandlerEvent.add(this._onAfterReplaceItemHandler),this._initContainersObservation()}return Object.defineProperty(e.prototype,"snapLinesHandler",{get:function(){return this._snapLinesHandler},enumerable:!0,configurable:!0}),e.prototype._initContainersObservation=function(){var e,t;this._updateLayers();try{for(var n=ht(this._viewer.containersFlatList),i=n.next();!i.done;i=n.next()){i.value.items.add_itemRemoved(this._onItemRemoved)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._viewer.containersFlatListChangedEvent.add(this._onContainersChanged)},e.prototype.setHistory=function(e){this._history=e,this._selection.history=e},Object.defineProperty(e.prototype,"conf",{set:function(e){this._canvasRenderer.conf=null===e||void 0===e?void 0:e.handlers,this.snapLinesHandler.setConfiguration(null===e||void 0===e?void 0:e.snapLines)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseBehaviorManager",{get:function(){return this._mouseBehaviorManager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"history",{get:function(){return this._history},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dndHandler",{get:function(){return this._dndHandler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hiddenFieldID",{get:function(){return this._hiddenFieldID},set:function(e){this._hiddenFieldID=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rgbColorProfileFileId",{get:function(){return this._rgbColorProfileFileId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cmykColorProfileFileId",{get:function(){return this._cmykColorProfileFileId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"grayscaleColorProfileFileId",{get:function(){return this._grayscaleColorProfileFileId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serviceEndpoint",{get:function(){return this._serviceEndpoint},set:function(e){this._serviceEndpoint=e,this.service=e?new m(e):null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"service",{get:function(){return this._service},set:function(e){null!=this._service&&this._service.imageLoaderService.removeImageContainerLoaded(this._onServiceImageContainerLoaded),this._service=e,null!=this._service&&this._service.imageLoaderService.addImageContainerLoaded(this._onServiceImageContainerLoaded)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewer",{get:function(){return this._viewer},enumerable:!0,configurable:!0}),e.prototype.setTextWhizzModule=function(e,t){var n,i;this._textWhizz=e,this._setFontRegistry(new et(this._textWhizz,t)),this.textEditor instanceof Je.a&&this.textEditor.setTextWhizz(this._textWhizz);var o=this._canvasElementHandler.staticTextCanvas,r=this._canvasElementHandler.activeTextCanvas,a=!M.a.IsFirefox()&&this._textWhizz.isHardwareAccelerationAvailable("#"+o.id);a||console.warn("WebGL text rendering is not supported"),this._textRenderer=a?new rt(o,r,e,this.zoom,this.offset):new st(o,r,e,this.zoom,this.offset);var s=this.getAllItemHandlers({flatGroupItems:!0});try{for(var l=ht(s),c=l.next();!c.done;c=l.next()){c.value.onTextWhizzInit()}}catch(e){n={error:e}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}},Object.defineProperty(e.prototype,"textWhizz",{get:function(){return this._textWhizz},enumerable:!0,configurable:!0}),e.prototype._setFontRegistry=function(e){this._fontRegistry=e,null!=this._fontRegistryUpdated&&this._fontRegistryUpdated.resolve()},Object.defineProperty(e.prototype,"fontRegistry",{get:function(){return this._fontRegistry},enumerable:!0,configurable:!0}),e.prototype.waitFontRegistryInitialized=function(){return null!=this._fontRegistry?Promise.resolve():(null==this._fontRegistryUpdated&&(this._fontRegistryUpdated=new Ae.a),this._fontRegistryUpdated.promise)},Object.defineProperty(e.prototype,"textEditor",{get:function(){return this._textEditor},enumerable:!0,configurable:!0}),e.prototype.initTextEditor=function(e,t,n,i){var o;this._textEditor=e==fe.c.None?null:e==fe.c.Html||M.a.IsTouchDevice()?new Qe.a(this._canvasElementHandler):new Je.a(this,this._canvasElementHandler),null===(o=this._textEditor)||void 0===o||o.init(t,n,i)},Object.defineProperty(e.prototype,"textRenderer",{get:function(){return this._textRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleMode",{get:function(){return this._simpleMode},set:function(e){this._simpleMode=e,this.clearSelectedItemHandlers(),this.redraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._offset},set:function(e){null!=e&&e.equals(this._offset)||null==e&&null!=this.offset||(this._offset=e,this._canvasRenderer.offset=e,this._canvasElementHandler.offset=e,null!=this._textRenderer&&(this._textRenderer.offset=e),this.redraw())},enumerable:!0,configurable:!0}),e.prototype.alignItemHandler=function(e,t){if(e&&!this.isLockedOrDisabled(e)&&!this._simpleMode){var n=e instanceof a.a&&!("verticalCenter"===t||"horizontalCenter"===t),i=n?e.getBoundsIncludingFrames():e.bounds,o=e.rectangle,r=e.rectangle,s=e.layer.region,l=e.getPermissions();s?"left"===t?r.centerX=l.allowMoveHorizontal?s.left+i.width/2:r.centerX:"horizontalCenter"===t?r.centerX=l.allowMoveHorizontal?s.left+s.width/2:r.centerX:"right"===t?r.centerX=l.allowMoveHorizontal?s.left+s.width-i.width/2:r.centerX:"top"===t?r.centerY=l.allowMoveVertical?s.top+i.height/2:r.centerY:"verticalCenter"===t?r.centerY=l.allowMoveVertical?s.top+s.height/2:r.centerY:"bottom"===t&&(r.centerY=l.allowMoveVertical?s.top+s.height-i.height/2:r.centerY):"left"===t?r.centerX=l.allowMoveHorizontal?this.leftMargin+i.width/2:r.centerX:"horizontalCenter"===t?r.centerX=l.allowMoveHorizontal?this.leftMargin+(this.workspaceWidth-this.rightMargin-this.leftMargin)/2:r.centerX:"right"===t?r.centerX=l.allowMoveHorizontal?this.workspaceWidth-this.rightMargin-i.width/2:r.centerX:"top"===t?r.centerY=l.allowMoveVertical?this.topMargin+i.height/2:r.centerY:"verticalCenter"===t?r.centerY=l.allowMoveVertical?this.topMargin+(this.workspaceHeight-this.bottomMargin-this.topMargin)/2:r.centerY:"bottom"===t&&(r.centerY=l.allowMoveVertical?this.workspaceHeight-this.bottomMargin-i.height/2:r.centerY),n&&!this.isLockedOrDisabled(e)&&("bottom"!==t&&"top"!==t||!e.getPermissions().allowMoveVertical||(r.centerY-=i.top+i.height/2-o.centerY),"left"!==t&&"right"!==t||!e.getPermissions().allowMoveHorizontal||(r.centerX-=i.left+i.width/2-o.centerX)),e instanceof a.a?(e.setRectangle(r,null,!0),e.updateContentAndFrames(function(e){var t=e.rectangle;t.centerX+=r.centerX-o.centerX,t.centerY+=r.centerY-o.centerY,e.setRectangle(t)})):e instanceof tt.a?e.setRectangle(r,null,!0):e.setRectangle(r),this._selection.update(),this.redraw()}},e.prototype.alignItemHandlers=function(e){if(!this._simpleMode){var t=this.getSelectedItemHandlers();if(t.length>1){for(var n=this._selection.visibleRectangle,i=0;i<t.length;i++){var o=t.getItem(i);if(!this.isLockedOrDisabled(o)){var r=o.rectangle,s=o.rectangle,l=s.bounds;"left"===e?s.centerX=o.getPermissions().allowMoveHorizontal?n.location.x+l.width/2:s.centerX:"horizontalCenter"===e?s.centerX=o.getPermissions().allowMoveHorizontal?n.centerX:s.centerX:"right"===e?s.centerX=o.getPermissions().allowMoveHorizontal?n.getBottomRightCorner().x-l.width/2:s.centerX:"top"===e?s.centerY=o.getPermissions().allowMoveVertical?n.location.y+l.height/2:s.centerY:"verticalCenter"===e?s.centerY=o.getPermissions().allowMoveVertical?n.centerY:s.centerY:"bottom"===e&&(s.centerY=o.getPermissions().allowMoveVertical?n.getBottomRightCorner().y-l.height/2:s.centerY),o.setRectangle(s),o instanceof a.a&&o.updateContentAndFrames(function(e){var t=e.rectangle;t.centerX+=s.centerX-r.centerX,t.centerY+=s.centerY-r.centerY,e.setRectangle(t)}),this._selection.update(),this.redraw()}}this.updateTexts()}}},Object.defineProperty(e.prototype,"handlerUrl",{get:function(){return this._handlerUrl},set:function(e){this._handlerUrl=e},enumerable:!0,configurable:!0}),e.prototype._deleteSelectedItemHandlersWithoutConfirm=function(){for(var e=!1,t=this.getSelectedItemHandlers().toArray(),n=0;n<t.length;n++){var i=t[n];if(this._canDeleteItemHandler(i))i.item.parentContainer.items.remove(i.item),e=!0}e&&(this.updateTexts(),this.updateSelection(),this.redraw())},e.prototype._canDeleteItemHandler=function(e){return!this.simpleMode&&null!=e&&null!=e.layer&&!this.isLockedOrDisabled(e)&&!e.layer.locked&&e.visible&&e.layer.getVisible()&&e.getPermissions()&&e.getPermissions().allowDelete},e.prototype.deleteSelectedItemHandlers=function(e){void 0===e&&(e=!1);for(var t=!0,n=this.getSelectedItemHandlers(),i=0;i<n.length;i++){var o=n.getItem(i);if(!this._canDeleteItemHandler(o)){t=!1;break}}t&&this.viewer.commandManager.execute(F.b.deleteItems,{items:n.toArray().map(function(e){return e.item}),force:e})},Object.defineProperty(e.prototype,"ready",{get:function(){return this._ready},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tags",{get:function(){return this._tags},set:function(e){this._tags=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._workspaceWidth*this._zoom*M.a.screenDpi/72},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._workspaceHeight*this._zoom*M.a.screenDpi/72},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keyEventEnabled",{get:function(){return this._keyEventEnabled},set:function(e){this._keyEventEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"marginColor",{get:function(){return this._marginColor},set:function(e){this._marginColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"marginWidth",{get:function(){return this._marginWidth},set:function(e){this._marginWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionColor",{get:function(){return this._selectionColor},set:function(e){this._selectionColor=e,this._updateGripsAndHoverDiv()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionWidth",{get:function(){return this._selectionWidth},set:function(e){this._selectionWidth=e,this._updateGripsAndHoverDiv()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"margin",{get:function(){return Math.min(this._leftMargin,this._topMargin,this._rightMargin,this._bottomMargin)},set:function(e){this._leftMargin=e,this._rightMargin=e,this._topMargin=e,this._bottomMargin=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftMargin",{get:function(){return this._leftMargin},set:function(e){this._leftMargin!==e&&(this._leftMargin=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightMargin",{get:function(){return this._rightMargin},set:function(e){this._rightMargin!==e&&(this._rightMargin=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topMargin",{get:function(){return this._topMargin},set:function(e){this._topMargin!==e&&(this._topMargin=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomMargin",{get:function(){return this._bottomMargin},set:function(e){this._bottomMargin!==e&&(this._bottomMargin=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"constrainedMarginEnabled",{get:function(){return this._constrainedMarginEnabled},set:function(e){this._constrainedMarginEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetDpi",{get:function(){return this._targetDpi},set:function(e){this._targetDpi=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"suppressOutOfRegionManipulation",{get:function(){return this._suppressOutOfRegionManipulation},set:function(e){this._suppressOutOfRegionManipulation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"floatingItemToolbarEnabled",{get:function(){return this._floatingItemToolbarEnabled},set:function(e){this._floatingItemToolbarEnabled=e,e?this._addFloatingItemToolbars():this._removeFloatingItemToolbars()},enumerable:!0,configurable:!0}),e.prototype.setViolationContainersEnabled=function(e,t){this._violationWarningButtonsEnabled=e,this._qualityChangeContainersEnabled=t,this._removeViolationContainers(),(e||t)&&this._addViolationContainers()},Object.defineProperty(e.prototype,"violationWarningButtonsEnabled",{get:function(){return this._violationWarningButtonsEnabled},set:function(e){this._violationWarningButtonsEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"qualityChangeContainersEnabled",{get:function(){return this._qualityChangeContainersEnabled},set:function(e){this._qualityChangeContainersEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxFontSize",{get:function(){return this._maxFontSize},set:function(e){this._maxFontSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minFontSize",{get:function(){return this._minFontSize},set:function(e){this._minFontSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxLeading",{get:function(){return this._maxLeading},set:function(e){this._maxLeading=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minLeading",{get:function(){return this._minLeading},set:function(e){this._minLeading=e},enumerable:!0,configurable:!0}),e.prototype.getCallService=function(e,t,n,i,o){void 0===o&&(o=null);var r=this,a=D.b.makeCancelable(new Promise(function(n,i){var a,s=[r.getData(!0,o)];null!=t&&(s=s.concat(t)),s=s.concat(n,function(e,t,n){i({error:e,userContext:t,methodName:n})}),(a=r.service)[e].apply(a,pt(s))}));return a.promise.then(function(e){"function"==typeof n&&n(e)}).catch(function(e){if(e instanceof C.c)console.error("Exception of type "+e.name+": "+e.message);else if(!e.isCanceled){var t=e.error;"function"==typeof i&&i(t)}}),a},e.prototype.updateColors=function(e){var t,n,i,o,r,a=this;void 0===e&&(e=null);var s=null!=e?new Array(e):this.getAllItemHandlers({onlyVisible:!0}),l=new Array;try{for(var c=ht(s),u=c.next();!u.done;u=c.next()){var h=u.value;h.validateActiveColorWebServiceCall();var d=h.getColorData();d.isEmpty()||l.push(d)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}if(0===l.length)return Promise.resolve();var p=this.getCallService("UpdateByColorData",JSON.stringify(l),function(e){var t,n,i=JSON.parse(e),o=function(e){var t=s.find(function(t){return t.item.id===e.id});null!=t&&(t.setColorData(e),t.onSuccessResponse(D.c.Color))};try{for(var r=ht(i),l=r.next();!l.done;l=r.next())o(l.value)}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}a.redraw()},function(e){var t,n;console.log(e);try{for(var i=ht(s),o=i.next();!o.done;o=i.next())o.value.onErrorResponse(e)}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}),f=function(t){null===(r=s.find(function(e){return e.item.id===t.id}))||void 0===r||r.updateActiveColorWebServiceCall(p,null==e)};try{for(var g=ht(l),_=g.next();!_.done;_=g.next()){f(_.value)}}catch(e){i={error:e}}finally{try{_&&!_.done&&(o=g.return)&&o.call(g)}finally{if(i)throw i.error}}return p.promise},e.prototype.waitUpdate=function(e){void 0===e&&(e=null);var t=null!=e?e:this.getAllItemHandlers();return Promise.all(t.map(function(e){return e.waitUpdate()}))},Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"surfaceCanvas",{get:function(){return this._canvasElementHandler.surfaceCanvas},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multipleSelectionEnabled",{get:function(){return this._selection.multipleSelectionEnabled},set:function(e){this._selection.multipleSelectionEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseMoveTimeout",{get:function(){return this._mouseMoveTimeout},set:function(e){this._mouseMoveTimeout=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disableSmoothing",{get:function(){return this._disableSmoothing},set:function(e){this._disableSmoothing=e},enumerable:!0,configurable:!0}),e.prototype.getAllItemHandlers=function(e){e=function(e){null==e&&(e={});return O.defaults(e,{excludeGroupItems:!1,flatGroupItems:!1,onlyVisible:!1,onlyUnlocked:!1,whiteListFilter:function(e){return!1}})}(e);var t=this;return this.layers.toArray().map(function(e){return e.itemHandlers.toArray()}).reduce(function(e,t){return e.concat(t)},[]).reduce(function(t,n){return t.push(n),e.flatGroupItems&&n instanceof He.a&&t.push.apply(t,pt(n.getNestedItemHandlers())),t},[]).filter(function(n){if(e.whiteListFilter(n))return!0;var i=!0;return e.excludeGroupItems&&(i=i&&!(n instanceof He.a)),e.onlyVisible&&i&&(i=(i=(i=i&&null!=n.layer&&n.layer.getVisible())&&n.visible)&&!n.getPermissions().noShow),e.onlyUnlocked&&i&&(i=!n.layer.locked&&!t.isLockedOrDisabled(n)),e.onlyType&&i&&(Array.isArray(e.onlyType)||(e.onlyType=[e.onlyType]),i=!1,e.onlyType.some(function(e){if(n instanceof e)return i=!0,!0})),i})},Object.defineProperty(e.prototype,"previewMode",{get:function(){var e,t;return null!==(t=null===(e=this._canvasRenderer)||void 0===e?void 0:e.previewMode)&&void 0!==t&&t},set:function(e){if(null==this._canvasRenderer)throw new C.c("CanvasRendere is not initialized!");this._canvasRenderer.previewMode=e,this.redraw()},enumerable:!0,configurable:!0}),e.prototype.flatGroupItemsInLayer=function(e){var t=e.itemHandlers.toArray();return new y.a(t.reduce(function(e,t){return e.concat(t instanceof He.a?pt([t],t.getNestedItemHandlers(!0)):t)},[]))},e.prototype.updateTexts=function(e){void 0===e&&(e=null);for(var t=function(e){return e instanceof re.a||e instanceof le.a||e instanceof R.i},n=t(e)?e.uniqueId:null,i=this.layers,o=0,r=i.length;o<r;o++){var a=i.getItem(o);if(a.getVisible())for(var s=this.flatGroupItemsInLayer(a),l=0,c=s.length;l<c;l++){var u=s.getItem(l);u.uniqueId!==n&&t(u)&&u.visible&&!u.getPermissions().noShow&&this._updateWrappingRectangles(u)}}},Object.defineProperty(e.prototype,"backgroundImage",{set:function(e){this._backgroundImage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSquaredBackground",{get:function(){return this._isSquaredBackground},set:function(e){if(this._isSquaredBackground=e,this.isInitialized){var t="url("+this._backgroundImage+") repeat";this._isSquaredBackground||(t="transparent"),this.surfaceCanvas.style.background=t}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingImageUrl",{get:function(){return this._loadingImageUrl},set:function(e){"string"==typeof e&&this._loadingImageUrl!==e&&(this._loadingImageUrl=e,this._canvasRenderer.setLoadingImageUrl(e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"workspaceWidth",{get:function(){return this._workspaceWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"workspaceHeight",{get:function(){return this._workspaceHeight},enumerable:!0,configurable:!0}),e.prototype.setWorkspaceSize=function(e,t,n){Object(f.EqualsOfFloatNumbers)(this._workspaceWidth,e)&&Object(f.EqualsOfFloatNumbers)(this._workspaceHeight,t)||(this._workspaceWidth=e,this._workspaceHeight=t,this._workspaceSizeChangedEvent.notify(this,n))},e.prototype.begin_initialization=function(){this._initialization=!0,this._prevWorkspaceSize={width:this._workspaceWidth,height:this._workspaceHeight},this.service.beginMultiCall()},e.prototype.end_initialization=function(e){void 0===e&&(e=!1),this._initialization=!1,(e||this._workspaceWidth!==this._prevWorkspaceSize.width||this._workspaceHeight!==this._prevWorkspaceSize.height)&&this._workspaceSizeChangedEvent.notify(this,{}),this.service.endMultiCall()},Object.defineProperty(e.prototype,"initialization",{get:function(){return this._initialization},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationGripColor",{get:function(){return this._rotationGripColor},set:function(e){this._rotationGripColor=e,this._updateGripsAndHoverDiv()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resizeGripColor",{get:function(){return this._resizeGripColor},set:function(e){this._resizeGripColor=e,this._updateGripsAndHoverDiv()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationGripSize",{get:function(){return this._rotationGripSize},set:function(e){this._rotationGripSize=e,this._updateGripsAndHoverDiv()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resizeGripSize",{get:function(){return this._resizeGripSize},set:function(e){this._resizeGripSize=e,this._updateGripsAndHoverDiv()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resizeGripLineColor",{get:function(){return this._resizeGripLineColor},set:function(e){this._resizeGripLineColor=e,this._updateGripsAndHoverDiv()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationGripLineColor",{get:function(){return this._rotationGripLineColor},set:function(e){this._rotationGripLineColor=e,this._updateGripsAndHoverDiv()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationGripLineLength",{get:function(){return this._rotationGripLineLength},set:function(e){this._rotationGripLineLength=e,this._updateGripsAndHoverDiv()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"placeholderButtonGroupCssClass",{get:function(){return this._placeholderButtonGroupCssClass},set:function(e){this._placeholderButtonGroupCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"floatingItemToolbarCssClass",{get:function(){return this._floatingItemToolbarCssClass},set:function(e){this._floatingItemToolbarCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"violationContainerCssClass",{get:function(){return this._violationContainerCssClass},set:function(e){this._violationContainerCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectImageButtonCssClass",{get:function(){return this._selectImageButtonCssClass},set:function(e){this._selectImageButtonCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectBarcodeButtonCssClass",{get:function(){return this._selectBarcodeButtonCssClass},set:function(e){this._selectBarcodeButtonCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"handleButtonCssClass",{get:function(){return this._handleButtonCssClass},set:function(e){this._handleButtonCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doneButtonCssClass",{get:function(){return this._doneButtonCssClass},set:function(e){this._doneButtonCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"violationWarningButtonCssClass",{get:function(){return this._violationWarningButtonCssClass},set:function(e){this._violationWarningButtonCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"qualityChangeContainerCssClass",{get:function(){return this._qualityChangeContainerCssClass},set:function(e){this._qualityChangeContainerCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"qualityChangeScaleBarCssClass",{get:function(){return this._qualityChangeScaleBarCssClass},set:function(e){this._qualityChangeScaleBarCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"qualityBadToWarningChangeScaleBarCssClass",{get:function(){return this._qualityBadToWarningChangeScaleBarCssClass},set:function(e){this._qualityBadToWarningChangeScaleBarCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"qualityWarningToGoodChangeScaleBarCssClass",{get:function(){return this._qualityWarningToGoodChangeScaleBarCssClass},set:function(e){this._qualityWarningToGoodChangeScaleBarCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"qualityBadToGoodChangeScaleBarCssClass",{get:function(){return this._qualityBadToGoodChangeScaleBarCssClass},set:function(e){this._qualityBadToGoodChangeScaleBarCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"qualityNoAnimationChangeScaleBarCssClass",{get:function(){return this._qualityNoAnimationChangeScaleBarCssClass},set:function(e){this._qualityNoAnimationChangeScaleBarCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"qualityChangeInfoBarCssClass",{get:function(){return this._qualityChangeInfoBarCssClass},set:function(e){this._qualityChangeInfoBarCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deleteToolbarButtonCssClass",{get:function(){return this._deleteToolbarButtonCssClass},set:function(e){this._deleteToolbarButtonCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"editToolbarButtonCssClass",{get:function(){return this._editToolbarButtonCssClass},set:function(e){this._editToolbarButtonCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectToolbarButtonCssClass",{get:function(){return this._selectToolbarButtonCssClass},set:function(e){this._selectToolbarButtonCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bigButtonGroupCssClass",{get:function(){return this._bigButtonGroupCssClass},set:function(e){this._bigButtonGroupCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"goodViolationIconCssClass",{get:function(){return this._goodViolationIconCssClass},set:function(e){this._goodViolationIconCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"warningViolationIconCssClass",{get:function(){return this._warningViolationIconCssClass},set:function(e){this._warningViolationIconCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"badViolationIconCssClass",{get:function(){return this._violationBadIconCssClass},set:function(e){this._violationBadIconCssClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectButtonTitle",{get:function(){return this._selectButtonTitle},set:function(e){this.setSelectButtonTitle(e)},enumerable:!0,configurable:!0}),e.prototype.setSelectButtonTitle=function(e,t){return void 0===t&&(t=!1),e=null!=e?e:"",this.selectButtonTitle!==e&&(this._selectButtonTitle=e,t||this.updatePlaceholderButtonGroups(),!0)},Object.defineProperty(e.prototype,"editBarcodeButtonTitle",{get:function(){return this._editBarcodeButtonTitle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EditBarcodeButtonTitle",{set:function(e){this.setEditBarcodeButtonTitle(e)},enumerable:!0,configurable:!0}),e.prototype.setEditBarcodeButtonTitle=function(e,t){return void 0===t&&(t=!1),e=null!=e?e:"",this.editBarcodeButtonTitle!==e&&(this._editBarcodeButtonTitle=e,t||this.updatePlaceholderButtonGroups(),!0)},Object.defineProperty(e.prototype,"replaceGroupContentButtonTitle",{get:function(){return this._replaceGroupContentButtonTitle},set:function(e){this.setReplaceGroupContentButtonTitle(e)},enumerable:!0,configurable:!0}),e.prototype.setReplaceGroupContentButtonTitle=function(e,t){return void 0===t&&(t=!1),e=null!=e?e:"",this.replaceGroupContentButtonTitle!==e&&(this._replaceGroupContentButtonTitle=e,t||this.updatePlaceholderButtonGroups(),!0)},Object.defineProperty(e.prototype,"handleButtonTitle",{get:function(){return this._handleButtonTitle},set:function(e){this.setHandleButtonTitle(e)},enumerable:!0,configurable:!0}),e.prototype.setHandleButtonTitle=function(e,t){return void 0===t&&(t=!1),e=null!=e?e:"",this.handleButtonTitle!==e&&(this._handleButtonTitle=e,t||this.updatePlaceholderButtonGroups(),!0)},Object.defineProperty(e.prototype,"doneButtonTitle",{get:function(){return this._doneButtonTitle},set:function(e){this.setDoneButtonTitle(e)},enumerable:!0,configurable:!0}),e.prototype.setDoneButtonTitle=function(e,t){return void 0===t&&(t=!1),e=null!=e?e:"",this.doneButtonTitle!==e&&(this._doneButtonTitle=e,t||this.updatePlaceholderButtonGroups(),!0)},Object.defineProperty(e.prototype,"deleteButtonTitle",{get:function(){return this._deleteButtonTitle},set:function(e){this.setDeleteButtonTitle(e)},enumerable:!0,configurable:!0}),e.prototype.setDeleteButtonTitle=function(e,t){return void 0===t&&(t=!1),e=null!=e?e:"",this.deleteButtonTitle!==e&&(this._deleteButtonTitle=e,t||this.updatePlaceholderButtonGroups(),!0)},Object.defineProperty(e.prototype,"editButtonTitle",{get:function(){return this._editButtonTitle},set:function(e){this.setEditButtonTitle(e)},enumerable:!0,configurable:!0}),e.prototype.setEditButtonTitle=function(e,t){return void 0===t&&(t=!1),e=null!=e?e:"",this.editButtonTitle!==e&&(this._editButtonTitle=e,t||this.updatePlaceholderButtonGroups(),!0)},e.prototype.setZoom=function(e,t,n){var i;null==n&&(n={}),null==n.force&&(n.force=!1),null==n.updateButtonGroup&&(n.updateButtonGroup=!0),(e!==this._zoom||n.force)&&(this._zoom=e,null===(i=this._textRenderer)||void 0===i||i.setZoom(this._zoom),this._initialization||(this._updateCanvasElementSize(n.updateButtonGroup),t||this._zoomChangedEvent.notify(this,{})))},Object.defineProperty(e.prototype,"zoom",{get:function(){return this._zoom},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoPlaceholderEditModeEnabled",{get:function(){return this._autoPlaceholderEditModeEnabled},set:function(e){void 0!=e&&null!=e&&(this._autoPlaceholderEditModeEnabled=e)},enumerable:!0,configurable:!0}),e.prototype.calcPlatformLimitZoom=function(){var e=se.c(this.workspaceWidth,M.a.screenDpi),t=se.c(this.workspaceHeight,M.a.screenDpi),n=function(n){return Math.sqrt(n/(e*t))},i=function(n,i){return Math.min(n/e,i/t)};if(M.a.IsIos()){var o=M.a.GetIosVersion();return n("number"==typeof o[0]&&o[0]>=9&&"number"==typeof o[1]&&o[1]>=3?16e6:5e6)}return M.a.IsIE()||M.a.IsEdge()?i(8192,8192):M.a.IsGoogleChrome()?Math.min(i(32767,32767),n(268435456)):M.a.IsSafariOrSafariWebView()?Math.min(i(32767,32767)):M.a.IsFirefox()?Math.min(i(32767,32767),n(472907776)):2147483647},e.prototype._updateCanvasElementSize=function(e){var t=this.width,n=this.height;this._canvasElementSize||(this._canvasElementSize={});var i=this._canvasElementSize;t===i.width&&n===i.height||(i.width=t,i.height=n,this._canvasElementHandler.updateElementSize(t,n)),(null==e||e)&&this.updateButtonGroups()},e.prototype.updateSelection=function(){if(this.getSelectedItemHandlers().where(function(e){return!e.isVisible()}).toArray().length>0)this.getSelectedItemHandlers().where(function(e){return e.isVisible()}).toArray();if(this._selection.update(),this._floatingItemToolbarEnabled){var e=this.getSelectedItemHandlers().where(function(e){return e.isVisible()}).firstOrDefault();null!=e&&null!=e.floatingItemToolbar&&this.isOnlyThisItemHandlerSelected(e)&&this.updateFloatingItemToolbar(e)}},e.prototype.getSelectedItemHandlers=function(){return this._selection.getSelectedItemHandlers()},e.prototype.setSelectedItemHandlers=function(e){this._selection.setSelectedItemHandlers(e)},e.prototype.isItemHandlerSelected=function(e){return this._selection.isItemHandlerSelected(e)},e.prototype.isOnlyThisItemHandlerSelected=function(e){return this._selection.isOnlyThisItemHandlerSelected(e)},e.prototype.addSelectedItemHandler=function(e){this._selection.addSelectedItemHandler(e)},e.prototype.removeSelectedItemHandler=function(e){this._selection.removeSelectedItemHandler(e)},e.prototype.clearSelectedItemHandlers=function(){this._selection.clearSelectedItemHandlers()},Object.defineProperty(e.prototype,"currentItemHandler",{get:function(){return this._selection.currentItemHandler},enumerable:!0,configurable:!0}),e.prototype._onDragNDropStarting=function(e){this._dragNDropStartingEvent.notify(this,e)},e.prototype._onDragNDropDone=function(){this._dragNDropDoneEvent.notify(this)},e.prototype._onDragNDropPerformed=function(e){this._dragNDropPerformedEvent.notify(this,e),this._currentItemHandlerChangedEvent.notify(this.currentItemHandler)},e.prototype.onCurrentItemHandlerChanged=function(e){this._mouseBehaviorManager.isSelectionMouseBehavior&&null==e&&this._viewer.setCursor(D.a.defaultCursor),this._currentItemHandlerChangedEvent.notify(e)},e.prototype.onSelectionLocked=function(){this._onSelectionLockedEvent.notify(this)},e.prototype.enableSelection=function(){this._selection.enable()},e.prototype.disableSelection=function(){this._selection.disable()},e.prototype.isSelectionLocked=function(){return this._selection.isLocked},Object.defineProperty(e.prototype,"layers",{get:function(){return this._layers},set:function(e){this._layers=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disabledLayers",{get:function(){return this._disabledLayers},set:function(e){this._disabledLayers=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maskedLayers",{get:function(){return this._maskedLayers},set:function(e){this._maskedLayers=e},enumerable:!0,configurable:!0}),e.prototype.getData=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=null);var n=new J(this,e,t);return JSON.stringify(n)},Object.defineProperty(e.prototype,"returnValue",{get:function(){return this._returnValue},enumerable:!0,configurable:!0}),e.prototype.add_zoomChanged=function(e){this._zoomChangedEvent.add(e)},e.prototype.remove_zoomChanged=function(e){this._zoomChangedEvent.remove(e)},e.prototype.add_statusChanged=function(e){this._statusChangedEvent.add(e)},e.prototype.remove_statusChanged=function(e){this._statusChangedEvent.remove(e)},e.prototype.add_callbackException=function(e){this._callbackExceptionEvent.add(e)},e.prototype.remove_callbackException=function(e){this._callbackExceptionEvent.remove(e)},e.prototype.add_initialized=function(e){this._initializedEvent.add(e)},e.prototype.remove_initialized=function(e){this._initializedEvent.remove(e)},e.prototype.add_invokingCallbackRequest=function(e){this._invokingCallbackRequestEvent.add(e)},e.prototype.remove_invokingCallbackRequest=function(e){this._invokingCallbackRequestEvent.remove(e)},e.prototype.raiseMouseMove=function(e){this._onMouseMove(e)},e.prototype.raiseMouseUp=function(e){this._onMouseUp(e)},e.prototype.raiseMouseDown=function(e){this._onMouseDown(e)},e.prototype.raiseDoubleClick=function(e){this._onDoubleClick(e)},e.prototype.raiseKeyDown=function(e){this._keyEventEnabled&&this._onKeyDown(e)},e.prototype.raisePinch=function(e){this.currentItemHandler.editing&&(e.preventDefault(),e.gesture.preventDefault(),this._selection.processPinch(e),this.redrawDesign(),this.updateSelection())},e.prototype.raiseRelease=function(){var e=this.currentItemHandler;null!=e&&(e.update(),this.updateViolationContainer(e,!0))},e.prototype.raiseKeyUp=function(e){this._keyEventEnabled&&this._onKeyUp(e)},e.prototype.add_currentItemHandlerChanged=function(e){this._currentItemHandlerChangedEvent.add(e)},e.prototype.remove_currentItemHandlerChanged=function(e){this._currentItemHandlerChangedEvent.remove(e)},e.prototype.add_selectedItemHandlerChanged=function(e){this._selectedItemHandlersChangedEvent.add(e)},e.prototype.remove_selectedItemHandlerChanged=function(e){this._selectedItemHandlersChangedEvent.remove(e)},e.prototype.add_dragNDropDone=function(e){this._dragNDropDoneEvent.add(e)},e.prototype.remove_dragNDropDone=function(e){this._dragNDropDoneEvent.remove(e)},e.prototype.add_dragNDropStarting=function(e){this._dragNDropStartingEvent.add(e)},e.prototype.remove_dragNDropStarting=function(e){this._dragNDropStartingEvent.remove(e)},e.prototype.add_dragNDropPerformed=function(e){this._dragNDropPerformedEvent.add(e)},e.prototype.remove_dragNDropPerformed=function(e){this._dragNDropPerformedEvent.remove(e)},e.prototype.add_ready=function(e){this._readyEvent.add(e)},e.prototype.remove_ready=function(e){this._readyEvent.remove(e)},e.prototype.add_workspaceSizeChanged=function(e){this._workspaceSizeChangedEvent.add(e)},e.prototype.remove_workspaceSizeChanged=function(e){this._workspaceSizeChangedEvent.remove(e)},e.prototype.add_layersUpdated=function(e){this._layersUpdatedEvent.add(e)},e.prototype.remove_layersUpdated=function(e){this._layersUpdatedEvent.remove(e)},e.prototype.add_beforeReplaceItemHandler=function(e){this._beforeReplaceItemHandlerEvent.add(e)},e.prototype.remove_beforeReplaceItemHandler=function(e){this._beforeReplaceItemHandlerEvent.remove(e)},e.prototype.add_afterReplaceItemHandler=function(e){this._afterReplaceItemHandlerEvent.add(e)},e.prototype.remove_afterReplaceItemHandler=function(e){this._afterReplaceItemHandlerEvent.remove(e)},e.prototype.add_onSelectionLocked=function(e){this._onSelectionLockedEvent.add(e)},e.prototype.remove_onSelectionLocked=function(e){this._onSelectionLockedEvent.remove(e)},e.prototype.addElement=function(e){null!=this._viewer&&(this._removeElement(),this._parent=e,this._document=e.ownerDocument,this._document&&this._canvasElementHandler.addElement(this._parent,this._viewer.whitespaceDiv,this.width,this.height))},Object.defineProperty(e.prototype,"parentElement",{get:function(){return this._parent},enumerable:!0,configurable:!0}),e.prototype._removeElement=function(){this._canvasElementHandler.removeElement(),this._document=null},Object.defineProperty(e.prototype,"hoverDiv",{get:function(){return this._canvasElementHandler.hoverDiv},enumerable:!0,configurable:!0}),e.prototype.addStyles=function(){this._canvasElementHandler.addStyles()},e.prototype.updateHoverDiv=function(){this._canvasElementHandler.updateHoverDiv()},e.prototype.updateSelectionDiv=function(){this._canvasElementHandler.updateSelectionDiv()},e.prototype._updateGripsAndHoverDiv=function(){this._canvasElementHandler.updateSelectionDiv(),this._canvasElementHandler.updateParentSelectionDiv(),this._canvasElementHandler.updateHoverDiv()},e.prototype.showDnd=function(e,t){this._canvasElementHandler.showDnd(e,t,this._viewer.contentAngle)},e.prototype.hideDnd=function(){this._canvasElementHandler.hideDnd()},e.prototype.showSpotlight=function(e,t){var n=this,i=[],o=[];e.forEach(function(e){var r=n._viewer.getHandler(e).rectangle;i.push(r),o.push(lt(lt({},t),{id:e.id}))}),this._canvasElementHandler.showSpotlight(i,o,this.viewer)},e.prototype.hideSpotlight=function(e){var t=e.map(function(e){return e.id});this._canvasElementHandler.hideSpotlight(t)},e.prototype.updateSpotlight=function(e,t){var n=this,i=e.map(function(e){return e.id}),o=[],r=[];e.forEach(function(e){var i=n._viewer.getHandler(e).rectangle;o.push(i),r.push(lt(lt({},t),{id:e.id}))}),this._canvasElementHandler.updateSpotlight(i,o,r,this.viewer)},e.prototype.showSelection=function(e,t){this._canvasElementHandler.showSelection(e,t,this._viewer)},e.prototype.showParentSelection=function(e){this._canvasElementHandler.showParentSelection(e,this._viewer)},e.prototype.hideSelection=function(){this._canvasElementHandler.hideSelection()},e.prototype.showHover=function(e,t){this._canvasElementHandler.showHover(e,t,this._viewer)},e.prototype.updateHoverPosition=function(e,t){this._canvasElementHandler.updateHoverPosition(e,this._viewer,t)},e.prototype.hideHover=function(){this._canvasElementHandler.hideHover()},e.prototype.isPlaceholder=function(e){return e instanceof a.a},e.prototype._isImage=function(e){return e instanceof s.a},e.prototype._isGroup=function(e){return e instanceof He.a},e.prototype._isImageOrPlaceholder=function(e){return this._isImage(e)||this.isPlaceholder(e)},e.prototype._addFloatingItemToolbars=function(){if(null!=this._viewer)for(var e=this.getAllItemHandlers(),t=0;t<e.length;t++)this.addFloatingItemToolbar(e[t])},e.prototype._removeFloatingItemToolbars=function(){if(null!=this._viewer)for(var e=this.getAllItemHandlers(),t=0;t<e.length;t++)this._canvasElementHandler.removeFloatingItemToolbar(e[t])},e.prototype._addViolationContainers=function(){if(null!=this._viewer)for(var e=this.getAllItemHandlers(),t=0;t<e.length;t++)this.addViolationContainer(e[t])},e.prototype._removeViolationContainers=function(){var e,t;if(null!=this._viewer){var n=this.getAllItemHandlers();try{for(var i=ht(n),o=i.next();!o.done;o=i.next()){var r=o.value;this.removeViolationContainer(r);var l=r.getViolationWarningButton();if(null!=l&&l.remove(),r instanceof s.a||r instanceof a.a){var c=void 0;null!=(c=(s.a,r.qualityChangeContainer))&&c.remove()}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}}},e.prototype.addPlaceholderButtonGroup=function(e){this._canvasElementHandler.addPlaceholderButtonGroup(e,this._viewer)},e.prototype.addFloatingItemToolbar=function(e){this._canvasElementHandler.addFloatingItemToolbar(e,this._viewer)},e.prototype.addViolationContainer=function(e){this._canvasElementHandler.addViolationContainer(e,this._viewer)},e.prototype.removePlaceholderButtonGroup=function(e){this._canvasElementHandler.removePlaceholderButtonGroup(e)},e.prototype.removeFloatingItemToolbar=function(e){this._canvasElementHandler.removeFloatingItemToolbar(e)},e.prototype.removeViolationContainer=function(e){this._canvasElementHandler.removeViolationContainer(e)},e.prototype.updateButtonGroups=function(e){void 0===e&&(e={onlyVisible:!0,floatingItemToolbar:!0,violationContainers:!0,placeholderButtons:!0}),!0===e.floatingItemToolbar&&this.updateFloatingItemToolbars(e.onlyVisible),!0===e.violationContainers&&this.updateViolationContainers(!0,e.onlyVisible),!0===e.placeholderButtons&&this.updatePlaceholderButtonGroups(e.onlyVisible)},e.prototype.updateFloatingItemToolbars=function(e){if(this._floatingItemToolbarEnabled)for(var t=this.getAllItemHandlers({onlyVisible:e,flatGroupItems:!0}),n=0;n<t.length;n++)this.updateFloatingItemToolbar(t[n])},e.prototype.updateViolationContainers=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),this._violationWarningButtonsEnabled||this._qualityChangeContainersEnabled)for(var n=this.getAllItemHandlers({onlyVisible:t,flatGroupItems:!0}),i=0;i<n.length;i++)this.updateViolationContainer(n[i],e)},e.prototype.updatePlaceholderButtonGroups=function(e){void 0===e&&(e=!1);for(var t=this.getAllItemHandlers({onlyType:a.a,onlyVisible:e,flatGroupItems:!0,excludeGroupItems:!0}),n=0;n<t.length;n++)this.updatePlaceholderButtonGroup(t[n])},e.prototype.updatePlaceholderButtonGroup=function(e){this._canvasElementHandler.updatePlaceholderButtonGroup(e,this._viewer)},e.prototype.updateViolationContainer=function(e,t){void 0===t&&(t=!1),this._canvasElementHandler.updateViolationContainer(e,t,this._viewer)},e.prototype.updateFloatingItemToolbar=function(e){this._canvasElementHandler.updateFloatingItemToolbar(e,this._viewer)},e.prototype.updatePlaceholderButtonGroupPosition=function(e){this._canvasElementHandler.updatePlaceholderButtonGroupPosition(e,this._viewer)},e.prototype.updateViolationContainerPosition=function(e){this._canvasElementHandler.updateViolationContainerPosition(e,this._viewer)},e.prototype.violationWarningButtonHitTestObject=function(e){if(null==this._viewer||null==this._parent||!this._violationWarningButtonsEnabled)return null;for(var t=this.getAllItemHandlers({onlyVisible:!0}).reduce(function(e,t){return t instanceof He.a?pt(e,t.itemHandlers):pt(e,[t])},[]),n=0;n<t.length;n++){var i=t[n].getViolationWarningButton();if(null!=i)if(this.getButtonGroupRectInGripsDiv(i).contains(e))return t[n]}return null},e.prototype.getButtonGroupRectInGripsDiv=function(e,t){void 0===t&&(t=!1);var n=this._viewer.element.getBoundingClientRect(),i=e.getBoundingClientRect(),o=new f.RectangleF(i.left-n.left,i.top-n.top,e.offsetWidth,e.offsetHeight),r=this._viewer.controlToWorkspaceRectangle(o),a=new f.RectangleF(r.left,r.top,r.width,r.height),s=f.RotatedRectangleF.fromRectangleF(a),l=this._viewer.contentAngle;return l>0&&!t&&(s.rotateAt(-l,new f.PointF),90===l?s.translate(0,this.workspaceHeight):180===l?s.translate(this.workspaceWidth,this.workspaceHeight):270===l&&s.translate(this.workspaceWidth,0)),s.bounds},e.prototype.pauseRedraw=function(){this._isRedrawPaused=!0},e.prototype.continueRedraw=function(e){void 0===e&&(e=!1),this._isRedrawPaused=!1,this.redraw(e)},e.prototype.redraw=function(e){void 0===e&&(e=!1),e?this._redraw():this._throttleRedraw()},e.prototype._redraw=function(e){void 0===e&&(e=!0),!this.isInitialized||this.isUpdating||this._initialization||this._isRedrawPaused||(e&&this._canvasElementHandler.calculateRenderStateForItemHandlers(this.layers),this._canvasRenderer.redrawInactiveCanvas(this.layers,this._canvasElementHandler.surfaceCanvas,this._canvasElementHandler.inactiveCanvas),this._canvasRenderer.redrawActiveCanvas(this.layers,this._canvasElementHandler.activeCanvas,this._canvasElementHandler.designCanvas))},e.prototype.redrawDesign=function(){this._isRedrawPaused||this._canvasRenderer.redrawActiveCanvas(this.layers,this._canvasElementHandler.activeCanvas,this._canvasElementHandler.designCanvas)},e.prototype.drawWaitClock=function(e,t){this._canvasRenderer.drawWaitClock(e,t)},e.prototype.drawTextCursor=function(e){var t=this.currentItemHandler;null!=t?this._canvasRenderer.drawTextCursor(this._canvasElementHandler.cursorCanvas,t,e):console.warn("drawTextCursor: itemHandler is undefined")},e.prototype.clearTextCursor=function(){this._canvasRenderer.clearTextCursor(this._canvasElementHandler.cursorCanvas)},e.prototype.workspaceToControl=function(e){var t=e.clone(),n=M.a.screenDpi/72*this.zoom;return t.scale(n,n),t.round()},e.prototype.controlToWorkspace=function(e){var t=e.clone(),n=72/(M.a.screenDpi*this.zoom);return t.scale(n,n),t},e.prototype._onClick=function(e){if(e.type="click",null!=e.x&&null!=e.y){var t=e instanceof ve?e:new ve(e);this._processMouseEvent(t)}},e.prototype._onKeyDown=function(e){if("keydown"!==e.type)throw new Error("fix this!");this._processKeyEvent(e)},e.prototype._onKeyUp=function(e){if("keyup"!==e.type)throw new Error("fix this!");this._processKeyEvent(e)},e.prototype._isPrimaryPointer=function(e){var t=e.originalEvent;return t instanceof MouseEvent&&(null!=t.button||null!=t.which)?null!=t.button?0===t.button:1===t.which:t instanceof TouchEvent?1===t.touches.length||0===t.touches.length:t instanceof PointerEvent?t.isPrimary:e.which>0&&1===e.which},e.prototype._onMouseMove=function(e){if(e.type="mousemove",null!=e.x&&null!=e.y){var t=e instanceof ve?e:new ve(e);this._processMouseEvent(t)}},e.prototype._onMouseUp=function(e){if(e.type="mouseup",null!=e.x&&null!=e.y&&this._isPrimaryPointer(e)){var t=e instanceof ve?e:new ve(e);this._processMouseEvent(t)}},e.prototype._onMouseDown=function(e){if(e.type="mousedown",null!=e.x&&null!=e.y&&this._isPrimaryPointer(e)){var t=e instanceof ve?e:new ve(e);this._processMouseEvent(t)}},e.prototype._onDoubleClick=function(e){if(e.type="dblclick",null!=e.x&&null!=e.y){var t=e instanceof ve?e:new ve(e);this._processMouseEvent(t)}},e.prototype._processMouseEvent=function(e){this._mouseBehaviorManager.processMouseEvent(e)},e.prototype.isSelectionByHitTest=function(e){return this._selection.visibleRectangle.contains(e)},e.prototype.getItemHandlersByHitTest=function(e){for(var t=this,n=[],i=function(e){return e.visible&&!t.isLockedOrDisabled(e)&&!e.getPermissions().noShow&&!e.isEmpty()},o=this.layers.length-1;o>=0;o--){var r=this.layers.getItem(o);if(r.getVisible()&&!r.locked)for(var a=r.itemHandlers.length-1;a>=0;a--){var s=r.itemHandlers.getItem(a);if(i(s))s.hitTest(e).body&&(n.push(s),s instanceof He.a&&s.item.groupItemPermissions.allowSelectNestedItems&&n.push.apply(n,pt(s.getNestedItemHandlers(!1,!0).filter(function(t){return!0===t.hitTest(e).body&&i(t)}))))}}return n},e.prototype._processKeyEvent=function(e){if("keydown"===e.type||"keyup"===e.type){if(null!=this.textEditor){var t=this.currentItemHandler;if(null!=t&&t instanceof R.h&&t.editing&&t.processInPlaceEditingKeyEvent(e))return}if("keydown"===e.type&&"Delete"===e.code)this.deleteSelectedItemHandlers(!0);else if("keydown"===e.type&&(e.ctrlKey||e.metaKey))switch(e.code){case"KeyZ":this._history.undo();break;case"KeyY":this._history.redo()}else this._selection.processKeyEvent(e),this.redrawDesign()}},Object.defineProperty(e.prototype,"contentUpdatingPlaceholderItemHandler",{get:function(){var e=this.selectedPlaceholderItemHandler;return null!=e&&e.isContentUpdating()?e:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentEditingPlaceholderItemHandler",{get:function(){var e=this.selectedPlaceholderItemHandler;return null!=e&&e.editing?e:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedPlaceholderItemHandler",{get:function(){var e=this.selectedHandler;return e instanceof a.a?e:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedHandler",{get:function(){var e=this.getSelectedItemHandlers();return 1===e.length?e.getItem(0):null},enumerable:!0,configurable:!0}),e.prototype.isShowFloatingItemToolbar=function(e){if(!this.mouseBehaviorManager.isSelectionMouseBehavior)return!1;var t=this.selectedHandler,n=!1,i=!1;return null!=e?(n=this.isOnlyThisItemHandlerSelected(e),i=this._autoPlaceholderEditModeEnabled&&this.isPlaceholder(e)):null!=t&&(n=this.isOnlyThisItemHandlerSelected(t),i=this._autoPlaceholderEditModeEnabled&&this.isPlaceholder(t)),null!=t&&n&&t.isVisible()&&!t.isLocked()&&!i&&this._floatingItemToolbarEnabled&&(t.showDeleteToolbarButton()&&!this.simpleMode||t.showEditToolbarButton()||(this._isImageOrPlaceholder(t)||this._isGroup(t))&&t.showSelectToolbarButton())&&!this._selection.isOperationNotNull()&&null==this.contentEditingPlaceholderItemHandler&&null==this.contentUpdatingPlaceholderItemHandler},e.prototype.isResizing=function(){return this._selection.isResizing()},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._initialized},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isUpdating",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.initialize=function(){var e=this;this.begin_initialization(),M.a.IsTouchDevice()&&(this.rotationGripSize=24),this._onSelectedItemHandlersChangedDelegate=function(t){e.updateButtonGroups(),e._selection.update(),e._selectedItemHandlersChangedEvent.notify(null),e._canvasElementHandler.calculateRenderStateForItemHandlers(e.layers)&&e._redraw(!1)};var t=this.getSelectedItemHandlers();t.add_itemAdded(this._onSelectedItemHandlersChangedDelegate),t.add_itemRemoved(this._onSelectedItemHandlersChangedDelegate),this._onSelectedItemHandlersDeletingDelegate=this._deleteSelectedItemHandlersWithoutConfirm.bind(this),this._canvasRenderer.setLoadingImageUrl(this._loadingImageUrl),this._document=document,this.redraw(),this._initialized=!0,this._initializedEvent.notify(null),this._checkReady(),this.end_initialization()},e.prototype.checkReady=function(){this._ready=!1,this._checkReady()},e.prototype._checkReady=function(){var e=this;if(!this._ready){for(var t=this.layers,n=[],i=0,o=t.length;i<o;i++)for(var r=t.getItem(i).itemHandlers,a=0,s=r.length;a<s;a++){var l=r.getItem(a);l.ready||n.push(l)}if(0===n.length)this._ready=!0,this._readyEvent.notify(this);else{var c=function t(i,o){for(var r=0,a=n.length;r<a;r++)if(n[r]==i){n[r].remove_ready(t),n.splice(r,1);break}0===n.length&&(e._ready=!0,e._readyEvent.notify(e))};for(i=0,o=n.length;i<o;i++)n[i].add_ready(c)}}},e.prototype._updateWrappingRectangles=function(e,t){return void 0===t&&(t=!1),ct(this,void 0,void 0,function(){var n,i,o,r,a,s,l,c,u,h,d,p,g,_,v,m,y,b,C,w,E,x,P,S,I,T;return ut(this,function(D){switch(D.label){case 0:return this.viewer.frontEndTextRenderingEnabled||!(e instanceof re.a||e instanceof le.a)?[3,2]:[4,this._updateWrappingRectanglesWithoutTextWhizz(e,t)];case 1:return D.sent(),[2];case 2:return!0===this._initialization||void 0==this.textWhizz?[2]:t&&e instanceof re.a?(e.update(),[2]):(n=e.layer.index,i=e.index,-1===n||-1===i?[2]:e.isUpdating?[4,e.waitUpdate()]:[3,4]);case 3:D.sent(),D.label=4;case 4:return o=null,e instanceof re.a||e instanceof R.i?(o=e.getTextRectangle(),[3,9]):[3,5];case 5:return e instanceof le.a?e.getControlBounds().equals(f.RectangleF.FromLTRB(0,0,10,10))?(s=(a=f.RotatedRectangleF).fromRectangleF,[4,e.getBoundingPathsBounds()]):[3,7]:[3,9];case 6:return r=s.apply(a,[D.sent(),e.angle]),[3,8];case 7:r=e.rectangle,D.label=8;case 8:o=r,D.label=9;case 9:for(l=f.Path.rotatedRectangle(o).toTextWhizzPath(this.textWhizz),c=[],u=this.layers,h=n,d=u.length;h>-1&&h<d;h++)if((p=u.getItem(h)).getVisible())for(g=this.flatGroupItemsInLayer(p),_=0,v=g.length;_<v;_++)(m=g.getItem(_)).visible&&!m.getPermissions().noShow&&m.item.textWrappingMode!==H.WrappingMode.None&&(m.index>i||p.index>n)&&(y=m.getTextWrappingPath(),this.textWhizz.Path.intersect(l,y.toTextWhizzPath(this.textWhizz)).isEmpty()||c.push(y));b=c.length>0?new f.Path:null;try{for(C=ht(c),w=C.next();!w.done;w=C.next())E=w.value,b.addPath(E)}catch(e){I={error:e}}finally{try{w&&!w.done&&(T=C.return)&&T.call(C)}finally{if(I)throw I.error}}return x=e.lastRectangle,P=!x||!o.equals(x),e.lastRectangle=o,S=null==e.item.wrappingPath||!e.item.wrappingPath.isEqual(b),e.item.wrappingPath=b,!S&&(t||P&&c.length>0)&&e.update(),[2]}})})},e.prototype._updateWrappingRectanglesWithoutTextWhizz=function(e,t){return void 0===t&&(t=!1),ct(this,void 0,void 0,function(){var n,i,o,r,a,s,l,c,u,h,d,p,g,_,v,m,y,b,C,w,E,x,P,S,I,T,D,k,M;return ut(this,function(B){switch(B.label){case 0:return!0===this._initialization?[2]:t&&e instanceof re.a?(e.update(),[2]):(n=e.layer.index,i=e.index,-1===n||-1===i?[2]:e.isUpdating?[4,e.waitUpdate()]:[3,2]);case 1:B.sent(),B.label=2;case 2:return o=null,e instanceof re.a?(o=e.getTextRectangle(),[3,7]):[3,3];case 3:return e.getControlBounds().equals(f.RectangleF.FromLTRB(0,0,10,10))?(s=(a=f.RotatedRectangleF).fromRectangleF,[4,e.getBoundingPathsBounds()]):[3,5];case 4:return r=s.apply(a,[B.sent(),e.angle]),[3,6];case 5:r=e.rectangle,B.label=6;case 6:o=r,B.label=7;case 7:for(l=[],c=this.layers,u=n,h=c.length;u>-1&&u<h;u++)if((d=c.getItem(u)).getVisible())for(p=this.flatGroupItemsInLayer(d),g=0,_=p.length;g<_;g++)(v=p.getItem(g)).visible&&!v.getPermissions().noShow&&v.item.textWrappingMode!==H.WrappingMode.None&&(v.index>i||d.index>n)&&(m=this._getItemHandlerWrappingRectangle(v),o.intersectsWith(m)&&l.push(m));y=l.length>0?new f.Path:null;try{for(b=ht(l),C=b.next();!C.done;C=b.next())w=C.value,E=w.getUpperLeftCorner(),x=w.getUpperRightCorner(),P=w.getBottomRightCorner(),S=w.getBottomLeftCorner(),y.moveTo(E.x,E.y),y.lineTo(x.x,x.y),y.lineTo(P.x,P.y),y.lineTo(S.x,S.y),y.lineTo(E.x,E.y),y.close()}catch(e){k={error:e}}finally{try{C&&!C.done&&(M=b.return)&&M.call(b)}finally{if(k)throw k.error}}return I=e.lastRectangle,T=!I||!o.equals(I),e.lastRectangle=o,D=null==e.item.wrappingPath||!e.item.wrappingPath.isEqual(y),e.item.wrappingPath=y,!D&&(t||T&&l.length>0)&&e.update(),[2]}})})},e.prototype._getItemHandlerWrappingRectangle=function(e){if(e instanceof re.a){var t=f.RotatedRectangleF.fromRectangleF(e.item.textRectangle,0);switch(e.item.transform.isEmpty||t.transform(e.item.transform.clone(),t.center),e.item.textWrappingMode){case H.WrappingMode.Square:return f.RotatedRectangleF.fromRectangleF(t.bounds);case H.WrappingMode.Tight:default:return t}}else switch(e.item.textWrappingMode){case H.WrappingMode.Square:return f.RotatedRectangleF.fromRectangleF(e.bounds);case H.WrappingMode.Tight:default:return e.rectangle}},e.prototype.dispose=function(){var e=this.getSelectedItemHandlers();null!=this._onSelectedItemHandlersChangedDelegate&&(e.remove_itemAdded(this._onSelectedItemHandlersChangedDelegate),delete this._onSelectedItemHandlersChangedDelegate),null!=this._onSelectedItemHandlersChangedDelegate&&(e.remove_itemRemoved(this._onSelectedItemHandlersChangedDelegate),delete this._onSelectedItemHandlersDeletingDelegate),this.getAllItemHandlers({flatGroupItems:!0}).forEach(function(e){return e.dispose()})},e.prototype.hitTestSelection=function(e,t,n,i){void 0===n&&(n=!1),void 0===i&&(i=null);var o=null==this._offset||this._offset.isOrigin()?t.clone():new f.PointF(t.x-this._offset.x,t.y-this._offset.y),r={},a=new f.Matrix;0!==e.angle&&a.rotate(-e.angle),a.translate(-e.centerX,-e.centerY),o=a.transformPoint(o,!0);var s=e.width,l=e.height,c=this.mul,u=null!=i?Math.max(i/c,l):l,h=null!=i?Math.max(i/c,s):s;r.body=new f.RectangleF(-h/2,-u/2,h,u).contains(o),r.resize=!1,r.resizeIndex=0;for(var d=(M.a.IsTouchDevice()?33:this.resizeGripSize)/c,p=d/2,g=[null,new f.RectangleF(-s/2-p,-l/2-p,d,d),new f.RectangleF(s/2-p,-l/2-p,d,d),new f.RectangleF(s/2-p,l/2-p,d,d),new f.RectangleF(-s/2-p,l/2-p,d,d),new f.RectangleF(-s/2-p,0-p,d,d),new f.RectangleF(0-p,-l/2-p,d,d),new f.RectangleF(s/2-p,0-p,d,d),new f.RectangleF(0-p,l/2-p,d,d)],_=new Array(5,7),v=1,m=g.length;v<m;v++)if(g[v].contains(o)&&(!n||-1!==_.indexOf(v))){r.resize=!0,r.resizeIndex=v;break}l<0&&(l=-l),r.rotate=!1,r.rotateIndex=0,d=this.rotationGripSize/2/c;var y=l/2+this.rotationGripSize/c+d,b=o.x-0,C=o.y-y;return b*b+C*C<d*d&&(r.rotate=!0,r.rotateIndex=6),r},Object.defineProperty(e.prototype,"mul",{get:function(){return 96*this.zoom/72},enumerable:!0,configurable:!0}),e.prototype.isLockedOrDisabled=function(e){return null==e||(e.isLocked()||this.disabledLayers.includes(e.layer))},e.prototype.onLayerTextureLoaded=function(){for(var e=0;e<this.layers.length;e++){var t=this.layers.getItem(e);if(!t.locked&&!t.isTextureLoadedOrNotExists())return}this.redraw()},e}(),gt=n(472),_t=n(432),vt=n(479),mt=n(433),yt=function(){return(yt=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},bt=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ct=function(){function e(t){var n=this;this._changedEvent=new r.c,this._visibilityChangedEvent=new r.a,this._containers=null,this._visible=!1,this._printZoneConf=e._getDefaultPrintZoneConfig(),this._onPrintAreaAdded=function(e){n._clearCurrentSafetyLinesContainers(),n._subscribePrintAreaEvents(e.item),n._changedEvent.notify(n)},this._onPrintAreaRemoved=function(e){n._clearCurrentSafetyLinesContainers(),n._unsubscribePrintAreaEvents(e.item),n._changedEvent.notify(n)},this._onSafetyLinePropertyChanged=function(){n._clearCurrentSafetyLinesContainers(),n._changedEvent.notify(n)},this._onSafetyLinesCollectionRemoved=function(e){n._unsubscribeSafetyLineEvents(e.item),n._clearCurrentSafetyLinesContainers(),n._changedEvent.notify(n)},this._onSafetyLinesCollectionAdded=function(e){n._subscribeSafetyLineEvents(e.item),n._clearCurrentSafetyLinesContainers(),n._changedEvent.notify(n)},this._onPrintAreaPropertyChanged=function(e,t){"bleed"!==t&&"slug"!==t&&"bounds"!==t||(n._clearCurrentSafetyLinesContainers(),n._changedEvent.notify(n))},this._onPrintAreaPropertyChangedDebounce=O.debounce(this._onPrintAreaPropertyChanged,100),this.conf=t}return Object.defineProperty(e.prototype,"conf",{set:function(t){var n=e._getDefaultPrintZoneConfig();this._printZoneConf.bleed=yt(yt({},n.bleed),(null===t||void 0===t?void 0:t.bleed)||{}),this._printZoneConf.trim=yt(yt({},n.trim),(null===t||void 0===t?void 0:t.trim)||{})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"surface",{get:function(){return this._surface},set:function(e){var t=this;this._surface!==e&&(null!=this._surface&&(this._surface.printAreas.remove_itemAdded(this._onPrintAreaAdded),this._surface.printAreas.remove_itemRemoved(this._onPrintAreaRemoved),this._surface.printAreas.forEach(function(e){return t._subscribePrintAreaEvents(e)})),this._surface=e,this._clearCurrentSafetyLinesContainers(),null!=this._surface&&(this._surface.printAreas.add_itemAdded(this._onPrintAreaAdded),this._surface.printAreas.add_itemRemoved(this._onPrintAreaRemoved),this._surface.printAreas.forEach(function(e){return t._subscribePrintAreaEvents(e)})))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"safetyLinesContainers",{get:function(){return null==this._containers&&(this._containers=this._buildSafetyLinesContainers()),this._containers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){var t,n;if(this._visible!==e&&(this._visible=e,null!=this._containers)){var i=!1;try{for(var o=bt(this._containers),r=o.next();!r.done;r=o.next()){var a=r.value;a.visible!==this._visible&&(a.visible=this._visible,i=!0)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}i&&this._visibilityChangedEvent.notify()}},enumerable:!0,configurable:!0}),e.prototype.addChanged=function(e){this._changedEvent.add(e)},e.prototype.removeChanged=function(e){this._changedEvent.remove(e)},e.prototype.addVisibilityChanged=function(e){this._visibilityChangedEvent.add(e)},e.prototype.removeVisibilityChanged=function(e){this._visibilityChangedEvent.remove(e)},e.prototype._clearCurrentSafetyLinesContainers=function(){this._containers=null},e.prototype._subscribePrintAreaEvents=function(e){var t=this;e.safetyLines.add_itemAdded(this._onSafetyLinesCollectionAdded),e.safetyLines.add_itemRemoved(this._onSafetyLinesCollectionRemoved),e.safetyLines.forEach(function(e){return t._subscribeSafetyLineEvents(e)}),e.addPropertyChanged(this._onPrintAreaPropertyChangedDebounce)},e.prototype._unsubscribePrintAreaEvents=function(e){var t=this;e.safetyLines.forEach(function(e){return t._unsubscribeSafetyLineEvents(e)}),e.safetyLines.remove_itemAdded(this._onSafetyLinesCollectionAdded),e.safetyLines.remove_itemRemoved(this._onSafetyLinesCollectionRemoved),e.removePropertyChanged(this._onPrintAreaPropertyChangedDebounce)},e.prototype._subscribeSafetyLineEvents=function(e){e.addPropertyChanged(this._onSafetyLinePropertyChanged)},e.prototype._unsubscribeSafetyLineEvents=function(e){e.removePropertyChanged(this._onSafetyLinePropertyChanged)},e.prototype._buildSafetyLinesContainers=function(){var e,t,n,i,o=new y.a;if(null==this.surface)return o;try{for(var r=bt(this.surface.printAreas),a=r.next();!a.done;a=r.next()){var s=a.value;if(null!=s.safetyLines)try{for(var l=(n=void 0,bt(s.safetyLines)),c=l.next();!c.done;c=l.next()){var u=c.value,h=this._createContainer("SafetyLines["+s.name+"]"),d=this._createDashedRectangleFromSafetyLine(s.bounds,u);h.items.add(d),o.add(h)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}if(!s.bleed.isEmpty){h=this._createContainer("Bleed["+s.name+"]");o.add(h);var p=this._printZoneConf.bleed;d=this._createDashedRect(s.getBounds(qe.a.Bleed),p.width,p.step,ne.ColorFactory.createColor(p.color),"bleed",p.altColor&&ne.ColorFactory.createColor(p.altColor));h.items.add(d)}if(!s.slug.isEmpty||!s.bleed.isEmpty){h=this._createContainer("Trim["+s.name+"]");o.add(h);p=this._printZoneConf.trim,d=this._createDashedRect(s.bounds,p.width,p.step,ne.ColorFactory.createColor(p.color),"trim",p.altColor&&ne.ColorFactory.createColor(p.altColor));h.items.add(d)}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return o},e.prototype._createContainer=function(e){var t=new ee.a;return t.locked=!0,t.name="Bleed["+e+"]",t.visible=this._visible,t},e.prototype._createDashedRectangleFromSafetyLine=function(e,t){var n=t.getRectangle(e),i=t.getCornerRadiuses(e);return this._createDashedRect(n,t.widthPx,t.stepPx,t.color,t.name,t.altColor,i)},e.prototype._createDashedRect=function(e,t,n,i,o,r,a){var s=mt.a.roundedRectangle(e.left,e.top,e.width,e.height,a),l=new _t.a(s);return l.name=vt.b.voPrefix+"_"+o+"_shape",l.borderColor=i,l.fillColor=ne.ColorFactory.createColor("transparent"),l.fixedBorderWidth=!0,l.borderWidth=t,null!=r&&(l.altBorderColor=r),l.dash=[n,3],l},e.prototype.dispose=function(){var e=this;null!=this._surface&&(this._surface.printAreas.remove_itemAdded(this._onPrintAreaAdded),this._surface.printAreas.remove_itemRemoved(this._onPrintAreaRemoved),this._surface.printAreas.forEach(function(t){return e._unsubscribePrintAreaEvents(t)}))},e._getDefaultPrintZoneConfig=function(){return{bleed:{color:"rgb(255, 0, 0)",altColor:"rgb(255, 0, 0)",step:1,width:1},trim:{color:"rgb(255, 0, 0)",step:5,width:1}}},e}(),wt=n(757),Et=function(){function e(e,t){var n=this;this._productParser=new wt.a,this._watermarkCollectionChangedEvent=new r.c,this._watermarkContainers=new y.a,this._onSurfacePropertyChanged=function(e,t){switch(t){case"width":case"height":n._updateWatermark()}},this._watermarkConfig=e,this._service=t,this._clearWatermarkContainer()}return Object.defineProperty(e.prototype,"surface",{get:function(){return this._surface},set:function(e){this._surface!==e&&(null!=this._surface&&this.surface.removePropertyChanged(this._onSurfacePropertyChanged),this._surface=e,this._watermarkConfig=null!=this._surface&&null!=this._surface.parentProduct?this._surface.parentProduct.watermarkConfig:null,null!=this._surface&&this.surface.addPropertyChanged(this._onSurfacePropertyChanged),this._updateWatermark())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"watermarkConfig",{get:function(){return this._watermarkConfig},set:function(e){this._watermarkConfig!==e&&(this._watermarkConfig=e,this._updateWatermark())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"watermarkContainers",{get:function(){return null==this._watermarkContainers&&(this._watermarkContainers=new y.a),this._watermarkContainers},enumerable:!0,configurable:!0}),e.prototype._setWatermarkContainers=function(e){this._watermarkContainers=e,this._watermarkCollectionChangedEvent.notify(this)},e.prototype.add_watermarkCollectionChanged=function(e){this._watermarkCollectionChangedEvent.add(e)},e.prototype.remove_watermarkCollectionChanged=function(e){this._watermarkCollectionChangedEvent.remove(e)},e.prototype._clearWatermarkContainer=function(){this._watermarkContainers=null},e.prototype._updateWatermark=function(){this._clearWatermarkContainer(),null!=this.surface&&0!==this.surface.width&&0!==this.surface.height&&null!=this.watermarkConfig&&null!=this.watermarkConfig.visibility&&!1!==this.watermarkConfig.visibility.canvas&&this._requestWatermarkItems()},e.prototype._requestWatermarkItems=function(){var e=this,t=Math.random();this._requestWatermarkItemsId=t,this._service.getWatermarkItemsAsync(this.surface.width,this.surface.height,this._watermarkConfig).then(function(n){try{if(t!==e._requestWatermarkItemsId)return;var i=new y.a([e._productParser.parseContainer(n)]);e._setWatermarkContainers(i)}catch(e){throw e}}).catch(function(e){console.error("Error while updating watermark items.",e)})},e}(),xt=n(558),Pt=function(){function e(){var e=this;this._visible=!1,this._changedEvent=new r.a,this._onSurfacePropertyChanged=function(t,n){switch(n){case"width":case"height":e._updateGrid()}}}return Object.defineProperty(e.prototype,"surface",{get:function(){return this._surface},set:function(e){this._surface!==e&&(null!=this._surface&&this.surface.removePropertyChanged(this._onSurfacePropertyChanged),this._surface=e,null!=this._surface&&this.surface.addPropertyChanged(this._onSurfacePropertyChanged),this._updateGrid())},enumerable:!0,configurable:!0}),e.prototype.setConfig=function(e,t){this._config=e,this._rulersConfig=t},Object.defineProperty(e.prototype,"gridContainers",{get:function(){var e=new y.a;return null!=this._gridContainer&&e.add(this._gridContainer),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gridContainer",{get:function(){return this._gridContainer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){this._visible!==e&&(this._visible=e,this._updateGrid())},enumerable:!0,configurable:!0}),e.prototype.addChanged=function(e){this._changedEvent.add(e)},e.prototype.removeChanged=function(e){this._changedEvent.remove(e)},e.prototype._updateGrid=function(){null!=this._gridContainer&&this._width==this.surface.width&&this._height==this.surface.height||(this._gridContainer=this._createGrid()),null!=this._gridContainer&&this._gridContainer.visible!==this._visible&&(this._gridContainer.visible=this._visible,this._changedEvent.fire())},e.prototype._createGrid=function(){if(null==this.surface)return null;if(this._width=this.surface.width,this._height=this.surface.height,0===this.surface.width||0===this.surface.height)return null;if(null==this._config)return null;var e=new ee.a;e.locked=!0,e.visible=!1,e.name="Grid";var t=Object(fe.d)(this._rulersConfig),n=this._config.stepX/t,i=this._config.stepY/t;if(n>0&&i>0){var o=Math.round(this._width/n)+1,r=Math.round(this._height/i)+1;if(o>0&&o!==Number.POSITIVE_INFINITY&&r>0&&r!==Number.POSITIVE_INFINITY){var a=new xt.a(0,0,o,r,n,i);a.horizontalLineColor=ne.ColorFactory.createColor(this._config.horizontalColor),a.verticalLineColor=ne.ColorFactory.createColor(this._config.verticalColor),a.lineWidth=this._config.lineWidthPx,a.fixedLineWidth=!0,e.items.add(a)}}return e},e}(),St=function(){return function(e){this.text={fitToPathStep:1},e=null!=e?e:{},Object(Te.e)(this,[e],{deep:!0})}}(),It=(function(){}(),function(){}(),function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}l((i=i.apply(e,t||[])).next())})}),Tt=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},Dt=function(){function e(e,t){var n=this;this._viewer=e,this._backendUrl=t,this._viewer.add_onResize(function(){n._updatePosition(),null!=n._expireLicenseMessageElement&&n._updateHeightExpireLicenseMessage()})}return e.prototype.checkLicense=function(){return It(this,void 0,void 0,function(){var e,t;return Tt(this,function(n){switch(n.label){case 0:return null!=this._license?[3,2]:(e=this,[4,this._getLicense()]);case 1:e._license=n.sent(),n.label=2;case 2:return this._license.isEnterprise&&!this._license.isTrial?(this._getLeftDays()<=30&&(this._expireLicenseMessageElement=this._createExpireLicenseMessage(),(t=document.getElementById("aspnetForm").parentElement).insertBefore(this._expireLicenseMessageElement,t.childNodes[0]),this._updateHeightExpireLicenseMessage()),[2]):this._isFullLicense()?[2]:(this._watermarkElement=this._createElement(),this._viewer.element.parentElement.appendChild(this._watermarkElement),this._updatePosition(),[2])}})})},e.prototype._updatePosition=function(){if(null!=this._watermarkElement){var t=this._viewer.element.clientWidth,n=this._viewer.element.clientHeight,i=this._watermarkElement.clientWidth,o=this._watermarkElement.clientHeight,r=t-i-e._margin,a=n-o-e._margin;this._watermarkElement.style.left=r+"px",this._watermarkElement.style.top=a+"px"}},e.prototype._isFullLicense=function(){return!this._license.isTrial&&!this._license.isDeveloper},e.prototype._createExpireLicenseMessage=function(){var e=document.createElement("div");e.style.background="rgba(244, 67, 54, 0.1)";var t=document.createElement("p");return t.style.color="#F44336",t.style.fontSize="14px",t.style.margin="0",t.style.lineHeight="20px",t.style.padding="8px 16px",t.textContent="The license expires soon. It won't affect your current design, but please contact the website administrator or customer service department and let them know that you see this message.",e.appendChild(t),e},e.prototype._updateHeightExpireLicenseMessage=function(){var e=this._expireLicenseMessageElement;if(null!=e){var t=e.clientHeight;document.getElementById("aspnetForm").style.height="calc(100% - "+t+"px)",e.style.textAlign=t>36?"left":"center"}},e.prototype._createElement=function(){var e=document.createElement("div");e.id="cvLicenseWatermark",e.style.width="auto",e.style.height="auto",e.style.whiteSpace="nowrap",e.style.position="absolute",e.style.borderRadius="4px",e.style.backgroundColor="rgba(255, 255, 255, 0.5)",e.style.zIndex="1",e.style.pointerEvents="none";var t=document.createElement("div");t.style.padding="8px",t.style.display="flex",t.style.flexDirection="column";var n=document.createElement("span");n.style.fontFamily="Roboto",n.style.fontStyle="normal",n.style.fontWeight="500",n.style.fontSize="14px",n.style.lineHeight="15px",n.style.color="#333333";var i=document.createElement("span");i.style.fontFamily="Roboto",i.style.fontStyle="normal",i.style.fontSize="12px",i.style.lineHeight="18px",i.style.color="#333333",n.textContent="This is a "+this._getLicenseType()+" edition";var o=this._license.expirationDate.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return i.textContent="Expires on "+o+" ("+this._getLeftDays()+" days left)",t.appendChild(n),t.appendChild(i),e.appendChild(t),e},e.prototype._getLicenseType=function(){return this._license.isTrial?"Trial":this._license.isDeveloper?"Developer":""},e.prototype._getLeftDays=function(){var e=Math.max(0,this._license.expirationDate.getTime()-Date.now());return Math.ceil(e/864e5)},e.prototype._getLicense=function(){return It(this,void 0,void 0,function(){var e,t;return Tt(this,function(n){switch(n.label){case 0:return[4,p.d(Object(Te.s)(this._backendUrl,"license"))];case 1:if((e=n.sent()).status!==p.c.Ok)throw new C.d("Cannot get license from server");return t=JSON.parse(e.value),[2,Object(Te.f)(new kt,{isDeveloper:t.isDeveloper,isTrial:t.isTrial,isDesktopOnly:t.isDesktopOnly,isEnterprise:t.isEnterprise,expirationDate:new Date(t.expirationDate)})]}})})},e._margin=12,e}(),kt=function(){return function(){}}(),Mt=n(749),Ht=n(745),Bt=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Rt=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},Ot=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Rt(arguments[t]));return e},zt=function(){function e(e,t){var n=this;this._product=e,this._viewer=t,this._notifyContainerCollectionChanged=function(){return n._containerCollectionChangedEvent.notify()},this._notifySurfaceCollectionChanged=function(){return n._surfaceCollectionChangedEvent.notify()},this._notifyItemHanderCollectionChanged=function(){return n._itemHanderCollectionChangedEvent.notify()},this._notifyLayerCollectionChanged=function(){return n._layerCollectionChangedEvent.notify()},this._notifyPrintAreaCollectionChanged=function(){return n._printAreaCollectionChangedEvent.notify()},this._notifyItemCollectionChanged=function(){return n._itemCollectionChangedEvent.notify()},this._notifyItemAdded=function(e){return n._itemAddedEvent.notify(e)},this._notifyItemRemoved=function(e){return n._itemRemovedEvent.notify(e)},this._notifyItemMoved=function(e){return n._itemMovedEvent.notify(e)},this._notifyUnderMockupCollectionChanged=function(){return n._underMockupContainerCollectionChangedEvent.notify()},this._notifyOverMockupCollectionChanged=function(){return n._overMockupContainerCollectionChangedEvent.notify()},this._notifyPreviewMockupCollectionChanged=function(){return n._previewMockupContainerCollectionChangedEvent.notify()},this._notifyPrintAreaPropertyChanged=function(e,t){return n._printAreaPropertyChangedEvent.notify(e,t)},this._notifyItemPropertyChanged=function(e,t){return n._itemPropertyChangedEvent.notify(e.item,t)},this._notifyItemChanged=function(e){return n._itemChangedEvent.notify(e.item)},this._notifyDeleteToolbarButtonClick=function(e){return n._deleteToolbarButtonClickEvent.notify(e.item)},this._notifySelectToolbarButtonClick=function(e){return n._selectToolbarButtonClickEvent.notify(e.item)},this._notifyEditToolbarButtonClick=function(e){return n._editToolbarButtonClickEvent.notify(e.item)},this._notifySelectButtonClick=function(e){return n._selectButtonClickEvent.notify(e.item)},this._notifyViolationWarningButtonClick=function(e){return n._violationWarningButtonClickEvent.notify(e.item)},this._notifyDoubleClick=function(e,t){return n._doubleClickEvent.notify(e.item)},this._notifyShapePathLoaded=function(){return n._shapePathLoadedEvent.notify()},this._notifyEnteredEditMode=function(e){return n._enteredEditModeEvent.notify(e.item)},this._notifyExitedEditMode=function(e){return n._exitedEditModeEvent.notify(e.item)},this._notifyCurrentItemChanged=function(e){return n._currentItemChangedEvent.notify(null!=e?e.item:null)},this._notifySelectedItemChanged=function(){return n._selectedItemChangedEvent.notify(n._viewer.selectedItems)},this._notifyDragNDropDone=function(e){return n._dragNDropDoneEvent.notify(e)},this._notifyDragNDropStarting=function(e){return n._dragNDropStartingEvent.notify(e)},this._notifyDragNDropPerformed=function(e){return n._dragNDropPerformedEvent.notify(e)},this._notifyReady=function(){return n._readyEvent.notify()},this._notifyWorkspaceSizeChanged=function(){return n._workspaceSizeChangedEvent.notify()},this._notifyBeforeReplaceItemHandler=function(e){n._unsubscribeFromItemHandlerEvents(e),n._beforeReplaceItemHandlerEvent.notify(e)},this._notifyAfterReplaceItemHandler=function(e){n._subscribeToItemHandlerEvents(e),n._afterReplaceItemHandlerEvent.notify(e)},this._subscribeToProductEvents=function(e){var t,i;if(null!=e){e.surfaces.add_collectionChanged(n._notifySurfaceCollectionChanged),e.surfaces.add_collectionChanged(n._onSurfaceCollectionChanged);try{for(var o=Bt(e.surfaces),r=o.next();!r.done;r=o.next()){var a=r.value;n._subscribeToSurfaceEvents(a)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}}},this._unsubscribeFromProductEvents=function(e){var t,i;if(null!=e){e.surfaces.remove_collectionChanged(n._notifySurfaceCollectionChanged),e.surfaces.remove_collectionChanged(n._onSurfaceCollectionChanged);try{for(var o=Bt(e.surfaces),r=o.next();!r.done;r=o.next()){var a=r.value;n._unsubscribeFromSurfaceEvents(a)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}}},this._onSurfaceCollectionChanged=function(e){if(e.type!==Ht.a.Move)if(e.type!==Ht.a.Remove)if(e.type!==Ht.a.Add);else{t=e;n._subscribeToSurfaceEvents(t.item)}else{var t=e;n._unsubscribeFromSurfaceEvents(t.item)}},this._onLayerCollectionChanged=function(e){if(e.type!==Ht.a.Move)if(e.type!==Ht.a.Remove)if(e.type!==Ht.a.Add);else{t=e;n._subscribeToLayerEvents(t.item)}else{var t=e;n._unsubscribeFromLayerEvents(t.item)}},this._onItemHanderCollectionChanged=function(e){if(e.type!==Ht.a.Move)if(e.type!==Ht.a.Remove)if(e.type!==Ht.a.Add);else{t=e;n._subscribeToItemHandlerEvents(t.item)}else{var t=e;n._unsubscribeFromItemHandlerEvents(t.item)}},this._subscribeToSurfaceEvents=function(e){var t,i;if(null!=e){e.containers.add_collectionChanged(n._notifyContainerCollectionChanged),e.containers.add_collectionChanged(n._onContainerCollectionChanged),e.mockup.underContainers.add_collectionChanged(n._notifyUnderMockupCollectionChanged),e.mockup.underContainers.add_collectionChanged(n._onContainerCollectionChanged),e.mockup.overContainers.add_collectionChanged(n._notifyOverMockupCollectionChanged),e.mockup.overContainers.add_collectionChanged(n._onContainerCollectionChanged),e.previewMockups.add_collectionChanged(n._notifyPreviewMockupCollectionChanged);var o=Ot(e.containers,e.mockup.underContainers,e.mockup.overContainers);try{for(var r=Bt(o),a=r.next();!a.done;a=r.next()){var s=a.value;n._subscribeToContainerEvents(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}e.printAreas.forEach(n._subscribeToPrintAreaEvents),e.printAreas.add_collectionChanged(n._notifyPrintAreaCollectionChanged),e.printAreas.add_collectionChanged(n._onPrintAreaCollectionChanged)}},this._unsubscribeFromSurfaceEvents=function(e){var t,i;if(null!=e){e.containers.remove_collectionChanged(n._notifyContainerCollectionChanged),e.containers.remove_collectionChanged(n._onContainerCollectionChanged),e.mockup.underContainers.remove_collectionChanged(n._notifyUnderMockupCollectionChanged),e.mockup.underContainers.remove_collectionChanged(n._onContainerCollectionChanged),e.mockup.overContainers.remove_collectionChanged(n._notifyOverMockupCollectionChanged),e.mockup.overContainers.remove_collectionChanged(n._onContainerCollectionChanged),e.previewMockups.remove_collectionChanged(n._notifyPreviewMockupCollectionChanged);var o=Ot(e.containers,e.mockup.underContainers,e.mockup.overContainers);try{for(var r=Bt(o),a=r.next();!a.done;a=r.next()){var s=a.value;n._unsubscribeFromContainerEvents(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}e.printAreas.forEach(n._unsubscribeFromPrintAreaEvents),e.printAreas.remove_collectionChanged(n._notifyPrintAreaCollectionChanged),e.printAreas.remove_collectionChanged(n._onPrintAreaCollectionChanged)}},this._onContainerCollectionChanged=function(e){if(e.type!==Ht.a.Move)if(e.type!==Ht.a.Remove)if(e.type!==Ht.a.Add);else{t=e;n._subscribeToContainerEvents(t.item)}else{var t=e;n._unsubscribeFromContainerEvents(t.item)}},this._subscribeToContainerEvents=function(e){null!=e&&(e.items.add_collectionChanged(n._notifyItemCollectionChanged),e.items.add_collectionChanged(n._onItemCollectionChanged),e.items.add_itemAdded(n._notifyItemAdded),e.items.add_itemRemoved(n._notifyItemRemoved),e.items.add_itemMoved(n._notifyItemMoved),e.items.forEach(n._subscribeToItemEvents))},this._unsubscribeFromContainerEvents=function(e){null!=e&&(e.items.remove_collectionChanged(n._notifyItemCollectionChanged),e.items.remove_collectionChanged(n._onItemCollectionChanged),e.items.remove_itemAdded(n._notifyItemAdded),e.items.remove_itemRemoved(n._notifyItemRemoved),e.items.remove_itemMoved(n._notifyItemMoved),e.items.forEach(n._unsubscribeFromItemEvents))},this._onPrintAreaCollectionChanged=function(e){if(e.type!==Ht.a.Move)if(e.type!==Ht.a.Remove)if(e.type!==Ht.a.Add);else{t=e;n._subscribeToPrintAreaEvents(t.item)}else{var t=e;n._unsubscribeFromPrintAreaEvents(t.item)}},this._subscribeToPrintAreaEvents=function(e){null!=e&&e.addPropertyChanged(n._notifyPrintAreaPropertyChanged)},this._unsubscribeFromPrintAreaEvents=function(e){null!=e&&e.removePropertyChanged(n._notifyPrintAreaPropertyChanged)},this._onItemCollectionChanged=function(e){if(e.type!==Ht.a.Move)if(e.type!==Ht.a.Remove)if(e.type!==Ht.a.Add);else{t=e;n._subscribeToItemEvents(t.item)}else{var t=e;n._unsubscribeFromItemEvents(t.item)}},this._subscribeToItemEvents=function(e){null!=e&&e instanceof H.GroupItem&&(e.items.forEach(function(e){return n._subscribeToItemEvents(e)}),e.items.add_itemAdded(n._notifyItemAdded),e.items.add_itemRemoved(n._notifyItemRemoved),e.items.add_collectionChanged(n._onItemCollectionChanged))},this._subscribeToItemHandlerEvents=function(e){var t,i;if(e.addItemPropertyChanged(n._notifyItemPropertyChanged),e.addChanged(n._notifyItemChanged),e.addDeleteToolbarButtonClick(n._notifyDeleteToolbarButtonClick),e.addSelectToolbarButtonClick(n._notifySelectToolbarButtonClick),e.addEditToolbarButtonClick(n._notifyEditToolbarButtonClick),e.addDoubleClick(n._notifyDoubleClick),e.addViolationWarningButtonClick(n._notifyViolationWarningButtonClick),e instanceof R.l&&(e.addSelectButtonClick(n._notifySelectButtonClick),null!=e.content&&e.content.addItemPropertyChanged(n._notifyItemPropertyChanged)),e instanceof R.o&&e.item.getPathLoadedEvent().add(n._notifyShapePathLoaded),e instanceof R.h&&(e.enteredEditModeEvent.add(n._notifyEnteredEditMode),e.exitedEditModeEvent.add(n._notifyExitedEditMode)),e instanceof R.e)try{for(var o=Bt(e.getNestedItemHandlers()),r=o.next();!r.done;r=o.next()){var a=r.value;a instanceof R.b&&n._subscribeToItemHandlerEvents(a)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}},this._unsubscribeFromItemEvents=function(e){null!=e&&e instanceof H.GroupItem&&null!=e.items&&(e.items.forEach(function(e){return n._unsubscribeFromItemEvents(e)}),e.items.remove_itemAdded(n._notifyItemAdded),e.items.remove_itemRemoved(n._notifyItemRemoved),e.items.remove_collectionChanged(n._onItemCollectionChanged))},this._unsubscribeFromItemHandlerEvents=function(e){var t,i;if(e.removeItemPropertyChanged(n._notifyItemPropertyChanged),e.removeChanged(n._notifyItemChanged),e.removeDeleteToolbarButtonClick(n._notifyDeleteToolbarButtonClick),e.removeSelectToolbarButtonClick(n._notifySelectToolbarButtonClick),e.removeEditToolbarButtonClick(n._notifyEditToolbarButtonClick),e.removeDoubleClick(n._notifyDoubleClick),e instanceof R.l&&(e.removeSelectButtonClick(n._notifySelectButtonClick),null!=e.content&&e.content.removeItemPropertyChanged(n._notifyItemPropertyChanged)),e instanceof R.o&&e.item.getPathLoadedEvent().remove(n._notifyShapePathLoaded),e instanceof R.h&&(e.enteredEditModeEvent.remove(n._notifyEnteredEditMode),e.exitedEditModeEvent.remove(n._notifyExitedEditMode)),e instanceof R.e)try{for(var o=Bt(e.getNestedItemHandlers()),r=o.next();!r.done;r=o.next()){var a=r.value;a instanceof R.b&&n._unsubscribeFromItemHandlerEvents(a)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}},this._subscribeOnCanvasEvents=function(e){var t,i;if(null!=e){e.add_currentItemHandlerChanged(n._notifyCurrentItemChanged),e.add_selectedItemHandlerChanged(n._notifySelectedItemChanged),e.add_dragNDropDone(n._notifyDragNDropDone),e.add_dragNDropPerformed(n._notifyDragNDropPerformed),e.add_dragNDropStarting(n._notifyDragNDropStarting),e.add_ready(n._notifyReady),e.add_workspaceSizeChanged(n._notifyWorkspaceSizeChanged),e.add_beforeReplaceItemHandler(n._notifyBeforeReplaceItemHandler),e.add_afterReplaceItemHandler(n._notifyAfterReplaceItemHandler),e.layers.add_collectionChanged(n._notifyLayerCollectionChanged),e.layers.add_collectionChanged(n._onLayerCollectionChanged);try{for(var o=Bt(e.layers),r=o.next();!r.done;r=o.next()){var a=r.value;n._subscribeToLayerEvents(a)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}}},this._unsubscribeFromCanvasEvents=function(e){var t,i;if(null!=e){e.remove_currentItemHandlerChanged(n._notifyCurrentItemChanged),e.remove_selectedItemHandlerChanged(n._notifySelectedItemChanged),e.remove_dragNDropDone(n._notifyDragNDropDone),e.remove_dragNDropPerformed(n._notifyDragNDropPerformed),e.remove_dragNDropStarting(n._notifyDragNDropStarting),e.remove_ready(n._notifyReady),e.remove_workspaceSizeChanged(n._notifyWorkspaceSizeChanged),e.remove_beforeReplaceItemHandler(n._notifyBeforeReplaceItemHandler),e.remove_afterReplaceItemHandler(n._notifyAfterReplaceItemHandler),e.layers.remove_collectionChanged(n._notifyLayerCollectionChanged),e.layers.remove_collectionChanged(n._onLayerCollectionChanged);try{for(var o=Bt(e.layers),r=o.next();!r.done;r=o.next()){var a=r.value;n._unsubscribeFromLayerEvents(a)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}}},this._subscribeToLayerEvents=function(e){var t,i;if(null!=e){e.itemHandlers.add_collectionChanged(n._notifyItemHanderCollectionChanged),e.itemHandlers.add_collectionChanged(n._onItemHanderCollectionChanged);try{for(var o=Bt(e.itemHandlers.cast()),r=o.next();!r.done;r=o.next()){var a=r.value;n._subscribeToItemHandlerEvents(a)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}}},this._unsubscribeFromLayerEvents=function(e){var t,i;if(null!=e){e.itemHandlers.remove_collectionChanged(n._notifyItemHanderCollectionChanged),e.itemHandlers.remove_collectionChanged(n._onItemHanderCollectionChanged);try{for(var o=Bt(e.itemHandlers.cast()),r=o.next();!r.done;r=o.next()){var a=r.value;n._unsubscribeFromItemHandlerEvents(a)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}}},this._itemChangedEvent=new r.a,this._itemPropertyChangedEvent=new r.c,this._changeSurfaceEvent=new r.a,this._itemAddedEvent=new r.a,this._itemRemovedEvent=new r.a,this._itemMovedEvent=new r.a,this._imageContentChangedEvent=new r.a,this._snapshotLoadedEvent=new r.a,this._surfaceCollectionChangedEvent=new r.a,this._layerCollectionChangedEvent=new r.a,this._itemHanderCollectionChangedEvent=new r.a,this._containerCollectionChangedEvent=new r.a,this._itemCollectionChangedEvent=new r.a,this._underMockupContainerCollectionChangedEvent=new r.a,this._overMockupContainerCollectionChangedEvent=new r.a,this._previewMockupContainerCollectionChangedEvent=new r.a,this._deleteToolbarButtonClickEvent=new r.a,this._selectToolbarButtonClickEvent=new r.a,this._enteredEditModeEvent=new r.a,this._exitedEditModeEvent=new r.a,this._editToolbarButtonClickEvent=new r.a,this._selectButtonClickEvent=new r.a,this._violationWarningButtonClickEvent=new r.a,this._doubleClickEvent=new r.a,this._shapePathLoadedEvent=new r.a,this._currentItemChangedEvent=new r.a,this._selectedItemChangedEvent=new r.a,this._dragNDropDoneEvent=new r.a,this._dragNDropStartingEvent=new r.a,this._dragNDropPerformedEvent=new r.a,this._readyEvent=new r.a,this._workspaceSizeChangedEvent=new r.a,this._productThemeChangedEvent=new r.a,this._userEditContainerChangedEvent=new r.a,this._mouseBehaviorCreateFinishedEvent=new r.a,this._printAreaCollectionChangedEvent=new r.a,this._printAreaPropertyChangedEvent=new r.c,this._selectPixelFinishedEvent=new r.a,this._beforeReplaceItemHandlerEvent=new r.a,this._afterReplaceItemHandlerEvent=new r.a,this._subscribeOnCanvasEvents(this._viewer.canvas),this._subscribeToProductEvents(e)}return e.prototype.setProduct=function(e){e!=this._product&&(this._unsubscribeFromProductEvents(this._product),this._product=e,this._subscribeToProductEvents(this._product))},Object.defineProperty(e.prototype,"itemChangedEvent",{get:function(){return this._itemChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addItemChanged=function(e){this._itemChangedEvent.add(e)},e.prototype.removeItemChanged=function(e){this._itemChangedEvent.remove(e)},Object.defineProperty(e.prototype,"itemPropertyChangedEvent",{get:function(){return this._itemPropertyChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addItemPropertyChanged=function(e){this._itemPropertyChangedEvent.add(e)},e.prototype.removeItemPropertyChanged=function(e){this._itemPropertyChangedEvent.remove(e)},Object.defineProperty(e.prototype,"surfaceChangedEvent",{get:function(){return this._changeSurfaceEvent},enumerable:!0,configurable:!0}),e.prototype.addSurfaceChanged=function(e){this._changeSurfaceEvent.add(e)},e.prototype.removeSurfaceChanged=function(e){this._changeSurfaceEvent.remove(e)},Object.defineProperty(e.prototype,"itemAddedEvent",{get:function(){return this._itemAddedEvent},enumerable:!0,configurable:!0}),e.prototype.addItemAdded=function(e){this._itemAddedEvent.add(e)},e.prototype.removeItemAdded=function(e){this._itemAddedEvent.remove(e)},Object.defineProperty(e.prototype,"itemRemovedEvent",{get:function(){return this._itemRemovedEvent},enumerable:!0,configurable:!0}),e.prototype.addItemRemoved=function(e){this._itemRemovedEvent.add(e)},e.prototype.removeItemRemoved=function(e){this._itemRemovedEvent.remove(e)},Object.defineProperty(e.prototype,"itemMovedEvent",{get:function(){return this._itemMovedEvent},enumerable:!0,configurable:!0}),e.prototype.addItemMoved=function(e){this._itemMovedEvent.add(e)},e.prototype.removeItemMoved=function(e){this._itemMovedEvent.remove(e)},Object.defineProperty(e.prototype,"imageContentChangedEvent",{get:function(){return this._imageContentChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addImageContentChanged=function(e){this._imageContentChangedEvent.add(e)},e.prototype.removeImageContentChanged=function(e){this._imageContentChangedEvent.remove(e)},Object.defineProperty(e.prototype,"snapshotLoadedEvent",{get:function(){return this._snapshotLoadedEvent},enumerable:!0,configurable:!0}),e.prototype.addSnapshotLoadedEvent=function(e){this._snapshotLoadedEvent.add(e)},e.prototype.removeSnapshotLoadedEvent=function(e){this._snapshotLoadedEvent.remove(e)},Object.defineProperty(e.prototype,"surfaceCollectionChangedEvent",{get:function(){return this._surfaceCollectionChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addSurfaceCollectionChanged=function(e){this._surfaceCollectionChangedEvent.add(e)},e.prototype.removeSurfaceCollectionChanged=function(e){this._surfaceCollectionChangedEvent.remove(e)},Object.defineProperty(e.prototype,"layerCollectionChangedEvent",{get:function(){return this._layerCollectionChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addLayerCollectionChanged=function(e){this._layerCollectionChangedEvent.add(e)},e.prototype.removeLayerCollectionChanged=function(e){this._layerCollectionChangedEvent.remove(e)},Object.defineProperty(e.prototype,"itemHanderCollectionChangedEvent",{get:function(){return this._itemHanderCollectionChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addIItemHandelrCollectionChanged=function(e){this._itemHanderCollectionChangedEvent.add(e)},e.prototype.removeItemHandlerCollectionChanged=function(e){this._itemHanderCollectionChangedEvent.remove(e)},Object.defineProperty(e.prototype,"containerCollectionChangedEvent",{get:function(){return this._containerCollectionChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addContainerCollectionChanged=function(e){this._containerCollectionChangedEvent.add(e)},e.prototype.removeContainerCollectionChanged=function(e){this._containerCollectionChangedEvent.remove(e)},Object.defineProperty(e.prototype,"itemCollectionChangedEvent",{get:function(){return this._itemCollectionChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addItemCollectionChanged=function(e){this._itemCollectionChangedEvent.add(e)},e.prototype.removeItemCollectionChanged=function(e){this._itemCollectionChangedEvent.remove(e)},Object.defineProperty(e.prototype,"underMockupContainerCollectionChangedEvent",{get:function(){return this._underMockupContainerCollectionChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addUnderMockupContainerCollectionChanged=function(e){this._underMockupContainerCollectionChangedEvent.add(e)},e.prototype.removeUnderMockupContainerCollectionChanged=function(e){this._underMockupContainerCollectionChangedEvent.remove(e)},Object.defineProperty(e.prototype,"overMockupContainerCollectionChangedEvent",{get:function(){return this._overMockupContainerCollectionChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addOverMockupContainerCollectionChanged=function(e){this._overMockupContainerCollectionChangedEvent.add(e)},e.prototype.removeOverMockupContainerCollectionChanged=function(e){this._overMockupContainerCollectionChangedEvent.remove(e)},Object.defineProperty(e.prototype,"previewMockupContainerCollectionChangedEvent",{get:function(){return this._previewMockupContainerCollectionChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addPreviewMockupContainerCollectionChanged=function(e){this._previewMockupContainerCollectionChangedEvent.add(e)},e.prototype.removePreviewMockupContainerCollectionChanged=function(e){this._previewMockupContainerCollectionChangedEvent.remove(e)},Object.defineProperty(e.prototype,"deleteToolbarButtonClickEvent",{get:function(){return this._deleteToolbarButtonClickEvent},enumerable:!0,configurable:!0}),e.prototype.addDeleteToolbarButtonClick=function(e){this._deleteToolbarButtonClickEvent.add(e)},e.prototype.removeDeleteToolbarButtonClick=function(e){this._deleteToolbarButtonClickEvent.remove(e)},Object.defineProperty(e.prototype,"selectToolbarButtonClickEvent",{get:function(){return this._selectToolbarButtonClickEvent},enumerable:!0,configurable:!0}),e.prototype.addSelectToolbarButtonClick=function(e){this._selectToolbarButtonClickEvent.add(e)},e.prototype.removeSelectToolbarButtonClick=function(e){this._selectToolbarButtonClickEvent.remove(e)},Object.defineProperty(e.prototype,"enteredEditModeEvent",{get:function(){return this._enteredEditModeEvent},enumerable:!0,configurable:!0}),e.prototype.addEnteredEditMode=function(e){this._enteredEditModeEvent.add(e)},e.prototype.removeEnteredEditMode=function(e){this._enteredEditModeEvent.remove(e)},Object.defineProperty(e.prototype,"exitedEditModeEvent",{get:function(){return this._exitedEditModeEvent},enumerable:!0,configurable:!0}),e.prototype.addExitedEditMode=function(e){this._exitedEditModeEvent.add(e)},e.prototype.removeExitedEditMode=function(e){this._exitedEditModeEvent.remove(e)},Object.defineProperty(e.prototype,"editToolbarButtonClickEvent",{get:function(){return this._editToolbarButtonClickEvent},enumerable:!0,configurable:!0}),e.prototype.addEditToolbarButtonClick=function(e){this._editToolbarButtonClickEvent.add(e)},e.prototype.removeEditToolbarButtonClick=function(e){this._editToolbarButtonClickEvent.remove(e)},Object.defineProperty(e.prototype,"selectButtonClickEvent",{get:function(){return this._selectButtonClickEvent},enumerable:!0,configurable:!0}),e.prototype.addSelectButtonClick=function(e){this._selectButtonClickEvent.add(e)},e.prototype.removeSelectButtonClick=function(e){this._selectButtonClickEvent.remove(e)},Object.defineProperty(e.prototype,"violationWarningButtonClickEvent",{get:function(){return this._violationWarningButtonClickEvent},enumerable:!0,configurable:!0}),e.prototype.addViolationWarningButtonClick=function(e){this._violationWarningButtonClickEvent.add(e)},e.prototype.removeViolationWarningButtonClick=function(e){this._violationWarningButtonClickEvent.remove(e)},Object.defineProperty(e.prototype,"doubleClickEvent",{get:function(){return this._doubleClickEvent},enumerable:!0,configurable:!0}),e.prototype.addDoubleClick=function(e){this._doubleClickEvent.add(e)},e.prototype.removeDoubleClick=function(e){this._doubleClickEvent.remove(e)},Object.defineProperty(e.prototype,"shapePathLoadedEvent",{get:function(){return this._shapePathLoadedEvent},enumerable:!0,configurable:!0}),e.prototype.addShapePathLoaded=function(e){this._shapePathLoadedEvent.add(e)},e.prototype.removeShapePathLoaded=function(e){this._shapePathLoadedEvent.remove(e)},Object.defineProperty(e.prototype,"currentItemChangedEvent",{get:function(){return this._currentItemChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addCurrentItemChanged=function(e){this._currentItemChangedEvent.add(e)},e.prototype.removeCurrentItemChanged=function(e){this._currentItemChangedEvent.remove(e)},Object.defineProperty(e.prototype,"selectedItemChangedEvent",{get:function(){return this._selectedItemChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addSelectedItemChanged=function(e){this._selectedItemChangedEvent.add(e)},e.prototype.removeSelectedItemChanged=function(e){this._selectedItemChangedEvent.remove(e)},Object.defineProperty(e.prototype,"dragNDropDoneEvent",{get:function(){return this._dragNDropDoneEvent},enumerable:!0,configurable:!0}),e.prototype.addDragNDropDone=function(e){this._dragNDropDoneEvent.add(e)},e.prototype.removeDragNDropDone=function(e){this._dragNDropDoneEvent.remove(e)},Object.defineProperty(e.prototype,"dragNDropStartingEvent",{get:function(){return this._dragNDropStartingEvent},enumerable:!0,configurable:!0}),e.prototype.addDragNDropStarting=function(e){this._dragNDropStartingEvent.add(e)},e.prototype.removeDragNDropStarting=function(e){this._dragNDropStartingEvent.remove(e)},Object.defineProperty(e.prototype,"dragNDropPerformedEvent",{get:function(){return this._dragNDropPerformedEvent},enumerable:!0,configurable:!0}),e.prototype.addDragNDropPerformed=function(e){this._dragNDropPerformedEvent.add(e)},e.prototype.removeDragNDropPerformed=function(e){this._dragNDropPerformedEvent.remove(e)},Object.defineProperty(e.prototype,"readyEvent",{get:function(){return this._readyEvent},enumerable:!0,configurable:!0}),e.prototype.addReady=function(e){this._readyEvent.add(e)},e.prototype.removeReady=function(e){this._readyEvent.remove(e)},Object.defineProperty(e.prototype,"workspaceSizeChangedEvent",{get:function(){return this._workspaceSizeChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addWorkspaceSizeChanged=function(e){this._workspaceSizeChangedEvent.add(e)},e.prototype.removeWorkspaceSizeChanged=function(e){this._workspaceSizeChangedEvent.remove(e)},Object.defineProperty(e.prototype,"productThemeChangedEvent",{get:function(){return this._productThemeChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addProductThemeChanged=function(e){this._productThemeChangedEvent.add(e)},e.prototype.removeProductThemeChanged=function(e){this._productThemeChangedEvent.remove(e)},Object.defineProperty(e.prototype,"userEditContainerChangedEvent",{get:function(){return this._userEditContainerChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addUserEditContainerChanged=function(e){this._userEditContainerChangedEvent.add(e)},e.prototype.removeUserEditContainerChanged=function(e){this._userEditContainerChangedEvent.remove(e)},Object.defineProperty(e.prototype,"mouseBehaviorCreateFinishedEvent",{get:function(){return this._mouseBehaviorCreateFinishedEvent},enumerable:!0,configurable:!0}),e.prototype.addMouseBehaviorCreateFinished=function(e){this._mouseBehaviorCreateFinishedEvent.add(e)},e.prototype.removeMouseBehaviorCreateFinished=function(e){this._mouseBehaviorCreateFinishedEvent.remove(e)},Object.defineProperty(e.prototype,"printAreaCollectionChangedEvent",{get:function(){return this._printAreaCollectionChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addPrintAreaCollectionChanged=function(e){this._printAreaCollectionChangedEvent.add(e)},e.prototype.removePrintAreaCollectionChanged=function(e){this._printAreaCollectionChangedEvent.remove(e)},Object.defineProperty(e.prototype,"printAreaPropertyChangedEvent",{get:function(){return this._printAreaPropertyChangedEvent},enumerable:!0,configurable:!0}),e.prototype.addPrintAreaPropertyChanged=function(e){this._printAreaPropertyChangedEvent.add(e)},e.prototype.removePrintAreaPropertyChanged=function(e){this._printAreaPropertyChangedEvent.remove(e)},Object.defineProperty(e.prototype,"selectPixelFinished",{get:function(){return this._selectPixelFinishedEvent},enumerable:!0,configurable:!0}),e.prototype.addMouseSelectPixelFinished=function(e){this._selectPixelFinishedEvent.add(e)},e.prototype.removeMouseSelectPixelFinished=function(e){this._selectPixelFinishedEvent.remove(e)},Object.defineProperty(e.prototype,"beforeReplaceItemHandlerEvent",{get:function(){return this._beforeReplaceItemHandlerEvent},enumerable:!0,configurable:!0}),e.prototype.addBeforeReplaceItemHandlerEvent=function(e){this._beforeReplaceItemHandlerEvent.add(e)},e.prototype.removeBeforeReplaceItemHandlerEvent=function(e){this._beforeReplaceItemHandlerEvent.remove(e)},Object.defineProperty(e.prototype,"afterReplaceItemHandlerEvent",{get:function(){return this._afterReplaceItemHandlerEvent},enumerable:!0,configurable:!0}),e.prototype.addAfterReplaceItemHandlerEvent=function(e){this._afterReplaceItemHandlerEvent.add(e)},e.prototype.removeAfterReplaceItemHandlerEvent=function(e){this._afterReplaceItemHandlerEvent.remove(e)},e.prototype.dispose=function(){this._unsubscribeFromCanvasEvents(this._viewer.canvas),this._unsubscribeFromProductEvents(this._product)},e}(),Lt=n(583),Ft=function(){function e(e,t,n,i){this._productHandler=e,this._canvas=n,this._eventManager=i,this._productThemeApplier=new Lt.a,this.productThemes=t}return e.prototype.applyProductTheme=function(e,t,n){var i=this,o=null;if("string"==typeof e)o=this.productThemes[e];else if(e instanceof At)o=e;else if(e instanceof Object)o=new At(e);else if(null==e)throw new C.a("Theme must be not null");if(null==o)throw new C.a("Theme not found");var r=t.getAllItems({ignoreMockups:!1,flatGroupItems:!0}).filter(function(e){return!(e.parentGroupItem instanceof H.ClipartItem)}),a=[];return this.currentProductTheme=o,n.execute(F.d.clearSelection),r.forEach(function(e){e instanceof H.Item&&i.applyToItem(e,o)&&a.push(e)}),a.length>0&&L.a.updateItems(a,this._productHandler,this._canvas,{addToHistory:!0,redraw:!0,updatePhase:L.b.Final}),0===a.length&&console.warn("No colors were applied from theme. Please check that theme matches to the product."),this._eventManager.productThemeChangedEvent.notify(this.currentProductTheme),a.length>0},e.prototype.applyToItem=function(e,t,n){return this._productThemeApplier.applyToItem(e,t,n)},e}(),At=function(){return function(e){Object.assign(this,e)}}(),Wt=function(){function e(e,t){void 0===t&&(t=10),this._snapshots=[],this._current=-1,this._enabled=!0,this._locked=!1,this._pauseCount=0,this._addSnapshotOnResume=!1,this._overflowMaxUndoStepCount=!1,this._changed=new r.a,this._snapshotHandler=e,this.historySize=t}return Object.defineProperty(e.prototype,"historySize",{set:function(e){e>=0?this._maxUndoStepCount=e:(console.warn("History: historySize value isn't correct, reset to 10"),this._maxUndoStepCount=10)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canRedo",{get:function(){return this._current<this._snapshots.length-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canUndo",{get:function(){return this._current>=1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"overflowMaxUndoStepCount",{get:function(){return this._overflowMaxUndoStepCount},enumerable:!0,configurable:!0}),e.prototype.enable=function(){this._enabled||(this._enabled=!0)},e.prototype.disable=function(){this._enabled&&(this._enabled=!1,this.clear())},e.prototype.isPaused=function(){return this._pauseCount>0},e.prototype.pause=function(){this._pauseCount++,1===this._pauseCount&&(this._addSnapshotOnResume=!1)},e.prototype.resume=function(e,t,n){void 0===e&&(e=!0),void 0===t&&(t=!1),void 0===n&&(n=!1),this._pauseCount<=0||(this._pauseCount--,0===this._pauseCount&&(e&&this._addSnapshotOnResume||t)&&this.addSnapshot(!1,n))},e.prototype.raiseChanged=function(){this._changed.notify()},e.prototype._clearRedo=function(){this._snapshots.splice(this._current+1)},e.prototype._clearUndo=function(){this._snapshots.splice(0,this._current+1),this._current=-1,this._overflowMaxUndoStepCount=!1},e.prototype.clear=function(e){void 0===e&&(e=!1),this._snapshots=[],this._current=-1,this.addSnapshot(!0),e||this.raiseChanged()},e.prototype.addSnapshot=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),this._enabled&&!this._locked)if(this._pauseCount>0)this._addSnapshotOnResume=!0;else{var n=this._snapshotHandler.createSnapshot();if(null==n)throw"Snapshot can not be null";this._locked=!0,this.canRedo&&this._clearRedo(),t&&this._snapshots.length>0&&(this._snapshots.pop(),this._current--),this._snapshots.push(n),this._current++,this._locked=!1,this._current>this._maxUndoStepCount&&(this._snapshots.splice(0,1),this._current--,this._overflowMaxUndoStepCount=!0),e||this.raiseChanged()}},e.prototype.redo=function(){if(this._enabled&&this.canRedo){this._locked=!0,this._current++;var e=this._snapshots[this._current];this._snapshotHandler.loadSnapshot(e),this._locked=!1,this.raiseChanged()}},e.prototype.undo=function(){if(this._enabled&&this.canUndo){this._locked=!0,this._current--;var e=this._snapshots[this._current];this._snapshotHandler.loadSnapshot(e),this._locked=!1,this.raiseChanged()}},e.prototype.addChanged=function(e){this._changed.add(e)},e.prototype.removeChanged=function(e){this._changed.remove(e)},e}(),jt=function(){function e(e){this._viewer=e}return Object.defineProperty(e.prototype,"_product",{get:function(){return null!=this._surface?this._surface.parentProduct:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_surface",{get:function(){return this._viewer.surface},enumerable:!0,configurable:!0}),e.prototype.createSnapshot=function(){var e=null!=this._product?this._product:this._surface;if(null!=e)return e.clone()},e.prototype.loadSnapshot=function(e){var t=e.clone();if(t instanceof Pe.Surface)throw new C.e("Surface as snapshot not implemented!");var n=this._surface.id,i=t.surfaces.firstOrDefault(function(e){return e.id===n});this._viewer.surface=null!=i?i:t.surfaces.get(0),this._viewer.eventManager.snapshotLoadedEvent.fire(t)},e}(),Vt=function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}l((i=i.apply(e,t||[])).next())})},Gt=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},Nt=function(){function e(e){var t=this;this._viewer=e,this.getHandler=function(e){return t._viewer.getHandler(e)}}return Object.defineProperty(e.prototype,"currentSurface",{get:function(){return this._viewer.surface},set:function(e){this._viewer.surface=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentAngle",{get:function(){return this._viewer.contentAngle},enumerable:!0,configurable:!0}),e.prototype.redraw=function(){this._viewer.canvas.redraw()},Object.defineProperty(e.prototype,"regionForCurrentContainer",{get:function(){var e=this._viewer.userEditContainer;return null!=e?e.region:null},enumerable:!0,configurable:!0}),e.prototype.beginMultiCall=function(){null!=this._viewer&&null!=this._viewer.canvas&&null!=this._viewer.canvas.service&&this._viewer.canvas.service.beginMultiCall()},e.prototype.endMultiCall=function(){null!=this._viewer&&null!=this._viewer.canvas&&null!=this._viewer.canvas.service&&this._viewer.canvas.service.endMultiCall()},e.prototype.findItemByHitTest=function(e,t){var n=this,i=this._viewer.pageToWorkspacePoint(e,t),o=this._viewer.canvas.getItemHandlersByHitTest(i),r=o.find(function(e){return n._viewer.canvas.isItemHandlerSelected(e)});return null!=r?r.item:null!=o[0]?o[0].item:null},e.prototype.waitUpdate=function(){return Vt(this,void 0,void 0,function(){return Gt(this,function(e){switch(e.label){case 0:return[4,this._viewer.canvas.waitUpdate()];case 1:return[2,e.sent()]}})})},Object.defineProperty(e.prototype,"product",{get:function(){var e=this.currentSurface;return null==e?null:e.parentProduct},enumerable:!0,configurable:!0}),e.prototype.checkSelectionByHitTest=function(e,t){var n=this._viewer.pageToWorkspacePoint(e,t);return this._viewer.canvas.isSelectionByHitTest(n)},Object.defineProperty(e.prototype,"selectedItems",{get:function(){return this._viewer.canvas.getSelectedItemHandlers().toArray().map(function(e){return e.item})},enumerable:!0,configurable:!0}),e.prototype.getPrintAreaVisualSize=function(e,t){var n=this.getPrintAreaBounds(e,t);return this.getVisualSize(n)},e.prototype.getVisualSize=function(e){var t=this._viewer.contentAngle;if(0===t)return Ue.a.from(e);var n=new f.RotatedRectangleF(0,0,e.width,e.height);return n.rotateAt(t,new f.PointF),Ue.a.from(n.bounds)},e.prototype.getPrintAreaBounds=function(e,t){var n=null!==e&&void 0!==e?e:this._viewer.userEditContainer,i=null!==t&&void 0!==t?t:this._viewer.getUserEditPrintArea();return null!=n.region?n.region:i.bounds},Object.defineProperty(e.prototype,"userEditContainer",{get:function(){return this._viewer.userEditContainer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userEditPrintArea",{get:function(){return this._viewer.getUserEditPrintArea()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"suppressOutOfRegionManipulation",{get:function(){return this._viewer.canvas.suppressOutOfRegionManipulation},enumerable:!0,configurable:!0}),e.prototype.updateSelection=function(){null!=this._viewer.canvas&&this._viewer.canvas.updateSelection()},e.prototype.replaceItem=function(e,t){var n,i=e.parentGroupItem,o=e.parentContainer,r=null===(n=null!==i&&void 0!==i?i:o)||void 0===n?void 0:n.items;if(null!=r){var a=r.indexOf(e);r.replaceAt(t,a),t.parentContainer=o,t.parentGroupItem=i,null!=this._viewer.canvas&&this._viewer.canvas.handlerFactory.replaceItemHandler(e,t)}},e}(),Ut=n(434),qt=function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}l((i=i.apply(e,t||[])).next())})},Yt=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},Xt=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},Zt=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Xt(arguments[t]));return e},Kt=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Qt=function(){function e(e,t,n){var i=this;this._productHandler=e,this._canvas=t,this._productThemeManager=n,this._applyToBarcode=function(e,t,n){return qt(i,void 0,void 0,function(){var i;return Yt(this,function(o){return this._applyBarcodePermissions(t.barcodePermissions,e.barcodePermissions),null==t.barcodeContent||!e.barcodePermissions.allowChangeBarcodeContent&&n.ignorePermissions||!e.barcodeData.isEmpty||(i=new H.BarcodeData(t.barcodeContent),e.barcodePermissions.allowChangeBarcodeType&&!n.ignorePermissions&&(i.barcodeFormat=e.barcodeFormat),i.barcodeFormat===H.BarcodeFormat.QR_CODE&&i.barcodeSubType===H.BarcodeSubType.None&&(i.barcodeSubType=H.BarcodeSubType.Url),e.applyBarcodeData(i)),null!=t.color&&(n.ignorePermissions||e.barcodePermissions.allowChangeBarcodeColor)&&(e.color=ne.ColorFactory.createColor(t.color)),[2,this._applyToContentItem(e,t,n)]})})},this._applyToImage=function(e,t,n){return qt(i,void 0,void 0,function(){var i,o,r;return Yt(this,function(a){switch(a.label){case 0:return null==t?[3,3]:(this._applyImagePermissions(t.imagePermissions,e.imagePermissions),e.violationSettings.allowImageQuality=null!==(r=null===(o=t.violationSettings)||void 0===o?void 0:o.allowImageQuality)&&void 0!==r?r:e.violationSettings.allowImageQuality,null==t.imageUrl||!n.ignorePermissions&&!e.imagePermissions.allowChangeImage?[3,2]:((i=this._productHandler.getHandler(e)).canvas=this._canvas,[4,i.loadImage(t.imageUrl,{downloadToServerCache:!0,actualSize:!1,saveAspectRatio:!0})]));case 1:a.sent(),a.label=2;case 2:if(null!=t.overlayColor&&L.a.setOverlayEffectColor(e,ne.ColorFactory.createColor(t.overlayColor)),null!=t.effect)switch(t.effect.toLowerCase()){case"none":e.effect=H.ImageEffect.None;break;case"blackandwhite":e.effect=H.ImageEffect.BlackAndWhite;break;case"flipvertical":e.effect=H.ImageEffect.FlipVertical;break;case"fliphorizontal":e.effect=H.ImageEffect.FlipHorizontal;break;case"colorize":e.effect=H.ImageEffect.Colorize;break;default:console.error("Unknown image effect:",t.effect)}a.label=3;case 3:return[2,this._applyToContentItem(e,t,n)]}})})},this._applyImagePermissions=function(e,t){null!=e&&(t.allowChangeImage=Te.a(t.allowChangeImage,e.allowChangeImage),t.allowEditImage=Te.a(t.allowEditImage,e.allowEditImage),t.allowKeepOverlayColor=Te.a(t.allowKeepOverlayColor,e.allowKeepOverlayColor))},this._applyBarcodePermissions=function(e,t){null!=e&&(t.allowChangeBarcodeType=Te.a(t.allowChangeBarcodeType,e.allowChangeBarcodeType),t.allowChangeBarcodeContent=Te.a(t.allowChangeBarcodeContent,e.allowChangeBarcodeContent),t.allowChangeBarcodeColor=Te.a(t.allowChangeBarcodeColor,e.allowChangeBarcodeColor))},this._updateThemeForItem=function(e){i._productThemeManager.applyToItem(e,i._productThemeManager.currentProductTheme)}}return e.prototype.applyToItem=function(e,t,n){return void 0===n&&(n=null),qt(this,void 0,void 0,function(){var i,o,r;return Yt(this,function(a){switch(a.label){case 0:return null==t?[2]:(i=Object.assign({ignorePermissions:!0,changePosition:!1,relativeToPrintArea:!0},n||{}),o=!1,r=function(){return o=!0},e.addPropertyChanged(r),e instanceof H.PlaceholderItem?[4,this._applyToPlaceholderItem(e,t,i)]:[3,2]);case 1:return a.sent(),[3,20];case 2:return e instanceof H.ImageItem?[4,this._applyToImage(e,t,i)]:[3,4];case 3:return a.sent(),[3,20];case 4:return e instanceof H.BaseTextItem?[4,this._applyToText(e,t,i)]:[3,6];case 5:return a.sent(),[3,20];case 6:return e instanceof H.BarcodeItem?[4,this._applyToBarcode(e,t,i)]:[3,8];case 7:return a.sent(),[3,20];case 8:return e instanceof H.EllipseItem?[4,this._applyToEllipse(e,t,i)]:[3,10];case 9:return a.sent(),[3,20];case 10:return e instanceof H.RectangleItem?[4,this._applyToRectangle(e,t,i)]:[3,12];case 11:return a.sent(),[3,20];case 12:return e instanceof H.ShapeItem?[4,this._applyToShapeItem(e,t,i)]:[3,14];case 13:return a.sent(),[3,20];case 14:return e instanceof H.LineItem?[4,this._applyToLineItem(e,t,i)]:[3,16];case 15:return a.sent(),[3,20];case 16:return e instanceof H.ClipartItem?[4,this._applyToClipartItem(e,t,i)]:[3,18];case 17:return a.sent(),[3,20];case 18:return e instanceof H.GroupItem?[4,this._applyToGroupItem(e,t,i)]:[3,20];case 19:a.sent(),a.label=20;case 20:return e.removePropertyChanged(r),o&&null!=this._productHandler.product&&this._productHandler.product.getAllItems().includes(e)&&(this._productHandler.getHandler(e).update(),this._canvas.redraw(),this._canvas.updateSelection()),[2,o]}})})},e.prototype._applyToText=function(e,t,n){if(null!=t){if(null!=t.textPermissions&&(e.textPermissions.allowChangeText=Te.a(e.textPermissions.allowChangeText,t.textPermissions.allowChangeText),e.textPermissions.allowChangeFont=Te.a(e.textPermissions.allowChangeFont,t.textPermissions.allowChangeFont),e.textPermissions.allowChangeFontSize=Te.a(e.textPermissions.allowChangeFontSize,t.textPermissions.allowChangeFontSize),e.textPermissions.allowChangeFontColor=Te.a(e.textPermissions.allowChangeFontColor,t.textPermissions.allowChangeFontColor),e.textPermissions.allowChangeTextAlignment=Te.a(e.textPermissions.allowChangeTextAlignment,t.textPermissions.allowChangeTextAlignment),e.textPermissions.allowChangeTextBIU=Te.a(e.textPermissions.allowChangeTextBIU,t.textPermissions.allowChangeTextBIU),e.textPermissions.allowChangeShadow=Te.a(e.textPermissions.allowChangeShadow,t.textPermissions.allowChangeShadow),e.textPermissions.allowChangeStroke=Te.a(e.textPermissions.allowChangeStroke,t.textPermissions.allowChangeStroke),e.textPermissions.allowTextFormatting=Te.a(e.textPermissions.allowTextFormatting,t.textPermissions.allowTextFormatting)),(e instanceof H.PlainTextItem||e instanceof H.BoundedTextItem||e instanceof H.PathBoundedTextItem)&&(e.isVertical=Te.a(e.isVertical,t.isVertical)),e instanceof H.CurvedTextItem||e instanceof H.ArchedTextItem||(e.maxLineCount=Te.a(e.maxLineCount,t.maxLineCount)),e.maxLineLength=Te.a(e.maxLineLength,t.maxLineLength),(e instanceof H.BoundedTextItem||e instanceof H.PathBoundedTextItem)&&(e.wrappingMargin=Te.a(e.wrappingMargin,t.wrappingMargin),e.characterLimit=Te.a(e.characterLimit,t.characterLimit),null!=t.paragraphSettings)){var i=new H.ParagraphSettings(e.paragraphSettings);i.FirstLineIndent=Te.a(i.FirstLineIndent,t.paragraphSettings.firstLineIndent),i.SpaceBefore=Te.a(i.SpaceBefore,t.paragraphSettings.spaceBefore),i.SpaceAfter=Te.a(i.SpaceAfter,t.paragraphSettings.spaceAfter),i.LeftIndent=Te.a(i.LeftIndent,t.paragraphSettings.leftIndent),i.RightIndent=Te.a(i.RightIndent,t.paragraphSettings.rightIndent),e.paragraphSettings=i}if(e instanceof H.BoundedTextItem){if(null!=t.verticalAlignment)if("string"==typeof t.verticalAlignment)switch(t.verticalAlignment.toLowerCase()){case"top":e.verticalAlignment=H.TextVerticalAlignment.Top;break;case"center":e.verticalAlignment=H.TextVerticalAlignment.Center;break;case"bottom":e.verticalAlignment=H.TextVerticalAlignment.Bottom}else e.verticalAlignment=t.verticalAlignment;var o=this._convertOverflowStrategy(t.overflowStrategy);e.overflowStrategy=Te.a(e.overflowStrategy,o),e.shrinkMode=Te.a(e.shrinkMode,this._convertShrinkMode(t.textShrinkMode))}e instanceof H.ArchedTextItem&&(e.bend=Te.a(e.bend,t.bend),e.warp=Te.a(e.warp,t.warp))}return this._applyToBaseTextItem(e,t,n)},e.prototype._convertShrinkMode=function(e){if(null==e)return null;if("number"==typeof e)return e;switch(e){case"scale":return H.ShrinkMode.Scale;case"size":return H.ShrinkMode.Size;default:throw new C.a("Invalid shrink mode.")}},e.prototype._convertOverflowStrategy=function(e){if(null==e)return null;if("number"==typeof e)return e;switch(e){case"clip":return H.OverflowStrategy.Clip;case"fitToWidth":return H.OverflowStrategy.FitToWidth;case"fitToBox":return H.OverflowStrategy.FitToBox;case"expandBox":return H.OverflowStrategy.ExpandBox;default:throw new C.a("Invalid overflow strategy.")}},e.prototype._applyToLineItem=function(e,t,n){null!=t.linePermissions&&(e.linePermissions.allowChangeLineColor=Te.a(e.linePermissions.allowChangeLineColor,t.linePermissions.allowChangeLineColor),e.linePermissions.allowChangeLineWidth=Te.a(e.linePermissions.allowChangeLineWidth,t.linePermissions.allowChangeLineWidth));var i=this._productHandler.userEditContainer,o=this._productHandler.userEditPrintArea,r=null!=o?o.bounds.center:new f.PointF(50,50),a=null!=i?.4*this._productHandler.getPrintAreaVisualSize(i).width:10;if(n.ignorePermissions||e.linePermissions.allowChangeLineWidth){var s=Te.a(e.width,t.width);if(null!=i&&null!=i.region&&this._productHandler.suppressOutOfRegionManipulation){var l=this._calcNewGroupBounds(this._productHandler.selectedItems,s);Object(Ue.h)(f.RectangleF.intersect(i.region,l),l)&&(e.width=s)}else e.width=s;e.fixedWidth=Te.a(e.fixedWidth,t.fixedWidth)}if(n.changePosition&&(null!=t.point0?(e.sourcePoint0.x=Te.a(e.sourcePoint0.x,t.point0.x),e.sourcePoint0.y=Te.a(e.sourcePoint0.y,t.point0.y)):e.sourcePoint0=new f.PointF(r.x-a/2,r.y),null!=t.point1?(e.sourcePoint1.x=Te.a(e.sourcePoint1.x,t.point1.x),e.sourcePoint1.y=Te.a(e.sourcePoint1.y,t.point1.y)):e.sourcePoint1=new f.PointF(r.x+a/2,r.y)),null!=t.color&&(n.ignorePermissions||e.linePermissions.allowChangeLineColor)){var c=ne.ColorFactory.createColor(t.color);e.color=Te.a(e.color,c)}null!=t.overprintStroke&&(e.overprintStroke=t.overprintStroke);var u=this._productHandler.contentAngle;u>0&&e.transform.rotate(-u);var h=e.width+.01,d=null!=i?this._getRotatedRegion(i):null;if(null!=d){d.width-=h,d.height-=h;var p=1,g=this._productHandler.getHandler(e),_=e instanceof H.PlaceholderItem?g.getBoundsIncludingFrames():g.bounds;if(_.width>d.width||_.height>d.height){var v=Object(Ue.f)(Ue.a.from(_),Ue.a.from(d));v.width*=.9,v.height*=.9,p=v.width/_.width}var m=new f.PointF(_.left+_.width/2,_.top+_.height/2),y=m.x-d.left-d.width/2,b=m.y-d.top-d.height/2;e.transform.setScaleX(p*e.transform.scaleX),e.transform.setScaleY(p*e.transform.scaleY),e.transform.setTranslateX(e.transform.translateX-y-(g.getTransformedRectangle().centerX-m.x)*(1-p)),e.transform.setTranslateY(e.transform.translateY-b-(g.getTransformedRectangle().centerY-m.y)*(1-p))}this._applyToItem(e,t,n)},e.prototype._applyToRectangle=function(e,t,n){this._applyToShapeItem(e,t,n)},e.prototype._applyToGroupItem=function(e,t,n){this._applyToItem(e,t,n)},e.prototype._applyToEllipse=function(e,t,n){this._applyToShapeItem(e,t,n)},e.prototype._applyToClipartItem=function(e,t,n){this._applyToItem(e,t,n)},e.prototype._applyToPlaceholderItem=function(e,t,n){var i,o,r,a;return qt(this,void 0,void 0,function(){var s,l,c,u,h,d,p;return Yt(this,function(g){switch(g.label){case 0:if(null!=t.placeholderPermissions&&(e.placeholderPermissions.allowEditContent=Te.a(e.placeholderPermissions.allowEditContent,t.placeholderPermissions.allowEditContent),e.placeholderPermissions.showSelectButton=Te.a(e.placeholderPermissions.showSelectButton,t.placeholderPermissions.showSelectButton),e.placeholderPermissions.showHandleButton=Te.a(e.placeholderPermissions.showHandleButton,t.placeholderPermissions.showHandleButton)),e.violationSettings.allowImageQuality=null!==(o=null===(i=t.violationSettings)||void 0===i?void 0:i.allowImageQuality)&&void 0!==o?o:e.violationSettings.allowImageQuality,null!=t.contentResizeMode)switch(t.contentResizeMode.toLowerCase()){case"original":e.contentResizeMode=H.ResizeMode.Original;break;case"fill":e.contentResizeMode=H.ResizeMode.Fill;break;case"fit":e.contentResizeMode=H.ResizeMode.Fit}return e.isStubContent=Te.a(e.isStubContent,t.isStubContent),e.allowedSubfolder=Te.a(e.allowedSubfolder,t.allowedSubfolder),e.allowedTabs=Te.a(e.allowedTabs,t.allowedTabs),e.isVariable=Te.a(e.isVariable,t.isVariable),e.isCoverMode=Te.a(e.isCoverMode,t.isCoverMode),e.fixedStubContentSize=Te.a(e.fixedStubContentSize,t.fixedStubContentSize),s=null!==(r=t.barcodeFormat)&&void 0!==r?r:null===(a=t.barcodeContent)||void 0===a?void 0:a.barcodeFormat,e.barcodeFormat=Te.a(e.barcodeFormat,s),null==e.content&&(l=void 0,null!=t.contentImageUrl?l=new H.ImageItem:e.isBarcodePlaceholder&&(c=e.barcodeFormat==H.BarcodeFormat.QR_CODE||e.barcodeFormat==H.BarcodeFormat.DATA_MATRIX,l=new H.BarcodeItem(null,null,null,new f.RectangleF(0,0,c?1:2.5,1))),e.content=l),null==e.content?[3,5]:((u=O.clone(n)).changePosition=!1,e.content instanceof H.ImageItem?(h={imageUrl:t.contentImageUrl,imagePermissions:e.contentPermissions.imagePermissions},[4,this._applyToImage(e.content,h,u)]):[3,2]);case 1:return g.sent(),[3,4];case 2:return e.content instanceof H.BarcodeItem?[4,this._applyToBarcode(e.content,{barcodeContent:t.barcodeContent||{barcodeFormat:e.barcodeFormat,barcodeValue:""},barcodePermissions:e.contentPermissions.barcodePermissions,color:t.contentBarcodeColor},u)]:[3,4];case 3:g.sent(),e.barcodeFormat=e.content.barcodeFormat,e.shapePermissions.allowChangeFillColor=!0,g.label=4;case 4:null==e.barcodeFormat&&(e.imageContent.allowedSubfolder=e.allowedSubfolder,e.imageContent.allowedTabs=e.allowedTabs),g.label=5;case 5:return this._applyToShapeItem(e,t,n),null==t.contentImageUrl&&null==e.barcodeFormat?[2]:[4,(d=this._productHandler.getHandler(e.content)).waitUpdate()];case 6:return g.sent(),p=this._productHandler.getHandler(e),d.updateRectangle(!1,e.contentResizeMode,p),[2]}})})},e.prototype._applyToContentItem=function(e,t,n){return null!=t&&(e.isVariable=Te.a(e.isVariable,t.isVariable),e.maskOpacity=Te.a(e.maskOpacity,t.maskOpacity)),this._applyToShapeItem(e,t,n)},e.prototype._applyToShapeItem=function(e,t,n){var i,o;if(void 0===t&&(t=null),null!=t){if(null!=t.shapePermissions&&(e.shapePermissions.allowChangeBorderColor=Te.a(e.shapePermissions.allowChangeBorderColor,t.shapePermissions.allowChangeBorderColor),e.shapePermissions.allowChangeBorderWidth=Te.a(e.shapePermissions.allowChangeBorderWidth,t.shapePermissions.allowChangeBorderWidth),e.shapePermissions.allowChangeFillColor=Te.a(e.shapePermissions.allowChangeFillColor,t.shapePermissions.allowChangeFillColor)),e.violationSettings.allowShape=null!==(o=null===(i=t.violationSettings)||void 0===i?void 0:i.allowShape)&&void 0!==o?o:e.violationSettings.allowShape,n.ignorePermissions||e.shapePermissions.allowChangeBorderWidth){var r=null!=e.parentContainer?e.parentContainer:this._productHandler.userEditContainer,a=Te.a(e.borderWidth,t.borderWidth);if(null!=r&&null!=r.region&&this._productHandler.suppressOutOfRegionManipulation){var s=this._calcNewGroupBounds(this._productHandler.selectedItems,a);Object(Ue.h)(f.RectangleF.intersect(r.region,s),s)&&(e.borderWidth=a)}else e.borderWidth=a}if(null!=t.borderColor&&(n.ignorePermissions||e.shapePermissions.allowChangeBorderColor)){var l=ne.ColorFactory.createColor(t.borderColor);e.borderColor=l}if(null!=t.fillColor&&(n.ignorePermissions||e.shapePermissions.allowChangeFillColor)){l=ne.ColorFactory.createColor(t.fillColor);e instanceof H.PlaceholderItem&&e.isBarcodePlaceholder?e.content.fillColor=l:e.fillColor=l}null!=t.overprintFill&&(e.overprintFill=t.overprintFill),null!=t.overprintStroke&&(e.overprintStroke=t.overprintStroke)}this._applyToItem(e,t,n)},e.prototype._applyToBaseTextItem=function(t,n,i){var o,r,a;if(null!=n){if((i.ignorePermissions||t.textPermissions.allowChangeText)&&(t.text=Te.a(t.text,n.text)),(i.ignorePermissions||t.textPermissions.allowChangeTextBIU)&&(t.underline=Te.a(t.underline,n.underline)),t.violationSettings.allowTextCrop=null!==(r=null===(o=n.violationSettings)||void 0===o?void 0:o.allowTextCrop)&&void 0!==r?r:t.violationSettings.allowTextCrop,t.tracking=Te.a(t.tracking,n.tracking),null!=n.previewLeading?t.previewLeading=Te.a(t.previewLeading,n.previewLeading):t.leading=Te.a(t.leading,n.leading),(i.ignorePermissions||t.textPermissions.allowChangeTextAlignment)&&(t.alignment=Te.a(t.alignment,n.alignment)),t.horizontalScale=Te.a(t.horizontalScale,n.horizontalScale),t.verticalScale=Te.a(t.verticalScale,n.verticalScale),t.previewScale=Te.a(t.previewScale,n.previewScale),t.overlapLinesEnabled=Te.a(t.overlapLinesEnabled,n.overlapLinesEnabled),t.checkTextCrop=Te.a(t.checkTextCrop,n.checkTextCrop),t.isVariable=null!==(a=n.isVariable)&&void 0!==a?a:t.isVariable,null!=n.color&&(i.ignorePermissions||t.textPermissions.allowChangeFontColor)){var s=ne.ColorFactory.createColor(n.color);t.color=Te.a(t.color,s)}if(null!=n.font){if((i.ignorePermissions||t.textPermissions.allowChangeTextBIU)&&(t.font.fauxBold=Te.a(t.font.fauxBold,n.font.fauxBold),t.font.fauxItalic=Te.a(t.font.fauxItalic,n.font.fauxItalic)),(i.ignorePermissions||t.textPermissions.allowChangeFont)&&(t.font.postScriptName=Te.a(t.font.postScriptName,n.font.postScriptName)),i.ignorePermissions||t.textPermissions.allowChangeFontSize)if(null!=n.font.previewSize){var l=e.parseItemsDataValueRelativeToHeight(n.font.previewSize,this._productHandler,i.relativeToPrintArea),c=Te.a(t.previewFontSize,l),u=t.previewFontSize;if(t.previewFontSize=c,t instanceof H.CurvedTextItem){var h=this._productHandler.getHandler(t).getTransformedRectangle().location,d=c/u,p=new Ut.a(d,d,0,0,0);t.textPath.transform(p,h)}}else if(null!=n.font.size){var f=e.parseItemsDataValueRelativeToHeight(n.font.size,this._productHandler,i.relativeToPrintArea);t.font.size=Te.a(t.font.size,f)}t.font.allCaps=Te.a(t.font.allCaps,n.font.allCaps)}if(void 0!==n.stroke&&(i.ignorePermissions||t.textPermissions.allowChangeStroke))if(null==n.stroke)t.stroke=null;else{s=ne.ColorFactory.createColor(n.stroke.color||"#00ffff");t.stroke=new H.StrokeSettings({size:n.stroke.size,color:s})}if(void 0!==n.shadow&&(i.ignorePermissions||t.textPermissions.allowChangeShadow))if(null==n.shadow)t.shadow=null;else{s=ne.ColorFactory.createColor(n.shadow.color||"#00ffff");t.shadow=new H.ShadowSettings({size:n.shadow.size,distance:n.shadow.distance,angle:n.shadow.angle,color:s})}null!=n.overprintText&&(t.overprintText=n.overprintText)}this._applyToShapeItem(t,n,i)},e.prototype._applyToItem=function(e,t,n){var i,o,r,a,s,l,c,u=this;if(null!=t){if(null!=t.manipulationPermissions){var h=t.manipulationPermissions,d=e.manipulationPermissions;d.resizeGrips.corner=Te.a(d.resizeGrips.corner,h.resizeGrips.corner),d.resizeGrips.edge=Te.a(d.resizeGrips.edge,h.resizeGrips.edge),d.allowDelete=Te.a(d.allowDelete,h.allowDelete),d.allowMoveHorizontal=Te.a(d.allowMoveHorizontal,h.allowMoveHorizontal),d.allowMoveVertical=Te.a(d.allowMoveVertical,h.allowMoveVertical),d.allowRotate=Te.a(d.allowRotate,h.allowRotate),d.allowDragAndDrop=Te.a(d.allowDragAndDrop,h.allowDragAndDrop)}null!=t.visualizationPermissions&&(e.visualizationPermissions.noPrint=Te.a(e.visualizationPermissions.noPrint,t.visualizationPermissions.noPrint),e.visualizationPermissions.noShow=Te.a(e.visualizationPermissions.noShow,t.visualizationPermissions.noShow));var p=t.itemPermissions;if(null!=p){e.itemPermissions.allowOpacityChange=Te.a(e.itemPermissions.allowOpacityChange,p.allowOpacityChange),e.itemPermissions.allowZOrderChange=Te.a(e.itemPermissions.allowZOrderChange,p.allowZOrderChange);var f=p.itemToolbarPermissions;null!=f&&(e.itemPermissions.itemToolbarPermissions.showEditButton=Te.a(e.itemPermissions.itemToolbarPermissions.showEditButton,f.showEditButton),e.itemPermissions.itemToolbarPermissions.showDeleteButton=Te.a(e.itemPermissions.itemToolbarPermissions.showDeleteButton,f.showDeleteButton),e.itemPermissions.itemToolbarPermissions.showSelectButton=Te.a(e.itemPermissions.itemToolbarPermissions.showSelectButton,f.showSelectButton)),e.itemPermissions.allowRemoveOnLayoutChange=Te.a(e.itemPermissions.allowRemoveOnLayoutChange,p.allowRemoveOnLayoutChange)}if(e.violationSettings.allowBleedArea=null!==(o=null===(i=t.violationSettings)||void 0===i?void 0:i.allowBleedArea)&&void 0!==o?o:e.violationSettings.allowBleedArea,e.violationSettings.allowRegion=null!==(a=null===(r=t.violationSettings)||void 0===r?void 0:r.allowRegion)&&void 0!==a?a:e.violationSettings.allowRegion,e.violationSettings.allowSafetyLines=null!==(l=null===(s=t.violationSettings)||void 0===s?void 0:s.allowSafetyLines)&&void 0!==l?l:e.violationSettings.allowSafetyLines,null!=t.textWrappingMode)switch(t.textWrappingMode.toLowerCase()){case"none":e.textWrappingMode=H.WrappingMode.None;break;case"square":e.textWrappingMode=H.WrappingMode.Square;break;case"tight":e.textWrappingMode=H.WrappingMode.Tight;break;default:console.error("Unknown textWrappingMode:",t.textWrappingMode)}if((n.ignorePermissions||e.itemPermissions.allowOpacityChange)&&(e.opacity=Te.a(e.opacity,t.opacity),e instanceof H.PlaceholderItem&&e.updateContentAndFrames(function(e){return e.opacity=Te.a(e.opacity,t.opacity)})),e.name=Te.a(e.name,t.name),null!=t.blendMode){var g=null!==(c=Te.j(H.BlendMode,t.blendMode))&&void 0!==c?c:H.BlendMode.Normal;e.blendMode=g}null!=t.themeBinding&&(e.themeBinding.text=Te.b(e.themeBinding.text,t.themeBinding.text),e.themeBinding.stroke=Te.b(e.themeBinding.stroke,t.themeBinding.stroke),e.themeBinding.shadow=Te.b(e.themeBinding.shadow,t.themeBinding.shadow),e.themeBinding.img=Te.b(e.themeBinding.img,t.themeBinding.img),e.themeBinding.border=Te.b(e.themeBinding.border,t.themeBinding.border),e.themeBinding.fill=Te.b(e.themeBinding.fill,t.themeBinding.fill),e.themeBinding.textFill=Te.b(e.themeBinding.textFill,t.themeBinding.textFill),e.themeBinding.barcode=Te.b(e.themeBinding.barcode,t.themeBinding.barcode),e.themeBinding.line=Te.b(e.themeBinding.line,t.themeBinding.line),null!=t.themeBinding.styles&&(e.themeBinding.styles=Zt(e.themeBinding.styles||[],t.themeBinding.styles)),this._updateThemeForItem(e))}if(n.changePosition&&!(e instanceof H.ContentItem&&null!=e.parentPlaceholder))if(e instanceof H.BaseTextItem&&""!==e.text.trim()){if(e instanceof H.BoundedTextItem){var _=t;null==_.width&&null==_.height?e.scheduledFitMode=H.FitMode.ShrinkOrStretchToContent:null==_.height?e.scheduledFitMode=H.FitMode.ShrinkOrStretchToContentHeight:null==_.width&&(e.scheduledFitMode=H.FitMode.ShrinkOrStretchToContentWidth)}e instanceof H.BoundedTextItem&&null==e.scheduledFitMode||e instanceof H.PathBoundedTextItem?this._applyPositionAndSize(e,t,n.relativeToPrintArea):e.getItemChangedEvent().add(function i(){e.getItemChangedEvent().remove(i),u._applyPositionAndSize(e,t,n.relativeToPrintArea)})}else this._applyPositionAndSize(e,t,n.relativeToPrintArea)},e.prototype._applyPositionAndSize=function(t,n,i){var o;if(!(t instanceof H.LineItem)){var r,a,s=e._getTargetBounds(this._productHandler,i),l=e._getVisualSize(this._productHandler,s),c=this._productHandler.contentAngle,u=Te.o(null!=n&&null!=n.width?n.width:"50%",l.width),h=Te.o(null!=n&&null!=n.height?n.height:"50%",l.height),d=this._productHandler.getHandler(t),p=d.getTransformedRectangle(!1),g=p.angle-c+(null!==(o=n.angle)&&void 0!==o?o:0);if(t instanceof H.PlainTextItem||t instanceof H.ArchedTextItem)r=p.width,a=p.height;else if(t.type===H.ShapeItem.type){if(p.width<l.width&&p.height<l.height)r=p.width,a=p.height;else{var _=2*d.getBorderMargin(),v=window.Math.min(l.width/(p.width+_),l.height/(p.height+_));r=p.width*v,a=p.height*v}}else t instanceof H.BoundedTextItem?(r=null!=n&&null!=n.width?u:p.width,a=null!=n&&null!=n.height?h:p.height):(r=u,a=h);if(null!=this._productHandler.regionForCurrentContainer)(v=window.Math.min(.9*l.width/r,.9*l.height/a))<1&&(r*=v,a*=v);if(t instanceof H.BarcodeItem){var m=Object(Ue.f)(new H.Size(t.isSquareCode?1:2.5,1),new H.Size(u,h));r=m.width,a=m.height}else if(t instanceof H.ImageItem||t instanceof H.PlaceholderItem&&!t.isEmptyContent&&null==t.barcodeFormat){if(null==n.width&&null==n.height&&!(t instanceof H.BarcodeItem)){var y=this._getOriginalImageSize(t),b=y.width<l.width&&y.height<l.height;r=b?y.width:l.width,a=b?y.height:l.height}var C=this._getImageSource(t);v=Math.min(r/C.width,a/C.height);r=C.width*v,a=C.height*v}else if(t instanceof H.GroupItem){var w=d.rectangle;v=Math.min(r/w.width,a/w.height);r=w.width*v,a=w.height*v}var E=s.width/2,x=s.height/2,P=null!=n&&null!=n.location&&null!=n.location.x?n.location.x:E,S=null!=n&&null!=n.location&&null!=n.location.y?n.location.y:x,I=Te.o(P,s.width),T=Te.o(S,s.height);90!==c&&180!==c||(T=s.height-T),180!==c&&270!==c||(I=s.width-I);var D=(null!=n&&null!=n.location?n.location.originX:null)||Oe.a.Center,k=(null!=n&&null!=n.location?n.location.originY:null)||Oe.a.Center;switch(D.toLowerCase()){case Oe.a.Left:E=I;break;case Oe.a.Right:0===c?E=I-r:90===c?E=I-a:180===c?E=I+r:270===c&&(E=I+a);break;case Oe.a.Center:0===c?E=I-r/2:90===c?E=I-a/2:180===c?E=I+r/2:270===c&&(E=I+a/2)}switch(k.toLowerCase()){case Oe.a.Top:x=T;break;case Oe.a.Bottom:0===c?x=T-a:90===c?x=T+r:180===c?x=T+a:270===c&&(x=T-r);break;case Oe.a.Center:0===c?x=T-a/2:90===c?x=T+r/2:180===c?x=T+a/2:270===c&&(x=T-r/2)}E+=s.left,x+=s.top;var M=new f.RotatedRectangleF(0,0,r,a);if(M.angle=g,M.location=new f.PointF(E,x),t instanceof H.BaseTextItem)if(t instanceof H.BoundedTextItem&&null!=n&&t.overflowStrategy===H.OverflowStrategy.Clip&&(null==n.width&&null==n.height?t.scheduledFitMode=H.FitMode.ShrinkOrStretchToContent:null==n.height?t.scheduledFitMode=H.FitMode.ShrinkOrStretchToContentHeight:null==n.width&&(t.scheduledFitMode=H.FitMode.ShrinkOrStretchToContentWidth)),t instanceof H.BoundedTextItem||t instanceof H.PathBoundedTextItem){var B=M.toRectangleF(),R=f.Path.rectangle(B.left,B.top,B.width,B.height);t.sourcePath=R,t.sourceRectangle=B.clone(),t instanceof H.BoundedTextItem?t.textRectangle=B:t.boundingPaths=[R]}else d.setTransformedRectangle(M);else{if(t instanceof H.PlaceholderItem||t instanceof H.ContentItem){var O=M.toRectangleF();t.sourceRectangle=O,t.sourcePath=f.Path.rectangle(O.left,O.top,O.width,O.height)}d.setTransformedRectangle(M)}this._productHandler.getHandler(t).update()}},e.prototype._getOriginalImageSize=function(e){return e instanceof H.ImageItem?e.getOriginalImageSize():null!=e.content&&e.content instanceof H.ImageItem?e.content.getOriginalImageSize():null},e._getTargetBounds=function(e,t){return t?e.getPrintAreaBounds():new f.RectangleF(0,0,e.currentSurface.width,e.currentSurface.height)},e._getVisualSize=function(e,t){return e.getVisualSize(t)},e.prototype._getImageSource=function(e){return e instanceof H.ImageItem?e.source:e.content.source},e.prototype._getRotatedRegion=function(e){if(null==e.region)return null;var t=this._productHandler.userEditPrintArea.bounds,n=f.RectangleF.FromObject(e.region),i=this._productHandler.contentAngle;if(i>0){var o=f.RotatedRectangleF.fromRectangleF(n),r=t.center;o.rotateAt(i,r),n=o.bounds}return n},e.prototype._calcNewGroupBounds=function(e,t){var n,i,o=this,r=e.map(function(e){return e.clone()}).map(function(e){return o._productHandler.getHandler(e)});try{for(var a=Kt(r),s=a.next();!s.done;s=a.next()){var l=s.value;l instanceof R.o?l.item.borderWidth=t:l.width=t}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}var c=r.map(function(e){return e.bounds});return f.RectangleF.FromLTRB(Math.min.apply(Math,Zt(c.map(function(e){return e.left}))),Math.min.apply(Math,Zt(c.map(function(e){return e.top}))),Math.max.apply(Math,Zt(c.map(function(e){return e.right}))),Math.max.apply(Math,Zt(c.map(function(e){return e.bottom}))))},e.parseItemsDataValueRelativeToHeight=function(t,n,i){if("number"==typeof t)return t;var o=e._getTargetBounds(n,i),r=e._getVisualSize(n,o);return Te.o(t,r.height)},e}(),Jt=n(748),$t=function(){function e(e){this._surface=e}return e.prototype.getBounds=function(e){var t=this.getPrintAreasBounds(e);return f.RectangleF.union(t,new f.RectangleF(0,0,this._surface.width,this._surface.height))},e.prototype.getPrintAreasBounds=function(e){return f.RectangleF.getOverallBounds(this._surface.printAreas.toArray().map(function(t){return t.getBounds(e)}))},e}(),en=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),tn=function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}l((i=i.apply(e,t||[])).next())})},nn=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},on=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},rn=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(on(arguments[t]));return e},an=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},sn=function(e){function t(t){var n=t.holderElement,i=t.backendUrl,o=t.surface,a=void 0===o?new gt.a:o,s=t.canvasBackground,l=void 0===s?"chess":s,c=t.rulerEnabled,u=void 0===c||c,h=t.frontEndTextRenderingEnabled,d=void 0!==h&&h,p=t.zone,g=void 0===p?null:p,_=t.productViewerPartId,v=void 0===_?"ProductViewer":_,m=e.call(this,g)||this;return m._containersFlatList=[],m.containersFlatListChangedEvent=new r.a,m._textFormattingEnabled=!0,m._updateItem=function(e){e instanceof H.CurvedTextItem&&(e.fitToPathStep=m.configuration.text.fitToPathStep)},m._onHistoryChanged=function(e,t){m._history.addSnapshot()},m._surface=null,m._onCurrentSurfaceContainerAdded=function(e){e.item.name===z.a.MAIN_CONTAINER_NAME&&e.item.renderingType===Pe.RenderingType.Normal&&(m.userEditContainer=e.item)},m._onSurfacePropertyChanged=function(e,t){switch(t){case"mockup":m._updateContainersFlatList();break;case"width":case"height":var n=m._surfaceHandler.getBounds(qe.a.Total);m._canvas.setWorkspaceSize(n.width,n.height);break;case"rotateAngle":m.contentAngle=m.surface.rotateAngle}},m._onPrintAreaPropertyChanged=function(e,t){"bounds"!==t&&"slug"!==t&&"bleed"!==t||m._updateCanvasByPrintAreaBounds()},m._updateCanvasByPrintAreaBounds=function(){var e=m._surfaceHandler.getBounds(qe.a.Total);m._canvas.workspaceWidth===e.width&&m._canvas.workspaceHeight===e.height||m._canvas.setWorkspaceSize(e.width,e.height);var t=new f.PointF(-Math.min(0,e.left),-Math.min(0,e.top));m._canvas.offset=t;var n=m._surfaceHandler.getPrintAreasBounds(qe.a.Trim);m._baseRulersOffset=new f.PointF(n.left+t.x,n.top+t.y)},m._updateContainersFlatList=function(){var e=m._containersFlatList;m._containersFlatList=rn(m.surface.mockup.underContainers,m.surface.containers,m.surface.mockup.overContainers,m.previewMode?[]:m._safetyLinesHandler.safetyLinesContainers,m._watermarkHandler.watermarkContainers,m._gridHandler.gridContainers),m.containersFlatListChangedEvent.notify(m._getDifference(e,m._containersFlatList))},m._setActiveThrowsException=!1,m.frontEndTextRenderingEnabled=d,m._backendUrl=i,m._serviceEndPoint=Object(Te.s)(m._backendUrl,"api/ccviewer"),m._normalizeHolderElement(n),m._viewerElement=m._createViewerElement(n,v),m._canvas=m._createCanvas(),m._configuration=new St(null),m._screenXDpi=m._screenYDpi=96,m._canvasSaveStateDelegate=null,m._bitmapViewerSaveStateDelegate=null,m._mouseMoveDelegate=null,m._mouseUpDelegate=null,m._mouseDownDelegate=null,m._ignoreMouseDown=!1,m._ignoreMouseDownTimeout=null,m._doubleClickDelegate=null,m._zoomDelegate=null,m._resizeDelegate=null,m._keyDownDelegate=null,m._keyUpDelegate=null,m._modalBgClass=null,m._clearSelectionOnDocumentClick=!0,m._clearSelectionOnViewerClick=!0,m._devicePixelRatio=1,m._whitespaceDiv=null,m._resizeCheckIntervalId=null,m._workspaceRotation=new Jt.a,m._safetyLinesHandler=new Ct(m._configuration.printZone),m._safetyLinesHandler.addChanged(m._updateContainersFlatList),m._safetyLinesHandler.addVisibilityChanged(function(){m.canvas.redraw()}),m._watermarkHandler=new Et(null,m._canvas.service),m._watermarkHandler.add_watermarkCollectionChanged(m._updateContainersFlatList),m._gridHandler=new Pt,m._gridHandler.addChanged(function(){m.canvas.redraw()}),m._eventManager=new zt(a.parentProduct,m),m._eventManager.addPrintAreaPropertyChanged(m._onPrintAreaPropertyChanged),m._eventManager.addPrintAreaCollectionChanged(m._updateCanvasByPrintAreaBounds),m.frontEndTextRenderingEnabled&&m._eventManager.addItemPropertyChanged(function(e,t){e instanceof H.BaseTextItem&&m._canvas.handlerFactory.replaceTextItemHandler(e)}),m._productHandler=new Nt(m),m.surface=a,m._licenseHandler=new Dt(m,m._serviceEndPoint),m.initialize({ignore:!1}),m.zoomMode=Y.bestFit,m.viewportAlignment=q.centerCenter,m.rulerEnabled=u,m._setCanvasBackground(l),m._snapshotHandler=new jt(m),m._variableItemHelper=new Mt.a(m._productHandler,m._canvas,m._eventManager),m._history=m._initializeHistory(),m._productThemeManager=new Ft(m._productHandler,null,m._canvas,m._eventManager),m._itemsDataApplier=new Qt(m._productHandler,m._canvas,m._productThemeManager),m._commandManager=new F.a(m._history,m._productHandler,m._productThemeManager,m._variableItemHelper,m._eventManager,m._canvas,m._itemsDataApplier),m.eventManager.addItemAdded(function(e){return m._updateItem(e.item)}),m.setMouseBehavior(Me.Selection),m}return en(t,e),Object.defineProperty(t.prototype,"containersFlatList",{get:function(){return this._containersFlatList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"commandManager",{get:function(){return this._commandManager},enumerable:!0,configurable:!0}),t.prototype.setMouseBehavior=function(e,t,n){if(null==this.canvas)throw new C.c("Canvas is not initialized!");this.canvas.mouseBehaviorManager.setMouseBehavior(e,t,n)},Object.defineProperty(t.prototype,"mouseBehavior",{get:function(){return this.canvas.mouseBehaviorManager.currentMouseBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"configuration",{get:function(){return this._configuration},set:function(e){this._configuration=new St(e),this.gridHandler.setConfig(this._configuration.grid,this._configuration.rulers),this._setRulersConfig(this._configuration.rulers),this._variableItemHelper.maskSymbol=this._configuration.variableItemsMaskSymbol,this._productThemeManager.productThemes=this._configuration.productThemes,null!=this.surface&&null!=this.surface.parentProduct&&this.surface.parentProduct.getAllItems().forEach(this._updateItem),this.history.historySize=this.configuration.historySize,this.commandManager.configuration=this.configuration,this._safetyLinesHandler.conf=this._configuration.printZone,this.canvas.conf=this._configuration},enumerable:!0,configurable:!0}),t.prototype.exitEditMode=function(){this._canvas.getAllItemHandlers({onlyType:R.h}).forEach(function(e){e.editing&&e.exitEditMode()})},t.prototype._initializeHistory=function(){var e=new Wt(this._snapshotHandler);return this.eventManager.addSurfaceCollectionChanged(this._onHistoryChanged),this.eventManager.addContainerCollectionChanged(this._onHistoryChanged),this.eventManager.addItemCollectionChanged(this._onHistoryChanged),this.eventManager.addUnderMockupContainerCollectionChanged(this._onHistoryChanged),this.eventManager.addOverMockupContainerCollectionChanged(this._onHistoryChanged),this.eventManager.addPreviewMockupContainerCollectionChanged(this._onHistoryChanged),this.eventManager.addItemPropertyChanged(this._onHistoryChanged),this.canvas.setHistory(e),e},t.prototype._normalizeHolderElement=function(e){e.style.overflow="hidden",e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.msUserSelect="none",e.style.position="relative"},t.prototype._createViewerElement=function(e,t){var n=document.createElement("div");return n.id=e.id+"_"+t,n.attributes.name=n.id,n.style.width="100%",n.style.height="100%",n.style.display="block",n.style.zIndex="1",n.style.margin="0",n.style.padding="0",n.style.border="0",n.style.position="relative",n.style.overflow="hidden",n.style.transform="translate3d(0px, 0px, 0px)",n.style.touchAction="none",e.appendChild(n),n},Object.defineProperty(t.prototype,"licenseHandler",{get:function(){return this._licenseHandler},enumerable:!0,configurable:!0}),t.prototype._createCanvas=function(){var e=new ft(this);return e.serviceEndpoint=this._serviceEndPoint,e.loadingImageUrl=Object(Te.s)(this._serviceEndPoint,"/resource?image=waitclock"),e.handlerUrl=this._serviceEndPoint,e.initialize(),e.multipleSelectionEnabled=!0,e},t.prototype._setCanvasBackground=function(e){"chess"===e?(this.canvas.backgroundImage=Object(Te.s)(this._serviceEndPoint,"/resource?image=background"),this.canvas.isSquaredBackground=!0):this.canvas.surfaceCanvas.style.backgroundColor=e.color},t.prototype.setTextWhizzModule=function(e){this.canvas.setTextWhizzModule(e,this._backendUrl)},t.prototype.initTextEditor=function(e,t,n){void 0===n&&(n=fe.c.Default),this.canvas.initTextEditor(n,e,t,this._serviceEndPoint)},Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"whitespaceDiv",{get:function(){return this._whitespaceDiv},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"surface",{get:function(){return this._surface},set:function(e){if(null==e)throw new C.b("surface");var t=this.surface;e!==t&&(this._canvas.clearSelectedItemHandlers(),this._surface=e,this._eventManager.setProduct(e.parentProduct),this._onCurrentSurfaceChange(t))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"safetyLinesHandler",{get:function(){return this._safetyLinesHandler},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gridHandler",{get:function(){return this._gridHandler},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"surfaceHandler",{get:function(){return this._surfaceHandler},enumerable:!0,configurable:!0}),t.prototype._onCurrentSurfaceChange=function(e){var t,n,i,o,r,a,s,l,c,u,h,d;this._safetyLinesHandler.surface=this.surface,this._watermarkHandler.surface=this.surface,this._gridHandler.surface=this.surface,this._surfaceHandler=new $t(this.surface);var p=this._surfaceHandler.getBounds(qe.a.Total);if(this._updateCanvasByPrintAreaBounds(),this.canvas.service.beginMultiCall(),this._canvas.setWorkspaceSize(p.width,p.height),this._updateContainersFlatList(),this.canvas.service.endMultiCall(),null!=e){try{for(var f=an(this._getContainerCollections(e)),g=f.next();!g.done;g=f.next()){var _=g.value;try{for(var v=(i=void 0,an(_)),m=v.next();!m.done;m=v.next()){var y=m.value;try{for(var b=(r=void 0,an(y.items)),C=b.next();!C.done;C=b.next()){var w=C.value;this.getHandler(w).canvas=null}}catch(e){r={error:e}}finally{try{C&&!C.done&&(a=b.return)&&a.call(b)}finally{if(r)throw r.error}}}}catch(e){i={error:e}}finally{try{m&&!m.done&&(o=v.return)&&o.call(v)}finally{if(i)throw i.error}}_.remove_collectionChanged(this._updateContainersFlatList)}}catch(e){t={error:e}}finally{try{g&&!g.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}e.containers.remove_itemAdded(this._onCurrentSurfaceContainerAdded)}try{for(var E=an(this._getContainerCollections(this._surface)),x=E.next();!x.done;x=E.next()){_=x.value;try{for(var P=(c=void 0,an(_)),S=P.next();!S.done;S=P.next()){y=S.value;try{for(var I=(h=void 0,an(y.items)),T=I.next();!T.done;T=I.next()){w=T.value;this.getHandler(w).canvas=this.canvas}}catch(e){h={error:e}}finally{try{T&&!T.done&&(d=I.return)&&d.call(I)}finally{if(h)throw h.error}}}}catch(e){c={error:e}}finally{try{S&&!S.done&&(u=P.return)&&u.call(P)}finally{if(c)throw c.error}}_.add_collectionChanged(this._updateContainersFlatList)}}catch(e){s={error:e}}finally{try{x&&!x.done&&(l=E.return)&&l.call(E)}finally{if(s)throw s.error}}if(this._canvas.updateColors(),this.surface.addPropertyChanged(this._onSurfacePropertyChanged),this.contentAngle=this.surface.rotateAngle,this._updateAlignMargin(),this._eventManager.surfaceChangedEvent.notify(this._surface),this._canvas.redraw(),this.zoomMode=Y.bestFit,this.canvas.updateButtonGroups({onlyVisible:!1}),this.canvas.clearSelectedItemHandlers(),this.surface.containers.length>0){var D=this.surface.containers.firstOrDefault(function(e){return e.name===z.a.MAIN_CONTAINER_NAME});this.userEditContainer=null!=D?D:this.surface.containers.get(0),this.surface.containers.add_itemAdded(this._onCurrentSurfaceContainerAdded)}},t.prototype._updateAlignMargin=function(){if(this.surface instanceof gt.a&&null!=this._canvas&&!this.surface.printAreas.empty){var e={left:0,right:0,top:0,bottom:0},t=this.surface.printAreas.selectMany(function(e){return e.safetyLines});if(t.length>0){var n=this.configuration.alignToSafetyLineName,i=O.isEmpty(n)?null:t.firstOrDefault(function(e){return e.name==n});null==i&&(i=t.first());var o=i.getMargin();e.left=o.left,e.right=o.right,e.top=o.top,e.bottom=o.bottom}var r=this.surface.printAreas.get(0).bounds;e.left+=r.left,e.top+=r.top,e.right+=this.surface.width-r.right,e.bottom+=this.surface.height-r.bottom,this._canvas.leftMargin=e.left,this._canvas.rightMargin=e.right,this._canvas.topMargin=e.top,this._canvas.bottomMargin=e.bottom}},t.prototype._getContainerCollections=function(e){return[e.mockup.underContainers,e.mockup.overContainers,e.containers,this._safetyLinesHandler.safetyLinesContainers,this._watermarkHandler.watermarkContainers,this._gridHandler.gridContainers]},Object.defineProperty(t.prototype,"watermarkConfig",{get:function(){return this._watermarkHandler.watermarkConfig},set:function(e){this._watermarkHandler.watermarkConfig=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedItems",{get:function(){var e=this.canvas.getSelectedItemHandlers();return null!==e?e.select(function(e){return e.item}).toArray():null},set:function(e){if(null!=e){var t=e.map(this.canvas.handlerFactory.get);this.canvas.setSelectedItemHandlers(t)}else this.canvas.clearSelectedItemHandlers()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentItem",{get:function(){var e=this.canvas.currentItemHandler;return null!=e?e.item:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomConfig",{get:function(){return this._configuration?this._configuration.zoom:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"previewMode",{get:function(){return this.canvas.previewMode},set:function(e){this.canvas.previewMode=e,this._updateContainersFlatList()},enumerable:!0,configurable:!0}),t.prototype._getDifference=function(e,t){return{added:t.reduce(function(t,n){return e.includes(n)||t.push(n),t},new Array),removed:e.reduce(function(e,n){return t.includes(n)||e.push(n),e},new Array)}},Object.defineProperty(t.prototype,"contentWidth",{get:function(){return this._getContentDimension(this.workspaceWidth,M.a.screenDpi)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentHeight",{get:function(){return this._getContentDimension(this.workspaceHeight,M.a.screenDpi)},enumerable:!0,configurable:!0}),t.prototype._getContentDimension=function(e,t){var n=se.a(se.c(e,t)*this.zoom);return Math.ceil(n)},Object.defineProperty(t.prototype,"workspaceWidth",{get:function(){return this.canvas.workspaceWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"workspaceHeight",{get:function(){return this.canvas.workspaceHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actualSizeHorizontalScale",{get:function(){return M.a.screenDpi/M.a.devicePixelRatio/72},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actualSizeVerticalScale",{get:function(){return M.a.screenDpi/M.a.devicePixelRatio/72},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"modalBgClass",{get:function(){return this._modalBgClass},set:function(e){this._modalBgClass=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textFormattingEnabled",{get:function(){return this._textFormattingEnabled},set:function(e){this._textFormattingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clearSelectionOnDocumentClick",{get:function(){return this._clearSelectionOnDocumentClick},set:function(e){this._clearSelectionOnDocumentClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clearSelectionOnViewerClick",{get:function(){return this._clearSelectionOnViewerClick},set:function(e){this._clearSelectionOnViewerClick=e},enumerable:!0,configurable:!0}),t.prototype._renderContent=function(e){return e+='<div id="cvImage" style="',e+="width:"+this.contentWidth+"px;height:"+this.contentHeight+"px;",e+='position:absolute;left:0px;top:0px;z-index:1"/>'},t.prototype._setZoomMode=function(t){e.prototype._setZoomMode.call(this,t),Object(f.EqualsOfFloatNumbers)(this.canvas.zoom,this.zoom)||(this.canvas.setZoom(this.zoom),this.canvas.redraw())},t.prototype.setZoom=function(t,n){if("number"==typeof t){this.zoomConfig&&(t>this.zoomConfig.max&&(t=this.zoomConfig.max),t<this.zoomConfig.min&&(t=this.zoomConfig.min)),t=e.prototype.setZoom.call(this,t,n);var i=this.canvas;return i.service.beginMultiCall(),i.setZoom(t),i.service.endMultiCall().finally(function(){return i.redraw()}),t}},t.prototype.getMaxZoom=function(){var t=e.prototype.getMaxZoom.call(this);return Math.min(t,this.canvas.calcPlatformLimitZoom())},t.prototype._onDocumentClick=function(t){if(!0!==this._ignoreDocumentClickOnce){if(e.prototype._onDocumentClick.call(this,t),this.clearSelectionOnDocumentClick&&!this._ignoreSelectionClick(t)){var n=this.canvas;n&&n.getSelectedItemHandlers().length>0&&(n.clearSelectedItemHandlers(),n.redraw())}}else this._ignoreDocumentClickOnce=!1},t.prototype._ignoreSelectionClick=function(e){return!!this.element.contains(e.target)||D.b.isEventPathContainsClass(e,t.preventClickHandleClass)},t.prototype._onMouseMove=function(t){e.prototype._onMouseMove.call(this,t);var n=this.canvas;(n.multipleSelectionEnabled||n.getSelectedItemHandlers().length>0)&&t.preventDefault()},t.prototype._onTouch=function(t){e.prototype._onTouch.call(this,t),this._touchFlags.isScroll=!0,this._touchFlags.isScrollChecked=!1,this._touchFlags.gestureCenter=null,this._touchFlags.lastPinchEvent=null,this._touchFlags.initialCurrentLeft=this._holderElement.scrollLeft,this._touchFlags.initialCurrentTop=this._holderElement.scrollTop},t.prototype._onPinch=function(t){if(this._touchFlags.pinchStarted||(this._touchFlags.pinchStarted=!0),this.canvas.raisePinch(t),!t.defaultPrevented){null!==this._touchFlags.mouseDown.onTimeout&&(clearTimeout(this._touchFlags.mouseDown.timeout),this._touchFlags.mouseDown.onTimeout=null);var n=this._touchFlags;if(null==n.gestureCenter&&(n.gestureCenter=t.gesture.center),n.lastPinchEvent=t,n.isScroll){var i=n.initialCurrentLeft+(n.gestureCenter.pageX-t.gesture.center.pageX),o=n.initialCurrentTop+(n.gestureCenter.pageY-t.gesture.center.pageY);this.scrollingPosition=new f.PointF(i,o)}else(!M.a.IsIos()||M.a.IosMajorVersion()>5)&&e.prototype._onPinch.call(this,t,!1);if(!n.isScrollChecked&&this.pinchZoomEnabled&&t.gesture.deltaTime>350){n.isScrollChecked=!0;var r=this._calcAngle(t.gesture.touches[0],t.gesture.touches[1],n.gestureCenter);this._isPinchByAngle(r,t.gesture.scale)&&this._isPinchByModule(t.gesture.touches[0],t.gesture.touches[1],n.gestureCenter)&&(n.isScroll=!1,e.prototype._onPinch.call(this,t,!1))}}},t.prototype._onRelease=function(t){var n=this._touchFlags;if(this._touchFlags.pinchStarted)return this._touchFlags.pinchStarted=!1,void this.canvas.raiseRelease();if(this.pinchZoomEnabled&&!n.isScrollChecked&&null!=n.lastPinchEvent){var i=this._calcAngle(n.lastPinchEvent.gesture.touches[0],n.lastPinchEvent.gesture.touches[1],n.gestureCenter);this._isPinchByAngle(i,n.lastPinchEvent.gesture.scale)&&e.prototype._onPinch.call(this,n.lastPinchEvent,!1)}e.prototype._onRelease.call(this,t)},t.prototype._isPinchByAngle=function(e,t){return M.a.IsTouchIE()?e>=160||t<=.85||t>=1.3:e>=160&&(t<=.85||t>=1.3)},t.prototype._isPinchByModule=function(e,t,n){var i=[e.pageX-n.pageX,e.pageY-n.pageY],o=[t.pageX-n.pageX,t.pageY-n.pageY],r=Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2)),a=Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2)),s=[i[0]+o[0],i[1]+o[1]],l=Math.sqrt(Math.pow(s[0],2)+Math.pow(s[1],2));return l<r&&l<a},t.prototype._calcAngle=function(e,t,n){var i=[e.pageX-n.pageX,e.pageY-n.pageY],o=[t.pageX-n.pageX,t.pageY-n.pageY],r=(i[0]*o[0]+i[1]*o[1])/(Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2))*Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2)));return 180*Math.acos(r)/Math.PI},t.prototype.initialize=function(n){var i=this,r=void 0===n?{}:n,a=r.ignore,s=void 0===a||a,l=r.intervalCheckLoop,c=void 0===l?null:l;if(!s){e.prototype.initialize.call(this,c),this._holderElement.style.msTouchAction="none",this._holderElement.style.touchAction="none",this._contentElements.push(this._imageCtx=this.element.querySelector("#cvImage")),this._whitespaceDiv=document.createElement("div"),this._whitespaceDiv.id="cvWhitespace",this._whitespaceDiv.tabIndex=-1,this._whitespaceDiv.style.position="absolute",this._whitespaceDiv.style.zIndex="1",this._whitespaceDiv.style.overflow="hidden",this._holderElement.appendChild(this._whitespaceDiv),this._updateWhitespace();var u=this._pointerEvents;this._whitespaceDiv.addEventListener("click",D.b.createBoundedWrapper(this,this._onWorkspaceClick)),u.start.split(" ").forEach(function(e){i._holderElement.addEventListener(e,D.b.createBoundedWrapper(i,i._onWhitespaceMouseDown))}),u.move.split(" ").forEach(function(e){i._holderElement.addEventListener(e,D.b.createBoundedWrapper(i,i._onWhitespaceMouseMove))}),u.up.split(" ").forEach(function(e){i._holderElement.addEventListener(e,D.b.createBoundedWrapper(i,i._onWhitespaceMouseUp))}),u.cancel.split(" ").forEach(function(e){i._holderElement.addEventListener(e,D.b.createBoundedWrapper(i,i._onWhitespaceMouseUp))}),de(this._whitespaceDiv).on("doubletap",this._onWorkspaceDoubleClick.bind(this));var h=this.canvas;h.addStyles();var d,p=this._contentCtx.firstChild;this._onCanvasStatusChangedDelegate||(this._onCanvasStatusChangedDelegate=this._onCanvasStatusChanged.bind(this),h.add_statusChanged(this._onCanvasStatusChangedDelegate));h.status==o.ready&&h.isInitialized?(h.setZoom(this.zoom,!0),h.addElement(p),h.redraw()):(d=function(){h.status==o.ready&&h.isInitialized&&(h.remove_statusChanged(d),h.remove_initialized(d),d=null,h.setZoom(this.getZoom(),!0),h.addElement(p),h.redraw())}.bind(this),h.add_statusChanged(d),h.add_initialized(d));var f=function(e,n){var i=n.currentItemHandler;return i instanceof R.h&&i.editing?e.keyCode>=112&&e.keyCode<=123||!0===e.altKey:!(null!=e.code&&!D.b.isEventPathContainsClass(e,t.preventKeyHandleClass)&&D.b.getEventPath(e).includes(h.viewer.whitespaceDiv))||"ArrowLeft"!==e.code&&"ArrowUp"!==e.code&&"ArrowRight"!==e.code&&"ArrowDown"!==e.code&&"ShiftLeft"!==e.code&&"ShiftRight"!==e.code&&"Delete"!==e.code&&function(e){if(e.ctrlKey||e.metaKey)return"KeyZ"!==e.code&&"KeyY"!==e.code;return!0}(e)};this._keyUpDelegate=function(e){f(e,h)||(h.raiseKeyUp(e),e.preventDefault())},this._keyDownDelegate=function(e){f(e,h)||(h.raiseKeyDown(e),e.preventDefault())},document.addEventListener("keyup",this._keyUpDelegate),document.addEventListener("keydown",this._keyDownDelegate),this._touchFlags.mouseDown={onTimeout:null},this._mouseDownDelegate=function(e,t){if(i._setActiveElementIeFix(),"touchstart"===t.type||"MSPointerDown"===t.type||"pointerDown"===t.type){"touchstart"===t.type&&(i._ignoreMouseDown=!0),null!=i._ignoreMouseDownTimeout&&clearTimeout(i._ignoreMouseDownTimeout),i._ignoreMouseDownTimeout=setTimeout(function(){this._ignoreMouseDown=!1},300);i._touchFlags.mouseDown.onTimeout=function(){h.raiseMouseDown(t)}}else i._ignoreMouseDown||h.raiseMouseDown(t);return!0},this.add_workspaceMouseDown(this._mouseDownDelegate),this._doubleClickDelegate=function(e,t){return i._setActiveElementIeFix(),h.raiseDoubleClick(t),!0},this.add_workspaceDoubleClick(this._doubleClickDelegate),this._mouseMoveDelegate=function(e,t){return null!==i._touchFlags.mouseDown.onTimeout&&(clearTimeout(i._touchFlags.mouseDown.timeout),i._touchFlags.mouseDown.onTimeout(),i._touchFlags.mouseDown.onTimeout=null),h.raiseMouseMove(t),!0},this.add_workspaceMouseMove(this._mouseMoveDelegate);var g=!1;this._mouseUpDelegate=function(e,t){if(M.a.IsTouchDevice()){if(g)return;g=!0,setTimeout(function(){return g=!1},200)}return null!==i._touchFlags.mouseDown.onTimeout&&(clearTimeout(i._touchFlags.mouseDown.timeout),i._touchFlags.mouseDown.onTimeout(),i._touchFlags.mouseDown.onTimeout=null),h.raiseMouseUp(t),!0},this.add_workspaceMouseUp(this._mouseUpDelegate),this._resizeDelegate=this._onResize.bind(this),h.add_workspaceSizeChanged(this._resizeDelegate),this._resizeCheckIntervalId=this._intervalCheckLoop.start({checkFunction:function(){return i._devicePixelRatio!==M.a.devicePixelRatio},onChange:function(){i._devicePixelRatio=M.a.devicePixelRatio,i._onResize(i,!1)}})}},t.prototype._onWorkspaceClick=function(t){e.prototype._onWorkspaceClick.call(this,t);var n=new f.PointF(t.x,t.y),i=this.canvas.getItemHandlersByHitTest(n);null!=i[0]&&i[0].dispatchClickEvent(null)},t.prototype._setActiveElementIeFix=function(){if(M.a.IsIE()){var e=this.element;try{if(!(document.activeElement===e)&&e.setActive){if(!this._setActiveThrowsException)try{e.setActive(!0)}catch(e){this._setActiveThrowsException=!0}if(this._setActiveThrowsException){var t=null;try{t=this._getCurrentScrollPosition()}catch(e){}e.focus(),t&&window.parent.scrollTo(t.x,t.y)}}}catch(e){console.log(e)}}},t.prototype._getCurrentScrollPosition=function(){var e,t,n=null!=window.parent?window.parent:window;return void 0!==n.pageXOffset?(e=n.pageXOffset,t=n.pageYOffset):void 0!==n.scrollX?(e=n.scrollX,t=n.scrollY):document.documentElement&&void 0!==document.documentElement.scrollLeft?(e=document.documentElement.scrollLeft,t=document.documentElement.scrollTop):(e=document.body.scrollLeft,t=document.body.scrollTop),{x:e,y:t}},t.prototype._updateWhitespace=function(){if(null!=this._whitespaceDiv){var e=90===this._contentAngle||270===this._contentAngle,t=e?this.contentHeight:this.contentWidth,n=e?this.contentWidth:this.contentHeight,i=this._getViewportLocation(),o=this.width,r=this.height,a=this.rulerEnabled?this.rulerWidth:0,s=this.scrollBarWidth,l=this.scrollBarsStyle===U.always,c=this.scrollBarsStyle===U.auto,u=l||c&&n>r-a,h=l||c&&t>o-a;u=u||h&&c&&n>r-a-s,h=h||u&&c&&t>o-a-s;var d=u?s:0,p=h?s:0;this._whitespaceDiv.style.left=Math.min(i.x,a)+"px",this._whitespaceDiv.style.top=Math.min(i.y,a)+"px",this._whitespaceDiv.style.width=Math.max(o-a-d,t)+"px",this._whitespaceDiv.style.height=Math.max(r-a-p,n)+"px",c&&(this._holderElement.style.overflowX=h?"auto":"hidden",this._holderElement.style.overflowY=u?"auto":"hidden"),this.canvas.updateButtonGroups()}},t.prototype._updateViewport=function(){e.prototype._updateViewport.call(this),this._updateWhitespace()},t.prototype._onWhitespaceDoubleClick=function(e){var t=this._useWorkspaceCoords(e),n={x:t.x,y:t.y};this._workspaceDoubleClickEvent.notify(this,n)},t.prototype._onWhitespaceMouseDown=function(e){if(!this._isManyTouches(e)){var t=this._useWorkspaceCoords(e);this._workspaceMouseDownEvent.notify(this,t),M.a.IsTouchIE()||this._whitespaceDiv.setCapture()}},t.prototype._onWhitespaceMouseUp=function(e){if(!this._isManyTouches(e)){var t=this._useWorkspaceCoords(e);this._workspaceMouseUpEvent.notify(this,t),this._whitespaceDiv.releaseCapture()}},t.prototype._onWhitespaceMouseMove=function(e){if(this._isManyTouches(e))e.preventDefault();else{var t=this._useWorkspaceCoords(e);this._workspaceMouseMoveEvent.notify(this,t)}},t.prototype._getElementForCursor=function(){return null!=this._whitespaceDiv?this._whitespaceDiv:e.prototype._getElementForCursor.call(this)},t.prototype._onResize=function(t,n){e.prototype._onResize.call(this,t,n);var i=this.canvas;i.service.beginMultiCall(),i.setZoom(this.zoom,void 0,{force:!0,updateButtonGroup:n}),i.service.endMultiCall().finally(function(){return i.redraw()})},t.prototype._onCanvasStatusChanged=function(e){this.canvas.status==o.busy?this.lockViewer():this.unlockViewer()},t.prototype.lockViewer=function(){this._isViewerLocked=!0;var e=this.element,t=document.getElementById(this.id+"_modalBg");if(!t){var n=(t=document.createElement("div")).style;n.position="absolute",n.top="0",n.left="0",this._modalBgClass?t.className=this._modalBgClass:(n.backgroundPosition="50% 50%",n.backgroundColor="#000000",n.opacity="0.4",n.filter="alpha(opacity=40)",n.zIndex="1000"),t.id=this.id+"_modalBg",e.offsetParent&&e.offsetParent.appendChild(t),n.width="100%",n.height="100%",n.bottom="0",n.right="0"}t.style.display="block"},t.prototype.unlockViewer=function(){this._isViewerLocked=!1;var e=document.getElementById(this.id+"_modalBg");e&&(e.style.display="none")},t.prototype.contentToWhitespaceRectangle=function(e){var t=this.rulerEnabled?this.rulerWidth:0,n=this._getViewportLocation();return new f.RectangleF(e.left+n.x-t,e.top+n.y-t,e.width,e.height)},Object.defineProperty(t.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"history",{get:function(){return this._history},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userEditContainer",{get:function(){return this._userEditContainer},set:function(e){var t=this;if(this._userEditContainer!=e){this.canvas.clearSelectedItemHandlers(),this._userEditContainer=e;var n=this.canvas;if(null!=n){var i=this.surface.containers,o=[],r=[],a=i.where(function(e){return e.renderingType!==Pe.RenderingType.Normal}).toArray();null!=this._userEditContainer?(o=i.where(function(e){return e!=t._userEditContainer&&e.renderingType!==Pe.RenderingType.Normal}).toArray(),r=a.slice(a.findIndex(function(e){return t._userEditContainer.id===e.id})+1,a.length)):(o=a,r=a),n.disabledLayers=o.map(function(e){return n.layers.getLayerByContainerId(e.id)}),n.maskedLayers=r.map(function(e){return n.layers.getLayerByContainerId(e.id)}),n.redraw()}this._eventManager.userEditContainerChangedEvent.notify(this._userEditContainer)}},enumerable:!0,configurable:!0}),t.prototype.getUserEditSurface=function(){return this.surface},t.prototype.getUserEditPrintArea=function(){return this.surface.printAreas.get(0)},Object.defineProperty(t.prototype,"variableItemHelper",{get:function(){return this._variableItemHelper},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"productThemeManager",{get:function(){return this._productThemeManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"productHandler",{get:function(){return this._productHandler},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemsDataApplier",{get:function(){return this._itemsDataApplier},enumerable:!0,configurable:!0}),t.prototype.getHandler=function(e){return this._canvas.handlerFactory.get(e)},t.prototype.waitUpdate=function(){return tn(this,void 0,void 0,function(){return nn(this,function(e){switch(e.label){case 0:return[4,this._canvas.waitUpdate()];case 1:return e.sent(),[2]}})})},t.prototype.getParentPosition=function(e){var t=this.element;return{top:e.offsetTop-t.scrollTop,left:e.offsetLeft-t.scrollLeft}},t.prototype.dispose=function(){null!=this._resizeCheckIntervalId&&this._intervalCheckLoop.stop(this._resizeCheckIntervalId);var t=this.canvas;t&&(this._mouseUpDelegate&&(this.remove_workspaceMouseUp(this._mouseUpDelegate),this._mouseUpDelegate=null),this._mouseDownDelegate&&(this.remove_workspaceMouseDown(this._mouseDownDelegate),this._mouseDownDelegate=null),this._mouseMoveDelegate&&(this.remove_workspaceMouseMove(this._mouseMoveDelegate),this._mouseMoveDelegate=null),this._doubleClickDelegate&&(this.remove_workspaceDoubleClick(this._doubleClickDelegate),this._doubleClickDelegate=null),this._zoomDelegate&&(this.remove_zoomed(this._zoomDelegate),this._zoomDelegate=null),this._onCanvasStatusChangedDelegate&&(t.remove_statusChanged(this._onCanvasStatusChangedDelegate),delete this._onCanvasStatusChangedDelegate),this._resizeDelegate&&(t.remove_workspaceSizeChanged(this._resizeDelegate),delete this._resizeDelegate),t.dispose()),null!=this._eventManager&&this._eventManager.dispose(),null!=this.safetyLinesHandler&&this.safetyLinesHandler.dispose(),this.surface.containers.remove_itemAdded(this._onCurrentSurfaceContainerAdded),e.prototype.dispose.call(this)},t.prototype._refresh=function(){this._refreshTimer&&window.clearTimeout(this._refreshTimer),this._needToRefresh=!1},t.preventKeyHandleClass="preventCanvasKeyHandle",t.preventClickHandleClass="preventCanvasClickHandle",t}(be)}}]);